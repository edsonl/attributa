import{G as J,h as r,s as w,x as le,c as oe,A as ne,B as x,r as I,I as C,i as k,t as O,v as U,N}from"./vendor-quasar-DYxT2uMy.js";import{f as F,A as L,F as c,B as l,K as M,L as m,r as i,w as z,E as p,C as e,O as u,u as g,N as se,P as re,_ as ie,J as E,j as S,G,H as ce,Q as K,S as H}from"./vendor-D6jaF0sv.js";import{q as f}from"./qtable-pt-CkdICETI.js";const ue={__name:"StatusChip",props:{value:{type:[Boolean,Number],required:!0}},setup(P){const s=P,V=F(()=>s.value?"Ativo":"Inativo"),d=F(()=>s.value?"positive":"negative");return(n,R)=>(c(),L(J,{dense:"",color:d.value,"text-color":"white"},{default:l(()=>[M(m(V.value),1)]),_:1},8,["color"]))}},de={class:"tw-space-y-3"},pe={class:"tw-flex tw-items-center tw-justify-between tw-flex-col sm:tw-flex-row tw-gap-3"},ge={class:"tw-flex tw-gap-3 tw-flex-col md:tw-flex-row"},me={class:"tw-flex tw-items-center tw-gap-2 tw-flex-wrap"},fe={key:0,class:"tw-text-sm tw-text-gray-600"},we={key:1},ve={key:0,class:"tw-text-center tw-py-6"},he={class:"tw-text-sm tw-text-gray-600"},_e={key:0,class:"tw-text-center tw-py-6"},ye={key:1,class:"tw-text-sm tw-text-gray-600"},be={key:2,class:"tw-flex tw-flex-wrap tw-gap-2 tw-max-h-96 tw-overflow-y-auto"},Ne={__name:"Index",props:{campaigns:{type:Object,required:!0},filters:{type:Object,default:()=>({})}},setup(P){const s=P,V=F(()=>s.campaigns?.data??[]),d=i(s.filters?.search??""),n=i({page:s.campaigns?.current_page??1,rowsPerPage:s.campaigns?.per_page??15,rowsNumber:s.campaigns?.total??0,sortBy:s.filters?.sort??"created_at",descending:(s.filters?.direction??"desc")==="desc"});z(()=>s.campaigns,t=>{t&&(n.value.page=t.current_page,n.value.rowsPerPage=t.per_page,n.value.rowsNumber=t.total)}),z(()=>s.filters,t=>{n.value.sortBy=t?.sort??"created_at",n.value.descending=(t?.direction??"desc")==="desc",(t?.search??"")!==d.value&&(d.value=t?.search??"")});const R=[{name:"code",label:"Código",field:"code",align:"left",sortable:!0},{name:"name",label:"Nome",field:"name",align:"left",sortable:!0},{name:"countries",label:"Países",field:"countries",align:"left"},{name:"channel",label:"Canal",field:t=>t.channel?.name??"-",align:"left"},{name:"conversion_goal",label:"Meta de conversao",field:t=>t.conversion_goal?.goal_code??"-",align:"left"},{name:"status",label:"Status",field:"status",align:"center",sortable:!0},{name:"tracking_snippet",label:"Acompanhamento",field:"code",align:"left"},{name:"actions",label:"Ações",field:"actions",align:"right"}],D=i(!1),Q=i(!1),v=i(""),h=i(null),B=i(!1),T=i(!1),_=i(""),j=i(0),y=i([]);function q(){const t={page:n.value.page,per_page:n.value.rowsPerPage,sort:n.value.sortBy,direction:n.value.descending?"desc":"asc",search:d.value||void 0};K.get(route("panel.campaigns.index"),t,{preserveState:!0,preserveScroll:!0,replace:!0})}function W({pagination:t}){Object.assign(n.value,t),q()}function A(){n.value.page=1,q()}function X(){d.value!==""&&(d.value="",n.value.page=1,q())}function b(t){return t?.hashid??t?.id}function Y(t){K.visit(route("panel.campaigns.edit",b(t)))}function Z(t){confirm(`Deseja realmente remover a campanha "${t.name}"?`)&&K.delete(route("panel.campaigns.destroy",b(t)))}async function ee(t){const o=b(t);if(o){D.value=!0,Q.value=!0,v.value="";try{const a=await H.get(route("panel.campaigns.tracking_code",o));v.value=String(a.data.script||"").trim()}catch{N.create({type:"negative",message:"Não foi possível carregar o código de acompanhamento",position:"top-right"})}finally{Q.value=!1}}}async function ae(t){const o=b(t);if(o){B.value=!0,T.value=!0,_.value=t?.name??"Campanha",j.value=Number(t?.countries_count??0),y.value=[];try{const a=await H.get(route("panel.campaigns.countries",o));_.value=String(a.data?.campaign?.name??_.value),j.value=Number(a.data?.campaign?.countries_count??0),y.value=Array.isArray(a.data?.countries)?a.data.countries:[]}catch{N.create({type:"negative",message:"Não foi possível carregar a lista de países",position:"top-right"})}finally{T.value=!1}}}function te(){if(h.value){h.value.focus(),h.value.select();try{if(!document.execCommand("copy"))throw new Error;N.create({type:"positive",message:"Código copiado",timeout:2e3,position:"top-right"})}catch{N.create({type:"negative",message:"Não foi possível copiar o código",timeout:3e3,position:"top-right"})}}}return(t,o)=>(c(),p(G,null,[e(g(se),{title:"Campanhas"}),u("div",de,[u("div",pe,[o[4]||(o[4]=u("h1",{class:"tw-text-lg tw-font-semibold"}," Campanhas ",-1)),e(g(re),{href:t.route("panel.campaigns.create")},{default:l(()=>[e(r,{color:"positive",icon:"add",label:"Nova Campanha",unelevated:""})]),_:1},8,["href"])]),e(I,{flat:"",bordered:""},{default:l(()=>[e(w,{class:"tw-space-y-3"},{default:l(()=>[u("div",ge,[e(le,{modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=a=>d.value=a),dense:"",outlined:"",clearable:"",placeholder:"Pesquisar por código ou nome",class:"md:tw-flex-1",onKeyup:ie(A,["enter"]),onClear:X},{append:l(()=>[e(oe,{name:"search",class:"cursor-pointer",onClick:A})]),_:1},8,["modelValue"]),e(r,{outline:"",color:"primary",icon:"search",label:"Filtrar",class:"md:tw-w-auto",onClick:A})]),e(ne,{flat:"",rows:V.value,columns:R,"row-key":"id","binary-state-sort":"",pagination:n.value,"onUpdate:pagination":o[1]||(o[1]=a=>n.value=a),"rows-per-page-options":[10,15,25,50],"no-data-label":g(f).noData,"no-results-label":g(f).noResults,"loading-label":g(f).loading,"rows-per-page-label":g(f).recordsPerPage,"all-rows-label":g(f).allRows,"pagination-label":g(f).pagination,onRequest:W},{"body-cell-countries":l(a=>[e(x,{props:a},{default:l(()=>[u("div",me,[Number(a.row.countries_count??0)===0?(c(),p("span",fe," 0 país(es) ")):(c(),p("span",we,m((a.row.countries_preview??[]).join(", ")),1)),Number(a.row.countries_hidden_count??0)>0?(c(),L(r,{key:2,flat:"",dense:"","no-caps":"",color:"primary",label:`(+${a.row.countries_hidden_count??0})`,onClick:$=>ae(a.row)},null,8,["label","onClick"])):E("",!0)])]),_:2},1032,["props"])]),"body-cell-status":l(a=>[e(x,{props:a,class:"tw-text-center"},{default:l(()=>[e(ue,{value:a.row.status},null,8,["value"])]),_:2},1032,["props"])]),"body-cell-tracking_snippet":l(a=>[e(x,{props:a},{default:l(()=>[e(r,{flat:"",dense:"",size:"sm",icon:"code",color:"primary",label:"Snippet",onClick:$=>ee(a.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-actions":l(a=>[e(x,{props:a,class:"tw-text-right"},{default:l(()=>[e(r,{flat:"",dense:"",size:"sm",icon:"edit",color:"primary",onClick:$=>Y(a.row)},null,8,["onClick"]),e(r,{flat:"",dense:"",size:"sm",icon:"delete",color:"negative",onClick:$=>Z(a.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","pagination","no-data-label","no-results-label","loading-label","rows-per-page-label","all-rows-label","pagination-label"])]),_:1})]),_:1})]),e(U,{modelValue:D.value,"onUpdate:modelValue":o[2]||(o[2]=a=>D.value=a)},{default:l(()=>[e(I,{style:{"min-width":"720px","max-width":"95vw","min-height":"450px"}},{default:l(()=>[e(w,{class:"tw-flex tw-justify-between tw-items-center"},{default:l(()=>[o[5]||(o[5]=u("div",{class:"tw-text-lg tw-font-semibold"}," Código de acompanhamento ",-1)),S(e(r,{flat:"",dense:"",icon:"close"},null,512),[[C]])]),_:1}),e(k),e(w,null,{default:l(()=>[Q.value?(c(),p("div",ve," Carregando... ")):E("",!0),u("textarea",{ref_key:"trackingTextarea",ref:h,class:"tw-w-full tw-h-72 tw-font-mono tw-text-sm tw-p-3 tw-bg-gray-100 tw-rounded",readonly:""},m(v.value),513)]),_:1}),e(k),e(O,{align:"right"},{default:l(()=>[e(r,{flat:"",icon:"content_copy",label:"Copiar",disable:!v.value,onClick:te},null,8,["disable"]),S(e(r,{color:"primary",label:"Fechar"},null,512),[[C]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(U,{modelValue:B.value,"onUpdate:modelValue":o[3]||(o[3]=a=>B.value=a)},{default:l(()=>[e(I,{style:{"min-width":"620px","max-width":"95vw","max-height":"85vh"}},{default:l(()=>[e(w,{class:"tw-flex tw-items-center tw-justify-between"},{default:l(()=>[u("div",null,[o[6]||(o[6]=u("div",{class:"tw-text-lg tw-font-semibold"}," Países da campanha ",-1)),u("div",he,m(_.value)+" · "+m(j.value)+" país(es) ",1)]),S(e(r,{flat:"",dense:"",icon:"close"},null,512),[[C]])]),_:1}),e(k),e(w,null,{default:l(()=>[T.value?(c(),p("div",_e," Carregando... ")):y.value.length?(c(),p("div",be,[(c(!0),p(G,null,ce(y.value,a=>(c(),L(J,{key:a.id,dense:"",square:""},{default:l(()=>[M(m(a.name)+" ("+m(a.iso2)+") ",1)]),_:2},1024))),128))])):(c(),p("div",ye," Nenhum país encontrado para esta campanha. "))]),_:1}),e(k),e(O,{align:"right"},{default:l(()=>[S(e(r,{color:"primary",label:"Fechar"},null,512),[[C]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{Ne as default};
