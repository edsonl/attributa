import{u as te,E as le,h as k,A as oe,B as i,k as L,c as M,n as z,r as ne}from"./vendor-quasar-DYxT2uMy.js";import{r as f,f as ie,w as re,e as se,E as p,F as r,C as o,u as j,N as ce,B as l,O as n,A as h,K as _,L as u,J as P,M as V,G as de,S as C}from"./vendor-D6jaF0sv.js";import ue from"./pageviewdetailmodal-CYv31z3A.js";import{_ as fe}from"../app-7BtKpvhq.js";const ge={class:"row q-mb-md items-center q-col-gutter-md"},me={class:"col-12 col-md-4 q-mb-sm q-mb-md-0"},ve={class:"col-12 col-md-4 col-lg-3 q-mt-sm q-mt-md-0 q-pl-md-sm"},we={class:"tw-flex tw-items-center tw-gap-1"},pe={class:"tw-flex tw-items-center tw-gap-2"},be={class:"tw-flex tw-items-center tw-gap-2 tw-flex-wrap"},_e={key:0,class:"tw-inline-flex tw-items-center tw-gap-1"},ye={key:1},he={key:2},Ce={key:3,class:"tw-text-slate-400"},xe={key:4,class:"tw-inline-flex tw-items-center tw-gap-1"},ke={class:"tw-flex tw-items-center tw-gap-2"},Le=["src","alt"],Pe={__name:"Pageviews",setup(Be){const R=f([]),w=f(!1),G=f(null),g=te(),m=f({page:1,rowsPerPage:20,rowsNumber:0,sortBy:"created_at",descending:!0}),x=f(null),T=f([]),B={label:"Não determinado",color:"#FCE7F3",description:"Categoria ainda não determinada."},D=f(!1),$=f(!1),N=f(null),b=f([]),q=ie(()=>b.value.length>0),F="https://attributa.master.dev.br".replace(/\/$/,""),O=[{name:"created_at",label:"Data",field:"created_at_formatted",sortable:!0,align:"left"},{name:"ip",label:"Classificação / IP",field:"ip",sortable:!0,align:"left"},{name:"campaign_name",label:"Campanha",field:"campaign_name",sortable:!0,align:"left"},{name:"traffic_source",label:"Origem do Tráfego",field:"traffic_source_name",sortable:!0,align:"left"},{name:"device_browser",label:"Dispositivo/Navegador",field:a=>J(a),sortable:!0,align:"left"},{name:"country_code",label:"País",field:"country_code",sortable:!0,align:"left"},{name:"region_name",label:"Região",field:"region_name",sortable:!0,align:"left"},{name:"city",label:"Cidade",field:"city",sortable:!0,align:"left"},{name:"gclid",label:"GCLID",field:"has_gclid",sortable:!0,align:"left"},{name:"conversion",label:"Conversão",field:"conversion",sortable:!0,align:"left"},{name:"details",label:"Detalhes",field:"id",align:"center"},{name:"actions",label:"Ações",field:"id",align:"right"}];function Q(a){return{label:a?.ip_category_name??B.label,color:a?.ip_category_color??B.color,description:a?.ip_category_description??B.description}}function S(a){return{label:a?.traffic_source_name??"-",icon:a?.traffic_source_icon||"help_outline",color:a?.traffic_source_color||"#64748B"}}function E(a){const t=a?.country_code;if(!t)return null;const e=String(t).toLowerCase();return`${F}/assets/country-flags/${e}.svg`}function K(a){return a===!0||a===1||a==="1"}function W(a){return a===!0||a===1||a==="1"?!0:typeof a=="string"?a.trim().length>0&&a!=="0":!1}function A(a){const t=String(a||"").trim();return t?t.split(/[_\s-]+/).filter(Boolean).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"-"}function J(a){const t=A(a?.device_type),e=String(a?.browser_name||"").trim()||"-";return t==="-"&&e==="-"?"-":t==="-"?e:e==="-"?t:`${t} • ${e}`}function s(a){return{deviceLabel:A(a?.device_type),deviceIcon:a?.device_icon||"devices_other",deviceColor:a?.device_color||"#64748B",browserLabel:String(a?.browser_name||"").trim()||"-"}}function I(a){return s(a).deviceLabel!=="-"}async function Y(a,t="Valor"){if(a)try{await navigator.clipboard.writeText(String(a)),g.notify({type:"positive",message:`${t} copiado.`})}catch{g.notify({type:"negative",message:`Não foi possível copiar ${t.toLowerCase()}.`})}}function H(){C.get(route("panel.atividade.campaigns")).then(a=>{T.value=a.data})}function y(a){w.value=!0;const{page:t,rowsPerPage:e,sortBy:c,descending:d}=a.pagination;return C.get(route("panel.atividade.pageviews.data"),{params:{page:t,per_page:e,sortBy:c,descending:d,campaign_id:x.value}}).then(v=>{R.value=v.data.data,b.value=[],m.value={...m.value,page:v.data.current_page,rowsPerPage:v.data.per_page,rowsNumber:v.data.total,sortBy:c,descending:d}}).finally(()=>{w.value=!1})}async function X(a){if(!a)return;let t=!0;const e=typeof window<"u",c=e?window.$confirm:null;if(c?t=await c({title:"Excluir pageview",message:"Esta ação é permanente. Deseja realmente remover?",okLabel:"Remover",okColor:"negative"}):e&&(t=window.confirm("Excluir este pageview?")),!!t){w.value=!0;try{const{data:d}=await C.delete(route("panel.atividade.pageviews.destroy",a));if(d?.deleted===!1){g.notify({type:"warning",message:d?.message||"Pageview convertido não pode ser excluído."});return}g.notify({type:"positive",message:d?.message||"Pageview excluído com sucesso."}),await y({pagination:m.value})}catch{g.notify({type:"negative",message:"Falha ao excluir pageview."})}finally{w.value=!1}}}async function Z(){if(!q.value)return;let a=!0;const t=typeof window<"u",e=t?window.$confirm:null,c=`Você selecionou ${b.value.length} registro(s). Deseja remover?`;if(e?a=await e({title:"Remover pageviews",message:c,okLabel:"Remover",okColor:"negative"}):t&&(a=window.confirm(c)),!!a){w.value=!0;try{const{data:d}=await C.delete(route("panel.atividade.pageviews.bulk-destroy"),{data:{ids:b.value.map(ae=>ae.id)}}),v=Number(d?.deleted||0),U=Number(d?.ignored_converted||0);v>0&&U>0?g.notify({type:"warning",message:`${v} removido(s). ${U} convertido(s) ignorado(s).`}):v>0?g.notify({type:"positive",message:d?.message||"Pageviews excluídos com sucesso."}):g.notify({type:"warning",message:d?.message||"Nenhum pageview elegível para exclusão."}),await y({pagination:m.value})}catch{g.notify({type:"negative",message:"Falha ao remover os pageviews selecionados."})}finally{w.value=!1}}}async function ee(a){D.value=!0,$.value=!0,N.value=null;try{const t=await C.get(route("panel.atividade.pageviews.show",a.id));N.value=t.data}finally{$.value=!1}}return re(x,()=>{m.value.page=1,y({pagination:m.value})}),se(()=>{H(),y({pagination:m.value})}),(a,t)=>(r(),p(de,null,[o(j(ce),{title:"Relatório de atividade"}),o(ne,{flat:"",bordered:"",class:"tw-rounded-2xl tw-p-4"},{default:l(()=>[n("div",ge,[n("div",me,[o(le,{ref_key:"tableRef",ref:G,modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=e=>x.value=e),options:T.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",clearable:"",label:"Filtrar por campanha"},null,8,["modelValue","options"])]),n("div",ve,[o(k,{color:"negative",label:"Remover selecionados",disable:!q.value,onClick:Z,class:"tw-w-full lg:tw-w-auto bulk-delete-btn"},null,8,["disable"])])]),o(oe,{rows:R.value,columns:O,"row-key":"id",loading:w.value,pagination:m.value,"onUpdate:pagination":t[1]||(t[1]=e=>m.value=e),"binary-state-sort":!0,onRequest:y,selection:"multiple",selected:b.value,"onUpdate:selected":t[2]||(t[2]=e=>b.value=e)},{"body-cell-created_at":l(e=>[o(i,{props:e},{default:l(()=>[_(u(e.value),1)]),_:2},1032,["props"])]),"body-cell-ip":l(e=>[o(i,{props:e},{default:l(()=>[n("div",we,[n("span",{class:"tw-inline-flex tw-h-3 tw-w-3 tw-rounded-full tw-border tw-border-white/20 tw-shadow-sm",style:V({backgroundColor:Q(e.row).color})},null,4),n("span",null,u(e.value||"-"),1),e.value?(r(),h(k,{key:0,dense:"",flat:"",round:"",size:"sm",icon:"content_copy",color:"primary",onClick:c=>Y(e.value,"IP")},{default:l(()=>[o(z,null,{default:l(()=>[...t[4]||(t[4]=[_("Copiar IP",-1)])]),_:1})]),_:1},8,["onClick"])):P("",!0),o(z,{class:"tw-text-xs tw-max-w-xs tw-leading-snug"},{default:l(()=>[_(u(Q(e.row).description),1)]),_:2},1024)])]),_:2},1032,["props"])]),"body-cell-campaign_name":l(e=>[o(i,{props:e},{default:l(()=>[_(u(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-traffic_source":l(e=>[o(i,{props:e},{default:l(()=>[n("div",pe,[o(M,{name:S(e.row).icon,size:"18px",color:"primary",style:V({color:S(e.row).color})},null,8,["name","style"]),n("span",null,u(S(e.row).label),1)])]),_:2},1032,["props"])]),"body-cell-device_browser":l(e=>[o(i,{props:e},{default:l(()=>[n("div",be,[I(e.row)?(r(),p("div",_e,[o(M,{name:s(e.row).deviceIcon,size:"18px",style:V({color:s(e.row).deviceColor})},null,8,["name","style"]),n("span",null,u(s(e.row).deviceLabel),1)])):s(e.row).browserLabel==="-"?(r(),p("span",ye,"-")):(r(),p("span",he,u(s(e.row).browserLabel),1)),I(e.row)&&s(e.row).browserLabel&&s(e.row).browserLabel!=="-"?(r(),p("span",Ce," • ")):P("",!0),I(e.row)&&s(e.row).browserLabel&&s(e.row).browserLabel!=="-"?(r(),p("div",xe,[n("span",null,u(s(e.row).browserLabel),1)])):P("",!0)])]),_:2},1032,["props"])]),"body-cell-country_code":l(e=>[o(i,{props:e},{default:l(()=>[n("div",ke,[E(e.row)?(r(),p("img",{key:0,src:E(e.row),alt:e.value,class:"tw-w-6 tw-h-4 tw-rounded-sm tw-object-cover tw-border tw-border-gray-200"},null,8,Le)):P("",!0),n("span",null,u(e.value?e.value.toUpperCase():"-"),1)])]),_:2},1032,["props"])]),"body-cell-region_name":l(e=>[o(i,{props:e},{default:l(()=>[_(u(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-city":l(e=>[o(i,{props:e},{default:l(()=>[_(u(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-gclid":l(e=>[o(i,{props:e},{default:l(()=>[W(e.value)?(r(),h(L,{key:0,color:"primary",label:"Sim"})):(r(),h(L,{key:1,color:"grey-4","text-color":"dark",label:"Não"}))]),_:2},1032,["props"])]),"body-cell-conversion":l(e=>[o(i,{props:e},{default:l(()=>[K(e.value)?(r(),h(L,{key:0,color:"green",label:"Convertido"})):(r(),h(L,{key:1,color:"grey-4","text-color":"dark",label:"Não convertido"}))]),_:2},1032,["props"])]),"body-cell-details":l(e=>[o(i,{props:e},{default:l(()=>[o(k,{dense:"",flat:"",round:"",size:"sm",icon:"manage_search",color:"primary",onClick:c=>ee(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-actions":l(e=>[o(i,{props:e,class:"tw-text-right"},{default:l(()=>[o(k,{dense:"",flat:"",icon:"delete",color:"negative",onClick:c=>X(e.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","selected"])]),_:1}),o(ue,{modelValue:D.value,"onUpdate:modelValue":t[3]||(t[3]=e=>D.value=e),loading:$.value,payload:N.value,"asset-base-url":j(F)},null,8,["modelValue","loading","payload","asset-base-url"])],64))}},Ie=fe(Pe,[["__scopeId","data-v-e3ca3e85"]]);export{Ie as default};
