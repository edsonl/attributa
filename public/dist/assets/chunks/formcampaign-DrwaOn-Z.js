import{A as O,H as K,S as we,e as c,J as be,T as ye,v as P,w as A,K as z,l as N,x as J,y as W,Q as he,a as Se,b as X,E as Ce,U as Y,N as U}from"./vendor-quasar-Bee0Lbku.js";import{f as m,r as g,w as b,$ as xe,G as f,H as p,Q as u,E as l,C as I,M as y,u as i,O as v,D as s,I as $,J as Z,N as j,V as ke,a0 as ee,j as ae,R as Ve}from"./vendor-BB0I-wvh.js";import{_ as Ae}from"../app-BhEibbii.js";const Ne={class:"tw-grid tw-grid-cols-1 lg:tw-grid-cols-2 tw-gap-4"},Qe={class:"campaign-status-block"},Be={key:0,class:"campaign-status-error"},Le={class:"tw-flex tw-items-center tw-gap-2 tw-py-1 tw-min-h-8 tw-w-full"},De={class:"tw-flex tw-items-center tw-flex-wrap tw-gap-2"},Oe={key:0,class:"tw-text-gray-500"},Ue={class:"tw-flex tw-justify-end tw-gap-2"},Ie={key:0,class:"tw-text-center tw-py-6"},$e={class:"tw-flex tw-items-center tw-justify-between tw-gap-2"},je={class:"tw-text-sm tw-text-gray-600"},Ee={class:"tw-flex tw-gap-2"},Te={class:"tw-border tw-rounded tw-max-h-96 tw-overflow-y-auto tw-p-2"},Fe={key:0,class:"tw-text-sm tw-text-gray-500 tw-p-3"},te=74,Ge={__name:"FormCampaign",props:{campaign:{type:Object,default:null},channels:{type:Array,default:()=>[]},countries:{type:Array,required:!0},affiliate_platforms:{type:Array,required:!0},googleAdsAccounts:{type:Array,required:!0},conversionGoals:{type:Array,required:!0},campaignStatuses:{type:Array,required:!0},defaults:{type:Object,default:()=>({})}},setup(E){const n=E,oe=m(()=>!!n.campaign),_=g(n.countries??[]),h=g(!1),S=g(""),d=g([]),T=m(()=>(n.affiliate_platforms??[]).map(e=>({...e,value:String(e.id),label:e.label??e.name}))),le=m(()=>(n.googleAdsAccounts??[]).map(e=>({...e,value:String(e.id),label:e.label}))),F=m(()=>(n.conversionGoals??[]).map(e=>({...e,value:String(e.id),label:e.active===!1?`${e.label??e.goal_code} (inativa)`:e.label??e.goal_code}))),G=m(()=>(n.campaignStatuses??[]).map(e=>({...e,value:String(e.id),label:e.label??e.name})));b(()=>n.countries,(e=[])=>{_.value=e;const a=new Set(e.map(t=>String(t.id)));o.countries=(o.countries??[]).filter(t=>a.has(String(t))),d.value=(d.value??[]).filter(t=>a.has(String(t)))});function C(e,a=[]){if(e==null||e==="")return e;const t=a.find(r=>String(r?.value)===String(e));return t?t.value:e}function w(e){return e==null||e===""?null:String(e)}const o=xe({name:n.campaign?.name??"",product_url:n.campaign?.product_url??"",campaign_status_id:w(n.campaign?.campaign_status_id??n.defaults?.campaign_status_id??null),conversion_goal_id:w(n.campaign?.conversion_goal_id),channel_id:w(n.defaults?.channel_id??n.campaign?.channel_id??null),affiliate_platform_id:w(n.campaign?.affiliate_platform_id??n.defaults?.affiliate_platform_id??null),google_ads_account_id:w(n.campaign?.google_ads_account_id),countries:n.campaign?.countries?n.campaign.countries.map(e=>e.id):[],commission_value:n.campaign?.commission_value??null}),ne=m(()=>String(o.name||"").length);b(T,e=>{o.affiliate_platform_id=C(o.affiliate_platform_id,e)},{immediate:!0}),b(F,e=>{o.conversion_goal_id=C(o.conversion_goal_id,e)},{immediate:!0}),b(G,e=>{o.campaign_status_id=C(o.campaign_status_id,e)},{immediate:!0}),b(le,e=>{o.google_ads_account_id=C(o.google_ads_account_id,e)},{immediate:!0});const M=m(()=>{if(o.errors.countries)return o.errors.countries;const e=Object.entries(o.errors).find(([a])=>a.startsWith("countries."));return e?e[1]:null}),R=m(()=>{const e=new Map;for(const a of _.value)e.set(String(a.id),a);return e}),q=m(()=>(o.countries??[]).map(e=>R.value.get(String(e))).filter(Boolean)),Q=m(()=>{const e=S.value.trim().toLowerCase();return e?_.value.filter(a=>{const t=(a.name??"").toLowerCase(),r=(a.iso2??"").toLowerCase(),V=(a.iso3??"").toLowerCase();return t.includes(e)||r.includes(e)||V.includes(e)}):_.value}),ie=m(()=>(d.value??[]).map(e=>R.value.get(String(e))).filter(Boolean)),se=m(()=>{const e=ie.value;if(!e.length)return"Nenhum país selecionado";const a=5,t=70,r=e.slice(0,a).map(_e=>_e.name).join(", "),V=e.length-a,H=r.length>t?`${r.slice(0,t).trim()} (...)`:r;return V>0?`${H} (+${V})`:H});function re(){const e=n.campaign?.hashid??n.campaign?.id;oe.value?o.put(route("panel.campaigns.update",e)):o.post(route("panel.campaigns.store"))}function ue(e){o.countries=(o.countries??[]).filter(a=>String(a)!==String(e))}function de(){d.value=[...o.countries??[]],S.value="",h.value=!0}function B(){h.value=!1}function ce(){o.countries=[...d.value??[]],B()}function me(){const e=new Set((d.value??[]).map(a=>String(a)));for(const a of Q.value)e.add(String(a.id));d.value=_.value.filter(a=>e.has(String(a.id))).map(a=>a.id)}function pe(){d.value=[]}function ge(e){const a=new Set((d.value??[]).map(r=>String(r))),t=String(e);a.has(t)?a.delete(t):a.add(t),d.value=_.value.filter(r=>a.has(String(r.id))).map(r=>r.id)}const L=g(!1),D=g(!1),x=g(""),k=g(null);async function fe(){const e=n.campaign?.hashid??n.campaign?.id;if(e){L.value=!0,D.value=!0,x.value="";try{const a=await Ve.get(route("panel.campaigns.tracking_code",e));x.value=String(a.data.script||"").trim()}catch{U.create({type:"negative",message:"Não foi possível carregar o código de acompanhamento",position:"top-right"})}finally{D.value=!1}}}function ve(){if(k.value){k.value.focus(),k.value.select();try{if(!document.execCommand("copy"))throw new Error;U.create({type:"positive",message:"Código copiado",timeout:2e3,position:"top-right"})}catch{U.create({type:"negative",message:"Não foi possível copiar o código",timeout:3e3,position:"top-right"})}}}return(e,a)=>(p(),f($,null,[u("form",{onSubmit:ee(re,["prevent"]),class:"tw-space-y-6"},[u("div",Ne,[l(O,{modelValue:i(o).name,"onUpdate:modelValue":a[0]||(a[0]=t=>i(o).name=t),label:"Nome da campanha",maxlength:te,hint:`${ne.value}/${te} caracteres`,counter:"",outlined:"",dense:"",error:!!i(o).errors.name,"error-message":i(o).errors.name},null,8,["modelValue","hint","error","error-message"]),l(O,{modelValue:i(o).product_url,"onUpdate:modelValue":a[1]||(a[1]=t=>i(o).product_url=t),label:"URL do produto autorizada",hint:"Exemplo: https://biovitania.online",outlined:"",dense:"",error:!!i(o).errors.product_url,"error-message":i(o).errors.product_url},null,8,["modelValue","error","error-message"]),l(K,{modelValue:i(o).affiliate_platform_id,"onUpdate:modelValue":a[2]||(a[2]=t=>i(o).affiliate_platform_id=t),options:T.value,"option-label":"label","option-value":"value","emit-value":"","map-options":"",label:"Plataforma de Afiliado",outlined:"",dense:"",error:!!i(o).errors.affiliate_platform_id,"error-message":i(o).errors.affiliate_platform_id},null,8,["modelValue","options","error","error-message"]),u("div",Qe,[a[11]||(a[11]=u("div",{class:"campaign-status-label"}," Status da campanha ",-1)),l(we,{modelValue:i(o).campaign_status_id,"onUpdate:modelValue":a[3]||(a[3]=t=>i(o).campaign_status_id=t),options:G.value,type:"radio",inline:"",dense:""},null,8,["modelValue","options"]),i(o).errors.campaign_status_id?(p(),f("div",Be,v(i(o).errors.campaign_status_id),1)):y("",!0)]),l(K,{modelValue:i(o).conversion_goal_id,"onUpdate:modelValue":a[4]||(a[4]=t=>i(o).conversion_goal_id=t),options:F.value,"option-value":"value","option-label":"label","emit-value":"","map-options":"",clearable:"",label:"Meta de conversao",hint:"Selecione a meta/codigo de conversao vinculada a campanha",outlined:"",dense:"",error:!!i(o).errors.conversion_goal_id,"error-message":i(o).errors.conversion_goal_id},null,8,["modelValue","options","error","error-message"]),l(ye,{class:"lg:tw-col-span-2",label:"Regiões de segmentação (países)",outlined:"",dense:"","stack-label":"",error:!!M.value,"error-message":M.value},{control:s(()=>[u("div",Le,[l(c,{flat:"",dense:"",icon:"travel_explore",label:"Selecionar",onClick:de}),u("div",De,[(p(!0),f($,null,Z(q.value,t=>(p(),I(be,{key:t.id,removable:"",dense:"",square:"",onRemove:r=>ue(t.id)},{default:s(()=>[j(v(t.name),1)]),_:2},1032,["onRemove"]))),128)),q.value.length?y("",!0):(p(),f("span",Oe," Nenhum país selecionado "))])])]),_:1},8,["error","error-message"])]),E.campaign?(p(),I(c,{key:0,flat:"",icon:"code",color:"primary",label:"Ver código de acompanhamento",onClick:fe})):y("",!0),u("div",Ue,[l(c,{flat:"",label:"Cancelar",onClick:a[5]||(a[5]=t=>i(ke).visit(e.route("panel.campaigns.index")))}),l(c,{color:"primary",label:"Salvar",type:"submit"})])],32),l(W,{modelValue:L.value,"onUpdate:modelValue":a[6]||(a[6]=t=>L.value=t)},{default:s(()=>[l(P,{style:{"min-width":"750px","max-width":"95vw","min-height":"450px"}},{default:s(()=>[l(A,{class:"tw-flex tw-justify-between tw-items-center"},{default:s(()=>[a[12]||(a[12]=u("div",{class:"tw-text-lg tw-font-semibold"}," Código de acompanhamento ",-1)),ae(l(c,{flat:"",dense:"",icon:"close"},null,512),[[z]])]),_:1}),l(N),l(A,null,{default:s(()=>[D.value?(p(),f("div",Ie," Carregando... ")):y("",!0),u("textarea",{ref_key:"trackingTextarea",ref:k,class:"tw-w-full tw-h-72 tw-font-mono tw-text-sm tw-p-3 tw-bg-gray-100 tw-rounded",readonly:""},v(x.value),513)]),_:1}),l(N),l(J,{align:"right"},{default:s(()=>[l(c,{flat:"",icon:"content_copy",label:"Copiar",disable:!x.value,onClick:ve},null,8,["disable"]),ae(l(c,{color:"primary",label:"Fechar"},null,512),[[z]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(W,{modelValue:h.value,"onUpdate:modelValue":a[10]||(a[10]=t=>h.value=t)},{default:s(()=>[l(P,{style:{"min-width":"720px","max-width":"95vw",width:"900px","max-height":"90vh"}},{default:s(()=>[l(A,{class:"tw-flex tw-items-center tw-justify-between"},{default:s(()=>[a[13]||(a[13]=u("div",{class:"tw-flex tw-items-center tw-gap-2 tw-flex-wrap"},[u("div",{class:"tw-text-lg tw-font-semibold"}," Selecionar países "),u("span",{class:"countries-info-badge"}," Se a campanha for global, não é necessário selecionar países. ")],-1)),l(c,{flat:"",dense:"",icon:"close",onClick:B})]),_:1}),l(N),l(A,{class:"tw-space-y-3"},{default:s(()=>[l(O,{modelValue:S.value,"onUpdate:modelValue":a[7]||(a[7]=t=>S.value=t),dense:"",outlined:"",clearable:"",autofocus:"",label:"Buscar país por nome ou código"},null,8,["modelValue"]),u("div",$e,[u("div",je,v(se.value),1),u("div",Ee,[l(c,{flat:"",dense:"",label:"Selecionar filtrados",onClick:me}),l(c,{flat:"",dense:"",label:"Limpar",onClick:pe})])]),u("div",Te,[l(he,{separator:""},{default:s(()=>[(p(!0),f($,null,Z(Q.value,t=>(p(),I(Se,{key:t.id,clickable:"",dense:"",onClick:r=>ge(t.id)},{default:s(()=>[l(X,{avatar:""},{default:s(()=>[l(Ce,{modelValue:d.value,"onUpdate:modelValue":a[8]||(a[8]=r=>d.value=r),val:t.id,onClick:a[9]||(a[9]=ee(()=>{},["stop"]))},null,8,["modelValue","val"])]),_:2},1024),l(X,null,{default:s(()=>[l(Y,null,{default:s(()=>[j(v(t.name),1)]),_:2},1024),l(Y,{caption:""},{default:s(()=>[j(v(t.iso2)+" · "+v(t.iso3),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}),Q.value.length?y("",!0):(p(),f("div",Fe," Nenhum país encontrado para esta busca. "))])]),_:1}),l(N),l(J,{align:"right"},{default:s(()=>[l(c,{flat:"",label:"Cancelar",onClick:B}),l(c,{color:"primary",label:"Aplicar",onClick:ce})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},He=Ae(Ge,[["__scopeId","data-v-428cf948"]]);export{He as default};
