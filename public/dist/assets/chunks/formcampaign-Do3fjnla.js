import{x as k,C as v,h as s,E as G,r as I,s as S,F as A,i as B,t as $,v as H,N as C}from"./vendor-quasar-CLzIisyG.js";import{f as Q,r as i,w as M,_ as W,G as N,H as h,Q as y,E as t,C as z,L as U,u as a,S as J,$ as K,D as d,j,N as X,I as Y,V as Z}from"./vendor-D8nj3W7R.js";const ee={class:"tw-flex tw-justify-end tw-gap-2"},ae={key:0,class:"tw-text-center tw-py-6"},le={__name:"FormCampaign",props:{campaign:{type:Object,default:null},channels:{type:Array,required:!0},countries:{type:Array,required:!0},affiliate_platforms:{type:Array,required:!0},googleAdsAccounts:{type:Array,required:!0},defaults:{type:Object,default:()=>({})}},setup(u){const l=u,D=Q(()=>!!l.campaign),c=i(l.countries??[]),m=i([...l.countries??[]]),_=i(null);M(()=>l.countries,(n=[])=>{c.value=n,m.value=[...n]});const e=W({name:l.campaign?.name??"",pixel_code:l.campaign?.pixel_code??"",status:l.campaign?.status??!0,channel_id:l.campaign?.channel_id??l.defaults?.channel_id??null,affiliate_platform_id:l.campaign?.affiliate_platform_id??l.defaults?.affiliate_platform_id??null,google_ads_account_id:l.campaign?.google_ads_account_id??null,countries:l.campaign?.countries?l.campaign.countries.map(n=>n.id):[],commission_value:l.campaign?.commission_value??null}),x=Q(()=>{if(e.errors.countries)return e.errors.countries;const n=Object.entries(e.errors).find(([o])=>o.startsWith("countries."));return n?n[1]:null});function E(){D.value?e.put(route("panel.campaigns.update",l.campaign.id)):e.post(route("panel.campaigns.store"))}function F(n,o,r){if(!c.value.length)return r();const f=(n||"").trim().toLowerCase();o(()=>{if(!f){m.value=[...c.value];return}m.value=c.value.filter(V=>{const q=(V.name||"").toLowerCase(),O=(V.iso2||"").toLowerCase(),R=(V.iso3||"").toLowerCase();return q.includes(f)||O.includes(f)||R.includes(f)})})}function L(){_.value?.hidePopup&&_.value.hidePopup()}const w=i(!1),b=i(!1),p=i(""),g=i(null);async function P(){if(l.campaign?.id){w.value=!0,b.value=!0,p.value="";try{const n=await Z.get(route("panel.campaigns.tracking_code",l.campaign.id));p.value=String(n.data.script||"").trim()}catch{C.create({type:"negative",message:"Não foi possível carregar o código de acompanhamento",position:"top-right"})}finally{b.value=!1}}}function T(){if(g.value){g.value.focus(),g.value.select();try{if(!document.execCommand("copy"))throw new Error;C.create({type:"positive",message:"Código copiado",timeout:2e3,position:"top-right"})}catch{C.create({type:"negative",message:"Não foi possível copiar o código",timeout:3e3,position:"top-right"})}}}return(n,o)=>(h(),N(Y,null,[y("form",{onSubmit:K(E,["prevent"]),class:"tw-space-y-6"},[t(k,{modelValue:a(e).name,"onUpdate:modelValue":o[0]||(o[0]=r=>a(e).name=r),label:"Nome da campanha",outlined:"",dense:"",error:!!a(e).errors.name,"error-message":a(e).errors.name},null,8,["modelValue","error","error-message"]),t(v,{modelValue:a(e).channel_id,"onUpdate:modelValue":o[1]||(o[1]=r=>a(e).channel_id=r),options:u.channels,"option-label":"name","option-value":"id","emit-value":"","map-options":"",label:"Canal",outlined:"",dense:"",error:!!a(e).errors.channel_id,"error-message":a(e).errors.channel_id},null,8,["modelValue","options","error","error-message"]),t(v,{modelValue:a(e).affiliate_platform_id,"onUpdate:modelValue":o[2]||(o[2]=r=>a(e).affiliate_platform_id=r),options:u.affiliate_platforms,"option-label":"name","option-value":"id","emit-value":"","map-options":"",label:"Plataforma de Afiliado",outlined:"",dense:"",error:!!a(e).errors.affiliate_platform_id,"error-message":a(e).errors.affiliate_platform_id},null,8,["modelValue","options","error","error-message"]),t(v,{ref_key:"countrySelectRef",ref:_,label:"Regiões de segmentação (países)",modelValue:a(e).countries,"onUpdate:modelValue":[o[3]||(o[3]=r=>a(e).countries=r),L],options:m.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",multiple:"","use-chips":"","use-input":"",onFilter:F,outlined:"",dense:"",error:!!x.value,"error-message":x.value},null,8,["modelValue","options","error","error-message"]),t(v,{modelValue:a(e).google_ads_account_id,"onUpdate:modelValue":o[4]||(o[4]=r=>a(e).google_ads_account_id=r),options:u.googleAdsAccounts,"option-value":"id","option-label":"label","emit-value":"","map-options":"",clearable:"",label:"Conta de Anúncios",hint:"Selecione a conta do Google Ads desta campanha",error:!!a(e).errors.google_ads_account_id,"error-message":a(e).errors.google_ads_account_id},null,8,["modelValue","options","error","error-message"]),t(k,{modelValue:a(e).pixel_code,"onUpdate:modelValue":o[5]||(o[5]=r=>a(e).pixel_code=r),label:"Pixel de acompanhamento",outlined:"",dense:"",error:!!a(e).errors.pixel_code,"error-message":a(e).errors.pixel_code},null,8,["modelValue","error","error-message"]),u.campaign?(h(),z(s,{key:0,flat:"",icon:"code",color:"primary",label:"Ver código de acompanhamento",onClick:P})):U("",!0),t(G,{modelValue:a(e).status,"onUpdate:modelValue":o[6]||(o[6]=r=>a(e).status=r),label:"Campanha ativa"},null,8,["modelValue"]),y("div",ee,[t(s,{flat:"",label:"Cancelar",onClick:o[7]||(o[7]=r=>a(J).visit(n.route("panel.campaigns.index")))}),t(s,{color:"primary",label:"Salvar",type:"submit"})])],32),t(H,{modelValue:w.value,"onUpdate:modelValue":o[8]||(o[8]=r=>w.value=r)},{default:d(()=>[t(I,{style:{"min-width":"720px","max-width":"95vw","min-height":"450px"}},{default:d(()=>[t(S,{class:"tw-flex tw-justify-between tw-items-center"},{default:d(()=>[o[9]||(o[9]=y("div",{class:"tw-text-lg tw-font-semibold"}," Código de acompanhamento ",-1)),j(t(s,{flat:"",dense:"",icon:"close"},null,512),[[A]])]),_:1}),t(B),t(S,null,{default:d(()=>[b.value?(h(),N("div",ae," Carregando... ")):U("",!0),y("textarea",{ref_key:"trackingTextarea",ref:g,class:"tw-w-full tw-h-72 tw-font-mono tw-text-sm tw-p-3 tw-bg-gray-100 tw-rounded",readonly:""},X(p.value),513)]),_:1}),t(B),t($,{align:"right"},{default:d(()=>[t(s,{flat:"",icon:"content_copy",label:"Copiar",disable:!p.value,onClick:T},null,8,["disable"]),j(t(s,{color:"primary",label:"Fechar"},null,512),[[A]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{le as default};
