import{u as de,h as i,s as h,x as S,c as ue,A as U,B as w,F as ce,r as D,G as $,i as G,E as ge,t as pe,v as E,H as ve}from"./vendor-quasar-DSLrBDx5.js";import{f as fe,r as v,w as T,E as F,F as M,C as t,O as s,u as n,N as we,B as o,P as me,_ as be,L as b,K as A,j as Q,J as ye,Z as N,M as _e,I as he,G as xe,Q as j,S as q}from"./vendor-D6jaF0sv.js";import{q as g}from"./qtable-pt-CkdICETI.js";const Ce={class:"tw-space-y-3"},ke={class:"tw-flex tw-items-center tw-justify-between tw-flex-col sm:tw-flex-row tw-gap-3"},Se={class:"tw-flex tw-gap-3 tw-flex-col md:tw-flex-row"},Pe={class:"tw-text-xs tw-text-slate-700"},Be={class:"tw-text-xs tw-text-slate-700"},Ve={key:0,class:"tw-rounded-md tw-border tw-border-slate-200 tw-bg-slate-50 tw-p-3 tw-space-y-2"},ze={class:"tw-flex tw-justify-end"},Le={class:"tw-flex tw-items-center tw-gap-3"},Re={class:"tw-text-base tw-font-semibold"},De={class:"tw-inline-flex tw-items-center tw-rounded-full tw-bg-slate-100 tw-px-3 tw-py-1 tw-text-xs tw-font-medium tw-text-slate-600"},$e={class:"tw-flex tw-items-center tw-gap-2"},Ge={class:"tw-flex tw-items-center tw-gap-2"},Qe=["title"],Ie={__name:"Index",props:{conversionGoals:{type:Object,required:!0},logsRetentionDays:{type:Number,default:10},filters:{type:Object,default:()=>({})}},setup(O){const f=O,K=fe(()=>f.conversionGoals?.data??[]),m=v(f.filters?.search??""),c=de(),P=v(!1),d=v(null),x=v(!1),B=v(!1),y=v(!1),V=v(""),C=v([]),u=v({page:1,rowsPerPage:15,rowsNumber:0,sortBy:"created_at",descending:!0}),_=v(null),H=[{name:"created_at",label:"Data",field:"created_at_formatted",align:"left",sortable:!0},{name:"message",label:"Mensagem",field:"message",align:"left",sortable:!1}],r=v({page:f.conversionGoals?.current_page??1,rowsPerPage:f.conversionGoals?.per_page??15,rowsNumber:f.conversionGoals?.total??0,sortBy:f.filters?.sort??"created_at",descending:(f.filters?.direction??"desc")==="desc"});T(()=>f.conversionGoals,a=>{a&&(r.value.page=a.current_page,r.value.rowsPerPage=a.per_page,r.value.rowsNumber=a.total)}),T(()=>f.filters,a=>{r.value.sortBy=a?.sort??"created_at",r.value.descending=(a?.direction??"desc")==="desc",(a?.search??"")!==m.value&&(m.value=a?.search??"")});const J=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"goal_code",label:"Codigo",field:"goal_code",align:"left",sortable:!0},{name:"active",label:"Status",field:"active",align:"center",sortable:!0},{name:"timezone",label:"Timezone",field:a=>a.timezone?.label??a.timezone?.identifier??"-",align:"left"},{name:"campaigns",label:"Campanhas",field:"campaigns",align:"left"},{name:"created_at",label:"Criado em",field:"created_at",align:"left",sortable:!0},{name:"integration",label:"Integracao",field:"integration",align:"center"},{name:"logs",label:"Logs",field:"logs",align:"center"},{name:"actions",label:"Acoes",field:"actions",align:"right"}];function z(){const a={page:r.value.page,per_page:r.value.rowsPerPage,sort:r.value.sortBy,direction:r.value.descending?"desc":"asc",search:m.value||void 0};j.get(route("panel.conversion-goals.index"),a,{preserveState:!0,preserveScroll:!0,replace:!0})}function Z({pagination:a}){Object.assign(r.value,a),z()}function L(){r.value.page=1,z()}function W(){m.value!==""&&(m.value="",r.value.page=1,z())}function k(a){return a?.hashid??a?.id}function X(a){j.visit(route("panel.conversion-goals.edit",k(a)))}function Y(a){const l=(a.campaigns??[]).map(p=>p?.name).filter(Boolean);if(!l.length)return"-";const e=l.join(", ");return e.length<=60?e:`${e.slice(0,60).trimEnd()}...`}function ee(a){c.dialog({title:"Confirmar exclusao",message:`Deseja realmente remover a meta "${a.goal_code}"?`,cancel:{label:"Cancelar",flat:!0},ok:{label:"Excluir",color:"negative",unelevated:!0},persistent:!0}).onOk(()=>{j.delete(route("panel.conversion-goals.destroy",k(a)))})}function ae(a){d.value={id:k(a),url:a.integration_url,username:`googleads-${a.user_slug_id}`,password:a.googleads_password,csv_fake_line_enabled:!!a.csv_fake_line_enabled},P.value=!0}async function te(){if(!(!d.value?.id||x.value)){x.value=!0;try{await q.patch(route("panel.conversion-goals.csv-fake-line",d.value.id),{csv_fake_line_enabled:!!d.value.csv_fake_line_enabled}),c.notify({type:"positive",message:"Configuração de integração salva."})}catch{c.notify({type:"negative",message:"Não foi possível salvar a configuração de integração."})}finally{x.value=!1}}}async function R(a,l){const e=String(a??"");if(e===""){c.notify({type:"warning",message:`${l} vazio.`});return}try{await ve(e),c.notify({type:"positive",message:`${l} copiado.`})}catch{c.notify({type:"negative",message:`Falha ao copiar ${l.toLowerCase()}.`})}}function le(){return c.screen.lt.sm?"width: 96vw; max-width: 96vw; height: 92vh; max-height: 92vh;":c.screen.lt.md?"width: 92vw; max-width: 92vw; height: 90vh; max-height: 90vh;":"width: 70vw; max-width: 70vw; height: 88vh; max-height: 88vh;"}async function I(a,l=null){if(!a)return;y.value=!0;const e=l??u.value;try{const p=await q.get(route("panel.conversion-goals.logs",a),{params:{page:e.page,per_page:e.rowsPerPage,sort:e.sortBy||"created_at",direction:e.descending?"desc":"asc"}});C.value=p.data.data??[],u.value={...u.value,page:p.data.current_page,rowsPerPage:p.data.per_page,rowsNumber:p.data.total,sortBy:e.sortBy||"created_at",descending:!!e.descending}}finally{y.value=!1}}async function oe(a){_.value=k(a),V.value=a.goal_code,C.value=[],u.value={...u.value,page:1,sortBy:"created_at",descending:!0},B.value=!0,await I(_.value,u.value)}async function se({pagination:a}){u.value={...u.value,...a},await I(_.value,u.value)}async function ne(){_.value&&c.dialog({title:"Excluir logs",message:`Deseja excluir todos os logs da meta ${V.value||""}?`,cancel:{label:"Cancelar",flat:!0},ok:{label:"Excluir logs",color:"negative",unelevated:!0},persistent:!0}).onOk(async()=>{y.value=!0;try{await q.delete(route("panel.conversion-goals.logs.destroy",_.value)),C.value=[],u.value={...u.value,page:1,rowsNumber:0},c.notify({type:"positive",message:"Logs removidos com sucesso."})}catch{c.notify({type:"negative",message:"Falha ao remover logs."})}finally{y.value=!1}})}function re(a){return a==="success"?"tw-bg-emerald-500":a==="warning"?"tw-bg-amber-500":a==="error"?"tw-bg-rose-500":"tw-bg-slate-400"}function ie(a){return a==="success"?"Sucesso":a==="warning"?"Atenção":a==="error"?"Erro":"Informação"}return(a,l)=>(M(),F(xe,null,[t(n(we),{title:"Metas de Conversao"}),s("div",Ce,[s("div",ke,[l[9]||(l[9]=s("h1",{class:"tw-text-lg tw-font-semibold"}," Metas de Conversao ",-1)),t(n(me),{href:a.route("panel.conversion-goals.create")},{default:o(()=>[t(i,{color:"positive",icon:"add",label:"Nova Meta",unelevated:""})]),_:1},8,["href"])]),t(D,{flat:"",bordered:""},{default:o(()=>[t(h,{class:"tw-space-y-3"},{default:o(()=>[s("div",Se,[t(S,{modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=e=>m.value=e),dense:"",outlined:"",clearable:"",placeholder:"Pesquisar por codigo",class:"md:tw-flex-1",onKeyup:be(L,["enter"]),onClear:W},{append:o(()=>[t(ue,{name:"search",class:"cursor-pointer",onClick:L})]),_:1},8,["modelValue"]),t(i,{outline:"",color:"primary",icon:"search",label:"Filtrar",class:"md:tw-w-auto",onClick:L})]),t(U,{flat:"",rows:K.value,columns:J,"row-key":"id","binary-state-sort":"",pagination:r.value,"onUpdate:pagination":l[1]||(l[1]=e=>r.value=e),"rows-per-page-options":[10,15,25,50],"no-data-label":n(g).noData,"no-results-label":n(g).noResults,"loading-label":n(g).loading,"rows-per-page-label":n(g).recordsPerPage,"all-rows-label":n(g).allRows,"pagination-label":n(g).pagination,onRequest:Z},{"body-cell-active":o(e=>[t(w,{props:e,class:"tw-text-center"},{default:o(()=>[t(ce,{dense:"",size:"sm",color:e.row.active?"positive":"negative","text-color":"white"},{default:o(()=>[A(b(e.row.active?"Ativo":"Inativo"),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-created_at":o(e=>[t(w,{props:e},{default:o(()=>[A(b(e.row.created_at?new Date(e.row.created_at).toLocaleString("pt-BR"):"-"),1)]),_:2},1032,["props"])]),"body-cell-campaigns":o(e=>[t(w,{props:e},{default:o(()=>[s("span",Pe,b(Y(e.row)),1)]),_:2},1032,["props"])]),"body-cell-timezone":o(e=>[t(w,{props:e},{default:o(()=>[s("span",Be,b(e.row.timezone?.label??e.row.timezone?.identifier??"-"),1)]),_:2},1032,["props"])]),"body-cell-actions":o(e=>[t(w,{props:e,class:"tw-text-right"},{default:o(()=>[t(i,{flat:"",dense:"",size:"sm",icon:"edit",class:"qtable-edit-btn",onClick:p=>X(e.row)},null,8,["onClick"]),t(i,{flat:"",dense:"",size:"sm",icon:"delete",class:"qtable-delete-btn",onClick:p=>ee(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-integration":o(e=>[t(w,{props:e,class:"tw-text-center"},{default:o(()=>[t(i,{flat:"",dense:"",size:"sm",icon:"link",color:"primary",onClick:p=>ae(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-logs":o(e=>[t(w,{props:e,class:"tw-text-center"},{default:o(()=>[t(i,{flat:"",dense:"",size:"sm",icon:"history",label:"Logs",color:"secondary",onClick:p=>oe(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","pagination","no-data-label","no-results-label","loading-label","rows-per-page-label","all-rows-label","pagination-label"])]),_:1})]),_:1}),t(E,{modelValue:P.value,"onUpdate:modelValue":l[6]||(l[6]=e=>P.value=e)},{default:o(()=>[t(D,{style:{"min-width":"620px","max-width":"90vw"}},{default:o(()=>[t(h,{class:"tw-flex tw-items-center tw-justify-between"},{default:o(()=>[l[10]||(l[10]=s("div",{class:"tw-text-base tw-font-semibold"}," Integração Google Ads ",-1)),Q(t(i,{flat:"",round:"",dense:"",icon:"close"},null,512),[[$]])]),_:1}),t(G),t(h,{class:"tw-space-y-4"},{default:o(()=>[t(S,{"model-value":d.value?.url??"",label:"URL CSV",readonly:"",outlined:"",dense:""},{append:o(()=>[t(i,{flat:"",dense:"",icon:"content_copy",onClick:l[2]||(l[2]=N(e=>R(d.value?.url,"URL"),["stop","prevent"]))})]),_:1},8,["model-value"]),t(S,{"model-value":d.value?.username??"",label:"Usuário",readonly:"",outlined:"",dense:""},{append:o(()=>[t(i,{flat:"",dense:"",icon:"content_copy",onClick:l[3]||(l[3]=N(e=>R(d.value?.username,"Usuário"),["stop","prevent"]))})]),_:1},8,["model-value"]),t(S,{"model-value":d.value?.password??"",label:"Senha",readonly:"",outlined:"",dense:""},{append:o(()=>[t(i,{flat:"",dense:"",icon:"content_copy",onClick:l[4]||(l[4]=N(e=>R(d.value?.password,"Senha"),["stop","prevent"]))})]),_:1},8,["model-value"]),d.value?(M(),F("div",Ve,[t(ge,{modelValue:d.value.csv_fake_line_enabled,"onUpdate:modelValue":l[5]||(l[5]=e=>d.value.csv_fake_line_enabled=e),label:"Gerar linha fake no CSV para integração","true-value":!0,"false-value":!1},null,8,["modelValue"]),l[11]||(l[11]=s("div",{class:"tw-text-xs tw-text-slate-600"}," Use este modo apenas para facilitar o mapeamento inicial no Google Ads quando não houver conversões. Recomenda-se desativar após concluir a integração. ",-1)),s("div",ze,[t(i,{color:"primary",unelevated:"",dense:"",label:"Salvar configuração",loading:x.value,onClick:te},null,8,["loading"])])])):ye("",!0)]),_:1}),t(G),t(pe,{align:"right"},{default:o(()=>[Q(t(i,{flat:"",label:"Fechar"},null,512),[[$]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(E,{modelValue:B.value,"onUpdate:modelValue":l[8]||(l[8]=e=>B.value=e),maximized:n(c).screen.lt.sm},{default:o(()=>[t(D,{style:_e(le())},{default:o(()=>[t(h,{class:"tw-flex tw-items-center tw-justify-between"},{default:o(()=>[s("div",Le,[s("div",Re," Logs da Meta "+b(V.value||"-"),1),s("span",De," Os logs são armazenados temporariamente e serão excluídos após "+b(f.logsRetentionDays)+" dias. ",1)]),s("div",$e,[t(i,{flat:"",dense:"",color:"negative",icon:"delete_sweep",label:"Excluir logs",disable:y.value||!_.value,onClick:ne},null,8,["disable"]),Q(t(i,{flat:"",round:"",dense:"",icon:"close"},null,512),[[$]])])]),_:1}),t(G),t(h,{class:"tw-p-0",style:{height:"calc(100% - 72px)"}},{default:o(()=>[t(U,{flat:"",rows:C.value,columns:H,"row-key":"id",loading:y.value,pagination:u.value,"onUpdate:pagination":l[7]||(l[7]=e=>u.value=e),"rows-per-page-options":[10,15,25,50],"no-data-label":n(g).noData,"no-results-label":n(g).noResults,"loading-label":n(g).loading,"rows-per-page-label":n(g).recordsPerPage,"all-rows-label":n(g).allRows,"pagination-label":n(g).pagination,"binary-state-sort":"",onRequest:se},{"body-cell-message":o(e=>[t(w,{props:e},{default:o(()=>[s("div",Ge,[s("span",{class:he(["tw-inline-block tw-h-2.5 tw-w-2.5 tw-rounded-full",re(e.row.status)]),title:ie(e.row.status)},null,10,Qe),s("span",null,b(e.row.message),1)])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","no-data-label","no-results-label","loading-label","rows-per-page-label","all-rows-label","pagination-label"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue","maximized"])])],64))}};export{Ie as default};
