import{x as O,E as k,h as d,G as ve,H as _e,F as we,r as J,s as A,I as P,i as Q,t as W,v as Y,Q as be,a as ye,b as Z,z as he,J as X,N as j}from"./vendor-quasar-DYxT2uMy.js";import{f as c,r as g,w,Y as Ce,E as v,F as p,O as m,C as l,A as F,J as B,u as n,B as i,G as I,H as ee,K as E,L as _,Q as Se,Z as ae,j as te,S as xe}from"./vendor-D6jaF0sv.js";import{_ as Ve}from"../app-7BtKpvhq.js";const ke={class:"tw-flex tw-items-start tw-gap-2 tw-py-1 tw-w-full"},Ae={class:"tw-flex tw-flex-wrap tw-gap-2"},Qe={key:0,class:"tw-text-gray-500"},Be={class:"tw-flex tw-justify-end tw-gap-2"},Ne={key:0,class:"tw-text-center tw-py-6"},Le={class:"tw-flex tw-items-center tw-justify-between tw-gap-2"},Ue={class:"tw-text-sm tw-text-gray-600"},De={class:"tw-flex tw-gap-2"},Oe={class:"tw-border tw-rounded tw-max-h-96 tw-overflow-y-auto tw-p-2"},je={key:0,class:"tw-text-sm tw-text-gray-500 tw-p-3"},Fe={__name:"FormCampaign",props:{campaign:{type:Object,default:null},channels:{type:Array,required:!0},countries:{type:Array,required:!0},affiliate_platforms:{type:Array,required:!0},googleAdsAccounts:{type:Array,required:!0},conversionGoals:{type:Array,required:!0},defaults:{type:Object,default:()=>({})}},setup(T){const r=T,oe=c(()=>!!r.campaign),f=g(r.countries??[]),b=g(!1),y=g(""),u=g([]),$=c(()=>(r.channels??[]).map(e=>({...e,value:String(e.id),label:e.label??e.name}))),q=c(()=>(r.affiliate_platforms??[]).map(e=>({...e,value:String(e.id),label:e.label??e.name}))),G=c(()=>(r.googleAdsAccounts??[]).map(e=>({...e,value:String(e.id),label:e.label}))),R=c(()=>(r.conversionGoals??[]).map(e=>({...e,value:String(e.id),label:e.active===!1?`${e.label??e.goal_code} (inativa)`:e.label??e.goal_code})));w(()=>r.countries,(e=[])=>{f.value=e;const a=new Set(e.map(t=>String(t.id)));o.countries=(o.countries??[]).filter(t=>a.has(String(t))),u.value=(u.value??[]).filter(t=>a.has(String(t)))});function h(e,a=[]){if(e==null||e==="")return e;const t=a.find(s=>String(s?.value)===String(e));return t?t.value:e}function C(e){return e==null||e===""?null:String(e)}const o=Ce({name:r.campaign?.name??"",product_url:r.campaign?.product_url??"",conversion_goal_id:C(r.campaign?.conversion_goal_id),status:r.campaign?.status??!0,channel_id:C(r.campaign?.channel_id??r.defaults?.channel_id??null),affiliate_platform_id:C(r.campaign?.affiliate_platform_id??r.defaults?.affiliate_platform_id??null),google_ads_account_id:C(r.campaign?.google_ads_account_id),countries:r.campaign?.countries?r.campaign.countries.map(e=>e.id):[],commission_value:r.campaign?.commission_value??null});w($,e=>{o.channel_id=h(o.channel_id,e)},{immediate:!0}),w(q,e=>{o.affiliate_platform_id=h(o.affiliate_platform_id,e)},{immediate:!0}),w(R,e=>{o.conversion_goal_id=h(o.conversion_goal_id,e)},{immediate:!0}),w(G,e=>{o.google_ads_account_id=h(o.google_ads_account_id,e)},{immediate:!0});const z=c(()=>{if(o.errors.countries)return o.errors.countries;const e=Object.entries(o.errors).find(([a])=>a.startsWith("countries."));return e?e[1]:null}),K=c(()=>{const e=new Map;for(const a of f.value)e.set(String(a.id),a);return e}),M=c(()=>(o.countries??[]).map(e=>K.value.get(String(e))).filter(Boolean)),N=c(()=>{const e=y.value.trim().toLowerCase();return e?f.value.filter(a=>{const t=(a.name??"").toLowerCase(),s=(a.iso2??"").toLowerCase(),V=(a.iso3??"").toLowerCase();return t.includes(e)||s.includes(e)||V.includes(e)}):f.value}),le=c(()=>(u.value??[]).map(e=>K.value.get(String(e))).filter(Boolean)),ne=c(()=>{const e=le.value;if(!e.length)return"Nenhum país selecionado";const a=5,t=70,s=e.slice(0,a).map(fe=>fe.name).join(", "),V=e.length-a,H=s.length>t?`${s.slice(0,t).trim()} (...)`:s;return V>0?`${H} (+${V})`:H});function re(){const e=r.campaign?.hashid??r.campaign?.id;oe.value?o.put(route("panel.campaigns.update",e)):o.post(route("panel.campaigns.store"))}function ie(e){o.countries=(o.countries??[]).filter(a=>String(a)!==String(e))}function se(){u.value=[...o.countries??[]],y.value="",b.value=!0}function L(){b.value=!1}function ue(){o.countries=[...u.value??[]],L()}function de(){const e=new Set((u.value??[]).map(a=>String(a)));for(const a of N.value)e.add(String(a.id));u.value=f.value.filter(a=>e.has(String(a.id))).map(a=>a.id)}function ce(){u.value=[]}function me(e){const a=new Set((u.value??[]).map(s=>String(s))),t=String(e);a.has(t)?a.delete(t):a.add(t),u.value=f.value.filter(s=>a.has(String(s.id))).map(s=>s.id)}const U=g(!1),D=g(!1),S=g(""),x=g(null);async function pe(){const e=r.campaign?.hashid??r.campaign?.id;if(e){U.value=!0,D.value=!0,S.value="";try{const a=await xe.get(route("panel.campaigns.tracking_code",e));S.value=String(a.data.script||"").trim()}catch{j.create({type:"negative",message:"Não foi possível carregar o código de acompanhamento",position:"top-right"})}finally{D.value=!1}}}function ge(){if(x.value){x.value.focus(),x.value.select();try{if(!document.execCommand("copy"))throw new Error;j.create({type:"positive",message:"Código copiado",timeout:2e3,position:"top-right"})}catch{j.create({type:"negative",message:"Não foi possível copiar o código",timeout:3e3,position:"top-right"})}}}return(e,a)=>(p(),v(I,null,[m("form",{onSubmit:ae(re,["prevent"]),class:"tw-space-y-6"},[l(O,{modelValue:n(o).name,"onUpdate:modelValue":a[0]||(a[0]=t=>n(o).name=t),label:"Nome da campanha",outlined:"",dense:"",error:!!n(o).errors.name,"error-message":n(o).errors.name},null,8,["modelValue","error","error-message"]),l(O,{modelValue:n(o).product_url,"onUpdate:modelValue":a[1]||(a[1]=t=>n(o).product_url=t),label:"URL do produto autorizada",hint:"Exemplo: https://biovitania.online",outlined:"",dense:"",error:!!n(o).errors.product_url,"error-message":n(o).errors.product_url},null,8,["modelValue","error","error-message"]),l(k,{modelValue:n(o).channel_id,"onUpdate:modelValue":a[2]||(a[2]=t=>n(o).channel_id=t),options:$.value,"option-label":"label","option-value":"value","emit-value":"","map-options":"",label:"Canal",outlined:"",dense:"",error:!!n(o).errors.channel_id,"error-message":n(o).errors.channel_id},null,8,["modelValue","options","error","error-message"]),l(k,{modelValue:n(o).affiliate_platform_id,"onUpdate:modelValue":a[3]||(a[3]=t=>n(o).affiliate_platform_id=t),options:q.value,"option-label":"label","option-value":"value","emit-value":"","map-options":"",label:"Plataforma de Afiliado",outlined:"",dense:"",error:!!n(o).errors.affiliate_platform_id,"error-message":n(o).errors.affiliate_platform_id},null,8,["modelValue","options","error","error-message"]),l(_e,{label:"Regiões de segmentação (países)",outlined:"",dense:"","stack-label":"",error:!!z.value,"error-message":z.value},{control:i(()=>[m("div",ke,[l(d,{flat:"",dense:"",icon:"travel_explore",label:"Selecionar",onClick:se}),m("div",Ae,[(p(!0),v(I,null,ee(M.value,t=>(p(),F(ve,{key:t.id,removable:"",dense:"",square:"",onRemove:s=>ie(t.id)},{default:i(()=>[E(_(t.name),1)]),_:2},1032,["onRemove"]))),128)),M.value.length?B("",!0):(p(),v("span",Qe," Nenhum país selecionado "))])])]),_:1},8,["error","error-message"]),l(k,{modelValue:n(o).google_ads_account_id,"onUpdate:modelValue":a[4]||(a[4]=t=>n(o).google_ads_account_id=t),options:G.value,"option-value":"value","option-label":"label","emit-value":"","map-options":"",clearable:"",label:"Conta de Anúncios",hint:"Selecione a conta do Google Ads desta campanha",error:!!n(o).errors.google_ads_account_id,"error-message":n(o).errors.google_ads_account_id},null,8,["modelValue","options","error","error-message"]),l(k,{modelValue:n(o).conversion_goal_id,"onUpdate:modelValue":a[5]||(a[5]=t=>n(o).conversion_goal_id=t),options:R.value,"option-value":"value","option-label":"label","emit-value":"","map-options":"",clearable:"",label:"Meta de conversao",hint:"Selecione a meta/codigo de conversao vinculada a campanha",outlined:"",dense:"",error:!!n(o).errors.conversion_goal_id,"error-message":n(o).errors.conversion_goal_id},null,8,["modelValue","options","error","error-message"]),T.campaign?(p(),F(d,{key:0,flat:"",icon:"code",color:"primary",label:"Ver código de acompanhamento",onClick:pe})):B("",!0),l(we,{modelValue:n(o).status,"onUpdate:modelValue":a[6]||(a[6]=t=>n(o).status=t),label:"Campanha ativa"},null,8,["modelValue"]),m("div",Be,[l(d,{flat:"",label:"Cancelar",onClick:a[7]||(a[7]=t=>n(Se).visit(e.route("panel.campaigns.index")))}),l(d,{color:"primary",label:"Salvar",type:"submit"})])],32),l(Y,{modelValue:U.value,"onUpdate:modelValue":a[8]||(a[8]=t=>U.value=t)},{default:i(()=>[l(J,{style:{"min-width":"720px","max-width":"95vw","min-height":"450px"}},{default:i(()=>[l(A,{class:"tw-flex tw-justify-between tw-items-center"},{default:i(()=>[a[13]||(a[13]=m("div",{class:"tw-text-lg tw-font-semibold"}," Código de acompanhamento ",-1)),te(l(d,{flat:"",dense:"",icon:"close"},null,512),[[P]])]),_:1}),l(Q),l(A,null,{default:i(()=>[D.value?(p(),v("div",Ne," Carregando... ")):B("",!0),m("textarea",{ref_key:"trackingTextarea",ref:x,class:"tw-w-full tw-h-72 tw-font-mono tw-text-sm tw-p-3 tw-bg-gray-100 tw-rounded",readonly:""},_(S.value),513)]),_:1}),l(Q),l(W,{align:"right"},{default:i(()=>[l(d,{flat:"",icon:"content_copy",label:"Copiar",disable:!S.value,onClick:ge},null,8,["disable"]),te(l(d,{color:"primary",label:"Fechar"},null,512),[[P]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Y,{modelValue:b.value,"onUpdate:modelValue":a[12]||(a[12]=t=>b.value=t)},{default:i(()=>[l(J,{style:{"min-width":"720px","max-width":"95vw",width:"900px","max-height":"90vh"}},{default:i(()=>[l(A,{class:"tw-flex tw-items-center tw-justify-between"},{default:i(()=>[a[14]||(a[14]=m("div",{class:"tw-text-lg tw-font-semibold"}," Selecionar países ",-1)),l(d,{flat:"",dense:"",icon:"close",onClick:L})]),_:1}),l(Q),l(A,{class:"tw-space-y-3"},{default:i(()=>[l(O,{modelValue:y.value,"onUpdate:modelValue":a[9]||(a[9]=t=>y.value=t),dense:"",outlined:"",clearable:"",autofocus:"",label:"Buscar país por nome ou código"},null,8,["modelValue"]),m("div",Le,[m("div",Ue,_(ne.value),1),m("div",De,[l(d,{flat:"",dense:"",label:"Selecionar filtrados",onClick:de}),l(d,{flat:"",dense:"",label:"Limpar",onClick:ce})])]),m("div",Oe,[l(be,{separator:""},{default:i(()=>[(p(!0),v(I,null,ee(N.value,t=>(p(),F(ye,{key:t.id,clickable:"",dense:"",onClick:s=>me(t.id)},{default:i(()=>[l(Z,{avatar:""},{default:i(()=>[l(he,{modelValue:u.value,"onUpdate:modelValue":a[10]||(a[10]=s=>u.value=s),val:t.id,onClick:a[11]||(a[11]=ae(()=>{},["stop"]))},null,8,["modelValue","val"])]),_:2},1024),l(Z,null,{default:i(()=>[l(X,null,{default:i(()=>[E(_(t.name),1)]),_:2},1024),l(X,{caption:""},{default:i(()=>[E(_(t.iso2)+" · "+_(t.iso3),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}),N.value.length?B("",!0):(p(),v("div",je," Nenhum país encontrado para esta busca. "))])]),_:1}),l(Q),l(W,{align:"right"},{default:i(()=>[l(d,{flat:"",label:"Cancelar",onClick:L}),l(d,{color:"primary",label:"Aplicar",onClick:ue})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},$e=Ve(Fe,[["__scopeId","data-v-659daad6"]]);export{$e as default};
