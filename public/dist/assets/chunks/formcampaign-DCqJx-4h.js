import{x as F,E as c,h as u,F as W,r as Y,s as E,G as L,i as j,t as Z,v as H,N as k}from"./vendor-quasar-D0sfcEux.js";import{f as d,r as i,w as m,Y as X,E as G,F as x,O as w,C as n,A as ee,J as R,u as l,Q as ae,Z as oe,B as p,j as T,L as le,G as te,S as re}from"./vendor-D6jaF0sv.js";import{_ as ne}from"../app-BSMajgdI.js";const ie={class:"tw-flex tw-justify-end tw-gap-2"},se={key:0,class:"tw-text-center tw-py-6"},ue={__name:"FormCampaign",props:{campaign:{type:Object,default:null},channels:{type:Array,required:!0},countries:{type:Array,required:!0},affiliate_platforms:{type:Array,required:!0},googleAdsAccounts:{type:Array,required:!0},conversionGoals:{type:Array,required:!0},defaults:{type:Object,default:()=>({})}},setup(A){const t=A,q=d(()=>!!t.campaign),g=i(t.countries??[]),f=i([...t.countries??[]]),h=i(null),B=d(()=>(t.channels??[]).map(e=>({...e,value:String(e.id),label:e.label??e.name}))),O=d(()=>(t.affiliate_platforms??[]).map(e=>({...e,value:String(e.id),label:e.label??e.name}))),Q=d(()=>(t.googleAdsAccounts??[]).map(e=>({...e,value:String(e.id),label:e.label}))),U=d(()=>(t.conversionGoals??[]).map(e=>({...e,value:String(e.id),label:e.active===!1?`${e.label??e.goal_code} (inativa)`:e.label??e.goal_code})));m(()=>t.countries,(e=[])=>{g.value=e,f.value=[...e]});function v(e,o=[]){if(e==null||e==="")return e;const r=o.find(s=>String(s?.value)===String(e));return r?r.value:e}function _(e){return e==null||e===""?null:String(e)}const a=X({name:t.campaign?.name??"",product_url:t.campaign?.product_url??"",conversion_goal_id:_(t.campaign?.conversion_goal_id),status:t.campaign?.status??!0,channel_id:_(t.campaign?.channel_id??t.defaults?.channel_id??null),affiliate_platform_id:_(t.campaign?.affiliate_platform_id??t.defaults?.affiliate_platform_id??null),google_ads_account_id:_(t.campaign?.google_ads_account_id),countries:t.campaign?.countries?t.campaign.countries.map(e=>e.id):[],commission_value:t.campaign?.commission_value??null});m(B,e=>{a.channel_id=v(a.channel_id,e)},{immediate:!0}),m(O,e=>{a.affiliate_platform_id=v(a.affiliate_platform_id,e)},{immediate:!0}),m(U,e=>{a.conversion_goal_id=v(a.conversion_goal_id,e)},{immediate:!0}),m(Q,e=>{a.google_ads_account_id=v(a.google_ads_account_id,e)},{immediate:!0});const N=d(()=>{if(a.errors.countries)return a.errors.countries;const e=Object.entries(a.errors).find(([o])=>o.startsWith("countries."));return e?e[1]:null});function D(){const e=t.campaign?.hashid??t.campaign?.id;q.value?a.put(route("panel.campaigns.update",e)):a.post(route("panel.campaigns.store"))}function P(e,o,r){if(!g.value.length)return r();const s=(e||"").trim().toLowerCase();o(()=>{if(!s){f.value=[...g.value];return}f.value=g.value.filter(S=>{const M=(S.name||"").toLowerCase(),$=(S.iso2||"").toLowerCase(),J=(S.iso3||"").toLowerCase();return M.includes(s)||$.includes(s)||J.includes(s)})})}function z(){h.value?.hidePopup&&h.value.hidePopup()}const C=i(!1),V=i(!1),b=i(""),y=i(null);async function I(){const e=t.campaign?.hashid??t.campaign?.id;if(e){C.value=!0,V.value=!0,b.value="";try{const o=await re.get(route("panel.campaigns.tracking_code",e));b.value=String(o.data.script||"").trim()}catch{k.create({type:"negative",message:"Não foi possível carregar o código de acompanhamento",position:"top-right"})}finally{V.value=!1}}}function K(){if(y.value){y.value.focus(),y.value.select();try{if(!document.execCommand("copy"))throw new Error;k.create({type:"positive",message:"Código copiado",timeout:2e3,position:"top-right"})}catch{k.create({type:"negative",message:"Não foi possível copiar o código",timeout:3e3,position:"top-right"})}}}return(e,o)=>(x(),G(te,null,[w("form",{onSubmit:oe(D,["prevent"]),class:"tw-space-y-6"},[n(F,{modelValue:l(a).name,"onUpdate:modelValue":o[0]||(o[0]=r=>l(a).name=r),label:"Nome da campanha",outlined:"",dense:"",error:!!l(a).errors.name,"error-message":l(a).errors.name},null,8,["modelValue","error","error-message"]),n(F,{modelValue:l(a).product_url,"onUpdate:modelValue":o[1]||(o[1]=r=>l(a).product_url=r),label:"URL do produto autorizada",hint:"Exemplo: https://biovitania.online",outlined:"",dense:"",error:!!l(a).errors.product_url,"error-message":l(a).errors.product_url},null,8,["modelValue","error","error-message"]),n(c,{modelValue:l(a).channel_id,"onUpdate:modelValue":o[2]||(o[2]=r=>l(a).channel_id=r),options:B.value,"option-label":"label","option-value":"value","emit-value":"","map-options":"",label:"Canal",outlined:"",dense:"",error:!!l(a).errors.channel_id,"error-message":l(a).errors.channel_id},null,8,["modelValue","options","error","error-message"]),n(c,{modelValue:l(a).affiliate_platform_id,"onUpdate:modelValue":o[3]||(o[3]=r=>l(a).affiliate_platform_id=r),options:O.value,"option-label":"label","option-value":"value","emit-value":"","map-options":"",label:"Plataforma de Afiliado",outlined:"",dense:"",error:!!l(a).errors.affiliate_platform_id,"error-message":l(a).errors.affiliate_platform_id},null,8,["modelValue","options","error","error-message"]),n(c,{ref_key:"countrySelectRef",ref:h,label:"Regiões de segmentação (países)",modelValue:l(a).countries,"onUpdate:modelValue":[o[4]||(o[4]=r=>l(a).countries=r),z],options:f.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",multiple:"","use-chips":"","use-input":"",onFilter:P,outlined:"",dense:"",error:!!N.value,"error-message":N.value},null,8,["modelValue","options","error","error-message"]),n(c,{modelValue:l(a).google_ads_account_id,"onUpdate:modelValue":o[5]||(o[5]=r=>l(a).google_ads_account_id=r),options:Q.value,"option-value":"value","option-label":"label","emit-value":"","map-options":"",clearable:"",label:"Conta de Anúncios",hint:"Selecione a conta do Google Ads desta campanha",error:!!l(a).errors.google_ads_account_id,"error-message":l(a).errors.google_ads_account_id},null,8,["modelValue","options","error","error-message"]),n(c,{modelValue:l(a).conversion_goal_id,"onUpdate:modelValue":o[6]||(o[6]=r=>l(a).conversion_goal_id=r),options:U.value,"option-value":"value","option-label":"label","emit-value":"","map-options":"",clearable:"",label:"Meta de conversao",hint:"Selecione a meta/codigo de conversao vinculada a campanha",outlined:"",dense:"",error:!!l(a).errors.conversion_goal_id,"error-message":l(a).errors.conversion_goal_id},null,8,["modelValue","options","error","error-message"]),A.campaign?(x(),ee(u,{key:0,flat:"",icon:"code",color:"primary",label:"Ver código de acompanhamento",onClick:I})):R("",!0),n(W,{modelValue:l(a).status,"onUpdate:modelValue":o[7]||(o[7]=r=>l(a).status=r),label:"Campanha ativa"},null,8,["modelValue"]),w("div",ie,[n(u,{flat:"",label:"Cancelar",onClick:o[8]||(o[8]=r=>l(ae).visit(e.route("panel.campaigns.index")))}),n(u,{color:"primary",label:"Salvar",type:"submit"})])],32),n(H,{modelValue:C.value,"onUpdate:modelValue":o[9]||(o[9]=r=>C.value=r)},{default:p(()=>[n(Y,{style:{"min-width":"720px","max-width":"95vw","min-height":"450px"}},{default:p(()=>[n(E,{class:"tw-flex tw-justify-between tw-items-center"},{default:p(()=>[o[10]||(o[10]=w("div",{class:"tw-text-lg tw-font-semibold"}," Código de acompanhamento ",-1)),T(n(u,{flat:"",dense:"",icon:"close"},null,512),[[L]])]),_:1}),n(j),n(E,null,{default:p(()=>[V.value?(x(),G("div",se," Carregando... ")):R("",!0),w("textarea",{ref_key:"trackingTextarea",ref:y,class:"tw-w-full tw-h-72 tw-font-mono tw-text-sm tw-p-3 tw-bg-gray-100 tw-rounded",readonly:""},le(b.value),513)]),_:1}),n(j),n(Z,{align:"right"},{default:p(()=>[n(u,{flat:"",icon:"content_copy",label:"Copiar",disable:!b.value,onClick:K},null,8,["disable"]),T(n(u,{color:"primary",label:"Fechar"},null,512),[[L]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},pe=ne(ue,[["__scopeId","data-v-14608d4d"]]);export{pe as default};
