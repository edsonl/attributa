import{C as z,h as N,E as O,A as W,B as i,k as h,n as H,r as K}from"./vendor-quasar-C1KtC9YM.js";import{r as n,f as Y,w as J,e as X,G as L,H as g,E as o,u as R,P as Z,D as t,Q as d,C as x,M as f,N as u,L as ee,O as ae,I as le,V as w}from"./vendor-D8nj3W7R.js";import te from"./pageviewdetailmodal-Dwbn0t2_.js";import oe from"./pageviewdetaildrawer-DWoZr8zi.js";import{_ as ne}from"../app-Ben3eMxq.js";const ie={class:"row q-mb-md items-center q-col-gutter-md"},re={class:"col-12 col-md-4 q-mb-sm q-mb-md-0"},se={class:"col-12 col-md-4 col-lg-3 q-mt-sm q-mt-md-0 q-pl-md-sm"},de={class:"col-12 col-md-4 col-lg-3 q-mt-sm q-mt-md-0"},ue={class:"tw-flex tw-items-center tw-gap-2"},ce={class:"tw-text-sm tw-font-medium"},me={class:"tw-flex tw-items-center tw-gap-2"},ge=["src","alt"],fe={__name:"Pageviews",setup(ve){const Q=n([]),c=n(!1),U=n(null),s=n({page:1,rowsPerPage:20,rowsNumber:0,sortBy:"created_at",descending:!0}),b=n(null),$=n([]),P={label:"Não determinado",color:"#FCE7F3",description:"Categoria ainda não determinada."},V=n(!1),D=n(!1),y=n(!1),_=n(null),m=n([]),E=Y(()=>m.value.length>0),v=n(!1),B="https://attributa.master.dev.br".replace(/\/$/,""),S=[{name:"created_at",label:"Data",field:"created_at_formatted",sortable:!0,align:"left"},{name:"ip_category",label:"Classificação IP",field:a=>a?.ip_category_name,sortable:!0,align:"left"},{name:"ip",label:"IP",field:"ip",sortable:!0,align:"left"},{name:"campaign_name",label:"Campanha",field:"campaign_name",sortable:!0,align:"left"},{name:"country_code",label:"País",field:"country_code",sortable:!0,align:"left"},{name:"region_name",label:"Região",field:"region_name",sortable:!0,align:"left"},{name:"city",label:"Cidade",field:"city",sortable:!0,align:"left"},{name:"gclid",label:"GCLID",field:"has_gclid",sortable:!0,align:"left"},{name:"conversion",label:"Conversão",field:"conversion",sortable:!0,align:"left"},{name:"details",label:"Detalhes",field:"id",align:"center"},{name:"actions",label:"Ações",field:"id",align:"right"}];function q(a){return{label:a?.ip_category_name??P.label,color:a?.ip_category_color??P.color,description:a?.ip_category_description??P.description}}function I(a){const l=a?.country_code;if(!l)return null;const e=String(l).toLowerCase();return`${B}/assets/country-flags/${e}.svg`}function F(a){return a===!0||a===1||a==="1"}function T(a){return a===!0||a===1||a==="1"?!0:typeof a=="string"?a.trim().length>0&&a!=="0":!1}function A(){w.get(route("panel.atividade.campaigns")).then(a=>{$.value=a.data})}function p(a){c.value=!0;const{page:l,rowsPerPage:e,sortBy:r,descending:C}=a.pagination;return w.get(route("panel.atividade.pageviews.data"),{params:{page:l,per_page:e,sortBy:r,descending:C,campaign_id:b.value}}).then(k=>{Q.value=k.data.data,m.value=[],s.value={...s.value,page:k.data.current_page,rowsPerPage:k.data.per_page,rowsNumber:k.data.total,sortBy:r,descending:C}}).finally(()=>{c.value=!1})}async function G(a){if(!a)return;let l=!0;const e=typeof window<"u",r=e?window.$confirm:null;if(r?l=await r({title:"Excluir pageview",message:"Esta ação é permanente. Deseja realmente remover?",okLabel:"Remover",okColor:"negative"}):e&&(l=window.confirm("Excluir este pageview?")),!!l){c.value=!0;try{await w.delete(route("panel.atividade.pageviews.destroy",a)),await p({pagination:s.value})}finally{c.value=!1}}}async function M(){if(!E.value)return;let a=!0;const l=typeof window<"u",e=l?window.$confirm:null,r=`Você selecionou ${m.value.length} registro(s). Deseja remover?`;if(e?a=await e({title:"Remover pageviews",message:r,okLabel:"Remover",okColor:"negative"}):l&&(a=window.confirm(r)),!!a){c.value=!0;try{await w.delete(route("panel.atividade.pageviews.bulk-destroy"),{data:{ids:m.value.map(C=>C.id)}}),await p({pagination:s.value})}finally{c.value=!1}}}async function j(a){V.value=v.value,D.value=!v.value,y.value=!0,_.value=null;try{const l=await w.get(route("panel.atividade.pageviews.show",a.id));_.value=l.data}finally{y.value=!1}}return J(b,()=>{s.value.page=1,p({pagination:s.value})}),X(()=>{A(),p({pagination:s.value})}),(a,l)=>(g(),L(le,null,[o(R(Z),{title:"Relatório de atividade"}),o(K,{flat:"",bordered:"",class:"tw-rounded-2xl tw-p-4"},{default:t(()=>[d("div",ie,[d("div",re,[o(z,{ref_key:"tableRef",ref:U,modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=e=>b.value=e),options:$.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",clearable:"",label:"Filtrar por campanha"},null,8,["modelValue","options"])]),d("div",se,[o(N,{color:"negative",label:"Remover selecionados",disable:!E.value,onClick:M,class:"tw-w-full lg:tw-w-auto bulk-delete-btn"},null,8,["disable"])]),d("div",de,[o(O,{modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=e=>v.value=e),label:`Popup: ${v.value?"true":"false"}`,color:"primary","keep-color":""},null,8,["modelValue","label"])])]),o(W,{rows:Q.value,columns:S,"row-key":"id",loading:c.value,pagination:s.value,"onUpdate:pagination":l[2]||(l[2]=e=>s.value=e),"binary-state-sort":!0,onRequest:p,selection:"multiple",selected:m.value,"onUpdate:selected":l[3]||(l[3]=e=>m.value=e)},{"body-cell-created_at":t(e=>[o(i,{props:e},{default:t(()=>[f(u(e.value),1)]),_:2},1032,["props"])]),"body-cell-ip_category":t(e=>[o(i,{props:e},{default:t(()=>[d("div",ue,[d("span",{class:"tw-inline-flex tw-h-3 tw-w-3 tw-rounded-full tw-border tw-border-white/20 tw-shadow-sm",style:ae({backgroundColor:q(e.row).color})},null,4),d("span",ce,u(q(e.row).label),1),o(H,{class:"tw-text-xs tw-max-w-xs tw-leading-snug"},{default:t(()=>[f(u(q(e.row).description),1)]),_:2},1024)])]),_:2},1032,["props"])]),"body-cell-ip":t(e=>[o(i,{props:e},{default:t(()=>[f(u(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-campaign_name":t(e=>[o(i,{props:e},{default:t(()=>[f(u(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-country_code":t(e=>[o(i,{props:e},{default:t(()=>[d("div",me,[I(e.row)?(g(),L("img",{key:0,src:I(e.row),alt:e.value,class:"tw-w-6 tw-h-4 tw-rounded-sm tw-object-cover tw-border tw-border-gray-200"},null,8,ge)):ee("",!0),d("span",null,u(e.value?e.value.toUpperCase():"-"),1)])]),_:2},1032,["props"])]),"body-cell-region_name":t(e=>[o(i,{props:e},{default:t(()=>[f(u(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-city":t(e=>[o(i,{props:e},{default:t(()=>[f(u(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-gclid":t(e=>[o(i,{props:e},{default:t(()=>[T(e.value)?(g(),x(h,{key:0,color:"primary",label:"Sim"})):(g(),x(h,{key:1,color:"grey-4","text-color":"dark",label:"Não"}))]),_:2},1032,["props"])]),"body-cell-conversion":t(e=>[o(i,{props:e},{default:t(()=>[F(e.value)?(g(),x(h,{key:0,color:"green",label:"Convertido"})):(g(),x(h,{key:1,color:"grey-4","text-color":"dark",label:"Não convertido"}))]),_:2},1032,["props"])]),"body-cell-details":t(e=>[o(i,{props:e},{default:t(()=>[o(N,{dense:"",flat:"",round:"",size:"sm",icon:"manage_search",color:"primary",onClick:r=>j(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-actions":t(e=>[o(i,{props:e,class:"tw-text-right"},{default:t(()=>[o(N,{dense:"",flat:"",icon:"delete",color:"negative",onClick:r=>G(e.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","selected"])]),_:1}),o(te,{modelValue:V.value,"onUpdate:modelValue":l[4]||(l[4]=e=>V.value=e),loading:y.value,payload:_.value,"asset-base-url":R(B)},null,8,["modelValue","loading","payload","asset-base-url"]),o(oe,{modelValue:D.value,"onUpdate:modelValue":l[5]||(l[5]=e=>D.value=e),loading:y.value,payload:_.value,"asset-base-url":R(B)},null,8,["modelValue","loading","payload","asset-base-url"])],64))}},Ce=ne(fe,[["__scopeId","data-v-b1de6eea"]]);export{Ce as default};
