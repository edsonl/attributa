import{u as se,h as d,s as h,x as C,c as ne,A as I,B as w,F as re,r as R,G as $,i as V,t as ie,v as N,H as de}from"./vendor-quasar-DSLrBDx5.js";import{f as ue,r as f,w as U,E as ce,F as ge,C as t,O as r,u as s,N as pe,B as l,P as fe,_ as we,L as b,K as E,j as Q,Z as G,M as ve,I as me,G as be,Q as j,S as T}from"./vendor-D6jaF0sv.js";import{q as u}from"./qtable-pt-CkdICETI.js";const ye={class:"tw-space-y-3"},_e={class:"tw-flex tw-items-center tw-justify-between tw-flex-col sm:tw-flex-row tw-gap-3"},he={class:"tw-flex tw-gap-3 tw-flex-col md:tw-flex-row"},xe={class:"tw-text-xs tw-text-slate-700"},Ce={class:"tw-text-xs tw-text-slate-700"},ke={class:"tw-flex tw-items-center tw-gap-3"},Pe={class:"tw-text-base tw-font-semibold"},Se={class:"tw-inline-flex tw-items-center tw-rounded-full tw-bg-slate-100 tw-px-3 tw-py-1 tw-text-xs tw-font-medium tw-text-slate-600"},ze={class:"tw-flex tw-items-center tw-gap-2"},Be={class:"tw-flex tw-items-center tw-gap-2"},Le=["title"],Ve={__name:"Index",props:{conversionGoals:{type:Object,required:!0},logsRetentionDays:{type:Number,default:10},filters:{type:Object,default:()=>({})}},setup(F){const g=F,M=ue(()=>g.conversionGoals?.data??[]),v=f(g.filters?.search??""),p=se(),k=f(!1),m=f(null),P=f(!1),y=f(!1),S=f(""),x=f([]),i=f({page:1,rowsPerPage:15,rowsNumber:0,sortBy:"created_at",descending:!0}),_=f(null),O=[{name:"created_at",label:"Data",field:"created_at_formatted",align:"left",sortable:!0},{name:"message",label:"Mensagem",field:"message",align:"left",sortable:!1}],n=f({page:g.conversionGoals?.current_page??1,rowsPerPage:g.conversionGoals?.per_page??15,rowsNumber:g.conversionGoals?.total??0,sortBy:g.filters?.sort??"created_at",descending:(g.filters?.direction??"desc")==="desc"});U(()=>g.conversionGoals,a=>{a&&(n.value.page=a.current_page,n.value.rowsPerPage=a.per_page,n.value.rowsNumber=a.total)}),U(()=>g.filters,a=>{n.value.sortBy=a?.sort??"created_at",n.value.descending=(a?.direction??"desc")==="desc",(a?.search??"")!==v.value&&(v.value=a?.search??"")});const A=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"goal_code",label:"Codigo",field:"goal_code",align:"left",sortable:!0},{name:"active",label:"Status",field:"active",align:"center",sortable:!0},{name:"timezone",label:"Timezone",field:a=>a.timezone?.label??a.timezone?.identifier??"-",align:"left"},{name:"campaigns",label:"Campanhas",field:"campaigns",align:"left"},{name:"created_at",label:"Criado em",field:"created_at",align:"left",sortable:!0},{name:"integration",label:"Integracao",field:"integration",align:"center"},{name:"logs",label:"Logs",field:"logs",align:"center"},{name:"actions",label:"Acoes",field:"actions",align:"right"}];function z(){const a={page:n.value.page,per_page:n.value.rowsPerPage,sort:n.value.sortBy,direction:n.value.descending?"desc":"asc",search:v.value||void 0};j.get(route("panel.conversion-goals.index"),a,{preserveState:!0,preserveScroll:!0,replace:!0})}function K({pagination:a}){Object.assign(n.value,a),z()}function B(){n.value.page=1,z()}function H(){v.value!==""&&(v.value="",n.value.page=1,z())}function L(a){return a?.hashid??a?.id}function Z(a){j.visit(route("panel.conversion-goals.edit",L(a)))}function J(a){const o=(a.campaigns??[]).map(c=>c?.name).filter(Boolean);if(!o.length)return"-";const e=o.join(", ");return e.length<=60?e:`${e.slice(0,60).trimEnd()}...`}function W(a){p.dialog({title:"Confirmar exclusao",message:`Deseja realmente remover a meta "${a.goal_code}"?`,cancel:{label:"Cancelar",flat:!0},ok:{label:"Excluir",color:"negative",unelevated:!0},persistent:!0}).onOk(()=>{j.delete(route("panel.conversion-goals.destroy",L(a)))})}function X(a){m.value={url:a.integration_url,username:`googleads-${a.user_slug_id}`,password:a.googleads_password},k.value=!0}async function D(a,o){const e=String(a??"");if(e===""){p.notify({type:"warning",message:`${o} vazio.`});return}try{await de(e),p.notify({type:"positive",message:`${o} copiado.`})}catch{p.notify({type:"negative",message:`Falha ao copiar ${o.toLowerCase()}.`})}}function Y(){return p.screen.lt.sm?"width: 96vw; max-width: 96vw; height: 92vh; max-height: 92vh;":p.screen.lt.md?"width: 92vw; max-width: 92vw; height: 90vh; max-height: 90vh;":"width: 70vw; max-width: 70vw; height: 88vh; max-height: 88vh;"}async function q(a,o=null){if(!a)return;y.value=!0;const e=o??i.value;try{const c=await T.get(route("panel.conversion-goals.logs",a),{params:{page:e.page,per_page:e.rowsPerPage,sort:e.sortBy||"created_at",direction:e.descending?"desc":"asc"}});x.value=c.data.data??[],i.value={...i.value,page:c.data.current_page,rowsPerPage:c.data.per_page,rowsNumber:c.data.total,sortBy:e.sortBy||"created_at",descending:!!e.descending}}finally{y.value=!1}}async function ee(a){_.value=L(a),S.value=a.goal_code,x.value=[],i.value={...i.value,page:1,sortBy:"created_at",descending:!0},P.value=!0,await q(_.value,i.value)}async function ae({pagination:a}){i.value={...i.value,...a},await q(_.value,i.value)}async function te(){_.value&&p.dialog({title:"Excluir logs",message:`Deseja excluir todos os logs da meta ${S.value||""}?`,cancel:{label:"Cancelar",flat:!0},ok:{label:"Excluir logs",color:"negative",unelevated:!0},persistent:!0}).onOk(async()=>{y.value=!0;try{await T.delete(route("panel.conversion-goals.logs.destroy",_.value)),x.value=[],i.value={...i.value,page:1,rowsNumber:0},p.notify({type:"positive",message:"Logs removidos com sucesso."})}catch{p.notify({type:"negative",message:"Falha ao remover logs."})}finally{y.value=!1}})}function le(a){return a==="success"?"tw-bg-emerald-500":a==="warning"?"tw-bg-amber-500":a==="error"?"tw-bg-rose-500":"tw-bg-slate-400"}function oe(a){return a==="success"?"Sucesso":a==="warning"?"Atenção":a==="error"?"Erro":"Informação"}return(a,o)=>(ge(),ce(be,null,[t(s(pe),{title:"Metas de Conversao"}),r("div",ye,[r("div",_e,[o[8]||(o[8]=r("h1",{class:"tw-text-lg tw-font-semibold"}," Metas de Conversao ",-1)),t(s(fe),{href:a.route("panel.conversion-goals.create")},{default:l(()=>[t(d,{color:"positive",icon:"add",label:"Nova Meta",unelevated:""})]),_:1},8,["href"])]),t(R,{flat:"",bordered:""},{default:l(()=>[t(h,{class:"tw-space-y-3"},{default:l(()=>[r("div",he,[t(C,{modelValue:v.value,"onUpdate:modelValue":o[0]||(o[0]=e=>v.value=e),dense:"",outlined:"",clearable:"",placeholder:"Pesquisar por codigo",class:"md:tw-flex-1",onKeyup:we(B,["enter"]),onClear:H},{append:l(()=>[t(ne,{name:"search",class:"cursor-pointer",onClick:B})]),_:1},8,["modelValue"]),t(d,{outline:"",color:"primary",icon:"search",label:"Filtrar",class:"md:tw-w-auto",onClick:B})]),t(I,{flat:"",rows:M.value,columns:A,"row-key":"id","binary-state-sort":"",pagination:n.value,"onUpdate:pagination":o[1]||(o[1]=e=>n.value=e),"rows-per-page-options":[10,15,25,50],"no-data-label":s(u).noData,"no-results-label":s(u).noResults,"loading-label":s(u).loading,"rows-per-page-label":s(u).recordsPerPage,"all-rows-label":s(u).allRows,"pagination-label":s(u).pagination,onRequest:K},{"body-cell-active":l(e=>[t(w,{props:e,class:"tw-text-center"},{default:l(()=>[t(re,{dense:"",size:"sm",color:e.row.active?"positive":"negative","text-color":"white"},{default:l(()=>[E(b(e.row.active?"Ativo":"Inativo"),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-created_at":l(e=>[t(w,{props:e},{default:l(()=>[E(b(e.row.created_at?new Date(e.row.created_at).toLocaleString("pt-BR"):"-"),1)]),_:2},1032,["props"])]),"body-cell-campaigns":l(e=>[t(w,{props:e},{default:l(()=>[r("span",xe,b(J(e.row)),1)]),_:2},1032,["props"])]),"body-cell-timezone":l(e=>[t(w,{props:e},{default:l(()=>[r("span",Ce,b(e.row.timezone?.label??e.row.timezone?.identifier??"-"),1)]),_:2},1032,["props"])]),"body-cell-actions":l(e=>[t(w,{props:e,class:"tw-text-right"},{default:l(()=>[t(d,{flat:"",dense:"",size:"sm",icon:"edit",class:"qtable-edit-btn",onClick:c=>Z(e.row)},null,8,["onClick"]),t(d,{flat:"",dense:"",size:"sm",icon:"delete",class:"qtable-delete-btn",onClick:c=>W(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-integration":l(e=>[t(w,{props:e,class:"tw-text-center"},{default:l(()=>[t(d,{flat:"",dense:"",size:"sm",icon:"link",color:"primary",onClick:c=>X(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-logs":l(e=>[t(w,{props:e,class:"tw-text-center"},{default:l(()=>[t(d,{flat:"",dense:"",size:"sm",icon:"history",label:"Logs",color:"secondary",onClick:c=>ee(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","pagination","no-data-label","no-results-label","loading-label","rows-per-page-label","all-rows-label","pagination-label"])]),_:1})]),_:1}),t(N,{modelValue:k.value,"onUpdate:modelValue":o[5]||(o[5]=e=>k.value=e)},{default:l(()=>[t(R,{style:{"min-width":"620px","max-width":"90vw"}},{default:l(()=>[t(h,{class:"tw-flex tw-items-center tw-justify-between"},{default:l(()=>[o[9]||(o[9]=r("div",{class:"tw-text-base tw-font-semibold"}," Integração Google Ads ",-1)),Q(t(d,{flat:"",round:"",dense:"",icon:"close"},null,512),[[$]])]),_:1}),t(V),t(h,{class:"tw-space-y-4"},{default:l(()=>[t(C,{"model-value":m.value?.url??"",label:"URL CSV",readonly:"",outlined:"",dense:""},{append:l(()=>[t(d,{flat:"",dense:"",icon:"content_copy",onClick:o[2]||(o[2]=G(e=>D(m.value?.url,"URL"),["stop","prevent"]))})]),_:1},8,["model-value"]),t(C,{"model-value":m.value?.username??"",label:"Usuário",readonly:"",outlined:"",dense:""},{append:l(()=>[t(d,{flat:"",dense:"",icon:"content_copy",onClick:o[3]||(o[3]=G(e=>D(m.value?.username,"Usuário"),["stop","prevent"]))})]),_:1},8,["model-value"]),t(C,{"model-value":m.value?.password??"",label:"Senha",readonly:"",outlined:"",dense:""},{append:l(()=>[t(d,{flat:"",dense:"",icon:"content_copy",onClick:o[4]||(o[4]=G(e=>D(m.value?.password,"Senha"),["stop","prevent"]))})]),_:1},8,["model-value"])]),_:1}),t(V),t(ie,{align:"right"},{default:l(()=>[Q(t(d,{flat:"",label:"Fechar"},null,512),[[$]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(N,{modelValue:P.value,"onUpdate:modelValue":o[7]||(o[7]=e=>P.value=e),maximized:s(p).screen.lt.sm},{default:l(()=>[t(R,{style:ve(Y())},{default:l(()=>[t(h,{class:"tw-flex tw-items-center tw-justify-between"},{default:l(()=>[r("div",ke,[r("div",Pe," Logs da Meta "+b(S.value||"-"),1),r("span",Se," Os logs são armazenados temporariamente e serão excluídos após "+b(g.logsRetentionDays)+" dias. ",1)]),r("div",ze,[t(d,{flat:"",dense:"",color:"negative",icon:"delete_sweep",label:"Excluir logs",disable:y.value||!_.value,onClick:te},null,8,["disable"]),Q(t(d,{flat:"",round:"",dense:"",icon:"close"},null,512),[[$]])])]),_:1}),t(V),t(h,{class:"tw-p-0",style:{height:"calc(100% - 72px)"}},{default:l(()=>[t(I,{flat:"",rows:x.value,columns:O,"row-key":"id",loading:y.value,pagination:i.value,"onUpdate:pagination":o[6]||(o[6]=e=>i.value=e),"rows-per-page-options":[10,15,25,50],"no-data-label":s(u).noData,"no-results-label":s(u).noResults,"loading-label":s(u).loading,"rows-per-page-label":s(u).recordsPerPage,"all-rows-label":s(u).allRows,"pagination-label":s(u).pagination,"binary-state-sort":"",onRequest:ae},{"body-cell-message":l(e=>[t(w,{props:e},{default:l(()=>[r("div",Be,[r("span",{class:me(["tw-inline-block tw-h-2.5 tw-w-2.5 tw-rounded-full",le(e.row.status)]),title:oe(e.row.status)},null,10,Le),r("span",null,b(e.row.message),1)])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","no-data-label","no-results-label","loading-label","rows-per-page-label","all-rows-label","pagination-label"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue","maximized"])])],64))}};export{Ve as default};
