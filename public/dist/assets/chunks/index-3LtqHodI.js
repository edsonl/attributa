import{u as ie,f as de,h as _,i as F,s as q,x as ue,c as N,C as j,A as ce,B as m,m as U,Q as G,a as K,b as g,k as E,G as L,r as M,t as pe,v as fe}from"./vendor-quasar-C1KtC9YM.js";import{r as d,f as H,G as p,H as i,E as t,D as a,u,R,a0 as me,Q as v,I as J,J as W,j as z,M as Q,N as c,C as A,L as S,K as ge,S as X}from"./vendor-D8nj3W7R.js";import ve from"./statuschip-gFNBlkQq.js";import ye from"./prioritychip-BKXXv7VA.js";import{q as y}from"./qtable-pt-CkdICETI.js";const _e={class:"tw-space-y-3"},we={class:"tw-text-gray-800"},be={key:0,class:"tw-flex tw-flex-col tw-gap-0.5"},ke={class:"tw-text-green-600 tw-text-xs"},xe={class:"tw-text-yellow-600 tw-text-xs"},he={class:"tw-text-gray-800 tw-text-xs tw-font-semibold"},Ce={class:"tw-inline-flex tw-cursor-pointer"},Qe={key:0,class:"tw-inline-flex tw-cursor-pointer"},Se={key:1,class:"tw-flex tw-items-center"},Ve={key:0,class:"tw-text-gray-500"},Pe={key:1,class:"tw-whitespace-pre-line tw-text-gray-800"},Ne={__name:"Index",props:{tasks:Object,filters:Object,statusOptions:Array,priorityOptions:Array,defaultSort:String,defaultDirection:String},setup(Y){const w=ie(),n=Y,b=d(n.filters?.q||""),k=d(n.filters?.status||""),x=d(n.filters?.priority||""),f=d({page:n.tasks?.current_page||1,rowsPerPage:n.tasks?.per_page||10,sortBy:n.defaultSort||"created_at",descending:(n.defaultDirection||"desc")==="desc"}),V=d(!1),Z=[{name:"title",label:"Título",field:"title",align:"left",sortable:!0},{name:"description",label:"Descrição",field:"description_preview",align:"left"},{name:"status",label:"Status",field:"status",align:"left",sortable:!0},{name:"total_time_formatted",label:"Tempo",field:"total_time_formatted",align:"center"},{name:"total_value",label:"Valor",field:"total_value",align:"right"},{name:"priority",label:"Prioridade",field:"priority",align:"left",sortable:!0},{name:"due_date",label:"Entrega",field:"due_date",align:"left",sortable:!0},{name:"created_at",label:"Criado em",field:"created_at",align:"left",sortable:!0},{name:"company",label:"Empresa",field:s=>s.company?.name,align:"left",sortable:!0},{name:"actions",label:"",field:"id",align:"right"}],P=[{value:"pending",label:"Pendente",color:"grey-5",css:"tw-text-gray-900"},{value:"in_progress",label:"Em andamento",color:"warning",css:"tw-text-yellow-900"},{value:"done",label:"Concluída",color:"positive",css:"tw-text-green-900"}],B=[{value:"low",label:"Baixa",color:"grey-5",css:"tw-text-gray-900"},{value:"medium",label:"Média",color:"warning",css:"tw-text-yellow-900"},{value:"high",label:"Alta",color:"secondary",css:"tw-text-white-900"}],ee=H(()=>n.tasks?.data??[]),te=H(()=>({current_page:n.tasks?.current_page??1,last_page:n.tasks?.last_page??1,per_page:n.tasks?.per_page??10,total:n.tasks?.total??0}));function I(s){V.value=!0,X.get(route("panel.tasks.index"),s,{preserveState:!0,preserveScroll:!0,replace:!0,onFinish:()=>V.value=!1})}function h(s=1){I({q:b.value||void 0,status:k.value||void 0,priority:x.value||void 0,sort:f.value.sortBy,direction:f.value.descending?"desc":"asc",page:s,per_page:f.value.rowsPerPage})}function ae({pagination:s}){f.value={...f.value,...s},I({q:b.value||void 0,status:k.value||void 0,priority:x.value||void 0,sort:s.sortBy,direction:s.descending?"desc":"asc",page:s.page,per_page:s.rowsPerPage})}async function le(s){if(window.$confirm){if(!await window.$confirm({title:"Excluir tarefa",message:"Esta ação é permanente. Deseja realmente remover?",okLabel:"Remover",okColor:"negative"}))return}else if(!confirm("Excluir tarefa?"))return;X.delete(route("panel.tasks.destroy",s),{preserveScroll:!0})}const D=d(!1),$=d(!1),C=d(""),O=d("");async function se(s,l){O.value=l??"Descrição",C.value="",D.value=!0,$.value=!0;try{const{data:e}=await axios.get(route("panel.tasks.description",s));C.value=e?.description??""}catch{C.value="Falha ao carregar descrição."}finally{$.value=!1}}async function oe(s,l,e){const r=e.status;e.status=l,e.status==="done"&&(e.priority="low");try{await axios.patch(route("panel.tasks.updateStatus",s),{status:l}),w.notify({type:"positive",message:"Status atualizado!"})}catch{e.status=r,w.notify({type:"negative",message:"Não foi possível atualizar o status."})}}async function re(s,l,e){const r=e.priority;e.priority=l;try{await axios.patch(route("panel.tasks.updatePriority",s),{priority:l}),w.notify({type:"positive",message:"Prioridade atualizado!"})}catch{e.priority=r,w.notify({type:"negative",message:"Não foi possível atualizar a prioridade."})}}const T=s=>Number(s||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"});return(s,l)=>(i(),p("div",_e,[t(M,{flat:"",bordered:"",class:"tw-rounded-2xl"},{default:a(()=>[t(de,null,{default:a(()=>[t(u(R),{href:s.route("panel.tasks.create")},{default:a(()=>[t(_,{icon:"add",label:"Adicionar Tarefa",color:"positive",unelevated:"",class:"tw-rounded-2xl"})]),_:1},8,["href"])]),_:1}),t(F),t(q,{class:"tw-grid tw-gap-3 md:tw-grid-cols-3"},{default:a(()=>[t(ue,{modelValue:b.value,"onUpdate:modelValue":l[1]||(l[1]=e=>b.value=e),dense:"",filled:"",clearable:"",placeholder:"Buscar título ou descrição",onKeyup:l[2]||(l[2]=me(e=>h(),["enter"]))},{append:a(()=>[t(N,{name:"search",class:"tw-cursor-pointer",onClick:l[0]||(l[0]=e=>h())})]),_:1},8,["modelValue"]),t(j,{modelValue:k.value,"onUpdate:modelValue":[l[3]||(l[3]=e=>k.value=e),l[4]||(l[4]=e=>h())],options:P,dense:"",filled:"",clearable:"","emit-value":"","map-options":"",label:"Status"},null,8,["modelValue"]),t(j,{modelValue:x.value,"onUpdate:modelValue":[l[5]||(l[5]=e=>x.value=e),l[6]||(l[6]=e=>h())],options:B,dense:"",filled:"",clearable:"","emit-value":"","map-options":"",label:"Prioridade"},null,8,["modelValue"])]),_:1}),t(F),t(ce,{flat:"",rows:ee.value,columns:Z,"row-key":"id",loading:V.value,pagination:f.value,"rows-per-page-options":[10,20,50,100],"rows-number":te.value.total,"binary-state-sort":"",onRequest:ae,"no-data-label":u(y).noData,"no-results-label":u(y).noResults,"loading-label":u(y).loading,"rows-per-page-label":u(y).recordsPerPage,"all-rows-label":u(y).allRows,"pagination-label":u(y).pagination},{"body-cell-title":a(({row:e,col:r,value:o})=>[t(m,{props:{row:e,col:r}},{default:a(()=>[t(u(R),{href:s.route("panel.tasks.edit",e.id),class:"hover:tw-underline"},{default:a(()=>[Q(c(o),1)]),_:2},1032,["href"])]),_:2},1032,["props"])]),"body-cell-description":a(({row:e,col:r})=>[t(m,{props:{row:e,col:r}},{default:a(()=>[v("span",we,c(e.description_preview||"—"),1),e.is_description_truncated?(i(),A(_,{key:0,dense:"",flat:"",round:"",icon:"add",size:"sm",class:"tw-ml-1",title:"Ver mais",onClick:o=>se(e.id,e.title)},null,8,["onClick"])):S("",!0)]),_:2},1032,["props"])]),"body-cell-total_value":a(e=>[t(m,{props:e},{default:a(()=>[e.row.total_value>0?(i(),p("div",be,[v("div",ke," Pago: "+c(T(e.row.notes_summary.paid)),1),v("div",xe," Pendente: "+c(T(e.row.notes_summary.pending)),1),v("div",he," Total: "+c(T(e.row.notes_summary.total)),1)])):S("",!0)]),_:2},1032,["props"])]),"body-cell-status":a(({row:e,col:r})=>[t(m,{props:{row:e,col:r}},{default:a(()=>[v("div",Ce,[t(ve,{value:e.status,options:P},null,8,["value"]),t(U,{anchor:"bottom middle",self:"top middle"},{default:a(()=>[t(G,{dense:""},{default:a(()=>[(i(),p(J,null,W(P,o=>z(t(K,{key:o.value,clickable:"",onClick:ne=>oe(e.id,o.value,e)},{default:a(()=>[t(g,{avatar:""},{default:a(()=>[t(E,{color:o.color,rounded:""},null,8,["color"])]),_:2},1024),t(g,null,{default:a(()=>[Q(c(o.label),1)]),_:2},1024),t(g,{side:""},{default:a(()=>[e.status===o.value?(i(),A(N,{key:0,name:"check"})):S("",!0)]),_:2},1024)]),_:2},1032,["onClick"]),[[L]])),64))]),_:2},1024)]),_:2},1024)])]),_:2},1032,["props"])]),"body-cell-priority":a(({row:e,col:r})=>[t(m,{props:{row:e,col:r}},{default:a(()=>[e.status!=="done"?(i(),p("div",Qe,[t(ye,{value:e.priority,options:B},null,8,["value"]),t(U,{anchor:"bottom middle",self:"top middle"},{default:a(()=>[t(G,{dense:""},{default:a(()=>[(i(),p(J,null,W(B,o=>z(t(K,{key:o.value,clickable:"",onClick:ne=>re(e.id,o.value,e)},{default:a(()=>[t(g,{avatar:""},{default:a(()=>[t(E,{color:o.color,rounded:""},null,8,["color"])]),_:2},1024),t(g,null,{default:a(()=>[Q(c(o.label),1)]),_:2},1024),t(g,{side:""},{default:a(()=>[e.priority===o.value?(i(),A(N,{key:0,name:"check"})):S("",!0)]),_:2},1024)]),_:2},1032,["onClick"]),[[L]])),64))]),_:2},1024)]),_:2},1024)])):(i(),p("div",Se,[t(E,{label:"Baixa",class:ge(["tw-font-medium","tw-rounded-md","tw-p-2","tw-pe-3","tw-ps-3","tw-rounded-sm","tw-bg-gray-200"]),align:"middle"})]))]),_:2},1032,["props"])]),"body-cell-actions":a(({row:e,col:r})=>[t(m,{props:{row:e,col:r},class:"tw-text-right tw-space-x-1"},{default:a(()=>[t(u(R),{href:s.route("panel.tasks.edit",e.id)},{default:a(()=>[t(_,{dense:"",flat:"",icon:"edit"})]),_:1},8,["href"]),t(_,{dense:"",flat:"",icon:"delete",color:"negative",onClick:o=>le(e.id)},null,8,["onClick"])]),_:2},1032,["props"])]),"no-data":a(()=>[...l[8]||(l[8]=[v("div",{class:"tw-text-gray-500 tw-py-6"},"Nenhuma tarefa encontrada.",-1)])]),_:1},8,["rows","loading","pagination","rows-number","no-data-label","no-results-label","loading-label","rows-per-page-label","all-rows-label","pagination-label"])]),_:1}),t(fe,{modelValue:D.value,"onUpdate:modelValue":l[7]||(l[7]=e=>D.value=e),persistent:""},{default:a(()=>[t(M,{class:"tw-w-full md:tw-w-[700px] tw-max-w-full tw-rounded-2xl"},{default:a(()=>[t(q,{class:"tw-font-semibold tw-text-lg"},{default:a(()=>[Q(c(O.value),1)]),_:1}),t(q,null,{default:a(()=>[$.value?(i(),p("div",Ve,"Carregando...")):(i(),p("div",Pe,c(C.value||"Sem descrição."),1))]),_:1}),t(pe,{align:"right"},{default:a(()=>[z(t(_,{flat:"",label:"Fechar"},null,512),[[L]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Ne as default};
