import{u as ae,E as te,h as x,A as le,B as i,k,c as U,n as M,r as oe}from"./vendor-quasar-D0sfcEux.js";import{r as c,f as ne,w as ie,e as re,E as P,F as g,C as o,u as z,N as se,B as l,O as n,A as y,K as _,L as d,J as B,M as V,G as ce,S as h}from"./vendor-D6jaF0sv.js";import de from"./pageviewdetailmodal-lJZj4z4V.js";import{_ as ue}from"../app-PRapPME2.js";const fe={class:"row q-mb-md items-center q-col-gutter-md"},ge={class:"col-12 col-md-4 q-mb-sm q-mb-md-0"},me={class:"col-12 col-md-4 col-lg-3 q-mt-sm q-mt-md-0 q-pl-md-sm"},ve={class:"tw-flex tw-items-center tw-gap-1"},we={class:"tw-flex tw-items-center tw-gap-2"},pe={class:"tw-flex tw-items-center tw-gap-2 tw-flex-wrap"},_e={class:"tw-inline-flex tw-items-center tw-gap-1"},be={key:0,class:"tw-text-slate-400"},ye={key:1,class:"tw-inline-flex tw-items-center tw-gap-1"},he={class:"tw-flex tw-items-center tw-gap-2"},Ce=["src","alt"],xe={__name:"Pageviews",setup(ke){const I=c([]),w=c(!1),j=c(null),u=ae(),f=c({page:1,rowsPerPage:20,rowsNumber:0,sortBy:"created_at",descending:!0}),C=c(null),R=c([]),L={label:"Não determinado",color:"#FCE7F3",description:"Categoria ainda não determinada."},$=c(!1),D=c(!1),N=c(null),p=c([]),T=ne(()=>p.value.length>0),q="https://attributa.master.dev.br".replace(/\/$/,""),G=[{name:"created_at",label:"Data",field:"created_at_formatted",sortable:!0,align:"left"},{name:"ip",label:"Classificação / IP",field:"ip",sortable:!0,align:"left"},{name:"campaign_name",label:"Campanha",field:"campaign_name",sortable:!0,align:"left"},{name:"traffic_source",label:"Origem do Tráfego",field:"traffic_source_name",sortable:!0,align:"left"},{name:"device_browser",label:"Dispositivo/Navegador",field:a=>W(a),sortable:!0,align:"left"},{name:"country_code",label:"País",field:"country_code",sortable:!0,align:"left"},{name:"region_name",label:"Região",field:"region_name",sortable:!0,align:"left"},{name:"city",label:"Cidade",field:"city",sortable:!0,align:"left"},{name:"gclid",label:"GCLID",field:"has_gclid",sortable:!0,align:"left"},{name:"conversion",label:"Conversão",field:"conversion",sortable:!0,align:"left"},{name:"details",label:"Detalhes",field:"id",align:"center"},{name:"actions",label:"Ações",field:"id",align:"right"}];function F(a){return{label:a?.ip_category_name??L.label,color:a?.ip_category_color??L.color,description:a?.ip_category_description??L.description}}function S(a){return{label:a?.traffic_source_name??"-",icon:a?.traffic_source_icon||"help_outline",color:a?.traffic_source_color||"#64748B"}}function Q(a){const t=a?.country_code;if(!t)return null;const e=String(t).toLowerCase();return`${q}/assets/country-flags/${e}.svg`}function O(a){return a===!0||a===1||a==="1"}function K(a){return a===!0||a===1||a==="1"?!0:typeof a=="string"?a.trim().length>0&&a!=="0":!1}function E(a){const t=String(a||"").trim();return t?t.split(/[_\s-]+/).filter(Boolean).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"-"}function W(a){const t=E(a?.device_type),e=String(a?.browser_name||"").trim()||"-";return t==="-"&&e==="-"?"-":t==="-"?e:e==="-"?t:`${t} • ${e}`}function m(a){return{deviceLabel:E(a?.device_type),deviceIcon:a?.device_icon||"devices_other",deviceColor:a?.device_color||"#64748B",browserLabel:String(a?.browser_name||"").trim()||"-"}}async function J(a,t="Valor"){if(a)try{await navigator.clipboard.writeText(String(a)),u.notify({type:"positive",message:`${t} copiado.`})}catch{u.notify({type:"negative",message:`Não foi possível copiar ${t.toLowerCase()}.`})}}function Y(){h.get(route("panel.atividade.campaigns")).then(a=>{R.value=a.data})}function b(a){w.value=!0;const{page:t,rowsPerPage:e,sortBy:r,descending:s}=a.pagination;return h.get(route("panel.atividade.pageviews.data"),{params:{page:t,per_page:e,sortBy:r,descending:s,campaign_id:C.value}}).then(v=>{I.value=v.data.data,p.value=[],f.value={...f.value,page:v.data.current_page,rowsPerPage:v.data.per_page,rowsNumber:v.data.total,sortBy:r,descending:s}}).finally(()=>{w.value=!1})}async function H(a){if(!a)return;let t=!0;const e=typeof window<"u",r=e?window.$confirm:null;if(r?t=await r({title:"Excluir pageview",message:"Esta ação é permanente. Deseja realmente remover?",okLabel:"Remover",okColor:"negative"}):e&&(t=window.confirm("Excluir este pageview?")),!!t){w.value=!0;try{const{data:s}=await h.delete(route("panel.atividade.pageviews.destroy",a));if(s?.deleted===!1){u.notify({type:"warning",message:s?.message||"Pageview convertido não pode ser excluído."});return}u.notify({type:"positive",message:s?.message||"Pageview excluído com sucesso."}),await b({pagination:f.value})}catch{u.notify({type:"negative",message:"Falha ao excluir pageview."})}finally{w.value=!1}}}async function X(){if(!T.value)return;let a=!0;const t=typeof window<"u",e=t?window.$confirm:null,r=`Você selecionou ${p.value.length} registro(s). Deseja remover?`;if(e?a=await e({title:"Remover pageviews",message:r,okLabel:"Remover",okColor:"negative"}):t&&(a=window.confirm(r)),!!a){w.value=!0;try{const{data:s}=await h.delete(route("panel.atividade.pageviews.bulk-destroy"),{data:{ids:p.value.map(ee=>ee.id)}}),v=Number(s?.deleted||0),A=Number(s?.ignored_converted||0);v>0&&A>0?u.notify({type:"warning",message:`${v} removido(s). ${A} convertido(s) ignorado(s).`}):v>0?u.notify({type:"positive",message:s?.message||"Pageviews excluídos com sucesso."}):u.notify({type:"warning",message:s?.message||"Nenhum pageview elegível para exclusão."}),await b({pagination:f.value})}catch{u.notify({type:"negative",message:"Falha ao remover os pageviews selecionados."})}finally{w.value=!1}}}async function Z(a){$.value=!0,D.value=!0,N.value=null;try{const t=await h.get(route("panel.atividade.pageviews.show",a.id));N.value=t.data}finally{D.value=!1}}return ie(C,()=>{f.value.page=1,b({pagination:f.value})}),re(()=>{Y(),b({pagination:f.value})}),(a,t)=>(g(),P(ce,null,[o(z(se),{title:"Relatório de atividade"}),o(oe,{flat:"",bordered:"",class:"tw-rounded-2xl tw-p-4"},{default:l(()=>[n("div",fe,[n("div",ge,[o(te,{ref_key:"tableRef",ref:j,modelValue:C.value,"onUpdate:modelValue":t[0]||(t[0]=e=>C.value=e),options:R.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",clearable:"",label:"Filtrar por campanha"},null,8,["modelValue","options"])]),n("div",me,[o(x,{color:"negative",label:"Remover selecionados",disable:!T.value,onClick:X,class:"tw-w-full lg:tw-w-auto bulk-delete-btn"},null,8,["disable"])])]),o(le,{rows:I.value,columns:G,"row-key":"id",loading:w.value,pagination:f.value,"onUpdate:pagination":t[1]||(t[1]=e=>f.value=e),"binary-state-sort":!0,onRequest:b,selection:"multiple",selected:p.value,"onUpdate:selected":t[2]||(t[2]=e=>p.value=e)},{"body-cell-created_at":l(e=>[o(i,{props:e},{default:l(()=>[_(d(e.value),1)]),_:2},1032,["props"])]),"body-cell-ip":l(e=>[o(i,{props:e},{default:l(()=>[n("div",ve,[n("span",{class:"tw-inline-flex tw-h-3 tw-w-3 tw-rounded-full tw-border tw-border-white/20 tw-shadow-sm",style:V({backgroundColor:F(e.row).color})},null,4),n("span",null,d(e.value||"-"),1),e.value?(g(),y(x,{key:0,dense:"",flat:"",round:"",size:"sm",icon:"content_copy",color:"primary",onClick:r=>J(e.value,"IP")},{default:l(()=>[o(M,null,{default:l(()=>[...t[4]||(t[4]=[_("Copiar IP",-1)])]),_:1})]),_:1},8,["onClick"])):B("",!0),o(M,{class:"tw-text-xs tw-max-w-xs tw-leading-snug"},{default:l(()=>[_(d(F(e.row).description),1)]),_:2},1024)])]),_:2},1032,["props"])]),"body-cell-campaign_name":l(e=>[o(i,{props:e},{default:l(()=>[_(d(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-traffic_source":l(e=>[o(i,{props:e},{default:l(()=>[n("div",we,[o(U,{name:S(e.row).icon,size:"18px",color:"primary",style:V({color:S(e.row).color})},null,8,["name","style"]),n("span",null,d(S(e.row).label),1)])]),_:2},1032,["props"])]),"body-cell-device_browser":l(e=>[o(i,{props:e},{default:l(()=>[n("div",pe,[n("div",_e,[o(U,{name:m(e.row).deviceIcon,size:"18px",style:V({color:m(e.row).deviceColor})},null,8,["name","style"]),n("span",null,d(m(e.row).deviceLabel),1)]),m(e.row).browserLabel&&m(e.row).browserLabel!=="-"?(g(),P("span",be," • ")):B("",!0),m(e.row).browserLabel&&m(e.row).browserLabel!=="-"?(g(),P("div",ye,[n("span",null,d(m(e.row).browserLabel),1)])):B("",!0)])]),_:2},1032,["props"])]),"body-cell-country_code":l(e=>[o(i,{props:e},{default:l(()=>[n("div",he,[Q(e.row)?(g(),P("img",{key:0,src:Q(e.row),alt:e.value,class:"tw-w-6 tw-h-4 tw-rounded-sm tw-object-cover tw-border tw-border-gray-200"},null,8,Ce)):B("",!0),n("span",null,d(e.value?e.value.toUpperCase():"-"),1)])]),_:2},1032,["props"])]),"body-cell-region_name":l(e=>[o(i,{props:e},{default:l(()=>[_(d(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-city":l(e=>[o(i,{props:e},{default:l(()=>[_(d(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-gclid":l(e=>[o(i,{props:e},{default:l(()=>[K(e.value)?(g(),y(k,{key:0,color:"primary",label:"Sim"})):(g(),y(k,{key:1,color:"grey-4","text-color":"dark",label:"Não"}))]),_:2},1032,["props"])]),"body-cell-conversion":l(e=>[o(i,{props:e},{default:l(()=>[O(e.value)?(g(),y(k,{key:0,color:"green",label:"Convertido"})):(g(),y(k,{key:1,color:"grey-4","text-color":"dark",label:"Não convertido"}))]),_:2},1032,["props"])]),"body-cell-details":l(e=>[o(i,{props:e},{default:l(()=>[o(x,{dense:"",flat:"",round:"",size:"sm",icon:"manage_search",color:"primary",onClick:r=>Z(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-actions":l(e=>[o(i,{props:e,class:"tw-text-right"},{default:l(()=>[o(x,{dense:"",flat:"",icon:"delete",color:"negative",onClick:r=>H(e.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","selected"])]),_:1}),o(de,{modelValue:$.value,"onUpdate:modelValue":t[3]||(t[3]=e=>$.value=e),loading:D.value,payload:N.value,"asset-base-url":z(q)},null,8,["modelValue","loading","payload","asset-base-url"])],64))}},De=ue(xe,[["__scopeId","data-v-8e665d35"]]);export{De as default};
