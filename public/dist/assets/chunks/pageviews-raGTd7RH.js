import{C as de,A as ce,B as d,h as R,k as f,r as z,s as j,E as ue,Q as ve,a as ge,b as pe,v as _e}from"./vendor-quasar-CQUzQrOh.js";import{r as v,f as r,w as me,e as fe,G as b,H as n,E as s,u as ye,P as we,D as o,Q as e,C as u,M as _,N as i,O as A,L as q,I as N,J as E,V as L}from"./vendor-D8nj3W7R.js";import{_ as be}from"../app-D_6v0H-1.js";const ke={class:"row q-mb-md items-center"},Ce={class:"col-12 col-md-4"},he={class:"tw-flex tw-items-center tw-gap-2"},Pe={class:"tw-text-sm tw-font-medium"},xe={class:"detail-section"},Ne={class:"section-card"},Le={class:"section-card__body"},Se={class:"tw-grid md:tw-grid-cols-2 lg:tw-grid-cols-3 tw-gap-4"},Ie={class:"detail-value"},De={class:"detail-value"},Re={class:"detail-value"},Ae={class:"tw-mt-1"},Ee={class:"ip-category-description"},Qe={class:"tw-mt-1"},Be={class:"detail-section"},Ue={class:"section-card"},Ve={class:"section-card__body"},Fe={class:"tw-grid md:tw-grid-cols-2 lg:tw-grid-cols-3 tw-gap-4"},Oe={class:"detail-label"},Ge={class:"detail-value"},Te={class:"detail-section"},$e={class:"section-card"},ze={class:"section-card__body section-body--stack"},je={class:"detail-value tw-break-all"},qe={class:"tw-mt-2"},Me={class:"tw-text-xs tw-uppercase tw-text-slate-500"},He={class:"tw-text-sm tw-font-medium tw-break-all"},Je={key:1,class:"tw-text-sm tw-text-slate-500"},Ke={class:"detail-section"},Ye={class:"section-card"},We={class:"section-card__body"},Ze={class:"tw-grid md:tw-grid-cols-2 lg:tw-grid-cols-3 tw-gap-4"},Xe={class:"detail-value"},ea={class:"detail-value"},aa={class:"tw-mt-1"},ta={class:"ip-category-description"},la={class:"detail-value"},oa={class:"detail-value"},ia={class:"tw-grid md:tw-grid-cols-2 lg:tw-grid-cols-3 tw-gap-3 tw-mt-4"},sa={class:"detail-label"},na={class:"detail-value"},ra={__name:"Pageviews",setup(da){const Q=v([]),y=v(!1),M=v(null),g=v({page:1,rowsPerPage:20,rowsNumber:0,sortBy:"created_at",descending:!0}),k=v(null),B=v([]),U={label:"Não determinado",color:"#FCE7F3"},H={name:"Não determinado",color_hex:"#FCE7F3",description:"Categoria ainda não determinada."},C=v(!1),h=v(!1),m=v(null),w=r(()=>m.value?.pageview??{}),V=r(()=>m.value?.url??{full:null,origin:null,path:null,query_params:{}}),J=r(()=>m.value?.geo??{}),p=r(()=>m.value?.network??{}),F=r(()=>{const l=V.value?.query_params??{};return Object.entries(l)}),K=r(()=>F.value.length>0),Y=r(()=>w.value?.campaign?.name??"-"),W=r(()=>p.value?.flags??{}),S=r(()=>w.value?.ip_category??H),I=r(()=>p.value?.ip_category??null),Z=r(()=>I.value?.color_hex??"#475569"),X=r(()=>I.value?.name??"-"),ee=r(()=>I.value?.description??"Sem descrição."),ae=r(()=>O(V.value?.full||"")),te=[{name:"created_at",label:"Data",field:"created_at",sortable:!0,align:"left"},{name:"ip_category",label:"Classificação IP",field:l=>l?.ip_category_name,sortable:!0,align:"left"},{name:"ip",label:"IP",field:"ip",sortable:!0,align:"left"},{name:"campaign_name",label:"Campanha",field:"campaign_name",sortable:!0,align:"left"},{name:"country_code",label:"País",field:"country_code",sortable:!0,align:"left"},{name:"region_name",label:"Região",field:"region_name",sortable:!0,align:"left"},{name:"city",label:"Cidade",field:"city",sortable:!0,align:"left"},{name:"url",label:"URL",field:"url",sortable:!0,align:"left"},{name:"gclid",label:"GCLID",field:"gclid",sortable:!0,align:"left"},{name:"conversion",label:"Conversão",field:"conversion",sortable:!0,align:"left"},{name:"details",label:"Detalhes",field:"id",align:"center"},{name:"actions",label:"Ações",field:"id",align:"right"}];function D(l){return l?new Date(l).toLocaleString("pt-BR",{dateStyle:"short",timeStyle:"medium"}):"-"}function O(l){if(!l)return"-";try{const t=typeof window<"u"?window.location.origin:"https://placeholder.local",a=new URL(l,t);return`${a.origin}${a.pathname}`}catch{return l.split("?")[0]??l}}function G(l){return{label:l?.ip_category_name??U.label,color:l?.ip_category_color??U.color}}function le(l){return l==null?!1:String(l).trim().length>0}function T(l){return l===!0||l===1||l==="1"}function oe(l){return l==null?"-":l?"Sim":"Não"}function ie(l){if(l==null)return"-";if(Array.isArray(l)||typeof l=="object")try{return JSON.stringify(l)}catch{return String(l)}return String(l)}function se(){L.get(route("panel.atividade.campaigns")).then(l=>{B.value=l.data})}function P(l){y.value=!0;const{page:t,rowsPerPage:a,sortBy:c,descending:$}=l.pagination;return L.get(route("panel.atividade.pageviews.data"),{params:{page:t,per_page:a,sortBy:c,descending:$,campaign_id:k.value}}).then(x=>{Q.value=x.data.data,g.value={...g.value,page:x.data.current_page,rowsPerPage:x.data.per_page,rowsNumber:x.data.total,sortBy:c,descending:$}}).finally(()=>{y.value=!1})}async function ne(l){if(!l)return;let t=!0;const a=typeof window<"u",c=a?window.$confirm:null;if(c?t=await c({title:"Excluir pageview",message:"Esta ação é permanente. Deseja realmente remover?",okLabel:"Remover",okColor:"negative"}):a&&(t=window.confirm("Excluir este pageview?")),!!t){y.value=!0;try{await L.delete(route("panel.atividade.pageviews.destroy",l)),await P({pagination:g.value})}finally{y.value=!1}}}async function re(l){C.value=!0,h.value=!0,m.value=null;try{const t=await L.get(route("panel.atividade.pageviews.show",l.id));m.value=t.data}finally{h.value=!1}}return me(k,()=>{g.value.page=1,P({pagination:g.value})}),fe(()=>{se(),P({pagination:g.value})}),(l,t)=>(n(),b(N,null,[s(ye(we),{title:"Relatório de atividade"}),s(z,{flat:"",bordered:"",class:"tw-rounded-2xl tw-p-4"},{default:o(()=>[e("div",ke,[e("div",Ce,[s(de,{ref_key:"tableRef",ref:M,modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=a=>k.value=a),options:B.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",clearable:"",label:"Filtrar por campanha"},null,8,["modelValue","options"])])]),s(ce,{rows:Q.value,columns:te,"row-key":"id",loading:y.value,pagination:g.value,"onUpdate:pagination":t[1]||(t[1]=a=>g.value=a),"binary-state-sort":!0,onRequest:P},{"body-cell-created_at":o(a=>[s(d,{props:a},{default:o(()=>[_(i(D(a.value)),1)]),_:2},1032,["props"])]),"body-cell-ip_category":o(a=>[s(d,{props:a},{default:o(()=>[e("div",he,[e("span",{class:"tw-inline-flex tw-h-3 tw-w-3 tw-rounded-full tw-border tw-border-white/20 tw-shadow-sm",style:A({backgroundColor:G(a.row).color})},null,4),e("span",Pe,i(G(a.row).label),1)])]),_:2},1032,["props"])]),"body-cell-ip":o(a=>[s(d,{props:a},{default:o(()=>[_(i(a.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-campaign_name":o(a=>[s(d,{props:a},{default:o(()=>[_(i(a.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-country_code":o(a=>[s(d,{props:a},{default:o(()=>[_(i(a.value?a.value.toUpperCase():"-"),1)]),_:2},1032,["props"])]),"body-cell-region_name":o(a=>[s(d,{props:a},{default:o(()=>[_(i(a.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-city":o(a=>[s(d,{props:a},{default:o(()=>[_(i(a.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-url":o(a=>[s(d,{props:a},{default:o(()=>[_(i(O(a.value)),1)]),_:2},1032,["props"])]),"body-cell-gclid":o(a=>[s(d,{props:a},{default:o(()=>[le(a.value)?(n(),u(f,{key:0,color:"primary",label:"Sim"})):(n(),u(f,{key:1,color:"grey-4","text-color":"dark",label:"Não"}))]),_:2},1032,["props"])]),"body-cell-conversion":o(a=>[s(d,{props:a},{default:o(()=>[T(a.value)?(n(),u(f,{key:0,color:"green",label:"Convertido"})):(n(),u(f,{key:1,color:"grey-4","text-color":"dark",label:"Não convertido"}))]),_:2},1032,["props"])]),"body-cell-details":o(a=>[s(d,{props:a},{default:o(()=>[s(R,{dense:"",flat:"",round:"",size:"sm",icon:"manage_search",color:"primary",onClick:c=>re(a.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-actions":o(a=>[s(d,{props:a,class:"tw-text-right"},{default:o(()=>[s(R,{dense:"",flat:"",icon:"delete",color:"negative",onClick:c=>ne(a.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])]),_:1}),s(_e,{modelValue:C.value,"onUpdate:modelValue":t[3]||(t[3]=a=>C.value=a),"transition-show":"scale","transition-hide":"scale"},{default:o(()=>[s(z,{class:"pageview-detail-card"},{default:o(()=>[s(j,{class:"tw-flex tw-justify-end"},{default:o(()=>[s(R,{icon:"close",flat:"",round:"",dense:"",onClick:t[2]||(t[2]=a=>C.value=!1)})]),_:1}),h.value?(n(),u(ue,{key:0,indeterminate:"",color:"primary"})):q("",!0),h.value?q("",!0):(n(),u(j,{key:1,class:"tw-space-y-6"},{default:o(()=>[e("section",xe,[e("div",Ne,[t[9]||(t[9]=e("div",{class:"section-card__header"},"VISITA",-1)),e("div",Le,[e("div",Se,[e("div",null,[t[4]||(t[4]=e("div",{class:"detail-label"},"Data/Horário",-1)),e("div",Ie,i(D(w.value.created_at)),1)]),e("div",null,[t[5]||(t[5]=e("div",{class:"detail-label"},"Campanha",-1)),e("div",De,i(Y.value),1)]),e("div",null,[t[6]||(t[6]=e("div",{class:"detail-label"},"IP",-1)),e("div",Re,i(w.value.ip||"-"),1)]),e("div",null,[t[7]||(t[7]=e("div",{class:"detail-label"},"Categoria de IP",-1)),e("div",Ae,[e("div",{class:"ip-category-label",style:A({color:S.value.color_hex})},i(S.value.name),5),e("div",Ee,i(S.value.description||"Sem descrição."),1)])]),e("div",null,[t[8]||(t[8]=e("div",{class:"detail-label"},"Conversão",-1)),e("div",Qe,[T(w.value.conversion)?(n(),u(f,{key:0,color:"green",label:"Convertido"})):(n(),u(f,{key:1,color:"grey-4","text-color":"dark",label:"Não convertido"}))])])])])])]),e("section",Be,[e("div",Ue,[t[10]||(t[10]=e("div",{class:"section-card__header"},"GEOLOCALIZAÇÃO",-1)),e("div",Ve,[e("div",Fe,[(n(),b(N,null,E([{label:"País",key:"country_name"},{label:"Código",key:"country_code"},{label:"Região",key:"region_name"},{label:"Cidade",key:"city"},{label:"Latitude",key:"latitude"},{label:"Longitude",key:"longitude"},{label:"Timezone",key:"timezone"}],a=>e("div",{key:a.key},[e("div",Oe,i(a.label),1),e("div",Ge,i(J.value[a.key]??"-"),1)])),64))])])])]),e("section",Te,[e("div",$e,[t[13]||(t[13]=e("div",{class:"section-card__header"},"ORIGEM DA URL",-1)),e("div",ze,[e("div",null,[t[11]||(t[11]=e("div",{class:"detail-label"},"Página (sem parâmetros)",-1)),e("div",je,i(ae.value),1)]),e("div",null,[t[12]||(t[12]=e("div",{class:"detail-label"},"Parâmetros",-1)),e("div",qe,[K.value?(n(),u(ve,{key:0,bordered:"",class:"rounded-borders"},{default:o(()=>[(n(!0),b(N,null,E(F.value,([a,c])=>(n(),u(ge,{key:`${a}-${c}`},{default:o(()=>[s(pe,null,{default:o(()=>[e("div",Me,i(a),1),e("div",He,i(ie(c)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(n(),b("div",Je,"Sem parâmetros na URL."))])])])])]),e("section",Ke,[e("div",Ye,[t[19]||(t[19]=e("div",{class:"section-card__header"},"REDE & SEGURANÇA",-1)),e("div",We,[e("div",Ze,[e("div",null,[t[14]||(t[14]=e("div",{class:"detail-label"},"ISP",-1)),e("div",Xe,i(p.value.isp||"-"),1)]),e("div",null,[t[15]||(t[15]=e("div",{class:"detail-label"},"Organização",-1)),e("div",ea,i(p.value.organization||"-"),1)]),e("div",null,[t[16]||(t[16]=e("div",{class:"detail-label"},"Categoria IP (Lookup)",-1)),e("div",aa,[e("div",{class:"ip-category-label",style:A({color:Z.value})},i(X.value),5),e("div",ta,i(ee.value),1)])]),e("div",null,[t[17]||(t[17]=e("div",{class:"detail-label"},"Fraud Score",-1)),e("div",la,i(p.value.fraud_score??"-"),1)]),e("div",null,[t[18]||(t[18]=e("div",{class:"detail-label"},"Última verificação",-1)),e("div",oa,i(p.value.last_checked?D(p.value.last_checked):"-"),1)])]),e("div",ia,[(n(),b(N,null,E([{key:"is_proxy",label:"Proxy"},{key:"is_vpn",label:"VPN"},{key:"is_tor",label:"Tor"},{key:"is_datacenter",label:"Datacenter"},{key:"is_bot",label:"Bot"}],a=>e("div",{key:a.key},[e("div",sa,i(a.label),1),e("div",na,i(oe(W.value[a.key])),1)])),64))])])])])]),_:1}))]),_:1})]),_:1},8,["modelValue"])],64))}},ga=be(ra,[["__scopeId","data-v-cb539019"]]);export{ga as default};
