import{h as c,s as y,x as pe,c as F,A as me,B as P,n as ge,U as fe,Q as we,a as ve,b as L,G as h,r as U,i as B,t as W,v as X,F as be,N as w}from"./vendor-quasar-DQshVSCQ.js";import{f as _e,r as u,w as Y,E as p,F as i,C as t,P as n,u as g,O as ye,B as o,Q as he,$ as xe,N as K,M as m,L as R,G as O,H as Z,j as x,A as D,J as E,R as G,U as M}from"./vendor-auwb9AcH.js";import{q as v}from"./qtable-pt-CkdICETI.js";import{_ as Ce}from"../app-DqTThPGM.js";const ke={class:"tw-space-y-3"},Ne={class:"tw-flex tw-items-center tw-justify-between tw-flex-col sm:tw-flex-row tw-gap-3"},Se={class:"tw-flex tw-gap-3 tw-flex-col md:tw-flex-row"},Qe={class:"tw-flex tw-items-center tw-gap-2 tw-flex-wrap"},Pe={key:0,class:"tw-inline-flex tw-items-center tw-gap-1 tw-text-sm tw-text-gray-600"},Be={key:1},De={class:"status-cell-wrapper"},Te={class:"status-pill"},Ve={key:0,class:"tw-text-center tw-py-6"},je={class:"tw-text-sm tw-text-gray-600"},qe={key:0,class:"tw-text-center tw-py-6"},$e={key:1,class:"tw-text-sm tw-text-gray-600"},ze={key:2,class:"tw-flex tw-flex-wrap tw-gap-2 tw-max-h-96 tw-overflow-y-auto"},Ae={__name:"Index",props:{campaigns:{type:Object,required:!0},campaignStatusCatalog:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})}},setup(H){const d=H,ee=_e(()=>d.campaigns?.data??[]),f=u(d.filters?.search??""),s=u({page:d.campaigns?.current_page??1,rowsPerPage:d.campaigns?.per_page??15,rowsNumber:d.campaigns?.total??0,sortBy:d.filters?.sort??"created_at",descending:(d.filters?.direction??"desc")==="desc"});Y(()=>d.campaigns,e=>{e&&(s.value.page=e.current_page,s.value.rowsPerPage=e.per_page,s.value.rowsNumber=e.total)}),Y(()=>d.filters,e=>{s.value.sortBy=e?.sort??"created_at",s.value.descending=(e?.direction??"desc")==="desc",(e?.search??"")!==f.value&&(f.value=e?.search??"")});const ae=[{name:"code",label:"Código",field:"code",align:"left",sortable:!0},{name:"name",label:"Nome",field:"name",align:"left",sortable:!0},{name:"countries",label:"Países",field:"countries",align:"left"},{name:"channel",label:"Canal",field:e=>e.channel?.name??"-",align:"left"},{name:"conversion_goal",label:"Meta de conversao",field:e=>e.conversion_goal?.goal_code??"-",align:"left"},{name:"status",label:"Status",field:"status",align:"center",sortable:!0},{name:"tracking_snippet",label:"Acompanhamento",field:"code",align:"left"},{name:"actions",label:"Ações",field:"actions",align:"right"}],T=u(!1),V=u(!1),C=u(""),k=u(null),j=u(!1),q=u(!1),N=u(""),$=u(0),S=u([]),b=u({});function z(){const e={page:s.value.page,per_page:s.value.rowsPerPage,sort:s.value.sortBy,direction:s.value.descending?"desc":"asc",search:f.value||void 0};G.get(route("panel.campaigns.index"),e,{preserveState:!0,preserveScroll:!0,replace:!0})}function te({pagination:e}){Object.assign(s.value,e),z()}function A(){s.value.page=1,z()}function le(){f.value!==""&&(f.value="",s.value.page=1,z())}function _(e){return e?.hashid??e?.id}function oe(e){G.visit(route("panel.campaigns.edit",_(e)))}function ne(e){confirm(`Deseja realmente remover a campanha "${e.name}"?`)&&G.delete(route("panel.campaigns.destroy",_(e)))}async function se(e){const l=_(e);if(l){T.value=!0,V.value=!0,C.value="";try{const a=await M.get(route("panel.campaigns.tracking_code",l));C.value=String(a.data.script||"").trim()}catch{w.create({type:"negative",message:"Não foi possível carregar o código de acompanhamento",position:"top-right"})}finally{V.value=!1}}}async function ie(e){const l=_(e);if(l){j.value=!0,q.value=!0,N.value=e?.name??"Campanha",$.value=Number(e?.countries_count??0),S.value=[];try{const a=await M.get(route("panel.campaigns.countries",l));N.value=String(a.data?.campaign?.name??N.value),$.value=Number(a.data?.campaign?.countries_count??0),S.value=Array.isArray(a.data?.countries)?a.data.countries:[]}catch{w.create({type:"negative",message:"Não foi possível carregar a lista de países",position:"top-right"})}finally{q.value=!1}}}function re(){if(k.value){k.value.focus(),k.value.select();try{if(!document.execCommand("copy"))throw new Error;w.create({type:"positive",message:"Código copiado",timeout:2e3,position:"top-right"})}catch{w.create({type:"negative",message:"Não foi possível copiar o código",timeout:3e3,position:"top-right"})}}}function ue(e){return I(e)?.label??"-"}function J(e){return I(e)?.color_hex??"#64748B"}function ce(e){const l=I(e);return l?l.tooltip??`Status da campanha: ${l.label}`:"Status da campanha"}function I(e){const l=Number(e?.campaign_status_id??0);return(d.campaignStatusCatalog??[]).find(a=>Number(a?.id??0)===l)??null}async function de(e,l){const a=_(e);if(a&&Number(e?.campaign_status_id??0)!==Number(l??0)){b.value={...b.value,[e.id]:!0};try{const r=await M.patch(route("panel.campaigns.update-status",a),{campaign_status_id:l}),Q=r.data?.campaign;Q&&Number(Q.id)===Number(e.id)&&(e.campaign_status_id=Q.campaign_status_id),w.create({type:"positive",message:r.data?.message||"Status atualizado com sucesso.",position:"top-right"})}catch{w.create({type:"negative",message:"Não foi possível atualizar o status da campanha.",position:"top-right"})}finally{b.value={...b.value,[e.id]:!1}}}}return(e,l)=>(i(),p(O,null,[t(g(ye),{title:"Campanhas"}),n("div",ke,[n("div",Ne,[l[4]||(l[4]=n("h1",{class:"tw-text-lg tw-font-semibold"}," Campanhas ",-1)),t(g(he),{href:e.route("panel.campaigns.create")},{default:o(()=>[t(c,{color:"positive",icon:"add",label:"Nova Campanha",unelevated:""})]),_:1},8,["href"])]),t(U,{flat:"",bordered:""},{default:o(()=>[t(y,{class:"tw-space-y-3"},{default:o(()=>[n("div",Se,[t(pe,{modelValue:f.value,"onUpdate:modelValue":l[0]||(l[0]=a=>f.value=a),dense:"",outlined:"",clearable:"",placeholder:"Pesquisar por código ou nome",class:"md:tw-flex-1",onKeyup:xe(A,["enter"]),onClear:le},{append:o(()=>[t(F,{name:"search",class:"cursor-pointer",onClick:A})]),_:1},8,["modelValue"]),t(c,{outline:"",color:"primary",icon:"search",label:"Filtrar",class:"md:tw-w-auto",onClick:A})]),t(me,{flat:"",rows:ee.value,columns:ae,"row-key":"id","binary-state-sort":"",pagination:s.value,"onUpdate:pagination":l[1]||(l[1]=a=>s.value=a),"rows-per-page-options":[10,15,25,50],"no-data-label":g(v).noData,"no-results-label":g(v).noResults,"loading-label":g(v).loading,"rows-per-page-label":g(v).recordsPerPage,"all-rows-label":g(v).allRows,"pagination-label":g(v).pagination,onRequest:te},{"body-cell-countries":o(a=>[t(P,{props:a},{default:o(()=>[n("div",Qe,[Number(a.row.countries_count??0)===0?(i(),p("span",Pe,[t(F,{name:"public",size:"16px"}),l[5]||(l[5]=n("span",null,"Global",-1))])):(i(),p("span",Be,m((a.row.countries_preview??[]).join(", ")),1)),Number(a.row.countries_hidden_count??0)>0?(i(),D(c,{key:2,flat:"",dense:"","no-caps":"",color:"primary",label:`(+${a.row.countries_hidden_count??0})`,onClick:r=>ie(a.row)},null,8,["label","onClick"])):E("",!0)])]),_:2},1032,["props"])]),"body-cell-status":o(a=>[t(P,{props:a,class:"tw-text-center"},{default:o(()=>[n("div",De,[n("div",Te,[n("span",{class:"status-dot",style:K({backgroundColor:J(a.row)})},null,4),n("span",null,m(ue(a.row)),1),t(ge,{style:K({backgroundColor:J(a.row),color:"#fff"})},{default:o(()=>[R(m(ce(a.row)),1)]),_:2},1032,["style"])]),t(fe,{flat:"",round:"",dense:"","dropdown-icon":"arrow_drop_down","no-icon-animation":"",disable:!!b.value[a.row.id]},{default:o(()=>[t(we,{dense:""},{default:o(()=>[(i(!0),p(O,null,Z(H.campaignStatusCatalog,r=>x((i(),D(ve,{key:r.id,clickable:"",onClick:Q=>de(a.row,r.id)},{default:o(()=>[t(L,{avatar:""},{default:o(()=>[n("span",{class:"tw-inline-flex tw-h-3 tw-w-3 tw-rounded-full tw-border tw-border-black/10",style:K({backgroundColor:r.color_hex})},null,4)]),_:2},1024),t(L,null,{default:o(()=>[R(m(r.label),1)]),_:2},1024),Number(a.row.campaign_status_id)===Number(r.id)?(i(),D(L,{key:0,side:""},{default:o(()=>[t(F,{name:"check",size:"16px"})]),_:1})):E("",!0)]),_:2},1032,["onClick"])),[[h]])),128))]),_:2},1024)]),_:2},1032,["disable"])])]),_:2},1032,["props"])]),"body-cell-tracking_snippet":o(a=>[t(P,{props:a},{default:o(()=>[t(c,{flat:"",dense:"",size:"sm",icon:"code",color:"primary",label:"Snippet",onClick:r=>se(a.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-actions":o(a=>[t(P,{props:a,class:"tw-text-right"},{default:o(()=>[t(c,{flat:"",dense:"",size:"sm",icon:"edit",class:"qtable-edit-btn",onClick:r=>oe(a.row)},null,8,["onClick"]),t(c,{flat:"",dense:"",size:"sm",icon:"delete",class:"qtable-delete-btn",onClick:r=>ne(a.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","pagination","no-data-label","no-results-label","loading-label","rows-per-page-label","all-rows-label","pagination-label"])]),_:1})]),_:1})]),t(X,{modelValue:T.value,"onUpdate:modelValue":l[2]||(l[2]=a=>T.value=a)},{default:o(()=>[t(U,{style:{"min-width":"750px","max-width":"95vw","min-height":"450px"}},{default:o(()=>[t(y,{class:"tw-flex tw-justify-between tw-items-center"},{default:o(()=>[l[6]||(l[6]=n("div",{class:"tw-text-lg tw-font-semibold"}," Código de acompanhamento ",-1)),x(t(c,{flat:"",dense:"",icon:"close"},null,512),[[h]])]),_:1}),t(B),t(y,null,{default:o(()=>[V.value?(i(),p("div",Ve," Carregando... ")):E("",!0),n("textarea",{ref_key:"trackingTextarea",ref:k,class:"tw-w-full tw-h-72 tw-font-mono tw-text-sm tw-p-3 tw-bg-gray-100 tw-rounded",readonly:""},m(C.value),513)]),_:1}),t(B),t(W,{align:"right"},{default:o(()=>[t(c,{flat:"",icon:"content_copy",label:"Copiar",disable:!C.value,onClick:re},null,8,["disable"]),x(t(c,{color:"primary",label:"Fechar"},null,512),[[h]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(X,{modelValue:j.value,"onUpdate:modelValue":l[3]||(l[3]=a=>j.value=a)},{default:o(()=>[t(U,{style:{"min-width":"620px","max-width":"95vw","max-height":"85vh"}},{default:o(()=>[t(y,{class:"tw-flex tw-items-center tw-justify-between"},{default:o(()=>[n("div",null,[l[7]||(l[7]=n("div",{class:"tw-text-lg tw-font-semibold"}," Países da campanha ",-1)),n("div",je,m(N.value)+" · "+m($.value)+" país(es) ",1)]),x(t(c,{flat:"",dense:"",icon:"close"},null,512),[[h]])]),_:1}),t(B),t(y,null,{default:o(()=>[q.value?(i(),p("div",qe," Carregando... ")):S.value.length?(i(),p("div",ze,[(i(!0),p(O,null,Z(S.value,a=>(i(),D(be,{key:a.id,dense:"",square:""},{default:o(()=>[R(m(a.name)+" ("+m(a.iso2)+") ",1)]),_:2},1024))),128))])):(i(),p("div",$e," Nenhum país encontrado para esta campanha. "))]),_:1}),t(B),t(W,{align:"right"},{default:o(()=>[x(t(c,{color:"primary",label:"Fechar"},null,512),[[h]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Ke=Ce(Ae,[["__scopeId","data-v-4bd141ca"]]);export{Ke as default};
