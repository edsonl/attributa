import{x as M,E as u,h as s,F as $,r as J,s as A,G as S,i as B,t as W,v as Y,N as h}from"./vendor-quasar-D0sfcEux.js";import{f as d,r as i,w as Z,Y as z,E as Q,F as k,O as _,C as r,A as H,J as F,u as o,Q as K,Z as X,B as c,j as N,L as ee,G as ae,S as oe}from"./vendor-D6jaF0sv.js";import{_ as le}from"../app-BD3XDZci.js";const te={class:"tw-flex tw-justify-end tw-gap-2"},re={key:0,class:"tw-text-center tw-py-6"},ne={__name:"FormCampaign",props:{campaign:{type:Object,default:null},channels:{type:Array,required:!0},countries:{type:Array,required:!0},affiliate_platforms:{type:Array,required:!0},googleAdsAccounts:{type:Array,required:!0},conversionGoals:{type:Array,required:!0},defaults:{type:Object,default:()=>({})}},setup(y){const t=y,O=d(()=>!!t.campaign),m=i(t.countries??[]),p=i([...t.countries??[]]),b=i(null),U=d(()=>(t.channels??[]).map(e=>({...e,value:e.id,label:e.label??e.name}))),j=d(()=>(t.affiliate_platforms??[]).map(e=>({...e,value:e.id,label:e.label??e.name}))),E=d(()=>(t.conversionGoals??[]).map(e=>({...e,value:e.id,label:e.active===!1?`${e.label??e.goal_code} (inativa)`:e.label??e.goal_code})));Z(()=>t.countries,(e=[])=>{m.value=e,p.value=[...e]});const a=z({name:t.campaign?.name??"",conversion_goal_id:t.campaign?.conversion_goal_id??null,status:t.campaign?.status??!0,channel_id:t.campaign?.channel_id??t.defaults?.channel_id??null,affiliate_platform_id:t.campaign?.affiliate_platform_id??t.defaults?.affiliate_platform_id??null,google_ads_account_id:t.campaign?.google_ads_account_id??null,countries:t.campaign?.countries?t.campaign.countries.map(e=>e.id):[],commission_value:t.campaign?.commission_value??null}),x=d(()=>{if(a.errors.countries)return a.errors.countries;const e=Object.entries(a.errors).find(([l])=>l.startsWith("countries."));return e?e[1]:null});function G(){O.value?a.put(route("panel.campaigns.update",t.campaign.id)):a.post(route("panel.campaigns.store"))}function L(e,l,n){if(!m.value.length)return n();const v=(e||"").trim().toLowerCase();l(()=>{if(!v){p.value=[...m.value];return}p.value=m.value.filter(V=>{const P=(V.name||"").toLowerCase(),R=(V.iso2||"").toLowerCase(),I=(V.iso3||"").toLowerCase();return P.includes(v)||R.includes(v)||I.includes(v)})})}function T(){b.value?.hidePopup&&b.value.hidePopup()}const w=i(!1),C=i(!1),g=i(""),f=i(null);async function q(){if(t.campaign?.id){w.value=!0,C.value=!0,g.value="";try{const e=await oe.get(route("panel.campaigns.tracking_code",t.campaign.id));g.value=String(e.data.script||"").trim()}catch{h.create({type:"negative",message:"Não foi possível carregar o código de acompanhamento",position:"top-right"})}finally{C.value=!1}}}function D(){if(f.value){f.value.focus(),f.value.select();try{if(!document.execCommand("copy"))throw new Error;h.create({type:"positive",message:"Código copiado",timeout:2e3,position:"top-right"})}catch{h.create({type:"negative",message:"Não foi possível copiar o código",timeout:3e3,position:"top-right"})}}}return(e,l)=>(k(),Q(ae,null,[_("form",{onSubmit:X(G,["prevent"]),class:"tw-space-y-6"},[r(M,{modelValue:o(a).name,"onUpdate:modelValue":l[0]||(l[0]=n=>o(a).name=n),label:"Nome da campanha",outlined:"",dense:"",error:!!o(a).errors.name,"error-message":o(a).errors.name},null,8,["modelValue","error","error-message"]),r(u,{modelValue:o(a).channel_id,"onUpdate:modelValue":l[1]||(l[1]=n=>o(a).channel_id=n),options:U.value,"option-label":"label","option-value":"value","emit-value":"","map-options":"",label:"Canal",outlined:"",dense:"",error:!!o(a).errors.channel_id,"error-message":o(a).errors.channel_id},null,8,["modelValue","options","error","error-message"]),r(u,{modelValue:o(a).affiliate_platform_id,"onUpdate:modelValue":l[2]||(l[2]=n=>o(a).affiliate_platform_id=n),options:j.value,"option-label":"label","option-value":"value","emit-value":"","map-options":"",label:"Plataforma de Afiliado",outlined:"",dense:"",error:!!o(a).errors.affiliate_platform_id,"error-message":o(a).errors.affiliate_platform_id},null,8,["modelValue","options","error","error-message"]),r(u,{ref_key:"countrySelectRef",ref:b,label:"Regiões de segmentação (países)",modelValue:o(a).countries,"onUpdate:modelValue":[l[3]||(l[3]=n=>o(a).countries=n),T],options:p.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",multiple:"","use-chips":"","use-input":"",onFilter:L,outlined:"",dense:"",error:!!x.value,"error-message":x.value},null,8,["modelValue","options","error","error-message"]),r(u,{modelValue:o(a).google_ads_account_id,"onUpdate:modelValue":l[4]||(l[4]=n=>o(a).google_ads_account_id=n),options:y.googleAdsAccounts,"option-value":"id","option-label":"label","emit-value":"","map-options":"",clearable:"",label:"Conta de Anúncios",hint:"Selecione a conta do Google Ads desta campanha",error:!!o(a).errors.google_ads_account_id,"error-message":o(a).errors.google_ads_account_id},null,8,["modelValue","options","error","error-message"]),r(u,{modelValue:o(a).conversion_goal_id,"onUpdate:modelValue":l[5]||(l[5]=n=>o(a).conversion_goal_id=n),options:E.value,"option-value":"value","option-label":"label","emit-value":"","map-options":"",clearable:"",label:"Meta de conversao",hint:"Selecione a meta/codigo de conversao vinculada a campanha",outlined:"",dense:"",error:!!o(a).errors.conversion_goal_id,"error-message":o(a).errors.conversion_goal_id},null,8,["modelValue","options","error","error-message"]),y.campaign?(k(),H(s,{key:0,flat:"",icon:"code",color:"primary",label:"Ver código de acompanhamento",onClick:q})):F("",!0),r($,{modelValue:o(a).status,"onUpdate:modelValue":l[6]||(l[6]=n=>o(a).status=n),label:"Campanha ativa"},null,8,["modelValue"]),_("div",te,[r(s,{flat:"",label:"Cancelar",onClick:l[7]||(l[7]=n=>o(K).visit(e.route("panel.campaigns.index")))}),r(s,{color:"primary",label:"Salvar",type:"submit"})])],32),r(Y,{modelValue:w.value,"onUpdate:modelValue":l[8]||(l[8]=n=>w.value=n)},{default:c(()=>[r(J,{style:{"min-width":"720px","max-width":"95vw","min-height":"450px"}},{default:c(()=>[r(A,{class:"tw-flex tw-justify-between tw-items-center"},{default:c(()=>[l[9]||(l[9]=_("div",{class:"tw-text-lg tw-font-semibold"}," Código de acompanhamento ",-1)),N(r(s,{flat:"",dense:"",icon:"close"},null,512),[[S]])]),_:1}),r(B),r(A,null,{default:c(()=>[C.value?(k(),Q("div",re," Carregando... ")):F("",!0),_("textarea",{ref_key:"trackingTextarea",ref:f,class:"tw-w-full tw-h-72 tw-font-mono tw-text-sm tw-p-3 tw-bg-gray-100 tw-rounded",readonly:""},ee(g.value),513)]),_:1}),r(B),r(W,{align:"right"},{default:c(()=>[r(s,{flat:"",icon:"content_copy",label:"Copiar",disable:!g.value,onClick:D},null,8,["disable"]),N(r(s,{color:"primary",label:"Fechar"},null,512),[[S]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},de=le(ne,[["__scopeId","data-v-3fa6c441"]]);export{de as default};
