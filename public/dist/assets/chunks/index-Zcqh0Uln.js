import{h as u,s as y,x as pe,c as H,A as me,B as P,n as ge,L as fe,Q as we,a as ve,b as z,J as h,r as K,i as B,t as W,v as X,G as _e,N as w}from"./vendor-quasar-C0Sd45BE.js";import{f as be,r as c,w as Y,E as p,F as i,C as t,O as n,u as g,N as ye,B as l,P as he,_ as xe,M as F,L as m,K as R,G as U,H as Z,j as x,A as D,J as O,Q as E,S as M}from"./vendor-D6jaF0sv.js";import{q as v}from"./qtable-pt-CkdICETI.js";import{_ as Ce}from"../app-DlqFOGlz.js";const ke={class:"tw-space-y-3"},Ne={class:"tw-flex tw-items-center tw-justify-between tw-flex-col sm:tw-flex-row tw-gap-3"},Se={class:"tw-flex tw-gap-3 tw-flex-col md:tw-flex-row"},Qe={class:"tw-flex tw-items-center tw-gap-2 tw-flex-wrap"},Pe={key:0,class:"tw-text-sm tw-text-gray-600"},Be={key:1},De={class:"status-cell-wrapper"},Te={class:"status-pill"},Ve={key:0,class:"tw-text-center tw-py-6"},je={class:"tw-text-sm tw-text-gray-600"},Ae={key:0,class:"tw-text-center tw-py-6"},Ie={key:1,class:"tw-text-sm tw-text-gray-600"},Le={key:2,class:"tw-flex tw-flex-wrap tw-gap-2 tw-max-h-96 tw-overflow-y-auto"},$e={__name:"Index",props:{campaigns:{type:Object,required:!0},campaignStatusCatalog:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})}},setup(G){const d=G,ee=be(()=>d.campaigns?.data??[]),f=c(d.filters?.search??""),s=c({page:d.campaigns?.current_page??1,rowsPerPage:d.campaigns?.per_page??15,rowsNumber:d.campaigns?.total??0,sortBy:d.filters?.sort??"created_at",descending:(d.filters?.direction??"desc")==="desc"});Y(()=>d.campaigns,e=>{e&&(s.value.page=e.current_page,s.value.rowsPerPage=e.per_page,s.value.rowsNumber=e.total)}),Y(()=>d.filters,e=>{s.value.sortBy=e?.sort??"created_at",s.value.descending=(e?.direction??"desc")==="desc",(e?.search??"")!==f.value&&(f.value=e?.search??"")});const ae=[{name:"code",label:"Código",field:"code",align:"left",sortable:!0},{name:"name",label:"Nome",field:"name",align:"left",sortable:!0},{name:"countries",label:"Países",field:"countries",align:"left"},{name:"channel",label:"Canal",field:e=>e.channel?.name??"-",align:"left"},{name:"conversion_goal",label:"Meta de conversao",field:e=>e.conversion_goal?.goal_code??"-",align:"left"},{name:"status",label:"Status",field:"status",align:"center",sortable:!0},{name:"tracking_snippet",label:"Acompanhamento",field:"code",align:"left"},{name:"actions",label:"Ações",field:"actions",align:"right"}],T=c(!1),V=c(!1),C=c(""),k=c(null),j=c(!1),A=c(!1),N=c(""),I=c(0),S=c([]),_=c({});function L(){const e={page:s.value.page,per_page:s.value.rowsPerPage,sort:s.value.sortBy,direction:s.value.descending?"desc":"asc",search:f.value||void 0};E.get(route("panel.campaigns.index"),e,{preserveState:!0,preserveScroll:!0,replace:!0})}function te({pagination:e}){Object.assign(s.value,e),L()}function $(){s.value.page=1,L()}function le(){f.value!==""&&(f.value="",s.value.page=1,L())}function b(e){return e?.hashid??e?.id}function oe(e){E.visit(route("panel.campaigns.edit",b(e)))}function ne(e){confirm(`Deseja realmente remover a campanha "${e.name}"?`)&&E.delete(route("panel.campaigns.destroy",b(e)))}async function se(e){const o=b(e);if(o){T.value=!0,V.value=!0,C.value="";try{const a=await M.get(route("panel.campaigns.tracking_code",o));C.value=String(a.data.script||"").trim()}catch{w.create({type:"negative",message:"Não foi possível carregar o código de acompanhamento",position:"top-right"})}finally{V.value=!1}}}async function ie(e){const o=b(e);if(o){j.value=!0,A.value=!0,N.value=e?.name??"Campanha",I.value=Number(e?.countries_count??0),S.value=[];try{const a=await M.get(route("panel.campaigns.countries",o));N.value=String(a.data?.campaign?.name??N.value),I.value=Number(a.data?.campaign?.countries_count??0),S.value=Array.isArray(a.data?.countries)?a.data.countries:[]}catch{w.create({type:"negative",message:"Não foi possível carregar a lista de países",position:"top-right"})}finally{A.value=!1}}}function re(){if(k.value){k.value.focus(),k.value.select();try{if(!document.execCommand("copy"))throw new Error;w.create({type:"positive",message:"Código copiado",timeout:2e3,position:"top-right"})}catch{w.create({type:"negative",message:"Não foi possível copiar o código",timeout:3e3,position:"top-right"})}}}function ce(e){return q(e)?.label??"-"}function J(e){return q(e)?.color_hex??"#64748B"}function ue(e){const o=q(e);return o?o.tooltip??`Status da campanha: ${o.label}`:"Status da campanha"}function q(e){const o=Number(e?.campaign_status_id??0);return(d.campaignStatusCatalog??[]).find(a=>Number(a?.id??0)===o)??null}async function de(e,o){const a=b(e);if(a&&Number(e?.campaign_status_id??0)!==Number(o??0)){_.value={..._.value,[e.id]:!0};try{const r=await M.patch(route("panel.campaigns.update-status",a),{campaign_status_id:o}),Q=r.data?.campaign;Q&&Number(Q.id)===Number(e.id)&&(e.campaign_status_id=Q.campaign_status_id),w.create({type:"positive",message:r.data?.message||"Status atualizado com sucesso.",position:"top-right"})}catch{w.create({type:"negative",message:"Não foi possível atualizar o status da campanha.",position:"top-right"})}finally{_.value={..._.value,[e.id]:!1}}}}return(e,o)=>(i(),p(U,null,[t(g(ye),{title:"Campanhas"}),n("div",ke,[n("div",Ne,[o[4]||(o[4]=n("h1",{class:"tw-text-lg tw-font-semibold"}," Campanhas ",-1)),t(g(he),{href:e.route("panel.campaigns.create")},{default:l(()=>[t(u,{color:"positive",icon:"add",label:"Nova Campanha",unelevated:""})]),_:1},8,["href"])]),t(K,{flat:"",bordered:""},{default:l(()=>[t(y,{class:"tw-space-y-3"},{default:l(()=>[n("div",Se,[t(pe,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=a=>f.value=a),dense:"",outlined:"",clearable:"",placeholder:"Pesquisar por código ou nome",class:"md:tw-flex-1",onKeyup:xe($,["enter"]),onClear:le},{append:l(()=>[t(H,{name:"search",class:"cursor-pointer",onClick:$})]),_:1},8,["modelValue"]),t(u,{outline:"",color:"primary",icon:"search",label:"Filtrar",class:"md:tw-w-auto",onClick:$})]),t(me,{flat:"",rows:ee.value,columns:ae,"row-key":"id","binary-state-sort":"",pagination:s.value,"onUpdate:pagination":o[1]||(o[1]=a=>s.value=a),"rows-per-page-options":[10,15,25,50],"no-data-label":g(v).noData,"no-results-label":g(v).noResults,"loading-label":g(v).loading,"rows-per-page-label":g(v).recordsPerPage,"all-rows-label":g(v).allRows,"pagination-label":g(v).pagination,onRequest:te},{"body-cell-countries":l(a=>[t(P,{props:a},{default:l(()=>[n("div",Qe,[Number(a.row.countries_count??0)===0?(i(),p("span",Pe," 0 país(es) ")):(i(),p("span",Be,m((a.row.countries_preview??[]).join(", ")),1)),Number(a.row.countries_hidden_count??0)>0?(i(),D(u,{key:2,flat:"",dense:"","no-caps":"",color:"primary",label:`(+${a.row.countries_hidden_count??0})`,onClick:r=>ie(a.row)},null,8,["label","onClick"])):O("",!0)])]),_:2},1032,["props"])]),"body-cell-status":l(a=>[t(P,{props:a,class:"tw-text-center"},{default:l(()=>[n("div",De,[n("div",Te,[n("span",{class:"status-dot",style:F({backgroundColor:J(a.row)})},null,4),n("span",null,m(ce(a.row)),1),t(ge,{style:F({backgroundColor:J(a.row),color:"#fff"})},{default:l(()=>[R(m(ue(a.row)),1)]),_:2},1032,["style"])]),t(fe,{flat:"",round:"",dense:"","dropdown-icon":"arrow_drop_down","no-icon-animation":"",disable:!!_.value[a.row.id]},{default:l(()=>[t(we,{dense:""},{default:l(()=>[(i(!0),p(U,null,Z(G.campaignStatusCatalog,r=>x((i(),D(ve,{key:r.id,clickable:"",onClick:Q=>de(a.row,r.id)},{default:l(()=>[t(z,{avatar:""},{default:l(()=>[n("span",{class:"tw-inline-flex tw-h-3 tw-w-3 tw-rounded-full tw-border tw-border-black/10",style:F({backgroundColor:r.color_hex})},null,4)]),_:2},1024),t(z,null,{default:l(()=>[R(m(r.label),1)]),_:2},1024),Number(a.row.campaign_status_id)===Number(r.id)?(i(),D(z,{key:0,side:""},{default:l(()=>[t(H,{name:"check",size:"16px"})]),_:1})):O("",!0)]),_:2},1032,["onClick"])),[[h]])),128))]),_:2},1024)]),_:2},1032,["disable"])])]),_:2},1032,["props"])]),"body-cell-tracking_snippet":l(a=>[t(P,{props:a},{default:l(()=>[t(u,{flat:"",dense:"",size:"sm",icon:"code",color:"primary",label:"Snippet",onClick:r=>se(a.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-actions":l(a=>[t(P,{props:a,class:"tw-text-right"},{default:l(()=>[t(u,{flat:"",dense:"",size:"sm",icon:"edit",color:"primary",onClick:r=>oe(a.row)},null,8,["onClick"]),t(u,{flat:"",dense:"",size:"sm",icon:"delete",color:"negative",onClick:r=>ne(a.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","pagination","no-data-label","no-results-label","loading-label","rows-per-page-label","all-rows-label","pagination-label"])]),_:1})]),_:1})]),t(X,{modelValue:T.value,"onUpdate:modelValue":o[2]||(o[2]=a=>T.value=a)},{default:l(()=>[t(K,{style:{"min-width":"720px","max-width":"95vw","min-height":"450px"}},{default:l(()=>[t(y,{class:"tw-flex tw-justify-between tw-items-center"},{default:l(()=>[o[5]||(o[5]=n("div",{class:"tw-text-lg tw-font-semibold"}," Código de acompanhamento ",-1)),x(t(u,{flat:"",dense:"",icon:"close"},null,512),[[h]])]),_:1}),t(B),t(y,null,{default:l(()=>[V.value?(i(),p("div",Ve," Carregando... ")):O("",!0),n("textarea",{ref_key:"trackingTextarea",ref:k,class:"tw-w-full tw-h-72 tw-font-mono tw-text-sm tw-p-3 tw-bg-gray-100 tw-rounded",readonly:""},m(C.value),513)]),_:1}),t(B),t(W,{align:"right"},{default:l(()=>[t(u,{flat:"",icon:"content_copy",label:"Copiar",disable:!C.value,onClick:re},null,8,["disable"]),x(t(u,{color:"primary",label:"Fechar"},null,512),[[h]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(X,{modelValue:j.value,"onUpdate:modelValue":o[3]||(o[3]=a=>j.value=a)},{default:l(()=>[t(K,{style:{"min-width":"620px","max-width":"95vw","max-height":"85vh"}},{default:l(()=>[t(y,{class:"tw-flex tw-items-center tw-justify-between"},{default:l(()=>[n("div",null,[o[6]||(o[6]=n("div",{class:"tw-text-lg tw-font-semibold"}," Países da campanha ",-1)),n("div",je,m(N.value)+" · "+m(I.value)+" país(es) ",1)]),x(t(u,{flat:"",dense:"",icon:"close"},null,512),[[h]])]),_:1}),t(B),t(y,null,{default:l(()=>[A.value?(i(),p("div",Ae," Carregando... ")):S.value.length?(i(),p("div",Le,[(i(!0),p(U,null,Z(S.value,a=>(i(),D(_e,{key:a.id,dense:"",square:""},{default:l(()=>[R(m(a.name)+" ("+m(a.iso2)+") ",1)]),_:2},1024))),128))])):(i(),p("div",Ie," Nenhum país encontrado para esta campanha. "))]),_:1}),t(B),t(W,{align:"right"},{default:l(()=>[x(t(u,{color:"primary",label:"Fechar"},null,512),[[h]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Re=Ce($e,[["__scopeId","data-v-1cf0de4b"]]);export{Re as default};
