import{u as Ee,e as u,w as _,A as U,c as Oe,F as Y,G as b,J as Qe,v as N,K as T,l as B,x as qe,y as ee,L as Fe}from"./vendor-quasar-Bee0Lbku.js";import{f as Me,r as s,w as ue,G as z,H as R,E as l,Q as r,u as n,S as Ke,D as o,U as He,a1 as Je,O as w,N as ae,j,a0 as L,P as de,L as ce,M as pe,I as ge,V as te,R as P}from"./vendor-BB0I-wvh.js";import{q as d}from"./qtable-pt-CkdICETI.js";import{_ as Ze}from"../app-BhEibbii.js";const We={class:"tw-space-y-3"},Xe={class:"tw-flex tw-items-center tw-justify-between tw-flex-col sm:tw-flex-row tw-gap-3"},Ye={class:"tw-flex tw-gap-3 tw-flex-col md:tw-flex-row"},ea={class:"tw-text-xs tw-text-slate-700"},aa={class:"tw-text-xs tw-text-slate-700"},ta={class:"tw-flex tw-items-center tw-gap-3"},la={class:"tw-text-base tw-font-semibold"},oa={class:"tw-inline-flex tw-items-center tw-rounded-full tw-bg-slate-100 tw-px-3 tw-py-1 tw-text-xs tw-font-medium tw-text-slate-600"},na={class:"tw-flex tw-items-center tw-gap-2"},sa={class:"tw-flex tw-items-center tw-gap-2"},ra=["title"],ia={class:"tw-flex tw-items-center tw-gap-3"},ua={class:"tw-text-base tw-font-semibold"},da={class:"tw-inline-flex tw-items-center tw-rounded-full tw-bg-slate-100 tw-px-3 tw-py-1 tw-text-xs tw-font-medium tw-text-slate-600"},ca={key:0,class:"tw-inline-flex tw-items-center tw-rounded-full tw-bg-amber-100 tw-px-3 tw-py-1 tw-text-xs tw-font-medium tw-text-amber-900"},pa={key:1,class:"tw-inline-flex tw-items-center tw-rounded-full tw-bg-slate-100 tw-px-3 tw-py-1 tw-text-xs tw-font-medium tw-text-slate-600"},ga={class:"tw-flex tw-items-center tw-gap-2"},wa={class:"snapshot-id-value-wrap"},fa={class:"snapshot-id-value"},va=30,ma={__name:"Index",props:{conversionGoals:{type:Object,required:!0},logsRetentionDays:{type:Number,default:10},filters:{type:Object,default:()=>({})}},setup(we){const f=we,fe=Me(()=>f.conversionGoals?.data??[]),y=s(f.filters?.search??""),c=Ee(),E=s(!1),v=s(null),V=s(!1),O=s(!1),Q=s(!1),q=s(""),D=s(null),G=s(0),A=s(null),F=s([]),M=s([]),$=s(!1),k=s({}),K=s(!1),x=s(!1),H=s(""),I=s([]),g=s({page:1,rowsPerPage:15,rowsNumber:0,sortBy:"created_at",descending:!0}),C=s(null),ve=[{name:"created_at",label:"Data",field:"created_at_formatted",align:"left",sortable:!0},{name:"message",label:"Mensagem",field:"message",align:"left",sortable:!1}],p=s({page:f.conversionGoals?.current_page??1,rowsPerPage:f.conversionGoals?.per_page??15,rowsNumber:f.conversionGoals?.total??0,sortBy:f.filters?.sort??"created_at",descending:(f.filters?.direction??"desc")==="desc"});ue(()=>f.conversionGoals,a=>{a&&(p.value.page=a.current_page,p.value.rowsPerPage=a.per_page,p.value.rowsNumber=a.total)}),ue(()=>f.filters,a=>{p.value.sortBy=a?.sort??"created_at",p.value.descending=(a?.direction??"desc")==="desc",(a?.search??"")!==y.value&&(y.value=a?.search??"")});const me=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"goal_code",label:"Codigo",field:"goal_code",align:"left",sortable:!0},{name:"active",label:"Status",field:"active",align:"center",sortable:!0},{name:"timezone",label:"Timezone",field:a=>a.timezone?.label??a.timezone?.identifier??"-",align:"left"},{name:"campaigns",label:"Campanhas",field:"campaigns",align:"left"},{name:"created_at",label:"Criado em",field:"created_at",align:"left",sortable:!0},{name:"integration",label:"Integracao",field:"integration",align:"center"},{name:"logs",label:"Logs",field:"logs",align:"center"},{name:"snapshot",label:"Snapshot CSV",field:"snapshot",align:"center"},{name:"actions",label:"Acoes",field:"actions",align:"right"}];function J(){const a={page:p.value.page,per_page:p.value.rowsPerPage,sort:p.value.sortBy,direction:p.value.descending?"desc":"asc",search:y.value||void 0};te.get(route("panel.conversion-goals.index"),a,{preserveState:!0,preserveScroll:!0,replace:!0})}function be({pagination:a}){Object.assign(p.value,a),J()}function Z(){p.value.page=1,J()}function ye(){y.value!==""&&(y.value="",p.value.page=1,J())}function S(a){return a?.hashid??a?.id}function he(a){te.visit(route("panel.conversion-goals.edit",S(a)))}function _e(a){const t=(a.campaigns??[]).map(i=>i?.name).filter(Boolean);if(!t.length)return"-";const e=t.join(", ");return e.length<=60?e:`${e.slice(0,60).trimEnd()}...`}function xe(a){c.dialog({title:"Confirmar exclusao",message:`Deseja realmente remover a meta "${a.goal_code}"?`,cancel:{label:"Cancelar",flat:!0},ok:{label:"Excluir",color:"negative",unelevated:!0},persistent:!0}).onOk(()=>{te.delete(route("panel.conversion-goals.destroy",S(a)))})}function Ce(a){v.value={id:S(a),url:a.integration_url,username:`googleads-${a.user_slug_id}`,password:a.googleads_password},E.value=!0}async function ke(){!v.value?.id||V.value||c.dialog({title:"Gerar nova senha?",message:"Ao gerar uma nova senha, a conexão atual no Google Ads deixará de autenticar imediatamente até você atualizar a senha na configuração da fonte de dados.",cancel:{label:"Cancelar",flat:!0},ok:{label:"Gerar nova senha",color:"warning",unelevated:!0},persistent:!0}).onOk(async()=>{V.value=!0;try{const a=await P.patch(route("panel.conversion-goals.regenerate-password",v.value.id));v.value.password=a.data?.googleads_password??"",c.notify({type:"warning",message:"Nova senha gerada. Atualize a senha no Google Ads para restabelecer a conexão.",timeout:5500})}catch{c.notify({type:"negative",message:"Não foi possível gerar uma nova senha agora."})}finally{V.value=!1}})}async function W(a,t){const e=String(a??"");if(e===""){c.notify({type:"warning",message:`${t} vazio.`});return}try{await Fe(e),c.notify({type:"positive",message:`${t} copiado.`})}catch{c.notify({type:"negative",message:`Falha ao copiar ${t.toLowerCase()}.`})}}function Se(a,t){if(!Array.isArray(a)||a.length===0)return{columns:[],rows:[]};const e=a.map((h,m)=>({name:`c${m}`,label:String(h??""),field:`c${m}`,align:"left",sortable:!1})),i=Array.isArray(t)?t.map((h,m)=>{const ie={__index:m+1};return e.forEach((Be,je)=>{ie[Be.field]=Array.isArray(h)?h[je]??"":""}),ie}):[];return{columns:e,rows:i}}function ze(a){return String(a??"").toUpperCase().replace(/[^A-Z0-9]/g,"")}function Re(a){const t=ze(a?.label??a?.name??"");return t==="GOOGLECLICKID"||t==="GCLID"||t==="GBRAID"}function le(a){return String(a??"")}function oe(a){const t=le(a);return t===""?"-":t}function Le(a,t){return Re(a)?le(t).length>va:!1}function ne(a,t){return`${a?.__index??"row"}:${t?.name??""}`}function X(a,t){return!!k.value[ne(a,t)]}function Pe(a,t){const e=ne(a,t);k.value={...k.value,[e]:!k.value[e]}}async function Ve(a){if(a){Q.value=!0;try{const t=await P.get(route("panel.conversion-goals.snapshot",a));G.value=Number(t.data?.rows_count??0),A.value=t.data?.updated_at_formatted??null;const e=Se(t.data?.header??[],t.data?.rows??[]);M.value=e.columns,F.value=e.rows}finally{Q.value=!1}}}function De(a){const t=String(a??"");if(t==="")return null;const e=t.match(/filename\*=UTF-8''([^;]+)/i);return e?.[1]?decodeURIComponent(e[1].trim()):t.match(/filename=\"?([^\";]+)\"?/i)?.[1]?.trim()??null}async function Ge(){if(!(!D.value||$.value)){$.value=!0;try{const a=await P.get(route("panel.conversion-goals.snapshot-csv",D.value),{responseType:"blob"});if(String(a.headers["content-type"]??"").includes("application/json")){c.notify({type:"warning",message:"Nenhum snapshot disponível para download."});return}const e=De(a.headers["content-disposition"])||`snapshot_${q.value||"conversion_goal"}.csv`,i=new Blob([a.data],{type:"text/csv;charset=utf-8;"}),h=window.URL.createObjectURL(i),m=document.createElement("a");m.href=h,m.download=e,document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(h)}catch{c.notify({type:"negative",message:"Não foi possível baixar o CSV do snapshot."})}finally{$.value=!1}}}async function Ae(a){D.value=S(a),q.value=a.goal_code,G.value=0,A.value=null,M.value=[],F.value=[],k.value={},O.value=!0,await Ve(D.value)}function se(){return c.screen.lt.sm?"width: 96vw; max-width: 96vw; height: 92vh; max-height: 92vh;":c.screen.lt.md?"width: 92vw; max-width: 92vw; height: 90vh; max-height: 90vh;":"width: 70vw; max-width: 70vw; height: 88vh; max-height: 88vh;"}async function re(a,t=null){if(!a)return;x.value=!0;const e=t??g.value;try{const i=await P.get(route("panel.conversion-goals.logs",a),{params:{page:e.page,per_page:e.rowsPerPage,sort:e.sortBy||"created_at",direction:e.descending?"desc":"asc"}});I.value=i.data.data??[],g.value={...g.value,page:i.data.current_page,rowsPerPage:i.data.per_page,rowsNumber:i.data.total,sortBy:e.sortBy||"created_at",descending:!!e.descending}}finally{x.value=!1}}async function $e(a){C.value=S(a),H.value=a.goal_code,I.value=[],g.value={...g.value,page:1,sortBy:"created_at",descending:!0},K.value=!0,await re(C.value,g.value)}async function Ie({pagination:a}){g.value={...g.value,...a},await re(C.value,g.value)}async function Ue(){C.value&&c.dialog({title:"Excluir logs",message:`Deseja excluir todos os logs da meta ${H.value||""}?`,cancel:{label:"Cancelar",flat:!0},ok:{label:"Excluir logs",color:"negative",unelevated:!0},persistent:!0}).onOk(async()=>{x.value=!0;try{await P.delete(route("panel.conversion-goals.logs.destroy",C.value)),I.value=[],g.value={...g.value,page:1,rowsNumber:0},c.notify({type:"positive",message:"Logs removidos com sucesso."})}catch{c.notify({type:"negative",message:"Falha ao remover logs."})}finally{x.value=!1}})}function Ne(a){return a==="success"?"tw-bg-emerald-500":a==="warning"?"tw-bg-amber-500":a==="error"?"tw-bg-rose-500":"tw-bg-slate-400"}function Te(a){return a==="success"?"Sucesso":a==="warning"?"Atenção":a==="error"?"Erro":"Informação"}return(a,t)=>(R(),z(ge,null,[l(n(Ke),{title:"Metas de Conversao"}),r("div",We,[r("div",Xe,[t[9]||(t[9]=r("h1",{class:"tw-text-lg tw-font-semibold"}," Metas de Conversao ",-1)),l(n(He),{href:a.route("panel.conversion-goals.create")},{default:o(()=>[l(u,{color:"positive",icon:"add",label:"Nova Meta",unelevated:""})]),_:1},8,["href"])]),l(N,{flat:"",bordered:""},{default:o(()=>[l(_,{class:"tw-space-y-3"},{default:o(()=>[r("div",Ye,[l(U,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=e=>y.value=e),dense:"",outlined:"",clearable:"",placeholder:"Pesquisar por codigo",class:"md:tw-flex-1",onKeyup:Je(Z,["enter"]),onClear:ye},{append:o(()=>[l(Oe,{name:"search",class:"cursor-pointer",onClick:Z})]),_:1},8,["modelValue"]),l(u,{outline:"",color:"primary",icon:"search",label:"Filtrar",class:"md:tw-w-auto",onClick:Z})]),l(Y,{flat:"",rows:fe.value,columns:me,"row-key":"id","binary-state-sort":"",pagination:p.value,"onUpdate:pagination":t[1]||(t[1]=e=>p.value=e),"rows-per-page-options":[10,15,25,50],"no-data-label":n(d).noData,"no-results-label":n(d).noResults,"loading-label":n(d).loading,"rows-per-page-label":n(d).recordsPerPage,"all-rows-label":n(d).allRows,"pagination-label":n(d).pagination,onRequest:be},{"body-cell-active":o(e=>[l(b,{props:e,class:"tw-text-center"},{default:o(()=>[l(Qe,{dense:"",size:"sm",color:e.row.active?"positive":"negative","text-color":"white"},{default:o(()=>[ae(w(e.row.active?"Ativo":"Inativo"),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-created_at":o(e=>[l(b,{props:e},{default:o(()=>[ae(w(e.row.created_at?new Date(e.row.created_at).toLocaleString("pt-BR"):"-"),1)]),_:2},1032,["props"])]),"body-cell-campaigns":o(e=>[l(b,{props:e},{default:o(()=>[r("span",ea,w(_e(e.row)),1)]),_:2},1032,["props"])]),"body-cell-timezone":o(e=>[l(b,{props:e},{default:o(()=>[r("span",aa,w(e.row.timezone?.label??e.row.timezone?.identifier??"-"),1)]),_:2},1032,["props"])]),"body-cell-actions":o(e=>[l(b,{props:e,class:"tw-text-right"},{default:o(()=>[l(u,{flat:"",dense:"",size:"sm",icon:"edit",class:"qtable-edit-btn",onClick:i=>he(e.row)},null,8,["onClick"]),l(u,{flat:"",dense:"",size:"sm",icon:"delete",class:"qtable-delete-btn",onClick:i=>xe(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-integration":o(e=>[l(b,{props:e,class:"tw-text-center"},{default:o(()=>[l(u,{flat:"",dense:"",size:"sm",icon:"link",color:"primary",onClick:i=>Ce(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-logs":o(e=>[l(b,{props:e,class:"tw-text-center"},{default:o(()=>[l(u,{flat:"",dense:"",size:"sm",icon:"history",label:"Logs",color:"secondary",onClick:i=>$e(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-snapshot":o(e=>[l(b,{props:e,class:"tw-text-center"},{default:o(()=>[l(u,{flat:"",dense:"",size:"sm",icon:"table_view",label:"Snapshot",color:"indigo",onClick:i=>Ae(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","pagination","no-data-label","no-results-label","loading-label","rows-per-page-label","all-rows-label","pagination-label"])]),_:1})]),_:1}),l(ee,{modelValue:E.value,"onUpdate:modelValue":t[5]||(t[5]=e=>E.value=e)},{default:o(()=>[l(N,{style:{"min-width":"620px","max-width":"90vw"}},{default:o(()=>[l(_,{class:"tw-flex tw-items-center tw-justify-between"},{default:o(()=>[t[10]||(t[10]=r("div",{class:"tw-text-base tw-font-semibold"}," Integração Google Ads ",-1)),j(l(u,{flat:"",round:"",dense:"",icon:"close"},null,512),[[T]])]),_:1}),l(B),l(_,{class:"tw-space-y-4"},{default:o(()=>[l(U,{"model-value":v.value?.url??"",label:"URL CSV",readonly:"",outlined:"",dense:""},{append:o(()=>[l(u,{flat:"",dense:"",icon:"content_copy",onClick:t[2]||(t[2]=L(e=>W(v.value?.url,"URL"),["stop","prevent"]))})]),_:1},8,["model-value"]),l(U,{"model-value":v.value?.username??"",label:"Usuário",readonly:"",outlined:"",dense:""},{append:o(()=>[l(u,{flat:"",dense:"",icon:"content_copy",onClick:t[3]||(t[3]=L(e=>W(v.value?.username,"Usuário"),["stop","prevent"]))})]),_:1},8,["model-value"]),l(U,{"model-value":v.value?.password??"",label:"Senha",readonly:"",outlined:"",dense:""},{append:o(()=>[l(u,{flat:"",dense:"",icon:"key",loading:V.value,onClick:L(ke,["stop","prevent"])},null,8,["loading"]),l(u,{flat:"",dense:"",icon:"content_copy",onClick:t[4]||(t[4]=L(e=>W(v.value?.password,"Senha"),["stop","prevent"]))})]),_:1},8,["model-value"]),t[11]||(t[11]=r("div",{class:"tw-rounded-md tw-border tw-border-amber-200 tw-bg-amber-50 tw-p-3 tw-text-xs tw-text-amber-900"}," Se você gerar nova senha, atualize a credencial no Google Ads imediatamente. Enquanto a senha antiga estiver configurada lá, o Google não conseguirá autenticar e a importação falhará. ",-1))]),_:1}),l(B),l(qe,{align:"right"},{default:o(()=>[j(l(u,{flat:"",label:"Fechar"},null,512),[[T]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(ee,{modelValue:K.value,"onUpdate:modelValue":t[7]||(t[7]=e=>K.value=e),maximized:n(c).screen.lt.sm},{default:o(()=>[l(N,{style:de(se())},{default:o(()=>[l(_,{class:"tw-flex tw-items-center tw-justify-between"},{default:o(()=>[r("div",ta,[r("div",la," Logs da Meta "+w(H.value||"-"),1),r("span",oa," Os logs são armazenados temporariamente e serão excluídos após "+w(f.logsRetentionDays)+" dias. ",1)]),r("div",na,[l(u,{flat:"",dense:"",color:"negative",icon:"delete_sweep",label:"Excluir logs",disable:x.value||!C.value,onClick:Ue},null,8,["disable"]),j(l(u,{flat:"",round:"",dense:"",icon:"close"},null,512),[[T]])])]),_:1}),l(B),l(_,{class:"tw-p-0",style:{height:"calc(100% - 72px)"}},{default:o(()=>[l(Y,{flat:"",rows:I.value,columns:ve,"row-key":"id",loading:x.value,pagination:g.value,"onUpdate:pagination":t[6]||(t[6]=e=>g.value=e),"rows-per-page-options":[10,15,25,50],"no-data-label":n(d).noData,"no-results-label":n(d).noResults,"loading-label":n(d).loading,"rows-per-page-label":n(d).recordsPerPage,"all-rows-label":n(d).allRows,"pagination-label":n(d).pagination,"binary-state-sort":"",onRequest:Ie},{"body-cell-message":o(e=>[l(b,{props:e},{default:o(()=>[r("div",sa,[r("span",{class:ce(["tw-inline-block tw-h-2.5 tw-w-2.5 tw-rounded-full",Ne(e.row.status)]),title:Te(e.row.status)},null,10,ra),r("span",null,w(e.row.message),1)])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","no-data-label","no-results-label","loading-label","rows-per-page-label","all-rows-label","pagination-label"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue","maximized"]),l(ee,{modelValue:O.value,"onUpdate:modelValue":t[8]||(t[8]=e=>O.value=e),maximized:n(c).screen.lt.sm},{default:o(()=>[l(N,{style:de(se())},{default:o(()=>[l(_,{class:"tw-flex tw-items-center tw-justify-between"},{default:o(()=>[r("div",ia,[r("div",ua," Snapshot CSV da Meta "+w(q.value||"-"),1),r("span",da," Última exportação: "+w(G.value)+" conversão(ões) ",1),G.value>100?(R(),z("span",ca," Visualizando apenas as 100 primeiras linhas do CSV da última exportação. ")):pe("",!0),A.value?(R(),z("span",pa," Atualizado em "+w(A.value),1)):pe("",!0)]),r("div",ga,[l(u,{round:"",dense:"",unelevated:"",color:"grey-3","text-color":"positive",icon:"download",loading:$.value,onClick:Ge},null,8,["loading"]),j(l(u,{flat:"",round:"",dense:"",icon:"close"},null,512),[[T]])])]),_:1}),l(B),l(_,{class:"tw-p-0",style:{height:"calc(100% - 72px)"}},{default:o(()=>[l(Y,{flat:"",rows:F.value,columns:M.value,"row-key":"__index",loading:Q.value,"rows-per-page-options":[10,15,25,50,100],"no-data-label":n(d).noData,"no-results-label":n(d).noResults,"loading-label":n(d).loading,"rows-per-page-label":n(d).recordsPerPage,"all-rows-label":n(d).allRows,"pagination-label":n(d).pagination},{"body-cell":o(e=>[l(b,{props:e},{default:o(()=>[Le(e.col,e.value)?(R(),z("div",{key:0,class:ce(["snapshot-id-cell",{"is-expanded":X(e.row,e.col)}])},[r("span",wa,[r("span",fa,w(oe(e.value)),1)]),l(u,{flat:"",round:"",dense:"",size:"sm",icon:X(e.row,e.col)?"visibility_off":"visibility",title:X(e.row,e.col)?"Ocultar valor completo":"Visualizar valor completo",onClick:L(i=>Pe(e.row,e.col),["stop"])},null,8,["icon","title","onClick"])],2)):(R(),z(ge,{key:1},[ae(w(oe(e.value)),1)],64))]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading","no-data-label","no-results-label","loading-label","rows-per-page-label","all-rows-label","pagination-label"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue","maximized"])])],64))}},xa=Ze(ma,[["__scopeId","data-v-070fe702"]]);export{xa as default};
