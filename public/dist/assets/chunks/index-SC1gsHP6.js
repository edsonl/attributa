import{u as le,v as V,e as c,F as z,G as C,n as U,H as Q,w as B,l as F,A as g,I as O,x as q,y as P}from"./vendor-quasar-Bee0Lbku.js";import{r as v,f as A,e as te,G as k,H as T,E as t,u as oe,S as re,D as r,Q as f,a0 as L,O as E,I as se,R as p}from"./vendor-BB0I-wvh.js";const ie={class:"tw-grid tw-grid-cols-1 lg:tw-grid-cols-12 tw-gap-4"},ne={class:"tw-flex tw-items-center tw-justify-between tw-mb-3"},ue={class:"tw-flex tw-items-center tw-justify-between tw-mb-3"},de={class:"tw-flex tw-items-center tw-gap-2"},ve={class:"tw-text-sm tw-text-slate-500"},me={key:0},ce={key:1},ge={key:2},fe={class:"text-h6"},pe={class:"text-h6"},_e={__name:"Index",setup(ye){const m=le(),x=v(!1),u=v([]),$=v(["info","success","warning","error"]),n=v(null),y=v(!1),b=v(!1),N=v(!1),S=v(!1),d=v({}),s=v({}),i=v(I()),o=v(M()),R=[{name:"name",label:"Categoria",field:"name",sortable:!0,align:"left"},{name:"slug",label:"Slug",field:"slug",sortable:!0,align:"left"},{name:"active",label:"Status",field:"active",sortable:!0,align:"left"},{name:"sort_order",label:"Ordem",field:"sort_order",sortable:!0,align:"left"},{name:"actions",label:"Ações",field:"actions",align:"right"}],j=[{name:"name",label:"Tipo",field:"name",sortable:!0,align:"left"},{name:"category_name",label:"Categoria",field:"category_name",sortable:!0,align:"left"},{name:"slug",label:"Slug",field:"slug",sortable:!0,align:"left"},{name:"severity",label:"Severidade",field:"severity",sortable:!0,align:"left"},{name:"active",label:"Status",field:"active",sortable:!0,align:"left"},{name:"sort_order",label:"Ordem",field:"sort_order",sortable:!0,align:"left"},{name:"actions",label:"Ações",field:"actions",align:"right"}],D=A(()=>u.value.find(l=>Number(l.id)===Number(n.value))||null),G=A(()=>[{id:0,name:"Todas as categorias"},...u.value.map(l=>({id:l.id,name:l.name}))]),H=A(()=>{if(Number(n.value)===0)return u.value.flatMap(e=>(e.types||[]).map(a=>({...a,category_name:e.name})));const l=u.value.find(e=>Number(e.id)===Number(n.value));return l?(l.types||[]).map(e=>({...e,category_name:l.name})):[]});function I(){return{id:null,name:"",slug:"",description:"",active:!0,sort_order:0}}function M(){return{id:null,notification_category_id:null,name:"",slug:"",description:"",default_title:"",default_message:"",severity:"info",active:!0,sort_order:0}}function J(l){return{...l,active:!!l.active,types:Array.isArray(l.types)?l.types.map(e=>({...e,active:!!e.active})):[]}}async function w(){x.value=!0;try{const{data:l}=await p.get(route("panel.notification-catalog.data"));u.value=(l.categories||[]).map(J),$.value=Array.isArray(l.severity_options)&&l.severity_options.length>0?l.severity_options:["info","success","warning","error"],!n.value&&u.value.length>0&&(n.value=u.value[0].id),n.value&&Number(n.value)!==0&&!u.value.some(e=>Number(e.id)===Number(n.value))&&(n.value=u.value[0]?.id||null)}finally{x.value=!1}}function K(){i.value=I(),d.value={},y.value=!0}function W(l){i.value={id:l.id,name:l.name||"",slug:l.slug||"",description:l.description||"",active:!!l.active,sort_order:Number(l.sort_order||0)},d.value={},y.value=!0}async function X(){if(N.value)return;N.value=!0,d.value={};const l={name:String(i.value.name||"").trim(),slug:String(i.value.slug||"").trim().toLowerCase(),description:String(i.value.description||"").trim()||null,active:!!i.value.active,sort_order:Number(i.value.sort_order||0)};try{i.value.id?(await p.put(route("panel.notification-catalog.categories.update",i.value.id),l),m.notify({type:"positive",message:"Categoria atualizada com sucesso."})):(await p.post(route("panel.notification-catalog.categories.store"),l),m.notify({type:"positive",message:"Categoria cadastrada com sucesso."})),y.value=!1,await w()}catch(e){if(e.response?.status===422){d.value=e.response.data.errors||{};return}m.notify({type:"negative",message:"Não foi possível salvar a categoria."})}finally{N.value=!1}}async function Y(l){if(!(typeof window<"u")||window.confirm(`Excluir categoria "${l.name}"?`))try{await p.delete(route("panel.notification-catalog.categories.destroy",l.id)),m.notify({type:"positive",message:"Categoria removida com sucesso."}),await w()}catch(a){m.notify({type:"warning",message:a?.response?.data?.message||"Não foi possível remover a categoria."})}}function Z(){const l=Number(n.value)===0?Number(u.value[0]?.id||0):Number(n.value||0);o.value={...M(),notification_category_id:l||null},s.value={},b.value=!0}function h(l){o.value={id:l.id,notification_category_id:Number(l.notification_category_id),name:l.name||"",slug:l.slug||"",description:l.description||"",default_title:l.default_title||"",default_message:l.default_message||"",severity:l.severity||"info",active:!!l.active,sort_order:Number(l.sort_order||0)},s.value={},b.value=!0}async function ee(){if(S.value)return;S.value=!0,s.value={};const l={notification_category_id:Number(o.value.notification_category_id||0),name:String(o.value.name||"").trim(),slug:String(o.value.slug||"").trim().toLowerCase(),description:String(o.value.description||"").trim()||null,default_title:String(o.value.default_title||"").trim()||null,default_message:String(o.value.default_message||"").trim()||null,severity:String(o.value.severity||"info").trim().toLowerCase(),active:!!o.value.active,sort_order:Number(o.value.sort_order||0)};try{o.value.id?(await p.put(route("panel.notification-catalog.types.update",o.value.id),l),m.notify({type:"positive",message:"Tipo de notificação atualizado com sucesso."})):(await p.post(route("panel.notification-catalog.types.store"),l),m.notify({type:"positive",message:"Tipo de notificação cadastrado com sucesso."})),b.value=!1,await w()}catch(e){if(e.response?.status===422){s.value=e.response.data.errors||{};return}m.notify({type:"negative",message:"Não foi possível salvar o tipo de notificação."})}finally{S.value=!1}}async function ae(l){if(!(typeof window<"u")||window.confirm(`Excluir tipo "${l.name}"?`))try{await p.delete(route("panel.notification-catalog.types.destroy",l.id)),m.notify({type:"positive",message:"Tipo removido com sucesso."}),await w()}catch{m.notify({type:"negative",message:"Não foi possível remover o tipo."})}}return te(w),(l,e)=>(T(),k(se,null,[t(oe(re),{title:"Catálogo de notificações"}),t(V,{flat:"",bordered:"",class:"tw-rounded-2xl tw-p-4 tw-space-y-4"},{default:r(()=>[f("div",ie,[t(V,{flat:"",bordered:"",class:"tw-rounded-xl tw-p-3 lg:tw-col-span-4"},{default:r(()=>[f("div",ne,[e[20]||(e[20]=f("div",{class:"tw-text-base tw-font-semibold"},"Categorias",-1)),t(c,{color:"positive",dense:"",icon:"add",label:"Categoria",onClick:K})]),t(z,{rows:u.value,columns:R,"row-key":"id",loading:x.value,flat:"",pagination:{rowsPerPage:10},onRowClick:e[0]||(e[0]=(a,_)=>n.value=_.id)},{"body-cell-active":r(a=>[t(C,{props:a},{default:r(()=>[t(U,{color:a.row.active?"positive":"grey-6",label:a.row.active?"Ativa":"Inativa"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-actions":r(a=>[t(C,{props:a,class:"tw-text-right"},{default:r(()=>[t(c,{dense:"",flat:"",size:"sm",icon:"edit",class:"qtable-edit-btn",onClick:L(_=>W(a.row),["stop"])},null,8,["onClick"]),t(c,{dense:"",flat:"",size:"sm",icon:"delete",class:"qtable-delete-btn",onClick:L(_=>Y(a.row),["stop"])},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1}),t(V,{flat:"",bordered:"",class:"tw-rounded-xl tw-p-3 lg:tw-col-span-8"},{default:r(()=>[f("div",ue,[f("div",de,[e[21]||(e[21]=f("div",{class:"tw-text-base tw-font-semibold"},"Tipos",-1)),t(Q,{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=a=>n.value=a),options:G.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",dense:"",outlined:"",style:{"min-width":"230px"}},null,8,["modelValue","options"])]),f("div",ve,[Number(n.value)===0?(T(),k("span",me,"Mostrando todos")):D.value?(T(),k("span",ce,"Mostrando: "+E(D.value.name),1)):(T(),k("span",ge,"Selecione uma categoria"))]),t(c,{color:"primary",dense:"",icon:"add",label:"Tipo",disable:!n.value,onClick:Z},null,8,["disable"])]),t(z,{rows:H.value,columns:j,"row-key":"id",loading:x.value,flat:"",pagination:{rowsPerPage:10}},{"body-cell-severity":r(a=>[t(C,{props:a},{default:r(()=>[t(U,{label:a.row.severity,color:a.row.severity==="error"?"negative":a.row.severity==="warning"?"warning":a.row.severity==="success"?"positive":"primary"},null,8,["label","color"])]),_:2},1032,["props"])]),"body-cell-active":r(a=>[t(C,{props:a},{default:r(()=>[t(U,{color:a.row.active?"positive":"grey-6",label:a.row.active?"Ativo":"Inativo"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-actions":r(a=>[t(C,{props:a,class:"tw-text-right"},{default:r(()=>[t(c,{dense:"",flat:"",size:"sm",icon:"edit",class:"qtable-edit-btn",onClick:_=>h(a.row)},null,8,["onClick"]),t(c,{dense:"",flat:"",size:"sm",icon:"delete",class:"qtable-delete-btn",onClick:_=>ae(a.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading"])]),_:1})])]),_:1}),t(P,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=a=>y.value=a),persistent:""},{default:r(()=>[t(V,{class:"tw-w-full tw-max-w-xl"},{default:r(()=>[t(B,null,{default:r(()=>[f("div",fe,E(i.value.id?"Editar categoria":"Nova categoria"),1)]),_:1}),t(F),t(B,{class:"tw-space-y-3"},{default:r(()=>[t(g,{modelValue:i.value.name,"onUpdate:modelValue":e[2]||(e[2]=a=>i.value.name=a),label:"Nome",outlined:"",dense:"",error:!!d.value.name,"error-message":d.value.name?.[0]},null,8,["modelValue","error","error-message"]),t(g,{modelValue:i.value.slug,"onUpdate:modelValue":e[3]||(e[3]=a=>i.value.slug=a),label:"Slug",outlined:"",dense:"",error:!!d.value.slug,"error-message":d.value.slug?.[0]},null,8,["modelValue","error","error-message"]),t(g,{modelValue:i.value.description,"onUpdate:modelValue":e[4]||(e[4]=a=>i.value.description=a),label:"Descrição",outlined:"",dense:"",error:!!d.value.description,"error-message":d.value.description?.[0]},null,8,["modelValue","error","error-message"]),t(g,{modelValue:i.value.sort_order,"onUpdate:modelValue":e[5]||(e[5]=a=>i.value.sort_order=a),modelModifiers:{number:!0},type:"number",min:"0",label:"Ordem",outlined:"",dense:"",error:!!d.value.sort_order,"error-message":d.value.sort_order?.[0]},null,8,["modelValue","error","error-message"]),t(O,{modelValue:i.value.active,"onUpdate:modelValue":e[6]||(e[6]=a=>i.value.active=a),label:"Categoria ativa"},null,8,["modelValue"])]),_:1}),t(q,{align:"right",class:"tw-gap-2 tw-p-4"},{default:r(()=>[t(c,{flat:"",label:"Cancelar",onClick:e[7]||(e[7]=a=>y.value=!1)}),t(c,{color:"primary",unelevated:"",loading:N.value,label:"Salvar",onClick:X},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(P,{modelValue:b.value,"onUpdate:modelValue":e[19]||(e[19]=a=>b.value=a),persistent:""},{default:r(()=>[t(V,{class:"tw-w-full tw-max-w-2xl"},{default:r(()=>[t(B,null,{default:r(()=>[f("div",pe,E(o.value.id?"Editar tipo":"Novo tipo"),1)]),_:1}),t(F),t(B,{class:"tw-grid tw-grid-cols-1 md:tw-grid-cols-2 tw-gap-3"},{default:r(()=>[t(Q,{modelValue:o.value.notification_category_id,"onUpdate:modelValue":e[9]||(e[9]=a=>o.value.notification_category_id=a),options:u.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",label:"Categoria",outlined:"",dense:"",error:!!s.value.notification_category_id,"error-message":s.value.notification_category_id?.[0],class:"md:tw-col-span-2"},null,8,["modelValue","options","error","error-message"]),t(g,{modelValue:o.value.name,"onUpdate:modelValue":e[10]||(e[10]=a=>o.value.name=a),label:"Nome",outlined:"",dense:"",error:!!s.value.name,"error-message":s.value.name?.[0]},null,8,["modelValue","error","error-message"]),t(g,{modelValue:o.value.slug,"onUpdate:modelValue":e[11]||(e[11]=a=>o.value.slug=a),label:"Slug",outlined:"",dense:"",error:!!s.value.slug,"error-message":s.value.slug?.[0]},null,8,["modelValue","error","error-message"]),t(Q,{modelValue:o.value.severity,"onUpdate:modelValue":e[12]||(e[12]=a=>o.value.severity=a),options:$.value,label:"Severidade",outlined:"",dense:"",error:!!s.value.severity,"error-message":s.value.severity?.[0]},null,8,["modelValue","options","error","error-message"]),t(g,{modelValue:o.value.sort_order,"onUpdate:modelValue":e[13]||(e[13]=a=>o.value.sort_order=a),modelModifiers:{number:!0},type:"number",min:"0",label:"Ordem",outlined:"",dense:"",error:!!s.value.sort_order,"error-message":s.value.sort_order?.[0]},null,8,["modelValue","error","error-message"]),t(g,{modelValue:o.value.default_title,"onUpdate:modelValue":e[14]||(e[14]=a=>o.value.default_title=a),label:"Título padrão",outlined:"",dense:"",error:!!s.value.default_title,"error-message":s.value.default_title?.[0],class:"md:tw-col-span-2"},null,8,["modelValue","error","error-message"]),t(g,{modelValue:o.value.default_message,"onUpdate:modelValue":e[15]||(e[15]=a=>o.value.default_message=a),type:"textarea",autogrow:"",label:"Mensagem padrão",outlined:"",dense:"",error:!!s.value.default_message,"error-message":s.value.default_message?.[0],class:"md:tw-col-span-2"},null,8,["modelValue","error","error-message"]),t(g,{modelValue:o.value.description,"onUpdate:modelValue":e[16]||(e[16]=a=>o.value.description=a),label:"Descrição",outlined:"",dense:"",error:!!s.value.description,"error-message":s.value.description?.[0],class:"md:tw-col-span-2"},null,8,["modelValue","error","error-message"]),t(O,{modelValue:o.value.active,"onUpdate:modelValue":e[17]||(e[17]=a=>o.value.active=a),label:"Tipo ativo",class:"md:tw-col-span-2"},null,8,["modelValue"])]),_:1}),t(q,{align:"right",class:"tw-gap-2 tw-p-4"},{default:r(()=>[t(c,{flat:"",label:"Cancelar",onClick:e[18]||(e[18]=a=>b.value=!1)}),t(c,{color:"primary",unelevated:"",loading:S.value,label:"Salvar",onClick:ee},null,8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{_e as default};
