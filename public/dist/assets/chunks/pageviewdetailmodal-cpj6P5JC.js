import{u as Re,v as Pe,w as K,e as k,X as Ee,Y as De,Z as Be,o as C,n as Ie,y as Oe}from"./vendor-quasar-Bee0Lbku.js";import{_ as ze}from"../app-BhEibbii.js";import{f as o,C as f,H as r,D as d,E as m,M as _,Q as t,G as p,u as Te,I as V,J as L,N as y,O as a,P as Ue}from"./vendor-BB0I-wvh.js";const Ae={class:"detail-section first-row-section"},Fe={class:"section-card"},qe={class:"section-card__body"},Ge={class:"tw-grid md:tw-grid-cols-2 lg:tw-grid-cols-3 tw-gap-4"},Qe={class:"value-with-copy value-with-copy--inline"},je={class:"detail-value"},Me={class:"detail-value"},We={class:"detail-value"},He={class:"tw-flex tw-items-center tw-gap-2 tw-flex-wrap"},Je={class:"detail-value tw-font-semibold"},Ze={class:"detail-value"},Ke={class:"detail-value"},Xe={class:"value-with-copy value-with-copy--inline"},Ye={class:"truncated-preview"},et={class:"lg:tw-col-start-2"},tt={class:"value-with-copy value-with-copy--inline"},lt={class:"truncated-preview"},it={class:"tw-grid md:tw-grid-cols-2 lg:tw-grid-cols-3 tw-gap-4"},at={class:"detail-value tw-flex tw-items-center tw-gap-2"},ot=["src","alt"],st={class:"detail-label"},nt={class:"detail-value"},rt={class:"detail-value"},dt={class:"detail-section first-row-section"},ut={class:"section-card"},ct={class:"section-card__body"},vt={class:"tw-grid md:tw-grid-cols-2 lg:tw-grid-cols-3 tw-gap-4"},mt={class:"detail-value"},ft={class:"detail-value"},pt={class:"detail-value"},gt={class:"detail-value"},_t={class:"detail-value"},yt={class:"detail-value"},wt={class:"detail-value"},bt={class:"detail-value"},kt={class:"detail-value"},Ct={class:"detail-value"},ht={class:"tw-grid md:tw-grid-cols-2 lg:tw-grid-cols-4 tw-gap-4"},St={class:"detail-value"},$t={class:"detail-value"},Nt={class:"tw-mt-1"},Vt={class:"ip-category-description"},Lt={class:"detail-value"},xt={class:"tw-grid md:tw-grid-cols-2 lg:tw-grid-cols-4 tw-gap-3 tw-mt-4"},Rt={class:"detail-label"},Pt={class:"detail-value"},Et={class:"detail-section xl:tw-col-span-2"},Dt={class:"section-card"},Bt={class:"section-card__body section-body--compact"},It={class:"tw-grid md:tw-grid-cols-2 lg:tw-grid-cols-4 tw-gap-3"},Ot={class:"detail-value"},zt={class:"detail-value"},Tt={class:"detail-value"},Ut={class:"value-with-copy"},At={class:"detail-value tw-break-all"},Ft={class:"lg:tw-col-span-2"},qt={class:"value-with-copy"},Gt={class:"detail-value tw-break-all"},Qt={class:"lg:tw-col-span-2"},jt={class:"detail-value tw-break-all"},Mt={class:"lg:tw-col-span-4"},Wt={key:0,class:"url-params-inline"},Ht={class:"url-param-key"},Jt={class:"value-with-copy value-with-copy--inline"},Zt={class:"truncated-preview"},Kt={key:1,class:"traffic-empty"},X=20,Xt={__name:"PageviewDetailModal",props:{modelValue:{type:Boolean,required:!0},loading:{type:Boolean,default:!1},payload:{type:Object,default:()=>null},assetBaseUrl:{type:String,default:""}},emits:["update:modelValue"],setup(P,{emit:Y}){const ee=[{label:"Código",key:"country_code"},{label:"Região",key:"region_name"},{label:"Cidade",key:"city"},{label:"Timezone",key:"timezone"}],te=[{key:"is_proxy",label:"Proxy"},{key:"is_vpn",label:"VPN"},{key:"is_tor",label:"Tor"},{key:"is_datacenter",label:"Datacenter"},{key:"is_bot",label:"Bot"}],c=P,le=Y,E=Re(),D=o({get:()=>c.modelValue,set:l=>le("update:modelValue",l)}),s=o(()=>c.payload?.pageview??{}),x=o(()=>c.payload?.visitor??null),B=o(()=>c.payload?.url??{full:null,origin:null,path:null,query_params:{}}),h=o(()=>c.payload?.geo??{}),$=o(()=>c.payload?.network??{}),ie=o(()=>s.value?.campaign?.name??"-"),ae=o(()=>$.value?.flags??{}),I=o(()=>$.value?.ip_category??null),oe=o(()=>I.value?.color_hex??"#475569"),se=o(()=>I.value?.name??"-"),ne=o(()=>I.value?.description??"Sem descrição."),re=o(()=>s.value?.traffic_source_category??null),q=o(()=>re.value?.name??"Não classificado"),de=o(()=>$e(s.value?.traffic_source_reason)),G=o(()=>{const l=h.value?.country_code;return l?`${c.assetBaseUrl}/assets/country-flags/${String(l).toLowerCase()}.svg`:null}),ue=o(()=>W(B.value?.full||"")),O=o(()=>s.value?.landing_url??null),ce=o(()=>W(O.value||"")),R=o(()=>s.value?.referrer??null),ve=o(()=>Ce(R.value)),z=o(()=>Se()),T=o(()=>c.payload?.composed_code??null),me=o(()=>Array.isArray(c.payload?.events)?c.payload.events:[]),Q=o(()=>Array.isArray(c.payload?.flow_steps)?c.payload.flow_steps:[]),fe=o(()=>{const l=h.value?.latitude,e=h.value?.longitude;return l==null||e===null||e===void 0?"-":`${l}, ${e}`}),j=o(()=>{const l=B.value?.query_params??{};return Object.entries(l)}),pe=o(()=>j.value.length>0),U=o(()=>{const l={page_engaged:{first:null,count:0},form_submit:{first:null,count:0},link_click:{first:null,count:0}};return me.value.forEach(e=>{const i=String(e?.event_type||"").toLowerCase();Object.prototype.hasOwnProperty.call(l,i)&&(l[i].first||(l[i].first=e),l[i].count+=1)}),l}),A=o(()=>{if(Q.value.length>0)return Q.value;const l=U.value.page_engaged,e=U.value.form_submit,i=U.value.link_click,n=!!e.first,u=n?e:i,g=s.value?.created_at_formatted||"Não identificado",H=l.first?Ne(l.first):"",Ve=l.first?`${l.first.created_at_formatted||"-"}${l.count>1?` (+${l.count-1})`:""}${H?` • ${H}`:""}`:"Sem engajamento detectado",J=u.first?`${u.first.created_at_formatted||"-"}${u.count>1?` (+${u.count-1})`:""}`:n?"Sem envio de formulário":"Sem clique em link",Z=n&&u.first?u.first.form_has_user_data?"Dados informados":"Sem dados informados":"",Le=Z?`${J} • ${Z}`:J,N=!!s.value?.conversion,xe=N?`${s.value?.created_at_formatted||"-"} • Convertido`:"Não convertido";return[{name:1,title:"Page View",caption:g,icon:"visibility",done:!0,color:"primary",tooltip:`Registro inicial da visita.
Capturado em ${g}.`},{name:2,title:"Page Engaged",caption:Ve,icon:"insights",done:!!l.first,color:l.first?"primary":"grey-6",tooltip:l.first?"Usuário atingiu critério de engajamento nesta visita.":"Nenhum evento de engajamento foi detectado nesta visita."},{name:3,title:n?"Form Submit":"Link Click",caption:Le,icon:n?"fact_check":"ads_click",done:!!u.first,color:u.first?"primary":"grey-6",tooltip:u.first?n?"Visitante enviou formulário na página.":"Visitante clicou em link rastreado.":n?"Nenhum envio de formulário foi detectado nesta visita.":"Nenhum clique em link rastreado foi detectado nesta visita."},{name:4,title:"Conversão",caption:xe,icon:N?"task_alt":"radio_button_unchecked",done:N,color:N?"positive":"grey-6",tooltip:N?`Visita marcada como conversão.
Data/hora de referência: ${s.value?.created_at_formatted||"-"}.`:"Até o momento, esta visita não foi marcada como conversão."}]}),ge=o(()=>{const l=A.value.filter(e=>e.done);return l.length===0?1:l[l.length-1].name}),_e=o(()=>{const l=s.value?.device_category?.name,e=s.value?.device_type,i=b(l);return i!=="-"?i:b(e)}),ye=o(()=>{const l=s.value?.browser?.name,e=s.value?.browser_name,i=s.value?.browser_version,n=b(e),u=b(i),g=b(l);return n!=="-"&&u!=="-"?`${n} ${u}`:n!=="-"?n:g!=="-"?g:"-"}),we=o(()=>{const l=s.value?.os_name,e=s.value?.os_version,i=b(l),n=b(e);return i!=="-"&&n!=="-"?`${i} ${n}`:i!=="-"?i:"-"}),be=o(()=>String(x.value?.status||"").toLowerCase()==="recorrente"?"Recorrente":"Novo"),M=o(()=>Math.max(Number(x.value?.hits??1),1)),ke=o(()=>M.value===1?"visita":"visitas");function W(l){if(!l)return"-";try{const e=typeof window<"u"?window.location.origin:"https://placeholder.local",i=new URL(l,e);return`${i.origin}${i.pathname}`}catch{return l.split("?")[0]??l}}function Ce(l){if(!l)return null;try{const e=typeof window<"u"?window.location.origin:"https://placeholder.local";return new URL(l,e).host||null}catch{return null}}function w(l){return l!=null&&String(l).trim()!==""}function b(l){const e=String(l??"").trim();if(!e)return"-";const i=e.toLowerCase();return i==="-"||i==="unknown"||i==="desconhecido"||i==="unk"?"-":e}function he(l){return l==null?"-":l?"Sim":"Não"}function v(l){if(l==null)return"-";if(Array.isArray(l)||typeof l=="object")try{return JSON.stringify(l)}catch{return String(l)}return String(l)}function F(l){const e=v(l);return!w(e)||e==="-"?"-":e.length<=X?e:e.slice(0,X)}function Se(){const l=s.value?.gclid;if(w(l))return String(l);const e=B.value?.query_params??{},i=Object.entries(e).find(([n])=>String(n).toLowerCase()==="gclid");return i?v(i[1]):""}function $e(l){const e=String(l||"").trim();return e?e.startsWith("click_id:")?`Clique identificado por ${e.slice(9)}`:e.startsWith("utm_medium:")?`Classificado por utm_medium=${e.slice(11)}`:e.startsWith("referrer_search:")?`Referência de buscador (${e.slice(16)})`:e.startsWith("referrer_social:")?`Referência de rede social (${e.slice(16)})`:e.startsWith("referrer:")?`Referência externa (${e.slice(9)})`:e==="internal_referrer"?"Navegação interna no mesmo domínio":e.startsWith("utm_source_only:")?`Somente utm_source informado (${e.slice(16)})`:e==="no_referrer_no_utm_no_click_id"?"Sem referrer, UTM ou click-id (direto)":e:"-"}function Ne(l){const e=String(l?.element_id||"").trim().toLowerCase();let i="";if(e.startsWith("engagement_reason:"))i=e.slice(18);else{const u=String(l?.element_name||"").trim(),g=/^page engaged\s*\((.+)\)$/i.exec(u);i=g?.[1]?String(g[1]).trim().toLowerCase():""}return{scroll_30:"Scroll 30%",time_10s:"Tempo 10s",link_click:"Clique em link",form_submit:"Envio de formulário",interactions:"2+ interações"}[i]||(i?`Engajamento: ${i}`:"")}async function S(l){const e=v(l);try{await navigator.clipboard.writeText(e),E.notify({type:"positive",message:"Valor copiado."})}catch{E.notify({type:"negative",message:"Nao foi possivel copiar."})}}return(l,e)=>(r(),f(Oe,{modelValue:D.value,"onUpdate:modelValue":e[6]||(e[6]=i=>D.value=i),"transition-show":"scale","transition-hide":"scale"},{default:d(()=>[m(Pe,{class:"pageview-detail-card"},{default:d(()=>[m(K,{class:"tw-flex tw-justify-end detail-close-section"},{default:d(()=>[m(k,{icon:"close",flat:"",round:"",dense:"",onClick:e[0]||(e[0]=i=>D.value=!1)})]),_:1}),P.loading?(r(),f(Ee,{key:0,indeterminate:"",color:"primary"})):_("",!0),P.loading?_("",!0):(r(),f(K,{key:1,class:"tw-grid tw-gap-6 tw-grid-cols-1 xl:tw-grid-cols-2 detail-content-section"},{default:d(()=>[t("section",Ae,[t("div",Fe,[e[23]||(e[23]=t("div",{class:"section-card__header"},"VISITA",-1)),t("div",qe,[m(De,{flat:"",animated:"","alternative-labels":"",class:"visit-flow-stepper",vertical:Te(E).screen.lt.lg,"model-value":ge.value},{default:d(()=>[(r(!0),p(V,null,L(A.value,i=>(r(),f(Be,{key:i.name,name:i.name,title:i.title,caption:i.caption,icon:i.icon,done:i.done,color:i.color},null,8,["name","title","caption","icon","done","color"]))),128))]),_:1},8,["vertical","model-value"]),(r(!0),p(V,null,L(A.value,(i,n)=>(r(),f(C,{key:`step-tooltip-${i.name}`,target:`.visit-flow-stepper .q-stepper__tab:nth-child(${n+1})`,class:"visit-step-tooltip",anchor:"bottom middle",self:"top middle",offset:[0,-10],style:{background:"#1d4ed8",color:"#e2e8f0",border:"1px solid #1e40af",boxShadow:"0 8px 22px rgba(30, 64, 175, 0.28)",maxWidth:"260px",whiteSpace:"pre-line"}},{default:d(()=>[y(a(i.tooltip||`${i.title}: ${i.caption||"-"}`),1)]),_:2},1032,["target"]))),128)),e[20]||(e[20]=t("div",{class:"subsection-separator"},null,-1)),t("div",Ge,[t("div",null,[e[8]||(e[8]=t("div",{class:"detail-label"},"IP",-1)),t("div",Qe,[t("div",je,a(s.value.ip||"-"),1),w(s.value.ip)?(r(),f(k,{key:0,dense:"",flat:"",round:"",size:"sm",icon:"content_copy",onClick:e[1]||(e[1]=i=>S(s.value.ip))},{default:d(()=>[m(C,null,{default:d(()=>[...e[7]||(e[7]=[y("Copiar IP",-1)])]),_:1})]),_:1})):_("",!0)])]),t("div",null,[e[9]||(e[9]=t("div",{class:"detail-label"},"Campanha",-1)),t("div",Me,a(ie.value),1)]),t("div",null,[e[10]||(e[10]=t("div",{class:"detail-label"},"Canal",-1)),t("div",We,a(q.value),1)]),t("div",null,[e[11]||(e[11]=t("div",{class:"detail-label"},"Visitante",-1)),t("div",He,[m(Ie,{rounded:"",color:"blue-grey-1","text-color":"blue-grey-10",class:"visitor-chip"},{default:d(()=>[y(a(be.value),1)]),_:1}),t("span",Je,a(M.value.toLocaleString("pt-BR"))+" "+a(ke.value),1)])]),t("div",null,[e[12]||(e[12]=t("div",{class:"detail-label"},"Primeira visita (campanha)",-1)),t("div",Ze,a(x.value?.first_seen_at_formatted||"-"),1)]),t("div",null,[e[13]||(e[13]=t("div",{class:"detail-label"},"Última visita (campanha)",-1)),t("div",Ke,a(x.value?.last_seen_at_formatted||"-"),1)]),t("div",null,[e[15]||(e[15]=t("div",{class:"detail-label"},"GCLID",-1)),t("div",Xe,[t("div",Ye,a(F(z.value)),1),w(z.value)?(r(),f(k,{key:0,dense:"",flat:"",round:"",size:"sm",icon:"content_copy",onClick:e[2]||(e[2]=i=>S(z.value))},{default:d(()=>[m(C,null,{default:d(()=>[...e[14]||(e[14]=[y("Copiar GCLID",-1)])]),_:1})]),_:1})):_("",!0)])]),t("div",et,[e[17]||(e[17]=t("div",{class:"detail-label"},"Código de acompanhamento",-1)),t("div",tt,[t("div",lt,a(F(T.value)),1),w(T.value)?(r(),f(k,{key:0,dense:"",flat:"",round:"",size:"sm",icon:"content_copy",onClick:e[3]||(e[3]=i=>S(T.value))},{default:d(()=>[m(C,null,{default:d(()=>[...e[16]||(e[16]=[y("Copiar código composto",-1)])]),_:1})]),_:1})):_("",!0)])])]),e[21]||(e[21]=t("div",{class:"subsection-separator"},null,-1)),e[22]||(e[22]=t("div",{class:"subsection-title"},"GEOLOCALIZAÇÃO",-1)),t("div",it,[t("div",null,[e[18]||(e[18]=t("div",{class:"detail-label"},"País",-1)),t("div",at,[G.value?(r(),p("img",{key:0,src:G.value,alt:h.value.country_code,class:"tw-w-6 tw-h-4 tw-rounded-sm tw-object-cover tw-border tw-border-gray-200"},null,8,ot)):_("",!0),t("span",null,a(h.value.country_name??"-"),1)])]),(r(),p(V,null,L(ee,i=>t("div",{key:i.key},[t("div",st,a(i.label),1),t("div",nt,a(h.value[i.key]??"-"),1)])),64)),t("div",null,[e[19]||(e[19]=t("div",{class:"detail-label"},"Latitude/Longitude",-1)),t("div",rt,a(fe.value),1)])])])])]),t("section",dt,[t("div",ut,[e[40]||(e[40]=t("div",{class:"section-card__header"},"DISPOSITIVO, NAVEGADOR & REDE",-1)),t("div",ct,[t("div",vt,[t("div",null,[e[24]||(e[24]=t("div",{class:"detail-label"},"Categoria",-1)),t("div",mt,a(_e.value),1)]),t("div",null,[e[25]||(e[25]=t("div",{class:"detail-label"},"Marca",-1)),t("div",ft,a(v(s.value.device_brand)),1)]),t("div",null,[e[26]||(e[26]=t("div",{class:"detail-label"},"Modelo",-1)),t("div",pt,a(v(s.value.device_model)),1)]),t("div",null,[e[27]||(e[27]=t("div",{class:"detail-label"},"Sistema Operacional",-1)),t("div",gt,a(we.value),1)]),t("div",null,[e[28]||(e[28]=t("div",{class:"detail-label"},"Navegador",-1)),t("div",_t,a(ye.value),1)]),t("div",null,[e[29]||(e[29]=t("div",{class:"detail-label"},"Idioma",-1)),t("div",yt,a(v(s.value.language)),1)]),t("div",null,[e[30]||(e[30]=t("div",{class:"detail-label"},"Plataforma",-1)),t("div",wt,a(v(s.value.platform)),1)]),t("div",null,[e[31]||(e[31]=t("div",{class:"detail-label"},"Tela",-1)),t("div",bt,a(v(s.value.screen_width))+" x "+a(v(s.value.screen_height)),1)]),t("div",null,[e[32]||(e[32]=t("div",{class:"detail-label"},"Viewport",-1)),t("div",kt,a(v(s.value.viewport_width))+" x "+a(v(s.value.viewport_height)),1)]),t("div",null,[e[33]||(e[33]=t("div",{class:"detail-label"},"DPR",-1)),t("div",Ct,a(v(s.value.device_pixel_ratio)),1)])]),e[38]||(e[38]=t("div",{class:"subsection-separator"},null,-1)),e[39]||(e[39]=t("div",{class:"subsection-title"},"INFORMAÇÕES DA REDE",-1)),t("div",ht,[t("div",null,[e[34]||(e[34]=t("div",{class:"detail-label"},"ISP",-1)),t("div",St,a($.value.isp||"-"),1)]),t("div",null,[e[35]||(e[35]=t("div",{class:"detail-label"},"Organização",-1)),t("div",$t,a($.value.organization||"-"),1)]),t("div",null,[e[36]||(e[36]=t("div",{class:"detail-label"},"Categoria IP (Lookup)",-1)),t("div",Nt,[t("div",{class:"ip-category-label",style:Ue({color:oe.value})},a(se.value),5),t("div",Vt,a(ne.value),1)])]),t("div",null,[e[37]||(e[37]=t("div",{class:"detail-label"},"Fraud Score",-1)),t("div",Lt,a($.value.fraud_score??"-"),1)])]),t("div",xt,[(r(),p(V,null,L(te,i=>t("div",{key:i.key},[t("div",Rt,a(i.label),1),t("div",Pt,a(he(ae.value[i.key])),1)])),64))])])])]),t("section",Et,[t("div",Dt,[e[50]||(e[50]=t("div",{class:"section-card__header"},"ORIGEM DO TRÁFEGO",-1)),t("div",Bt,[t("div",It,[t("div",null,[e[41]||(e[41]=t("div",{class:"detail-label"},"Canal",-1)),t("div",Ot,a(q.value),1)]),t("div",null,[e[42]||(e[42]=t("div",{class:"detail-label"},"Motivo da classificação",-1)),t("div",zt,a(de.value),1)]),t("div",null,[e[43]||(e[43]=t("div",{class:"detail-label"},"Domínio de referrer",-1)),t("div",Tt,a(ve.value||"-"),1)]),t("div",null,[e[45]||(e[45]=t("div",{class:"detail-label"},"Referrer completo",-1)),t("div",Ut,[t("div",At,a(R.value||"-"),1),w(R.value)?(r(),f(k,{key:0,dense:"",flat:"",round:"",size:"sm",icon:"content_copy",onClick:e[4]||(e[4]=i=>S(R.value))},{default:d(()=>[m(C,null,{default:d(()=>[...e[44]||(e[44]=[y("Copiar referrer",-1)])]),_:1})]),_:1})):_("",!0)])]),t("div",Ft,[e[47]||(e[47]=t("div",{class:"detail-label"},"Landing page (sem parâmetros)",-1)),t("div",qt,[t("div",Gt,a(ce.value),1),w(O.value)?(r(),f(k,{key:0,dense:"",flat:"",round:"",size:"sm",icon:"content_copy",onClick:e[5]||(e[5]=i=>S(O.value))},{default:d(()=>[m(C,null,{default:d(()=>[...e[46]||(e[46]=[y("Copiar landing URL",-1)])]),_:1})]),_:1})):_("",!0)])]),t("div",Qt,[e[48]||(e[48]=t("div",{class:"detail-label"},"Página atual (sem parâmetros)",-1)),t("div",jt,a(ue.value),1)]),t("div",Mt,[e[49]||(e[49]=t("div",{class:"detail-label"},"Parâmetros da URL",-1)),pe.value?(r(),p("div",Wt,[(r(!0),p(V,null,L(j.value,([i,n])=>(r(),p("div",{key:`query-${i}-${n}`,class:"url-param-chip"},[t("div",Ht,a(i),1),t("div",Jt,[t("div",Zt,a(F(n)),1),m(k,{dense:"",flat:"",round:"",size:"sm",icon:"content_copy",onClick:u=>S(n)},{default:d(()=>[m(C,null,{default:d(()=>[y("Copiar "+a(i),1)]),_:2},1024)]),_:2},1032,["onClick"])])]))),128))])):(r(),p("div",Kt,"-"))])])])])])]),_:1}))]),_:1})]),_:1},8,["modelValue"]))}},ll=ze(Xt,[["__scopeId","data-v-f4fbf633"]]);export{ll as default};
