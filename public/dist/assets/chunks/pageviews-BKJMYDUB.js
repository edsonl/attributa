import{u as K,E as O,h as D,A as W,B as i,k as h,n as J,r as Y}from"./vendor-quasar-D0sfcEux.js";import{r,f as H,w as X,e as Z,E as L,F as p,C as o,u as Q,N as ee,B as t,O as u,A as C,K as w,L as g,J as ae,M as te,G as le,S as b}from"./vendor-D6jaF0sv.js";import oe from"./pageviewdetailmodal-rnWHllKv.js";import{_ as ne}from"../app-BD3XDZci.js";const ie={class:"row q-mb-md items-center q-col-gutter-md"},se={class:"col-12 col-md-4 q-mb-sm q-mb-md-0"},re={class:"col-12 col-md-4 col-lg-3 q-mt-sm q-mt-md-0 q-pl-md-sm"},de={class:"tw-flex tw-items-center tw-gap-2"},ce={class:"tw-text-sm tw-font-medium"},ue={class:"tw-flex tw-items-center tw-gap-2"},ge=["src","alt"],me={__name:"Pageviews",setup(fe){const V=r([]),m=r(!1),S=r(null),f=K(),d=r({page:1,rowsPerPage:20,rowsNumber:0,sortBy:"created_at",descending:!0}),_=r(null),$=r([]),k={label:"Não determinado",color:"#FCE7F3",description:"Categoria ainda não determinada."},x=r(!1),P=r(!1),N=r(null),v=r([]),R=H(()=>v.value.length>0),q="https://attributa.master.dev.br".replace(/\/$/,""),I=[{name:"created_at",label:"Data",field:"created_at_formatted",sortable:!0,align:"left"},{name:"ip_category",label:"Classificação IP",field:a=>a?.ip_category_name,sortable:!0,align:"left"},{name:"ip",label:"IP",field:"ip",sortable:!0,align:"left"},{name:"campaign_name",label:"Campanha",field:"campaign_name",sortable:!0,align:"left"},{name:"country_code",label:"País",field:"country_code",sortable:!0,align:"left"},{name:"region_name",label:"Região",field:"region_name",sortable:!0,align:"left"},{name:"city",label:"Cidade",field:"city",sortable:!0,align:"left"},{name:"gclid",label:"GCLID",field:"has_gclid",sortable:!0,align:"left"},{name:"conversion",label:"Conversão",field:"conversion",sortable:!0,align:"left"},{name:"details",label:"Detalhes",field:"id",align:"center"},{name:"actions",label:"Ações",field:"id",align:"right"}];function B(a){return{label:a?.ip_category_name??k.label,color:a?.ip_category_color??k.color,description:a?.ip_category_description??k.description}}function F(a){const l=a?.country_code;if(!l)return null;const e=String(l).toLowerCase();return`${q}/assets/country-flags/${e}.svg`}function A(a){return a===!0||a===1||a==="1"}function U(a){return a===!0||a===1||a==="1"?!0:typeof a=="string"?a.trim().length>0&&a!=="0":!1}function T(){b.get(route("panel.atividade.campaigns")).then(a=>{$.value=a.data})}function y(a){m.value=!0;const{page:l,rowsPerPage:e,sortBy:s,descending:n}=a.pagination;return b.get(route("panel.atividade.pageviews.data"),{params:{page:l,per_page:e,sortBy:s,descending:n,campaign_id:_.value}}).then(c=>{V.value=c.data.data,v.value=[],d.value={...d.value,page:c.data.current_page,rowsPerPage:c.data.per_page,rowsNumber:c.data.total,sortBy:s,descending:n}}).finally(()=>{m.value=!1})}async function G(a){if(!a)return;let l=!0;const e=typeof window<"u",s=e?window.$confirm:null;if(s?l=await s({title:"Excluir pageview",message:"Esta ação é permanente. Deseja realmente remover?",okLabel:"Remover",okColor:"negative"}):e&&(l=window.confirm("Excluir este pageview?")),!!l){m.value=!0;try{const{data:n}=await b.delete(route("panel.atividade.pageviews.destroy",a));if(n?.deleted===!1){f.notify({type:"warning",message:n?.message||"Pageview convertido não pode ser excluído."});return}f.notify({type:"positive",message:n?.message||"Pageview excluído com sucesso."}),await y({pagination:d.value})}catch{f.notify({type:"negative",message:"Falha ao excluir pageview."})}finally{m.value=!1}}}async function M(){if(!R.value)return;let a=!0;const l=typeof window<"u",e=l?window.$confirm:null,s=`Você selecionou ${v.value.length} registro(s). Deseja remover?`;if(e?a=await e({title:"Remover pageviews",message:s,okLabel:"Remover",okColor:"negative"}):l&&(a=window.confirm(s)),!!a){m.value=!0;try{const{data:n}=await b.delete(route("panel.atividade.pageviews.bulk-destroy"),{data:{ids:v.value.map(z=>z.id)}}),c=Number(n?.deleted||0),E=Number(n?.ignored_converted||0);c>0&&E>0?f.notify({type:"warning",message:`${c} removido(s). ${E} convertido(s) ignorado(s).`}):c>0?f.notify({type:"positive",message:n?.message||"Pageviews excluídos com sucesso."}):f.notify({type:"warning",message:n?.message||"Nenhum pageview elegível para exclusão."}),await y({pagination:d.value})}catch{f.notify({type:"negative",message:"Falha ao remover os pageviews selecionados."})}finally{m.value=!1}}}async function j(a){x.value=!0,P.value=!0,N.value=null;try{const l=await b.get(route("panel.atividade.pageviews.show",a.id));N.value=l.data}finally{P.value=!1}}return X(_,()=>{d.value.page=1,y({pagination:d.value})}),Z(()=>{T(),y({pagination:d.value})}),(a,l)=>(p(),L(le,null,[o(Q(ee),{title:"Relatório de atividade"}),o(Y,{flat:"",bordered:"",class:"tw-rounded-2xl tw-p-4"},{default:t(()=>[u("div",ie,[u("div",se,[o(O,{ref_key:"tableRef",ref:S,modelValue:_.value,"onUpdate:modelValue":l[0]||(l[0]=e=>_.value=e),options:$.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",clearable:"",label:"Filtrar por campanha"},null,8,["modelValue","options"])]),u("div",re,[o(D,{color:"negative",label:"Remover selecionados",disable:!R.value,onClick:M,class:"tw-w-full lg:tw-w-auto bulk-delete-btn"},null,8,["disable"])])]),o(W,{rows:V.value,columns:I,"row-key":"id",loading:m.value,pagination:d.value,"onUpdate:pagination":l[1]||(l[1]=e=>d.value=e),"binary-state-sort":!0,onRequest:y,selection:"multiple",selected:v.value,"onUpdate:selected":l[2]||(l[2]=e=>v.value=e)},{"body-cell-created_at":t(e=>[o(i,{props:e},{default:t(()=>[w(g(e.value),1)]),_:2},1032,["props"])]),"body-cell-ip_category":t(e=>[o(i,{props:e},{default:t(()=>[u("div",de,[u("span",{class:"tw-inline-flex tw-h-3 tw-w-3 tw-rounded-full tw-border tw-border-white/20 tw-shadow-sm",style:te({backgroundColor:B(e.row).color})},null,4),u("span",ce,g(B(e.row).label),1),o(J,{class:"tw-text-xs tw-max-w-xs tw-leading-snug"},{default:t(()=>[w(g(B(e.row).description),1)]),_:2},1024)])]),_:2},1032,["props"])]),"body-cell-ip":t(e=>[o(i,{props:e},{default:t(()=>[w(g(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-campaign_name":t(e=>[o(i,{props:e},{default:t(()=>[w(g(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-country_code":t(e=>[o(i,{props:e},{default:t(()=>[u("div",ue,[F(e.row)?(p(),L("img",{key:0,src:F(e.row),alt:e.value,class:"tw-w-6 tw-h-4 tw-rounded-sm tw-object-cover tw-border tw-border-gray-200"},null,8,ge)):ae("",!0),u("span",null,g(e.value?e.value.toUpperCase():"-"),1)])]),_:2},1032,["props"])]),"body-cell-region_name":t(e=>[o(i,{props:e},{default:t(()=>[w(g(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-city":t(e=>[o(i,{props:e},{default:t(()=>[w(g(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-gclid":t(e=>[o(i,{props:e},{default:t(()=>[U(e.value)?(p(),C(h,{key:0,color:"primary",label:"Sim"})):(p(),C(h,{key:1,color:"grey-4","text-color":"dark",label:"Não"}))]),_:2},1032,["props"])]),"body-cell-conversion":t(e=>[o(i,{props:e},{default:t(()=>[A(e.value)?(p(),C(h,{key:0,color:"green",label:"Convertido"})):(p(),C(h,{key:1,color:"grey-4","text-color":"dark",label:"Não convertido"}))]),_:2},1032,["props"])]),"body-cell-details":t(e=>[o(i,{props:e},{default:t(()=>[o(D,{dense:"",flat:"",round:"",size:"sm",icon:"manage_search",color:"primary",onClick:s=>j(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-actions":t(e=>[o(i,{props:e,class:"tw-text-right"},{default:t(()=>[o(D,{dense:"",flat:"",icon:"delete",color:"negative",onClick:s=>G(e.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","selected"])]),_:1}),o(oe,{modelValue:x.value,"onUpdate:modelValue":l[3]||(l[3]=e=>x.value=e),loading:P.value,payload:N.value,"asset-base-url":Q(q)},null,8,["modelValue","loading","payload","asset-base-url"])],64))}},be=ne(me,[["__scopeId","data-v-964a7b98"]]);export{be as default};
