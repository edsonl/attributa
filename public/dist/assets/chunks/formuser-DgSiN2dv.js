import{w as Q,B as P,A as _,C as A,E as h,e as x,v as M}from"./vendor-quasar-Bee0Lbku.js";import{r as g,w as B,f as C,_ as j,G as c,H as u,Q as i,E as o,D as b,u as s,O as y,a0 as F,I as k,J as N,C as L}from"./vendor-BB0I-wvh.js";const $={class:"tw-flex tw-justify-center tw-mt-8"},D={class:"tw-w-full md:tw-max-w-xl lg:tw-max-w-2xl"},z={class:"tw-text-lg tw-font-semibold tw-mb-2"},G={class:"md:tw-col-span-2 tw-border tw-border-slate-200 tw-rounded-lg tw-p-3 tw-space-y-3"},H={key:0,class:"tw-text-sm tw-text-slate-500"},J={key:1,class:"tw-space-y-3"},T={class:"tw-px-3 tw-pb-3 tw-space-y-2"},K={class:"tw-text-sm tw-font-medium"},R={class:"tw-text-xs tw-text-slate-500"},W={class:"md:tw-col-span-2 tw-flex tw-gap-2 tw-justify-between"},Z={__name:"FormUser",props:{mode:{type:String,default:"create"},user:{type:Object,default:()=>({id:null,name:"",email:"",notification_email:""})},notificationOptions:{type:Array,default:()=>[]},notificationPreferences:{type:Array,default:()=>[]}},emits:["submit"],setup(V,{emit:U}){const r=V,E=U,t=g({name:"",email:"",notification_email:"",password:"",password_confirmation:""}),f=g({});B(()=>r.user,n=>{n&&(t.value.name=n.name??"",t.value.email=n.email??"",t.value.notification_email=n.notification_email??"",t.value.password="",t.value.password_confirmation="")},{immediate:!0});const m=C(()=>r.mode==="edit"),I=C(()=>Array.isArray(r.notificationOptions)&&r.notificationOptions.length>0);function O(n,a){const p={},e={};for(const l of a||[]){const d=Number(l?.notification_type_id||0);d>0&&(e[d]={enabled_in_app:!!(l.enabled_in_app??!0),enabled_email:!!(l.enabled_email??!1),enabled_push:!!(l.enabled_push??!1),frequency:l.frequency??null})}for(const l of n||[])for(const d of l?.types||[]){const v=Number(d?.id||0);v<=0||(p[v]=e[v]||{enabled_in_app:!0,enabled_email:!1,enabled_push:!1,frequency:null})}return p}function S(){const n=[];for(const a of r.notificationOptions||[])for(const p of a?.types||[]){const e=Number(p?.id||0);if(e<=0)continue;const l=f.value[e]||{enabled_in_app:!0,enabled_email:!1,enabled_push:!1,frequency:null};n.push({notification_type_id:e,enabled_in_app:!!l.enabled_in_app,enabled_email:!!l.enabled_email,enabled_push:!!l.enabled_push,frequency:l.frequency??null})}return n}function w(n){const a=Number(n||0);return a<=0?{enabled_in_app:!0,enabled_email:!1,enabled_push:!1,frequency:null}:(f.value[a]||(f.value[a]={enabled_in_app:!0,enabled_email:!1,enabled_push:!1,frequency:null}),f.value[a])}function q(){E("submit",{...t.value,notification_preferences:S()})}return B(()=>[r.notificationOptions,r.notificationPreferences],([n,a])=>{f.value=O(n,a)},{immediate:!0,deep:!0}),(n,a)=>{const p=j("Link");return u(),c("div",$,[i("div",D,[o(s(M),{flat:"",bordered:""},{default:b(()=>[o(s(Q),null,{default:b(()=>[i("div",z,y(m.value?"Editar usuário":"Cadastrar usuário"),1),o(s(P),{onSubmit:F(q,["prevent"]),class:"tw-grid tw-gap-4 md:tw-grid-cols-2"},{default:b(()=>[o(s(_),{modelValue:t.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value.name=e),label:"Nome",outlined:"",dense:"",rules:[e=>!!e||"Informe o nome"],class:"md:tw-col-span-2"},null,8,["modelValue","rules"]),o(s(_),{modelValue:t.value.email,"onUpdate:modelValue":a[1]||(a[1]=e=>t.value.email=e),label:"E-mail",type:"email",outlined:"",dense:"",rules:[e=>!!e||"Informe o e-mail"],class:"md:tw-col-span-2"},null,8,["modelValue","rules"]),o(s(_),{modelValue:t.value.notification_email,"onUpdate:modelValue":a[2]||(a[2]=e=>t.value.notification_email=e),label:"E-mail para notificações",type:"email",outlined:"",dense:"",hint:"Se vazio, usaremos o e-mail principal da conta.",rules:[e=>!e||/^[^\\s@]+@[^\\s@]+\\.[^\\s@]{2,}$/.test(e)||"E-mail inválido"],class:"md:tw-col-span-2"},null,8,["modelValue","rules"]),o(s(_),{modelValue:t.value.password,"onUpdate:modelValue":a[3]||(a[3]=e=>t.value.password=e),type:"password",outlined:"",dense:"",label:m.value?"Senha (opcional)":"Senha",rules:m.value?[]:[e=>!!e||"Informe a senha",e=>(e?.length??0)>=8||"Mínimo 8 caracteres"]},null,8,["modelValue","label","rules"]),o(s(_),{modelValue:t.value.password_confirmation,"onUpdate:modelValue":a[4]||(a[4]=e=>t.value.password_confirmation=e),type:"password",outlined:"",dense:"",label:m.value?"Confirmar senha (opcional)":"Confirmar senha",rules:m.value?[]:[e=>e===t.value.password||"Confirmação não confere"]},null,8,["modelValue","label","rules"]),i("div",G,[a[5]||(a[5]=i("div",{class:"tw-text-sm tw-font-semibold"},"Preferências de notificação",-1)),I.value?(u(),c("div",J,[(u(!0),c(k,null,N(V.notificationOptions,e=>(u(),L(A,{key:`cat-${e.id}`,label:e.name,dense:"","default-opened":"",class:"tw-border tw-border-slate-200 tw-rounded"},{default:b(()=>[i("div",T,[(u(!0),c(k,null,N(e.types||[],l=>(u(),c("div",{key:`type-${l.id}`,class:"tw-grid tw-grid-cols-1 md:tw-grid-cols-[1fr_auto_auto] tw-gap-2 tw-items-center tw-border-b tw-border-slate-100 tw-py-2 last:tw-border-b-0"},[i("div",null,[i("div",K,y(l.name),1),i("div",R,y(l.slug),1)]),o(h,{modelValue:w(l.id).enabled_in_app,"onUpdate:modelValue":d=>w(l.id).enabled_in_app=d,dense:"",label:"No sistema"},null,8,["modelValue","onUpdate:modelValue"]),o(h,{modelValue:w(l.id).enabled_email,"onUpdate:modelValue":d=>w(l.id).enabled_email=d,dense:"",label:"Por e-mail"},null,8,["modelValue","onUpdate:modelValue"])]))),128))])]),_:2},1032,["label"]))),128))])):(u(),c("div",H," Nenhum tipo de notificação ativo no catálogo. "))]),i("div",W,[o(p,{href:n.route("panel.users.index"),as:"button",type:"button"},{default:b(()=>[o(s(x),{flat:"",color:"primary",label:"Voltar"})]),_:1},8,["href"]),o(s(x),{type:"submit",color:"positive",unelevated:"",label:m.value?"Salvar alterações":"Cadastrar"},null,8,["label"])])]),_:1})]),_:1})]),_:1})])])}}};export{Z as default};
