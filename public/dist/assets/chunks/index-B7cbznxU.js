import{e as d,w as y,A as ge,c as A,F as me,G as h,o as W,V as fe,Q as we,a as ve,b as K,K as x,n as be,v as F,l as D,x as X,y as Y,J as _e,N as w}from"./vendor-quasar-Bee0Lbku.js";import{f as ye,r as c,w as Z,G as g,H as i,E as t,Q as n,u as m,S as he,D as l,U as xe,a1 as Ce,P as U,O as r,N as C,I as O,J as ee,j as k,C as P,M as E,V as G,R as M}from"./vendor-BB0I-wvh.js";import{q as v}from"./qtable-pt-CkdICETI.js";import{_ as ke}from"../app-E_Yf9P2s.js";const Ne={class:"tw-space-y-3"},Se={class:"tw-flex tw-items-center tw-justify-between tw-flex-col sm:tw-flex-row tw-gap-3"},Qe={class:"tw-flex tw-gap-3 tw-flex-col md:tw-flex-row"},Be={class:"tw-flex tw-items-center tw-gap-2 tw-flex-wrap"},Ve={key:0,class:"tw-inline-flex tw-items-center tw-gap-1 tw-text-sm tw-text-gray-600"},De={key:1},Pe={class:"status-cell-wrapper"},Te={class:"status-pill"},Le={key:0,class:"tw-text-center tw-py-6"},Re={class:"tw-text-sm tw-text-gray-600"},je={key:0,class:"tw-text-center tw-py-6"},qe={key:1,class:"tw-text-sm tw-text-gray-600"},Ie={key:2,class:"tw-flex tw-flex-wrap tw-gap-2 tw-max-h-96 tw-overflow-y-auto"},ze={__name:"Index",props:{campaigns:{type:Object,required:!0},campaignStatusCatalog:{type:Array,default:()=>[]},filters:{type:Object,default:()=>({})}},setup(J){const p=J,ae=ye(()=>p.campaigns?.data??[]),f=c(p.filters?.search??""),s=c({page:p.campaigns?.current_page??1,rowsPerPage:p.campaigns?.per_page??15,rowsNumber:p.campaigns?.total??0,sortBy:p.filters?.sort??"created_at",descending:(p.filters?.direction??"desc")==="desc"});Z(()=>p.campaigns,a=>{a&&(s.value.page=a.current_page,s.value.rowsPerPage=a.per_page,s.value.rowsNumber=a.total)}),Z(()=>p.filters,a=>{s.value.sortBy=a?.sort??"created_at",s.value.descending=(a?.direction??"desc")==="desc",(a?.search??"")!==f.value&&(f.value=a?.search??"")});const te=[{name:"code",label:"Código",field:"code",align:"left",sortable:!0},{name:"name",label:"Nome",field:"name",align:"left",sortable:!0},{name:"views",label:"Visitas/Únicas",field:a=>Number(a.pageviews_count??0),align:"center",sortable:!0},{name:"countries",label:"Países",field:"countries",align:"left"},{name:"channel",label:"Canal",field:a=>a.channel?.name??"-",align:"left"},{name:"conversion_goal",label:"Meta de conversao",field:a=>a.conversion_goal?.goal_code??"-",align:"left"},{name:"status",label:"Status",field:"status",align:"center",sortable:!0},{name:"tracking_snippet",label:"Acompanhamento",field:"code",align:"left"},{name:"actions",label:"Ações",field:"actions",align:"right"}],T=c(!1),L=c(!1),N=c(""),S=c(null),R=c(!1),j=c(!1),Q=c(""),q=c(0),B=c([]),b=c({});function I(){const a={page:s.value.page,per_page:s.value.rowsPerPage,sort:s.value.sortBy,direction:s.value.descending?"desc":"asc",search:f.value||void 0};G.get(route("panel.campaigns.index"),a,{preserveState:!0,preserveScroll:!0,replace:!0})}function le({pagination:a}){Object.assign(s.value,a),I()}function z(){s.value.page=1,I()}function oe(){f.value!==""&&(f.value="",s.value.page=1,I())}function _(a){return a?.hashid??a?.id}function ne(a){G.visit(route("panel.campaigns.edit",_(a)))}function se(a){confirm(`Deseja realmente remover a campanha "${a.name}"?`)&&G.delete(route("panel.campaigns.destroy",_(a)))}async function ie(a){const o=_(a);if(o){T.value=!0,L.value=!0,N.value="";try{const e=await M.get(route("panel.campaigns.tracking_code",o));N.value=String(e.data.script||"").trim()}catch{w.create({type:"negative",message:"Não foi possível carregar o código de acompanhamento",position:"top-right"})}finally{L.value=!1}}}async function re(a){const o=_(a);if(o){R.value=!0,j.value=!0,Q.value=a?.name??"Campanha",q.value=Number(a?.countries_count??0),B.value=[];try{const e=await M.get(route("panel.campaigns.countries",o));Q.value=String(e.data?.campaign?.name??Q.value),q.value=Number(e.data?.campaign?.countries_count??0),B.value=Array.isArray(e.data?.countries)?e.data.countries:[]}catch{w.create({type:"negative",message:"Não foi possível carregar a lista de países",position:"top-right"})}finally{j.value=!1}}}function ue(){if(S.value){S.value.focus(),S.value.select();try{if(!document.execCommand("copy"))throw new Error;w.create({type:"positive",message:"Código copiado",timeout:2e3,position:"top-right"})}catch{w.create({type:"negative",message:"Não foi possível copiar o código",timeout:3e3,position:"top-right"})}}}function ce(a){return $(a)?.label??"-"}function H(a){return $(a)?.color_hex??"#64748B"}function de(a){const o=$(a);return o?o.tooltip??`Status da campanha: ${o.label}`:"Status da campanha"}function $(a){const o=Number(a?.campaign_status_id??0);return(p.campaignStatusCatalog??[]).find(e=>Number(e?.id??0)===o)??null}async function pe(a,o){const e=_(a);if(e&&Number(a?.campaign_status_id??0)!==Number(o??0)){b.value={...b.value,[a.id]:!0};try{const u=await M.patch(route("panel.campaigns.update-status",e),{campaign_status_id:o}),V=u.data?.campaign;V&&Number(V.id)===Number(a.id)&&(a.campaign_status_id=V.campaign_status_id),w.create({type:"positive",message:u.data?.message||"Status atualizado com sucesso.",position:"top-right"})}catch{w.create({type:"negative",message:"Não foi possível atualizar o status da campanha.",position:"top-right"})}finally{b.value={...b.value,[a.id]:!1}}}}return(a,o)=>(i(),g(O,null,[t(m(he),{title:"Campanhas"}),n("div",Ne,[n("div",Se,[o[4]||(o[4]=n("h1",{class:"tw-text-lg tw-font-semibold"}," Campanhas ",-1)),t(m(xe),{href:a.route("panel.campaigns.create")},{default:l(()=>[t(d,{color:"positive",icon:"add",label:"Nova Campanha",unelevated:""})]),_:1},8,["href"])]),t(F,{flat:"",bordered:""},{default:l(()=>[t(y,{class:"tw-space-y-3"},{default:l(()=>[n("div",Qe,[t(ge,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=e=>f.value=e),dense:"",outlined:"",clearable:"",placeholder:"Pesquisar por código ou nome",class:"md:tw-flex-1",onKeyup:Ce(z,["enter"]),onClear:oe},{append:l(()=>[t(A,{name:"search",class:"cursor-pointer",onClick:z})]),_:1},8,["modelValue"]),t(d,{outline:"",color:"primary",icon:"search",label:"Filtrar",class:"md:tw-w-auto",onClick:z})]),t(me,{flat:"",rows:ae.value,columns:te,"row-key":"id","binary-state-sort":"",pagination:s.value,"onUpdate:pagination":o[1]||(o[1]=e=>s.value=e),"rows-per-page-options":[10,15,25,50],"no-data-label":m(v).noData,"no-results-label":m(v).noResults,"loading-label":m(v).loading,"rows-per-page-label":m(v).recordsPerPage,"all-rows-label":m(v).allRows,"pagination-label":m(v).pagination,onRequest:le},{"body-cell-views":l(e=>[t(h,{props:e,class:"tw-text-center"},{default:l(()=>[t(be,{color:"blue-grey-1","text-color":"blue-grey-10",rounded:"",class:"views-badge"},{default:l(()=>[C(r(Number(e.row.pageviews_count??0).toLocaleString("pt-BR"))+"/"+r(Number(e.row.visitors_count??0).toLocaleString("pt-BR"))+" ",1),t(W,null,{default:l(()=>[C(r(Number(e.row.pageviews_count??0).toLocaleString("pt-BR"))+" pageviews / "+r(Number(e.row.visitors_count??0).toLocaleString("pt-BR"))+" visitas únicas ",1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-countries":l(e=>[t(h,{props:e},{default:l(()=>[n("div",Be,[Number(e.row.countries_count??0)===0?(i(),g("span",Ve,[t(A,{name:"public",size:"16px"}),o[5]||(o[5]=n("span",null,"Global",-1))])):(i(),g("span",De,r((e.row.countries_preview??[]).join(", ")),1)),Number(e.row.countries_hidden_count??0)>0?(i(),P(d,{key:2,flat:"",dense:"","no-caps":"",color:"primary",label:`(+${e.row.countries_hidden_count??0})`,onClick:u=>re(e.row)},null,8,["label","onClick"])):E("",!0)])]),_:2},1032,["props"])]),"body-cell-status":l(e=>[t(h,{props:e,class:"tw-text-center"},{default:l(()=>[n("div",Pe,[n("div",Te,[n("span",{class:"status-dot",style:U({backgroundColor:H(e.row)})},null,4),n("span",null,r(ce(e.row)),1),t(W,{style:U({backgroundColor:H(e.row),color:"#fff"})},{default:l(()=>[C(r(de(e.row)),1)]),_:2},1032,["style"])]),t(fe,{flat:"",round:"",dense:"","dropdown-icon":"arrow_drop_down","no-icon-animation":"",disable:!!b.value[e.row.id]},{default:l(()=>[t(we,{dense:""},{default:l(()=>[(i(!0),g(O,null,ee(J.campaignStatusCatalog,u=>k((i(),P(ve,{key:u.id,clickable:"",onClick:V=>pe(e.row,u.id)},{default:l(()=>[t(K,{avatar:""},{default:l(()=>[n("span",{class:"tw-inline-flex tw-h-3 tw-w-3 tw-rounded-full tw-border tw-border-black/10",style:U({backgroundColor:u.color_hex})},null,4)]),_:2},1024),t(K,null,{default:l(()=>[C(r(u.label),1)]),_:2},1024),Number(e.row.campaign_status_id)===Number(u.id)?(i(),P(K,{key:0,side:""},{default:l(()=>[t(A,{name:"check",size:"16px"})]),_:1})):E("",!0)]),_:2},1032,["onClick"])),[[x]])),128))]),_:2},1024)]),_:2},1032,["disable"])])]),_:2},1032,["props"])]),"body-cell-tracking_snippet":l(e=>[t(h,{props:e},{default:l(()=>[t(d,{flat:"",dense:"",size:"sm",icon:"code",color:"primary",label:"Snippet",onClick:u=>ie(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-actions":l(e=>[t(h,{props:e,class:"tw-text-right"},{default:l(()=>[t(d,{flat:"",dense:"",size:"sm",icon:"edit",class:"qtable-edit-btn",onClick:u=>ne(e.row)},null,8,["onClick"]),t(d,{flat:"",dense:"",size:"sm",icon:"delete",class:"qtable-delete-btn",onClick:u=>se(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","pagination","no-data-label","no-results-label","loading-label","rows-per-page-label","all-rows-label","pagination-label"])]),_:1})]),_:1})]),t(Y,{modelValue:T.value,"onUpdate:modelValue":o[2]||(o[2]=e=>T.value=e)},{default:l(()=>[t(F,{style:{"min-width":"750px","max-width":"95vw","min-height":"450px"}},{default:l(()=>[t(y,{class:"tw-flex tw-justify-between tw-items-center"},{default:l(()=>[o[6]||(o[6]=n("div",{class:"tw-text-lg tw-font-semibold"}," Código de acompanhamento ",-1)),k(t(d,{flat:"",dense:"",icon:"close"},null,512),[[x]])]),_:1}),t(D),t(y,null,{default:l(()=>[L.value?(i(),g("div",Le," Carregando... ")):E("",!0),n("textarea",{ref_key:"trackingTextarea",ref:S,class:"tw-w-full tw-h-72 tw-font-mono tw-text-sm tw-p-3 tw-bg-gray-100 tw-rounded",readonly:""},r(N.value),513)]),_:1}),t(D),t(X,{align:"right"},{default:l(()=>[t(d,{flat:"",icon:"content_copy",label:"Copiar",disable:!N.value,onClick:ue},null,8,["disable"]),k(t(d,{color:"primary",label:"Fechar"},null,512),[[x]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Y,{modelValue:R.value,"onUpdate:modelValue":o[3]||(o[3]=e=>R.value=e)},{default:l(()=>[t(F,{style:{"min-width":"620px","max-width":"95vw","max-height":"85vh"}},{default:l(()=>[t(y,{class:"tw-flex tw-items-center tw-justify-between"},{default:l(()=>[n("div",null,[o[7]||(o[7]=n("div",{class:"tw-text-lg tw-font-semibold"}," Países da campanha ",-1)),n("div",Re,r(Q.value)+" · "+r(q.value)+" país(es) ",1)]),k(t(d,{flat:"",dense:"",icon:"close"},null,512),[[x]])]),_:1}),t(D),t(y,null,{default:l(()=>[j.value?(i(),g("div",je," Carregando... ")):B.value.length?(i(),g("div",Ie,[(i(!0),g(O,null,ee(B.value,e=>(i(),P(_e,{key:e.id,dense:"",square:""},{default:l(()=>[C(r(e.name)+" ("+r(e.iso2)+") ",1)]),_:2},1024))),128))])):(i(),g("div",qe," Nenhum país encontrado para esta campanha. "))]),_:1}),t(D),t(X,{align:"right"},{default:l(()=>[k(t(d,{color:"primary",label:"Fechar"},null,512),[[x]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Ue=ke(ze,[["__scopeId","data-v-8f3768dc"]]);export{Ue as default};
