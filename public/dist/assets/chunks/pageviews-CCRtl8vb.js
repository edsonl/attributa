import{C as ve,h as D,A as ge,B as c,k as y,r as j,s as M,E as me,Q as pe,a as _e,b as fe,v as we}from"./vendor-quasar-CQUzQrOh.js";import{r as u,f as n,w as ye,e as be,G as C,H as d,E as s,u as ke,P as Ce,D as o,Q as e,C as v,M as _,N as i,O as Q,L as H,I,J as V,V as h}from"./vendor-D8nj3W7R.js";import{_ as he}from"../app-ngMEhA-0.js";const Pe={class:"row q-mb-md items-center q-col-gutter-md"},xe={class:"col-12 col-md-4 q-mb-sm q-mb-md-0"},Ne={class:"col-12 col-md-4 col-lg-3 q-mt-sm q-mt-md-0 q-pl-md-sm"},Se={class:"tw-flex tw-items-center tw-gap-2"},Le={class:"tw-text-sm tw-font-medium"},De={class:"detail-section"},Ie={class:"section-card"},Re={class:"section-card__body"},Ae={class:"tw-grid md:tw-grid-cols-2 lg:tw-grid-cols-3 tw-gap-4"},Ee={class:"detail-value"},Qe={class:"detail-value"},Ve={class:"detail-value"},Be={class:"tw-mt-1"},Ue={class:"ip-category-description"},Fe={class:"tw-mt-1"},qe={class:"detail-section"},Oe={class:"section-card"},$e={class:"section-card__body"},Ge={class:"tw-grid md:tw-grid-cols-2 lg:tw-grid-cols-3 tw-gap-4"},Te={class:"detail-label"},ze={class:"detail-value"},je={class:"detail-section"},Me={class:"section-card"},He={class:"section-card__body section-body--stack"},Je={class:"detail-value tw-break-all"},Ke={class:"tw-mt-2"},We={class:"tw-text-xs tw-uppercase tw-text-slate-500"},Ye={class:"tw-text-sm tw-font-medium tw-break-all"},Ze={key:1,class:"tw-text-sm tw-text-slate-500"},Xe={class:"detail-section"},ea={class:"section-card"},aa={class:"section-card__body"},la={class:"tw-grid md:tw-grid-cols-2 lg:tw-grid-cols-3 tw-gap-4"},ta={class:"detail-value"},oa={class:"detail-value"},ia={class:"tw-mt-1"},sa={class:"ip-category-description"},na={class:"detail-value"},da={class:"detail-value"},ra={class:"tw-grid md:tw-grid-cols-2 lg:tw-grid-cols-3 tw-gap-3 tw-mt-4"},ca={class:"detail-label"},ua={class:"detail-value"},va={__name:"Pageviews",setup(ga){const B=u([]),m=u(!1),J=u(null),g=u({page:1,rowsPerPage:20,rowsNumber:0,sortBy:"created_at",descending:!0}),P=u(null),U=u([]),F={label:"Não determinado",color:"#FCE7F3"},K={name:"Não determinado",color_hex:"#FCE7F3",description:"Categoria ainda não determinada."},x=u(!1),N=u(!1),f=u(null),w=u([]),b=n(()=>f.value?.pageview??{}),q=n(()=>f.value?.url??{full:null,origin:null,path:null,query_params:{}}),W=n(()=>f.value?.geo??{}),p=n(()=>f.value?.network??{}),O=n(()=>{const t=q.value?.query_params??{};return Object.entries(t)}),Y=n(()=>O.value.length>0),Z=n(()=>b.value?.campaign?.name??"-"),X=n(()=>p.value?.flags??{}),R=n(()=>b.value?.ip_category??K),A=n(()=>p.value?.ip_category??null),ee=n(()=>A.value?.color_hex??"#475569"),ae=n(()=>A.value?.name??"-"),le=n(()=>A.value?.description??"Sem descrição."),te=n(()=>G(q.value?.full||"")),$=n(()=>w.value.length>0),oe=[{name:"created_at",label:"Data",field:"created_at",sortable:!0,align:"left"},{name:"ip_category",label:"Classificação IP",field:t=>t?.ip_category_name,sortable:!0,align:"left"},{name:"ip",label:"IP",field:"ip",sortable:!0,align:"left"},{name:"campaign_name",label:"Campanha",field:"campaign_name",sortable:!0,align:"left"},{name:"country_code",label:"País",field:"country_code",sortable:!0,align:"left"},{name:"region_name",label:"Região",field:"region_name",sortable:!0,align:"left"},{name:"city",label:"Cidade",field:"city",sortable:!0,align:"left"},{name:"gclid",label:"GCLID",field:"gclid",sortable:!0,align:"left"},{name:"conversion",label:"Conversão",field:"conversion",sortable:!0,align:"left"},{name:"details",label:"Detalhes",field:"id",align:"center"},{name:"actions",label:"Ações",field:"id",align:"right"}];function E(t){return t?new Date(t).toLocaleString("pt-BR",{dateStyle:"short",timeStyle:"medium"}):"-"}function G(t){if(!t)return"-";try{const l=typeof window<"u"?window.location.origin:"https://placeholder.local",a=new URL(t,l);return`${a.origin}${a.pathname}`}catch{return t.split("?")[0]??t}}function T(t){return{label:t?.ip_category_name??F.label,color:t?.ip_category_color??F.color}}function ie(t){return t==null?!1:String(t).trim().length>0}function z(t){return t===!0||t===1||t==="1"}function se(t){return t==null?"-":t?"Sim":"Não"}function ne(t){if(t==null)return"-";if(Array.isArray(t)||typeof t=="object")try{return JSON.stringify(t)}catch{return String(t)}return String(t)}function de(){h.get(route("panel.atividade.campaigns")).then(t=>{U.value=t.data})}function k(t){m.value=!0;const{page:l,rowsPerPage:a,sortBy:r,descending:S}=t.pagination;return h.get(route("panel.atividade.pageviews.data"),{params:{page:l,per_page:a,sortBy:r,descending:S,campaign_id:P.value}}).then(L=>{B.value=L.data.data,w.value=[],g.value={...g.value,page:L.data.current_page,rowsPerPage:L.data.per_page,rowsNumber:L.data.total,sortBy:r,descending:S}}).finally(()=>{m.value=!1})}async function re(t){if(!t)return;let l=!0;const a=typeof window<"u",r=a?window.$confirm:null;if(r?l=await r({title:"Excluir pageview",message:"Esta ação é permanente. Deseja realmente remover?",okLabel:"Remover",okColor:"negative"}):a&&(l=window.confirm("Excluir este pageview?")),!!l){m.value=!0;try{await h.delete(route("panel.atividade.pageviews.destroy",t)),await k({pagination:g.value})}finally{m.value=!1}}}async function ce(){if(!$.value)return;let t=!0;const l=typeof window<"u",a=l?window.$confirm:null,r=`Você selecionou ${w.value.length} registro(s). Deseja remover?`;if(a?t=await a({title:"Remover pageviews",message:r,okLabel:"Remover",okColor:"negative"}):l&&(t=window.confirm(r)),!!t){m.value=!0;try{await h.delete(route("panel.atividade.pageviews.bulk-destroy"),{data:{ids:w.value.map(S=>S.id)}}),await k({pagination:g.value})}finally{m.value=!1}}}async function ue(t){x.value=!0,N.value=!0,f.value=null;try{const l=await h.get(route("panel.atividade.pageviews.show",t.id));f.value=l.data}finally{N.value=!1}}return ye(P,()=>{g.value.page=1,k({pagination:g.value})}),be(()=>{de(),k({pagination:g.value})}),(t,l)=>(d(),C(I,null,[s(ke(Ce),{title:"Relatório de atividade"}),s(j,{flat:"",bordered:"",class:"tw-rounded-2xl tw-p-4"},{default:o(()=>[e("div",Pe,[e("div",xe,[s(ve,{ref_key:"tableRef",ref:J,modelValue:P.value,"onUpdate:modelValue":l[0]||(l[0]=a=>P.value=a),options:U.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",clearable:"",label:"Filtrar por campanha"},null,8,["modelValue","options"])]),e("div",Ne,[s(D,{color:"negative",label:"Remover selecionados",disable:!$.value,onClick:ce,class:"tw-w-full lg:tw-w-auto bulk-delete-btn"},null,8,["disable"])])]),s(ge,{rows:B.value,columns:oe,"row-key":"id",loading:m.value,pagination:g.value,"onUpdate:pagination":l[1]||(l[1]=a=>g.value=a),"binary-state-sort":!0,onRequest:k,selection:"multiple",selected:w.value,"onUpdate:selected":l[2]||(l[2]=a=>w.value=a)},{"body-cell-created_at":o(a=>[s(c,{props:a},{default:o(()=>[_(i(E(a.value)),1)]),_:2},1032,["props"])]),"body-cell-ip_category":o(a=>[s(c,{props:a},{default:o(()=>[e("div",Se,[e("span",{class:"tw-inline-flex tw-h-3 tw-w-3 tw-rounded-full tw-border tw-border-white/20 tw-shadow-sm",style:Q({backgroundColor:T(a.row).color})},null,4),e("span",Le,i(T(a.row).label),1)])]),_:2},1032,["props"])]),"body-cell-ip":o(a=>[s(c,{props:a},{default:o(()=>[_(i(a.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-campaign_name":o(a=>[s(c,{props:a},{default:o(()=>[_(i(a.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-country_code":o(a=>[s(c,{props:a},{default:o(()=>[_(i(a.value?a.value.toUpperCase():"-"),1)]),_:2},1032,["props"])]),"body-cell-region_name":o(a=>[s(c,{props:a},{default:o(()=>[_(i(a.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-city":o(a=>[s(c,{props:a},{default:o(()=>[_(i(a.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-url":o(a=>[s(c,{props:a},{default:o(()=>[_(i(G(a.value)),1)]),_:2},1032,["props"])]),"body-cell-gclid":o(a=>[s(c,{props:a},{default:o(()=>[ie(a.value)?(d(),v(y,{key:0,color:"primary",label:"Sim"})):(d(),v(y,{key:1,color:"grey-4","text-color":"dark",label:"Não"}))]),_:2},1032,["props"])]),"body-cell-conversion":o(a=>[s(c,{props:a},{default:o(()=>[z(a.value)?(d(),v(y,{key:0,color:"green",label:"Convertido"})):(d(),v(y,{key:1,color:"grey-4","text-color":"dark",label:"Não convertido"}))]),_:2},1032,["props"])]),"body-cell-details":o(a=>[s(c,{props:a},{default:o(()=>[s(D,{dense:"",flat:"",round:"",size:"sm",icon:"manage_search",color:"primary",onClick:r=>ue(a.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-actions":o(a=>[s(c,{props:a,class:"tw-text-right"},{default:o(()=>[s(D,{dense:"",flat:"",icon:"delete",color:"negative",onClick:r=>re(a.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","selected"])]),_:1}),s(we,{modelValue:x.value,"onUpdate:modelValue":l[4]||(l[4]=a=>x.value=a),"transition-show":"scale","transition-hide":"scale"},{default:o(()=>[s(j,{class:"pageview-detail-card"},{default:o(()=>[s(M,{class:"tw-flex tw-justify-end"},{default:o(()=>[s(D,{icon:"close",flat:"",round:"",dense:"",onClick:l[3]||(l[3]=a=>x.value=!1)})]),_:1}),N.value?(d(),v(me,{key:0,indeterminate:"",color:"primary"})):H("",!0),N.value?H("",!0):(d(),v(M,{key:1,class:"tw-space-y-6"},{default:o(()=>[e("section",De,[e("div",Ie,[l[10]||(l[10]=e("div",{class:"section-card__header"},"VISITA",-1)),e("div",Re,[e("div",Ae,[e("div",null,[l[5]||(l[5]=e("div",{class:"detail-label"},"Data/Horário",-1)),e("div",Ee,i(E(b.value.created_at)),1)]),e("div",null,[l[6]||(l[6]=e("div",{class:"detail-label"},"Campanha",-1)),e("div",Qe,i(Z.value),1)]),e("div",null,[l[7]||(l[7]=e("div",{class:"detail-label"},"IP",-1)),e("div",Ve,i(b.value.ip||"-"),1)]),e("div",null,[l[8]||(l[8]=e("div",{class:"detail-label"},"Categoria de IP",-1)),e("div",Be,[e("div",{class:"ip-category-label",style:Q({color:R.value.color_hex})},i(R.value.name),5),e("div",Ue,i(R.value.description||"Sem descrição."),1)])]),e("div",null,[l[9]||(l[9]=e("div",{class:"detail-label"},"Conversão",-1)),e("div",Fe,[z(b.value.conversion)?(d(),v(y,{key:0,color:"green",label:"Convertido"})):(d(),v(y,{key:1,color:"grey-4","text-color":"dark",label:"Não convertido"}))])])])])])]),e("section",qe,[e("div",Oe,[l[11]||(l[11]=e("div",{class:"section-card__header"},"GEOLOCALIZAÇÃO",-1)),e("div",$e,[e("div",Ge,[(d(),C(I,null,V([{label:"País",key:"country_name"},{label:"Código",key:"country_code"},{label:"Região",key:"region_name"},{label:"Cidade",key:"city"},{label:"Latitude",key:"latitude"},{label:"Longitude",key:"longitude"},{label:"Timezone",key:"timezone"}],a=>e("div",{key:a.key},[e("div",Te,i(a.label),1),e("div",ze,i(W.value[a.key]??"-"),1)])),64))])])])]),e("section",je,[e("div",Me,[l[14]||(l[14]=e("div",{class:"section-card__header"},"ORIGEM DA URL",-1)),e("div",He,[e("div",null,[l[12]||(l[12]=e("div",{class:"detail-label"},"Página (sem parâmetros)",-1)),e("div",Je,i(te.value),1)]),e("div",null,[l[13]||(l[13]=e("div",{class:"detail-label"},"Parâmetros",-1)),e("div",Ke,[Y.value?(d(),v(pe,{key:0,class:"rounded-borders"},{default:o(()=>[(d(!0),C(I,null,V(O.value,([a,r])=>(d(),v(_e,{key:`${a}-${r}`},{default:o(()=>[s(fe,null,{default:o(()=>[e("div",We,i(a),1),e("div",Ye,i(ne(r)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(d(),C("div",Ze,"Sem parâmetros na URL."))])])])])]),e("section",Xe,[e("div",ea,[l[20]||(l[20]=e("div",{class:"section-card__header"},"REDE & SEGURANÇA",-1)),e("div",aa,[e("div",la,[e("div",null,[l[15]||(l[15]=e("div",{class:"detail-label"},"ISP",-1)),e("div",ta,i(p.value.isp||"-"),1)]),e("div",null,[l[16]||(l[16]=e("div",{class:"detail-label"},"Organização",-1)),e("div",oa,i(p.value.organization||"-"),1)]),e("div",null,[l[17]||(l[17]=e("div",{class:"detail-label"},"Categoria IP (Lookup)",-1)),e("div",ia,[e("div",{class:"ip-category-label",style:Q({color:ee.value})},i(ae.value),5),e("div",sa,i(le.value),1)])]),e("div",null,[l[18]||(l[18]=e("div",{class:"detail-label"},"Fraud Score",-1)),e("div",na,i(p.value.fraud_score??"-"),1)]),e("div",null,[l[19]||(l[19]=e("div",{class:"detail-label"},"Última verificação",-1)),e("div",da,i(p.value.last_checked?E(p.value.last_checked):"-"),1)])]),e("div",ra,[(d(),C(I,null,V([{key:"is_proxy",label:"Proxy"},{key:"is_vpn",label:"VPN"},{key:"is_tor",label:"Tor"},{key:"is_datacenter",label:"Datacenter"},{key:"is_bot",label:"Bot"}],a=>e("div",{key:a.key},[e("div",ca,i(a.label),1),e("div",ua,i(se(X.value[a.key])),1)])),64))])])])])]),_:1}))]),_:1})]),_:1},8,["modelValue"])],64))}},fa=he(va,[["__scopeId","data-v-b91bf922"]]);export{fa as default};
