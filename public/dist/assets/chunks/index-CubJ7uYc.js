import{u as Ue,A as $e,M as Fe,e as u,O as Le,c as ae,H as le,n as T,o as j,q as te,Q as oe,a as A,b as S,E as ne,l as se,F as Ne,G as c,v as re,w as ie,K as Re,y as qe}from"./vendor-quasar-Bee0Lbku.js";import{r as s,f as Me,w as B,e as Ie,G as Y,H as $,E as t,u as de,S as Oe,D as o,Q as f,C as Te,M as je,N as i,O as m,I as z,J as ue,a0 as ce,j as Ae,R as F}from"./vendor-BB0I-wvh.js";import Be from"./pageviewdetailmodal-CM4HWsvF.js";import{_ as Ye}from"../app-ByB1HbPx.js";const ze={class:"row q-mb-md items-start q-col-gutter-md"},Ee={class:"col-12 col-sm-6 col-md-4 col-lg-2 q-mb-sm q-mb-md-0"},He={class:"tw-grid tw-grid-cols-1 md:tw-grid-cols-[150px_1fr] tw-gap-3 tw-p-3"},Je={class:"tw-flex tw-flex-col tw-gap-2"},Ge={class:"tw-flex tw-justify-end tw-gap-2 tw-px-3 tw-pb-3"},Ke={class:"col-12 col-sm-6 col-md-4 col-lg-3 q-mb-sm q-mb-md-0"},We={class:"col-12 col-sm-6 col-md-4 col-lg-2 q-mb-sm q-mb-md-0"},Xe={class:"col-auto q-mb-sm q-mb-md-0"},Ze={class:"col-auto q-mb-sm q-mb-md-0"},ea={class:"tw-font-mono"},aa={class:"payload-log-pre"},la={__name:"Index",setup(ta){const E=s([]),L=s(!1),N=Ue(),p=s({page:1,rowsPerPage:20,rowsNumber:0,sortBy:"created_at",descending:!0}),R=s([]),D=s([]),H=s([]),_=s(null),b=s(null),d=s([]),C=s(!1),r=s({from:"",to:""}),g=s({from:"",to:""}),k=s(!1),P=s(!1),q=s(!1),M=s(null),I=s(!1),O=s(""),fe="https://attributa.master.dev.br".replace(/\/$/,""),J=[{label:"Processando",value:"processing"},{label:"Aprovado",value:"approved"},{label:"Rejeitado",value:"rejected"},{label:"Lixo",value:"trash"},{label:"Cancelado",value:"cancelled"},{label:"Reembolsado",value:"refunded"},{label:"Chargeback",value:"chargeback"}],V=[{name:"created_at",label:"Data de criação",field:"created_at_formatted",sortable:!0,align:"left"},{name:"lead_status",label:"Status",field:"lead_status",sortable:!0,align:"left"},{name:"updated_at",label:"Data de atualização",field:"updated_at_formatted",sortable:!0,align:"left"},{name:"campaign_name",label:"Campanha",field:"campaign_name",sortable:!0,align:"left"},{name:"platform_name",label:"Plataforma",field:"platform_name",sortable:!0,align:"left"},{name:"platform_lead_id",label:"UUID Lead",field:"platform_lead_id",sortable:!0,align:"left"},{name:"offer_id",label:"Offer ID",field:"offer_id",sortable:!0,align:"left"},{name:"payout_amount",label:"Payout",field:"payout_amount",sortable:!0,align:"left"},{name:"currency_code",label:"Moeda",field:"currency_code",sortable:!0,align:"left"},{name:"details",label:"Detalhes",field:"id",sortable:!1,align:"center"},{name:"conversion",label:"Conversão",field:"has_conversion",sortable:!1,align:"left"},{name:"callback_log",label:"Log callback",field:"payload_json",sortable:!1,align:"center"}],me=["updated_at"],x=s(V.map(l=>l.name).filter(l=>!me.includes(l)));function G(l){return x.value.includes(l)}function K(l,a){const e=new Set(x.value);a?e.add(l):e.delete(l),x.value=V.map(n=>n.name).filter(n=>e.has(n))}const pe=Me(()=>{const l=String(r.value?.from||""),a=String(r.value?.to||"");return!l||!a?"":`${Z(l)}  -  ${Z(a)}`});function ve(l){const a=J.map(e=>e.value);return Array.isArray(l)?l.filter(e=>a.includes(String(e))):[]}function ge(){d.value=[]}function W(l){return d.value.includes(l)}function X(l,a){const e=new Set(ve(d.value));a?e.add(l):e.delete(l),d.value=Array.from(e)}function _e(l,a){a(()=>{const e=String(l||"").trim().toLowerCase();if(e===""){D.value=R.value;return}D.value=R.value.filter(n=>String(n?.name||"").toLowerCase().includes(e))})}function y(l){const a=new Date(l),e=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),v=String(a.getDate()).padStart(2,"0");return`${e}-${n}-${v}`}function Z(l){if(!l||!/^\d{4}-\d{2}-\d{2}$/.test(l))return"";const[a,e,n]=l.split("-");return`${n}.${e}.${a}`}function ee(){const l=new Date,a=new Date;return a.setDate(l.getDate()-6),{from:y(a),to:y(l)}}function be(l){const a=new Date,e=new Date(a),n=new Date(a);if(l==="last_7")e.setDate(a.getDate()-6);else if(l==="last_31")e.setDate(a.getDate()-30);else if(l==="month_current")e.setDate(1);else if(l==="month_previous"){const v=new Date(a.getFullYear(),a.getMonth()-1,1),w=new Date(a.getFullYear(),a.getMonth(),0);e.setTime(v.getTime()),n.setTime(w.getTime())}return{from:y(e),to:y(n)}}function Q(l){g.value=be(l)}function ye(){const l=y(new Date);g.value={from:l,to:l}}function we(){const l=new Date;l.setDate(l.getDate()-1);const a=y(l);g.value={from:a,to:a}}function he(){g.value={from:String(r.value?.from||""),to:String(r.value?.to||"")}}function Se(){k.value=!1}function De(){const l=String(g.value?.from||""),a=String(g.value?.to||"");l&&a&&(r.value={from:l,to:a}),k.value=!1}function Ce(l,a){const e=Number(l);if(Number.isNaN(e))return"-";try{return new Intl.NumberFormat("en-US",{style:"currency",currency:String(a||"USD").toUpperCase()}).format(e)}catch{return e.toFixed(2)}}function U(){if(typeof window>"u")return;const l=new URL(window.location.href);_.value?l.searchParams.set("campaign_id",String(_.value)):l.searchParams.delete("campaign_id"),b.value?l.searchParams.set("platform_id",String(b.value)):l.searchParams.delete("platform_id");const a=Array.isArray(d.value)?d.value:[];a.length>0?l.searchParams.set("lead_statuses",a.join(",")):l.searchParams.delete("lead_statuses"),r.value?.from&&r.value?.to?(l.searchParams.set("date_from",r.value.from),l.searchParams.set("date_to",r.value.to)):(l.searchParams.delete("date_from"),l.searchParams.delete("date_to")),window.history.replaceState({},"",l.toString())}function ke(){if(typeof window>"u"){r.value=ee();return}const l=new URLSearchParams(window.location.search);_.value=l.get("campaign_id")?Number(l.get("campaign_id")):null,b.value=l.get("platform_id")?Number(l.get("platform_id")):null,d.value=[];const a=l.get("date_from"),e=l.get("date_to"),n=v=>/^\d{4}-\d{2}-\d{2}$/.test(String(v||""));if(n(a)&&n(e)){r.value={from:a,to:e};return}r.value=ee()}function Pe(){F.get(route("panel.leads.campaigns")).then(l=>{R.value=l.data,D.value=l.data})}function Ve(){F.get(route("panel.leads.platforms")).then(l=>{H.value=l.data})}function h(l){L.value=!0;const{page:a,rowsPerPage:e,sortBy:n,descending:v}=l.pagination;return F.get(route("panel.leads.data"),{params:{page:a,per_page:e,sortBy:n,descending:v,campaign_id:_.value||void 0,platform_id:b.value||void 0,lead_statuses:Array.isArray(d.value)&&d.value.length>0?d.value:void 0,date_from:r.value?.from||void 0,date_to:r.value?.to||void 0}}).then(w=>{E.value=w.data.data,p.value={...p.value,page:w.data.current_page,rowsPerPage:w.data.per_page,rowsNumber:w.data.total,sortBy:n,descending:v}}).finally(()=>{L.value=!1})}async function xe(l){if(!l){N.notify({type:"warning",message:"Este lead não possui pageview associada."});return}P.value=!0,q.value=!0,M.value=null;try{const a=await F.get(route("panel.atividade.pageviews.show",l));M.value=a.data}catch{P.value=!1,N.notify({type:"negative",message:"Não foi possível carregar os detalhes da visita."})}finally{q.value=!1}}function Qe(l){const a=l?.payload_json;if(!a){N.notify({type:"warning",message:"Sem payload salvo para este lead."});return}try{const e=typeof a=="string"?JSON.parse(a):a;O.value=JSON.stringify(e,null,2)}catch{O.value=String(a)}I.value=!0}return B([_,b],()=>{C.value&&(p.value.page=1,U(),h({pagination:p.value}))}),B(d,()=>{C.value&&(p.value.page=1,U(),h({pagination:p.value}))},{deep:!0}),B(()=>[r.value?.from,r.value?.to],()=>{C.value&&(p.value.page=1,U(),h({pagination:p.value}))}),Ie(()=>{ke(),U(),C.value=!0,Pe(),Ve(),h({pagination:p.value})}),(l,a)=>($(),Y(z,null,[t(de(Oe),{title:"Leads"}),t(re,{flat:"",bordered:"",class:"tw-rounded-2xl tw-p-4"},{default:o(()=>[f("div",ze,[f("div",Ee,[t($e,{dense:"",outlined:"",readonly:"",class:"filter-field",label:"Período","model-value":pe.value,placeholder:"Selecione um intervalo"},{prepend:o(()=>[t(ae,{name:"event"})]),append:o(()=>[t(ae,{name:"expand_more"})]),default:o(()=>[t(Fe,{modelValue:k.value,"onUpdate:modelValue":a[5]||(a[5]=e=>k.value=e),anchor:"bottom left",self:"top left",offset:[0,6],"transition-show":"scale","transition-hide":"scale",onBeforeShow:he},{default:o(()=>[f("div",He,[f("div",Je,[t(u,{flat:"","no-caps":"",dense:"",label:"Hoje",onClick:ye}),t(u,{flat:"","no-caps":"",dense:"",label:"Ontem",onClick:we}),t(u,{flat:"","no-caps":"",dense:"",label:"Últimos 7 dias",onClick:a[0]||(a[0]=e=>Q("last_7"))}),t(u,{flat:"","no-caps":"",dense:"",label:"Últimos 31 dias",onClick:a[1]||(a[1]=e=>Q("last_31"))}),t(u,{flat:"","no-caps":"",dense:"",label:"Mês atual",onClick:a[2]||(a[2]=e=>Q("month_current"))}),t(u,{flat:"","no-caps":"",dense:"",label:"Mês anterior",onClick:a[3]||(a[3]=e=>Q("month_previous"))})]),t(Le,{modelValue:g.value,"onUpdate:modelValue":a[4]||(a[4]=e=>g.value=e),range:"",mask:"YYYY-MM-DD",minimal:"",class:"period-date-picker"},null,8,["modelValue"])]),f("div",Ge,[t(u,{flat:"","no-caps":"",label:"Cancelar",onClick:Se}),t(u,{color:"primary","no-caps":"",label:"Aplicar",onClick:De})])]),_:1},8,["modelValue"])]),_:1},8,["model-value"])]),f("div",Ke,[t(le,{modelValue:_.value,"onUpdate:modelValue":a[6]||(a[6]=e=>_.value=e),options:D.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"","use-input":"","fill-input":"","hide-selected":"","input-debounce":"0",clearable:"",dense:"",outlined:"","hide-bottom-space":"",class:"filter-field campaign-filter-field",label:"Filtrar por campanha",onFilter:_e},null,8,["modelValue","options"])]),f("div",We,[t(le,{modelValue:b.value,"onUpdate:modelValue":a[7]||(a[7]=e=>b.value=e),options:H.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",clearable:"",dense:"",outlined:"",class:"filter-field",label:"Filtrar por plataforma"},null,8,["modelValue","options"])]),f("div",Xe,[t(u,{dense:"",flat:"",round:"",icon:"filter_list",color:"grey-7","aria-label":"Filtrar status"},{default:o(()=>[d.value.length>0?($(),Te(T,{key:0,color:"primary",floating:""},{default:o(()=>[i(m(d.value.length),1)]),_:1})):je("",!0),t(j,null,{default:o(()=>[...a[13]||(a[13]=[i("Filtrar status",-1)])]),_:1}),t(te,{anchor:"bottom right",self:"top right"},{default:o(()=>[t(oe,{dense:"",style:{"min-width":"220px"}},{default:o(()=>[($(),Y(z,null,ue(J,e=>t(A,{key:e.value,clickable:"",onClick:n=>X(e.value,!W(e.value))},{default:o(()=>[t(S,{avatar:""},{default:o(()=>[t(ne,{dense:"","model-value":W(e.value),onClick:a[8]||(a[8]=ce(()=>{},["stop"])),"onUpdate:modelValue":n=>X(e.value,n)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024),t(S,null,{default:o(()=>[i(m(e.label),1)]),_:2},1024)]),_:2},1032,["onClick"])),64)),t(se),t(A,{clickable:"",onClick:ge},{default:o(()=>[t(S,{class:"tw-text-primary"},{default:o(()=>[...a[14]||(a[14]=[i("Limpar seleção",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),f("div",Ze,[t(u,{dense:"",flat:"",round:"",icon:"view_column",color:"grey-7","aria-label":"Organizar colunas"},{default:o(()=>[t(j,null,{default:o(()=>[...a[15]||(a[15]=[i("Organizar colunas",-1)])]),_:1}),t(te,{anchor:"bottom right",self:"top right"},{default:o(()=>[t(oe,{dense:"",style:{"min-width":"220px"}},{default:o(()=>[($(),Y(z,null,ue(V,e=>t(A,{key:e.name,clickable:"",onClick:n=>K(e.name,!G(e.name))},{default:o(()=>[t(S,{avatar:""},{default:o(()=>[t(ne,{dense:"","model-value":G(e.name),onClick:a[9]||(a[9]=ce(()=>{},["stop"])),"onUpdate:modelValue":n=>K(e.name,n)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024),t(S,null,{default:o(()=>[i(m(e.label),1)]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1})]),_:1})])]),t(Ne,{rows:E.value,columns:V,"visible-columns":x.value,"row-key":"id",loading:L.value,pagination:p.value,"onUpdate:pagination":a[10]||(a[10]=e=>p.value=e),"binary-state-sort":!0,"rows-per-page-options":[10,15,20,25,50],onRequest:h},{"body-cell-created_at":o(e=>[t(c,{props:e},{default:o(()=>[i(m(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-updated_at":o(e=>[t(c,{props:e},{default:o(()=>[i(m(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-campaign_name":o(e=>[t(c,{props:e},{default:o(()=>[i(m(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-platform_name":o(e=>[t(c,{props:e},{default:o(()=>[i(m(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-platform_lead_id":o(e=>[t(c,{props:e},{default:o(()=>[f("span",ea,m(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-offer_id":o(e=>[t(c,{props:e},{default:o(()=>[i(m(e.value??"-"),1)]),_:2},1032,["props"])]),"body-cell-lead_status":o(e=>[t(c,{props:e},{default:o(()=>[t(T,{color:e.row.lead_status_color||"warning",label:e.row.lead_status_label||e.row.lead_status||"-"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-payout_amount":o(e=>[t(c,{props:e},{default:o(()=>[i(m(Ce(e.value,e.row.currency_code)),1)]),_:2},1032,["props"])]),"body-cell-currency_code":o(e=>[t(c,{props:e},{default:o(()=>[i(m(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-details":o(e=>[t(c,{props:e},{default:o(()=>[t(u,{dense:"",flat:"",round:"",size:"sm",icon:"manage_search",color:"primary",disable:!e.row.pageview_id,onClick:n=>xe(e.row.pageview_id)},null,8,["disable","onClick"])]),_:2},1032,["props"])]),"body-cell-conversion":o(e=>[t(c,{props:e},{default:o(()=>[t(T,{color:e.row.has_conversion?"positive":"grey-6",label:e.row.has_conversion?"Criada":"Pendente"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-callback_log":o(e=>[t(c,{props:e},{default:o(()=>[t(u,{dense:"",flat:"",round:"",size:"sm",icon:"article",color:"primary",disable:!e.row.payload_json,onClick:n=>Qe(e.row)},{default:o(()=>[t(j,null,{default:o(()=>[...a[16]||(a[16]=[i("Ver log do callback",-1)])]),_:1})]),_:1},8,["disable","onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","visible-columns","loading","pagination"])]),_:1}),t(Be,{modelValue:P.value,"onUpdate:modelValue":a[11]||(a[11]=e=>P.value=e),loading:q.value,payload:M.value,"asset-base-url":de(fe)},null,8,["modelValue","loading","payload","asset-base-url"]),t(qe,{modelValue:I.value,"onUpdate:modelValue":a[12]||(a[12]=e=>I.value=e)},{default:o(()=>[t(re,{class:"payload-log-card"},{default:o(()=>[t(ie,{class:"tw-flex tw-items-center tw-justify-between"},{default:o(()=>[a[17]||(a[17]=f("div",{class:"text-h6"},"Log do callback",-1)),Ae(t(u,{flat:"",round:"",dense:"",icon:"close"},null,512),[[Re]])]),_:1}),t(se),t(ie,null,{default:o(()=>[f("pre",aa,m(O.value),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},ia=Ye(la,[["__scopeId","data-v-569703d5"]]);export{ia as default};
