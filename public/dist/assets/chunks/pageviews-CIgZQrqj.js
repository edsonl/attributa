import{C as G,h as N,E as z,A as O,B as i,k as h,n as W,r as H}from"./vendor-quasar-C1KtC9YM.js";import{r as n,f as K,w as Y,e as J,G as L,H as g,E as o,u as R,P as X,D as t,Q as d,C as x,M as v,N as u,L as Z,O as ee,I as ae,V as w}from"./vendor-D8nj3W7R.js";import le from"./pageviewdetailmodal-BVzOa_xf.js";import te from"./pageviewdetaildrawer-Rt8jviOT.js";import{_ as oe}from"../app-Bsnq-uzD.js";const ne={class:"row q-mb-md items-center q-col-gutter-md"},ie={class:"col-12 col-md-4 q-mb-sm q-mb-md-0"},se={class:"col-12 col-md-4 col-lg-3 q-mt-sm q-mt-md-0 q-pl-md-sm"},re={class:"col-12 col-md-4 col-lg-3 q-mt-sm q-mt-md-0"},de={class:"tw-flex tw-items-center tw-gap-2"},ue={class:"tw-text-sm tw-font-medium"},ce={class:"tw-flex tw-items-center tw-gap-2"},me=["src","alt"],ge={__name:"Pageviews",setup(ve){const Q=n([]),c=n(!1),U=n(null),r=n({page:1,rowsPerPage:20,rowsNumber:0,sortBy:"created_at",descending:!0}),b=n(null),$=n([]),P={label:"Não determinado",color:"#FCE7F3",description:"Categoria ainda não determinada."},V=n(!1),D=n(!1),_=n(!1),y=n(null),m=n([]),E=K(()=>m.value.length>0),f=n(!1),B="https://attributa.master.dev.br".replace(/\/$/,""),S=[{name:"created_at",label:"Data",field:"created_at_formatted",sortable:!0,align:"left"},{name:"ip_category",label:"Classificação IP",field:l=>l?.ip_category_name,sortable:!0,align:"left"},{name:"ip",label:"IP",field:"ip",sortable:!0,align:"left"},{name:"campaign_name",label:"Campanha",field:"campaign_name",sortable:!0,align:"left"},{name:"country_code",label:"País",field:"country_code",sortable:!0,align:"left"},{name:"region_name",label:"Região",field:"region_name",sortable:!0,align:"left"},{name:"city",label:"Cidade",field:"city",sortable:!0,align:"left"},{name:"gclid",label:"GCLID",field:"has_gclid",sortable:!0,align:"left"},{name:"conversion",label:"Conversão",field:"conversion",sortable:!0,align:"left"},{name:"details",label:"Detalhes",field:"id",align:"center"},{name:"actions",label:"Ações",field:"id",align:"right"}];function q(l){return{label:l?.ip_category_name??P.label,color:l?.ip_category_color??P.color,description:l?.ip_category_description??P.description}}function I(l){const a=l?.country_code;if(!a)return null;const e=String(a).toLowerCase();return`${B}/assets/country-flags/${e}.svg`}function F(l){return l===!0||l===1||l==="1"}function T(){w.get(route("panel.atividade.campaigns")).then(l=>{$.value=l.data})}function p(l){c.value=!0;const{page:a,rowsPerPage:e,sortBy:s,descending:C}=l.pagination;return w.get(route("panel.atividade.pageviews.data"),{params:{page:a,per_page:e,sortBy:s,descending:C,campaign_id:b.value}}).then(k=>{Q.value=k.data.data,m.value=[],r.value={...r.value,page:k.data.current_page,rowsPerPage:k.data.per_page,rowsNumber:k.data.total,sortBy:s,descending:C}}).finally(()=>{c.value=!1})}async function A(l){if(!l)return;let a=!0;const e=typeof window<"u",s=e?window.$confirm:null;if(s?a=await s({title:"Excluir pageview",message:"Esta ação é permanente. Deseja realmente remover?",okLabel:"Remover",okColor:"negative"}):e&&(a=window.confirm("Excluir este pageview?")),!!a){c.value=!0;try{await w.delete(route("panel.atividade.pageviews.destroy",l)),await p({pagination:r.value})}finally{c.value=!1}}}async function M(){if(!E.value)return;let l=!0;const a=typeof window<"u",e=a?window.$confirm:null,s=`Você selecionou ${m.value.length} registro(s). Deseja remover?`;if(e?l=await e({title:"Remover pageviews",message:s,okLabel:"Remover",okColor:"negative"}):a&&(l=window.confirm(s)),!!l){c.value=!0;try{await w.delete(route("panel.atividade.pageviews.bulk-destroy"),{data:{ids:m.value.map(C=>C.id)}}),await p({pagination:r.value})}finally{c.value=!1}}}async function j(l){V.value=f.value,D.value=!f.value,_.value=!0,y.value=null;try{const a=await w.get(route("panel.atividade.pageviews.show",l.id));y.value=a.data}finally{_.value=!1}}return Y(b,()=>{r.value.page=1,p({pagination:r.value})}),J(()=>{T(),p({pagination:r.value})}),(l,a)=>(g(),L(ae,null,[o(R(X),{title:"Relatório de atividade"}),o(H,{flat:"",bordered:"",class:"tw-rounded-2xl tw-p-4"},{default:t(()=>[d("div",ne,[d("div",ie,[o(G,{ref_key:"tableRef",ref:U,modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=e=>b.value=e),options:$.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",clearable:"",label:"Filtrar por campanha"},null,8,["modelValue","options"])]),d("div",se,[o(N,{color:"negative",label:"Remover selecionados",disable:!E.value,onClick:M,class:"tw-w-full lg:tw-w-auto bulk-delete-btn"},null,8,["disable"])]),d("div",re,[o(z,{modelValue:f.value,"onUpdate:modelValue":a[1]||(a[1]=e=>f.value=e),label:`Popup: ${f.value?"true":"false"}`,color:"primary","keep-color":""},null,8,["modelValue","label"])])]),o(O,{rows:Q.value,columns:S,"row-key":"id",loading:c.value,pagination:r.value,"onUpdate:pagination":a[2]||(a[2]=e=>r.value=e),"binary-state-sort":!0,onRequest:p,selection:"multiple",selected:m.value,"onUpdate:selected":a[3]||(a[3]=e=>m.value=e)},{"body-cell-created_at":t(e=>[o(i,{props:e},{default:t(()=>[v(u(e.value),1)]),_:2},1032,["props"])]),"body-cell-ip_category":t(e=>[o(i,{props:e},{default:t(()=>[d("div",de,[d("span",{class:"tw-inline-flex tw-h-3 tw-w-3 tw-rounded-full tw-border tw-border-white/20 tw-shadow-sm",style:ee({backgroundColor:q(e.row).color})},null,4),d("span",ue,u(q(e.row).label),1),o(W,{class:"tw-text-xs tw-max-w-xs tw-leading-snug"},{default:t(()=>[v(u(q(e.row).description),1)]),_:2},1024)])]),_:2},1032,["props"])]),"body-cell-ip":t(e=>[o(i,{props:e},{default:t(()=>[v(u(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-campaign_name":t(e=>[o(i,{props:e},{default:t(()=>[v(u(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-country_code":t(e=>[o(i,{props:e},{default:t(()=>[d("div",ce,[I(e.row)?(g(),L("img",{key:0,src:I(e.row),alt:e.value,class:"tw-w-6 tw-h-4 tw-rounded-sm tw-object-cover tw-border tw-border-gray-200"},null,8,me)):Z("",!0),d("span",null,u(e.value?e.value.toUpperCase():"-"),1)])]),_:2},1032,["props"])]),"body-cell-region_name":t(e=>[o(i,{props:e},{default:t(()=>[v(u(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-city":t(e=>[o(i,{props:e},{default:t(()=>[v(u(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-gclid":t(e=>[o(i,{props:e},{default:t(()=>[e.value?(g(),x(h,{key:0,color:"primary",label:"Sim"})):(g(),x(h,{key:1,color:"grey-4","text-color":"dark",label:"Não"}))]),_:2},1032,["props"])]),"body-cell-conversion":t(e=>[o(i,{props:e},{default:t(()=>[F(e.value)?(g(),x(h,{key:0,color:"green",label:"Convertido"})):(g(),x(h,{key:1,color:"grey-4","text-color":"dark",label:"Não convertido"}))]),_:2},1032,["props"])]),"body-cell-details":t(e=>[o(i,{props:e},{default:t(()=>[o(N,{dense:"",flat:"",round:"",size:"sm",icon:"manage_search",color:"primary",onClick:s=>j(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-actions":t(e=>[o(i,{props:e,class:"tw-text-right"},{default:t(()=>[o(N,{dense:"",flat:"",icon:"delete",color:"negative",onClick:s=>A(e.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","selected"])]),_:1}),o(le,{modelValue:V.value,"onUpdate:modelValue":a[4]||(a[4]=e=>V.value=e),loading:_.value,payload:y.value,"asset-base-url":R(B)},null,8,["modelValue","loading","payload","asset-base-url"]),o(te,{modelValue:D.value,"onUpdate:modelValue":a[5]||(a[5]=e=>D.value=e),loading:_.value,payload:y.value,"asset-base-url":R(B)},null,8,["modelValue","loading","payload","asset-base-url"])],64))}},ye=oe(ge,[["__scopeId","data-v-f1ca3a61"]]);export{ye as default};
