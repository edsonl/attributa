import{u as T,E as z,A,B as s,k as G,h as R,r as j}from"./vendor-quasar-D0sfcEux.js";import{r as n,w as J,e as K,E as Q,F as y,C as o,u as C,N as O,B as l,O as i,K as p,L as u,J as E,A as H,G as W,S as P}from"./vendor-D6jaF0sv.js";import X from"./conversionpageviewdetailmodal-CAmESVo-.js";import Y from"./conversionpageviewdetaildrawer-B7N7ohDJ.js";import"../app-BD3XDZci.js";const Z={class:"row q-mb-md items-center"},ee={class:"col-12 col-md-4"},ae={class:"tw-flex tw-items-center tw-gap-1"},te={class:"tw-flex tw-items-center tw-gap-2"},le=["src","alt"],de={__name:"Index",setup(oe){const h=n([]),_=n(!1),V=T(),r=n({page:1,rowsPerPage:20,rowsNumber:0,sortBy:"conversion_event_time",descending:!0}),d=n(null),x=n([]),c=n(!1),g=n(!1),v=n(!1),m=n(null),B=n(!0),b="https://attributa.master.dev.br".replace(/\/$/,""),F=[{name:"conversion_event_time",label:"Data",field:"conversion_event_time_formatted",sortable:!0,align:"left"},{name:"campaign_name",label:"Campanha",field:"campaign_name",sortable:!0,align:"left"},{name:"campaign_code",label:"Cód/Campanha",field:"campaign_code",sortable:!0,align:"left"},{name:"conversion_name",label:"Pixel/Conversão",field:"conversion_name",sortable:!0,align:"left"},{name:"pageview_id",label:"Pageview ID",field:"pageview_id",sortable:!0,align:"left"},{name:"country_code",label:"País",field:"country_code",sortable:!0,align:"left"},{name:"region_name",label:"Região",field:"region_name",sortable:!0,align:"left"},{name:"city",label:"Cidade",field:"city",sortable:!0,align:"left"},{name:"conversion_value",label:"Valor (USD)",field:"conversion_value",sortable:!0,align:"left"},{name:"currency_code",label:"Moeda",field:"currency_code",sortable:!0,align:"left"},{name:"google_upload_status",label:"Status Google",field:"google_upload_status",sortable:!0,align:"left"}];function L(t){return t==null||t===""?"-":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(Number(t))}function D(t){const a=t?.country_code;if(!a)return null;const e=String(a).toLowerCase();return`${b}/assets/country-flags/${e}.svg`}function S(t){return String(t??"").trim().toLowerCase()}function $(t){const a=S(t);return a==="exported"||a==="success"?"positive":a==="prossecing"||a==="processing"?"warning":a==="pending"?"grey-6":a==="error"||a==="failed"?"negative":"primary"}function q(t){const a=S(t);return a==="exported"?"Exportado":a==="prossecing"||a==="processing"?"Processando":a==="pending"?"Pendente":a==="error"||a==="failed"?"Erro":a==="success"?"Sucesso":t||"-"}async function I(t){if(!t){V.notify({type:"warning",message:"Pageview não encontrada para esta conversão."});return}c.value=B.value,g.value=!B.value,v.value=!0,m.value=null;try{const a=await P.get(route("panel.atividade.pageviews.show",t));m.value=a.data}catch{c.value=!1,g.value=!1,V.notify({type:"negative",message:"Não foi possível carregar os detalhes da pageview."})}finally{v.value=!1}}function M(){P.get(route("panel.conversoes.campaigns")).then(t=>{x.value=t.data})}function w(t=null){_.value=!0;const a=t?.pagination??r.value,{page:e,rowsPerPage:N,sortBy:U,descending:k}=a;P.get(route("panel.conversoes.data"),{params:{page:e,per_page:N,sortBy:U,descending:k,campaign_id:d.value}}).then(f=>{h.value=f.data.data,r.value={...r.value,page:f.data.current_page,rowsPerPage:f.data.per_page,rowsNumber:f.data.total,sortBy:U,descending:k}}).finally(()=>{_.value=!1})}return J(d,()=>{r.value.page=1,w({pagination:r.value})}),K(()=>{M(),w({pagination:r.value})}),(t,a)=>(y(),Q(W,null,[o(C(O),{title:"Conversões"}),o(j,{flat:"",bordered:"",class:"tw-rounded-2xl tw-p-4"},{default:l(()=>[i("div",Z,[i("div",ee,[o(z,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),options:x.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",clearable:"",label:"Filtrar por campanha"},null,8,["modelValue","options"])])]),o(A,{title:"Conversões",rows:h.value,columns:F,"row-key":"id",loading:_.value,pagination:r.value,"onUpdate:pagination":a[1]||(a[1]=e=>r.value=e),"binary-state-sort":!0,onRequest:w},{"body-cell-conversion_event_time":l(e=>[o(s,{props:e},{default:l(()=>[p(u(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-conversion_value":l(e=>[o(s,{props:e},{default:l(()=>[p(u(L(e.value)),1)]),_:2},1032,["props"])]),"body-cell-pageview_id":l(e=>[o(s,{props:e},{default:l(()=>[i("div",ae,[i("span",null,u(e.value??"-"),1),e.value?(y(),H(R,{key:0,dense:"",flat:"",round:"",size:"sm",icon:"manage_search",color:"primary",onClick:N=>I(e.value)},null,8,["onClick"])):E("",!0)])]),_:2},1032,["props"])]),"body-cell-country_code":l(e=>[o(s,{props:e},{default:l(()=>[i("div",te,[D(e.row)?(y(),Q("img",{key:0,src:D(e.row),alt:e.value,class:"tw-w-6 tw-h-4 tw-rounded-sm tw-object-cover tw-border tw-border-gray-200"},null,8,le)):E("",!0),i("span",null,u(e.value?e.value.toUpperCase():"-"),1)])]),_:2},1032,["props"])]),"body-cell-region_name":l(e=>[o(s,{props:e},{default:l(()=>[p(u(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-city":l(e=>[o(s,{props:e},{default:l(()=>[p(u(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-google_upload_status":l(e=>[o(s,{props:e},{default:l(()=>[o(G,{color:$(e.value),label:q(e.value)},null,8,["color","label"])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])]),_:1}),o(X,{modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=e=>c.value=e),loading:v.value,payload:m.value,"asset-base-url":C(b)},null,8,["modelValue","loading","payload","asset-base-url"]),o(Y,{modelValue:g.value,"onUpdate:modelValue":a[3]||(a[3]=e=>g.value=e),loading:v.value,payload:m.value,"asset-base-url":C(b)},null,8,["modelValue","loading","payload","asset-base-url"])],64))}};export{de as default};
