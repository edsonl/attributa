import{x as D,E as A,h as c,G as _e,H as we,I as be,r as P,s as Q,J as W,i as B,t as Y,v as Z,Q as ye,a as he,b as X,z as Se,K as ee,N as j}from"./vendor-quasar-C0Sd45BE.js";import{f as m,r as g,w,Y as Ce,E as f,F as p,O as u,C as l,A as I,J as h,u as n,B as r,G as F,H as ae,K as q,L as v,Q as xe,Z as te,j as oe,S as ke}from"./vendor-D6jaF0sv.js";import{_ as Ve}from"../app-DlqFOGlz.js";const Ae={class:"tw-flex tw-items-start tw-gap-2 tw-py-1 tw-w-full"},Qe={class:"tw-flex tw-flex-wrap tw-gap-2"},Be={key:0,class:"tw-text-gray-500"},Ne={class:"campaign-status-block"},Le={key:0,class:"campaign-status-error"},Oe={class:"tw-flex tw-justify-end tw-gap-2"},Ue={key:0,class:"tw-text-center tw-py-6"},De={class:"tw-flex tw-items-center tw-justify-between tw-gap-2"},je={class:"tw-text-sm tw-text-gray-600"},Ie={class:"tw-flex tw-gap-2"},Fe={class:"tw-border tw-rounded tw-max-h-96 tw-overflow-y-auto tw-p-2"},qe={key:0,class:"tw-text-sm tw-text-gray-500 tw-p-3"},Ee={__name:"FormCampaign",props:{campaign:{type:Object,default:null},channels:{type:Array,required:!0},countries:{type:Array,required:!0},affiliate_platforms:{type:Array,required:!0},googleAdsAccounts:{type:Array,required:!0},conversionGoals:{type:Array,required:!0},campaignStatuses:{type:Array,required:!0},defaults:{type:Object,default:()=>({})}},setup(E){const i=E,le=m(()=>!!i.campaign),_=g(i.countries??[]),S=g(!1),C=g(""),d=g([]),G=m(()=>(i.channels??[]).map(e=>({...e,value:String(e.id),label:e.label??e.name}))),$=m(()=>(i.affiliate_platforms??[]).map(e=>({...e,value:String(e.id),label:e.label??e.name}))),R=m(()=>(i.googleAdsAccounts??[]).map(e=>({...e,value:String(e.id),label:e.label}))),T=m(()=>(i.conversionGoals??[]).map(e=>({...e,value:String(e.id),label:e.active===!1?`${e.label??e.goal_code} (inativa)`:e.label??e.goal_code}))),K=m(()=>(i.campaignStatuses??[]).map(e=>({...e,value:String(e.id),label:e.label??e.name})));w(()=>i.countries,(e=[])=>{_.value=e;const a=new Set(e.map(o=>String(o.id)));t.countries=(t.countries??[]).filter(o=>a.has(String(o))),d.value=(d.value??[]).filter(o=>a.has(String(o)))});function b(e,a=[]){if(e==null||e==="")return e;const o=a.find(s=>String(s?.value)===String(e));return o?o.value:e}function y(e){return e==null||e===""?null:String(e)}const t=Ce({name:i.campaign?.name??"",product_url:i.campaign?.product_url??"",campaign_status_id:y(i.campaign?.campaign_status_id??i.defaults?.campaign_status_id??null),conversion_goal_id:y(i.campaign?.conversion_goal_id),channel_id:y(i.campaign?.channel_id??i.defaults?.channel_id??null),affiliate_platform_id:y(i.campaign?.affiliate_platform_id??i.defaults?.affiliate_platform_id??null),google_ads_account_id:y(i.campaign?.google_ads_account_id),countries:i.campaign?.countries?i.campaign.countries.map(e=>e.id):[],commission_value:i.campaign?.commission_value??null});w(G,e=>{t.channel_id=b(t.channel_id,e)},{immediate:!0}),w($,e=>{t.affiliate_platform_id=b(t.affiliate_platform_id,e)},{immediate:!0}),w(T,e=>{t.conversion_goal_id=b(t.conversion_goal_id,e)},{immediate:!0}),w(K,e=>{t.campaign_status_id=b(t.campaign_status_id,e)},{immediate:!0}),w(R,e=>{t.google_ads_account_id=b(t.google_ads_account_id,e)},{immediate:!0});const z=m(()=>{if(t.errors.countries)return t.errors.countries;const e=Object.entries(t.errors).find(([a])=>a.startsWith("countries."));return e?e[1]:null}),M=m(()=>{const e=new Map;for(const a of _.value)e.set(String(a.id),a);return e}),H=m(()=>(t.countries??[]).map(e=>M.value.get(String(e))).filter(Boolean)),N=m(()=>{const e=C.value.trim().toLowerCase();return e?_.value.filter(a=>{const o=(a.name??"").toLowerCase(),s=(a.iso2??"").toLowerCase(),V=(a.iso3??"").toLowerCase();return o.includes(e)||s.includes(e)||V.includes(e)}):_.value}),ne=m(()=>(d.value??[]).map(e=>M.value.get(String(e))).filter(Boolean)),ie=m(()=>{const e=ne.value;if(!e.length)return"Nenhum país selecionado";const a=5,o=70,s=e.slice(0,a).map(ve=>ve.name).join(", "),V=e.length-a,J=s.length>o?`${s.slice(0,o).trim()} (...)`:s;return V>0?`${J} (+${V})`:J});function re(){const e=i.campaign?.hashid??i.campaign?.id;le.value?t.put(route("panel.campaigns.update",e)):t.post(route("panel.campaigns.store"))}function se(e){t.countries=(t.countries??[]).filter(a=>String(a)!==String(e))}function ue(){d.value=[...t.countries??[]],C.value="",S.value=!0}function L(){S.value=!1}function de(){t.countries=[...d.value??[]],L()}function ce(){const e=new Set((d.value??[]).map(a=>String(a)));for(const a of N.value)e.add(String(a.id));d.value=_.value.filter(a=>e.has(String(a.id))).map(a=>a.id)}function me(){d.value=[]}function pe(e){const a=new Set((d.value??[]).map(s=>String(s))),o=String(e);a.has(o)?a.delete(o):a.add(o),d.value=_.value.filter(s=>a.has(String(s.id))).map(s=>s.id)}const O=g(!1),U=g(!1),x=g(""),k=g(null);async function ge(){const e=i.campaign?.hashid??i.campaign?.id;if(e){O.value=!0,U.value=!0,x.value="";try{const a=await ke.get(route("panel.campaigns.tracking_code",e));x.value=String(a.data.script||"").trim()}catch{j.create({type:"negative",message:"Não foi possível carregar o código de acompanhamento",position:"top-right"})}finally{U.value=!1}}}function fe(){if(k.value){k.value.focus(),k.value.select();try{if(!document.execCommand("copy"))throw new Error;j.create({type:"positive",message:"Código copiado",timeout:2e3,position:"top-right"})}catch{j.create({type:"negative",message:"Não foi possível copiar o código",timeout:3e3,position:"top-right"})}}}return(e,a)=>(p(),f(F,null,[u("form",{onSubmit:te(re,["prevent"]),class:"tw-space-y-6"},[l(D,{modelValue:n(t).name,"onUpdate:modelValue":a[0]||(a[0]=o=>n(t).name=o),label:"Nome da campanha",outlined:"",dense:"",error:!!n(t).errors.name,"error-message":n(t).errors.name},null,8,["modelValue","error","error-message"]),l(D,{modelValue:n(t).product_url,"onUpdate:modelValue":a[1]||(a[1]=o=>n(t).product_url=o),label:"URL do produto autorizada",hint:"Exemplo: https://biovitania.online",outlined:"",dense:"",error:!!n(t).errors.product_url,"error-message":n(t).errors.product_url},null,8,["modelValue","error","error-message"]),l(A,{modelValue:n(t).channel_id,"onUpdate:modelValue":a[2]||(a[2]=o=>n(t).channel_id=o),options:G.value,"option-label":"label","option-value":"value","emit-value":"","map-options":"",label:"Canal",outlined:"",dense:"",error:!!n(t).errors.channel_id,"error-message":n(t).errors.channel_id},null,8,["modelValue","options","error","error-message"]),l(A,{modelValue:n(t).affiliate_platform_id,"onUpdate:modelValue":a[3]||(a[3]=o=>n(t).affiliate_platform_id=o),options:$.value,"option-label":"label","option-value":"value","emit-value":"","map-options":"",label:"Plataforma de Afiliado",outlined:"",dense:"",error:!!n(t).errors.affiliate_platform_id,"error-message":n(t).errors.affiliate_platform_id},null,8,["modelValue","options","error","error-message"]),l(we,{label:"Regiões de segmentação (países)",outlined:"",dense:"","stack-label":"",error:!!z.value,"error-message":z.value},{control:r(()=>[u("div",Ae,[l(c,{flat:"",dense:"",icon:"travel_explore",label:"Selecionar",onClick:ue}),u("div",Qe,[(p(!0),f(F,null,ae(H.value,o=>(p(),I(_e,{key:o.id,removable:"",dense:"",square:"",onRemove:s=>se(o.id)},{default:r(()=>[q(v(o.name),1)]),_:2},1032,["onRemove"]))),128)),H.value.length?h("",!0):(p(),f("span",Be," Nenhum país selecionado "))])])]),_:1},8,["error","error-message"]),u("div",Ne,[a[13]||(a[13]=u("div",{class:"campaign-status-label"}," Status da campanha ",-1)),l(be,{modelValue:n(t).campaign_status_id,"onUpdate:modelValue":a[4]||(a[4]=o=>n(t).campaign_status_id=o),options:K.value,type:"radio",inline:"",dense:""},null,8,["modelValue","options"]),n(t).errors.campaign_status_id?(p(),f("div",Le,v(n(t).errors.campaign_status_id),1)):h("",!0)]),l(A,{modelValue:n(t).google_ads_account_id,"onUpdate:modelValue":a[5]||(a[5]=o=>n(t).google_ads_account_id=o),options:R.value,"option-value":"value","option-label":"label","emit-value":"","map-options":"",clearable:"",label:"Conta de Anúncios",hint:"Selecione a conta do Google Ads desta campanha",error:!!n(t).errors.google_ads_account_id,"error-message":n(t).errors.google_ads_account_id},null,8,["modelValue","options","error","error-message"]),l(A,{modelValue:n(t).conversion_goal_id,"onUpdate:modelValue":a[6]||(a[6]=o=>n(t).conversion_goal_id=o),options:T.value,"option-value":"value","option-label":"label","emit-value":"","map-options":"",clearable:"",label:"Meta de conversao",hint:"Selecione a meta/codigo de conversao vinculada a campanha",outlined:"",dense:"",error:!!n(t).errors.conversion_goal_id,"error-message":n(t).errors.conversion_goal_id},null,8,["modelValue","options","error","error-message"]),E.campaign?(p(),I(c,{key:0,flat:"",icon:"code",color:"primary",label:"Ver código de acompanhamento",onClick:ge})):h("",!0),u("div",Oe,[l(c,{flat:"",label:"Cancelar",onClick:a[7]||(a[7]=o=>n(xe).visit(e.route("panel.campaigns.index")))}),l(c,{color:"primary",label:"Salvar",type:"submit"})])],32),l(Z,{modelValue:O.value,"onUpdate:modelValue":a[8]||(a[8]=o=>O.value=o)},{default:r(()=>[l(P,{style:{"min-width":"720px","max-width":"95vw","min-height":"450px"}},{default:r(()=>[l(Q,{class:"tw-flex tw-justify-between tw-items-center"},{default:r(()=>[a[14]||(a[14]=u("div",{class:"tw-text-lg tw-font-semibold"}," Código de acompanhamento ",-1)),oe(l(c,{flat:"",dense:"",icon:"close"},null,512),[[W]])]),_:1}),l(B),l(Q,null,{default:r(()=>[U.value?(p(),f("div",Ue," Carregando... ")):h("",!0),u("textarea",{ref_key:"trackingTextarea",ref:k,class:"tw-w-full tw-h-72 tw-font-mono tw-text-sm tw-p-3 tw-bg-gray-100 tw-rounded",readonly:""},v(x.value),513)]),_:1}),l(B),l(Y,{align:"right"},{default:r(()=>[l(c,{flat:"",icon:"content_copy",label:"Copiar",disable:!x.value,onClick:fe},null,8,["disable"]),oe(l(c,{color:"primary",label:"Fechar"},null,512),[[W]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Z,{modelValue:S.value,"onUpdate:modelValue":a[12]||(a[12]=o=>S.value=o)},{default:r(()=>[l(P,{style:{"min-width":"720px","max-width":"95vw",width:"900px","max-height":"90vh"}},{default:r(()=>[l(Q,{class:"tw-flex tw-items-center tw-justify-between"},{default:r(()=>[a[15]||(a[15]=u("div",{class:"tw-text-lg tw-font-semibold"}," Selecionar países ",-1)),l(c,{flat:"",dense:"",icon:"close",onClick:L})]),_:1}),l(B),l(Q,{class:"tw-space-y-3"},{default:r(()=>[l(D,{modelValue:C.value,"onUpdate:modelValue":a[9]||(a[9]=o=>C.value=o),dense:"",outlined:"",clearable:"",autofocus:"",label:"Buscar país por nome ou código"},null,8,["modelValue"]),u("div",De,[u("div",je,v(ie.value),1),u("div",Ie,[l(c,{flat:"",dense:"",label:"Selecionar filtrados",onClick:ce}),l(c,{flat:"",dense:"",label:"Limpar",onClick:me})])]),u("div",Fe,[l(ye,{separator:""},{default:r(()=>[(p(!0),f(F,null,ae(N.value,o=>(p(),I(he,{key:o.id,clickable:"",dense:"",onClick:s=>pe(o.id)},{default:r(()=>[l(X,{avatar:""},{default:r(()=>[l(Se,{modelValue:d.value,"onUpdate:modelValue":a[10]||(a[10]=s=>d.value=s),val:o.id,onClick:a[11]||(a[11]=te(()=>{},["stop"]))},null,8,["modelValue","val"])]),_:2},1024),l(X,null,{default:r(()=>[l(ee,null,{default:r(()=>[q(v(o.name),1)]),_:2},1024),l(ee,{caption:""},{default:r(()=>[q(v(o.iso2)+" · "+v(o.iso3),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}),N.value.length?h("",!0):(p(),f("div",qe," Nenhum país encontrado para esta busca. "))])]),_:1}),l(B),l(Y,{align:"right"},{default:r(()=>[l(c,{flat:"",label:"Cancelar",onClick:L}),l(c,{color:"primary",label:"Aplicar",onClick:de})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Te=Ve(Ee,[["__scopeId","data-v-ea7cd32e"]]);export{Te as default};
