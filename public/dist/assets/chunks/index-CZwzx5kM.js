import{H as $,h as i,s as N,x as H,c as J,A as M,B as v,r as j,G as q,i as D,t as W,v as X,N as S}from"./vendor-quasar-D0sfcEux.js";import{f as B,A as z,F as f,B as l,K as F,L as T,r as d,w as A,E as P,C as a,O as u,u as c,N as Y,P as Z,_ as ee,G as K,H as ae,j as R,J as te,Q,S as le}from"./vendor-D6jaF0sv.js";import{q as p}from"./qtable-pt-CkdICETI.js";const oe={__name:"StatusChip",props:{value:{type:[Boolean,Number],required:!0}},setup(b){const s=b,h=B(()=>s.value?"Ativo":"Inativo"),r=B(()=>s.value?"positive":"negative");return(o,V)=>(f(),z($,{dense:"",color:r.value,"text-color":"white"},{default:l(()=>[F(T(h.value),1)]),_:1},8,["color"]))}},ne={class:"tw-space-y-3"},se={class:"tw-flex tw-items-center tw-justify-between tw-flex-col sm:tw-flex-row tw-gap-3"},re={class:"tw-flex tw-gap-3 tw-flex-col md:tw-flex-row"},ie={class:"tw-flex tw-flex-wrap tw-gap-1"},ce={key:0,class:"tw-text-center tw-py-6"},ge={__name:"Index",props:{campaigns:{type:Object,required:!0},filters:{type:Object,default:()=>({})}},setup(b){const s=b,h=B(()=>s.campaigns?.data??[]),r=d(s.filters?.search??""),o=d({page:s.campaigns?.current_page??1,rowsPerPage:s.campaigns?.per_page??15,rowsNumber:s.campaigns?.total??0,sortBy:s.filters?.sort??"created_at",descending:(s.filters?.direction??"desc")==="desc"});A(()=>s.campaigns,e=>{e&&(o.value.page=e.current_page,o.value.rowsPerPage=e.per_page,o.value.rowsNumber=e.total)}),A(()=>s.filters,e=>{o.value.sortBy=e?.sort??"created_at",o.value.descending=(e?.direction??"desc")==="desc",(e?.search??"")!==r.value&&(r.value=e?.search??"")});const V=[{name:"code",label:"Código",field:"code",align:"left",sortable:!0},{name:"name",label:"Nome",field:"name",align:"left",sortable:!0},{name:"channel",label:"Canal",field:e=>e.channel?.name??"-",align:"left"},{name:"conversion_goal",label:"Meta de conversao",field:e=>e.conversion_goal?.goal_code??"-",align:"left"},{name:"tracking_snippet",label:"Acompanhamento",field:"code",align:"left"},{name:"countries",label:"Países",field:"countries",align:"left"},{name:"status",label:"Status",field:"status",align:"center",sortable:!0},{name:"actions",label:"Ações",field:"actions",align:"right"}],_=d(!1),y=d(!1),m=d(""),w=d(null);function x(){const e={page:o.value.page,per_page:o.value.rowsPerPage,sort:o.value.sortBy,direction:o.value.descending?"desc":"asc",search:r.value||void 0};Q.get(route("panel.campaigns.index"),e,{preserveState:!0,preserveScroll:!0,replace:!0})}function I({pagination:e}){Object.assign(o.value,e),x()}function C(){o.value.page=1,x()}function L(){r.value!==""&&(r.value="",o.value.page=1,x())}function k(e){return e?.hashid??e?.id}function O(e){Q.visit(route("panel.campaigns.edit",k(e)))}function E(e){confirm(`Deseja realmente remover a campanha "${e.name}"?`)&&Q.delete(route("panel.campaigns.destroy",k(e)))}async function U(e){const n=k(e);if(n){_.value=!0,y.value=!0,m.value="";try{const t=await le.get(route("panel.campaigns.tracking_code",n));m.value=String(t.data.script||"").trim()}catch{S.create({type:"negative",message:"Não foi possível carregar o código de acompanhamento",position:"top-right"})}finally{y.value=!1}}}function G(){if(w.value){w.value.focus(),w.value.select();try{if(!document.execCommand("copy"))throw new Error;S.create({type:"positive",message:"Código copiado",timeout:2e3,position:"top-right"})}catch{S.create({type:"negative",message:"Não foi possível copiar o código",timeout:3e3,position:"top-right"})}}}return(e,n)=>(f(),P(K,null,[a(c(Y),{title:"Campanhas"}),u("div",ne,[u("div",se,[n[3]||(n[3]=u("h1",{class:"tw-text-lg tw-font-semibold"}," Campanhas ",-1)),a(c(Z),{href:e.route("panel.campaigns.create")},{default:l(()=>[a(i,{color:"positive",icon:"add",label:"Nova Campanha",unelevated:""})]),_:1},8,["href"])]),a(j,{flat:"",bordered:""},{default:l(()=>[a(N,{class:"tw-space-y-3"},{default:l(()=>[u("div",re,[a(H,{modelValue:r.value,"onUpdate:modelValue":n[0]||(n[0]=t=>r.value=t),dense:"",outlined:"",clearable:"",placeholder:"Pesquisar por código ou nome",class:"md:tw-flex-1",onKeyup:ee(C,["enter"]),onClear:L},{append:l(()=>[a(J,{name:"search",class:"cursor-pointer",onClick:C})]),_:1},8,["modelValue"]),a(i,{outline:"",color:"primary",icon:"search",label:"Filtrar",class:"md:tw-w-auto",onClick:C})]),a(M,{flat:"",rows:h.value,columns:V,"row-key":"id","binary-state-sort":"",pagination:o.value,"onUpdate:pagination":n[1]||(n[1]=t=>o.value=t),"rows-per-page-options":[10,15,25,50],"no-data-label":c(p).noData,"no-results-label":c(p).noResults,"loading-label":c(p).loading,"rows-per-page-label":c(p).recordsPerPage,"all-rows-label":c(p).allRows,"pagination-label":c(p).pagination,onRequest:I},{"body-cell-countries":l(t=>[a(v,{props:t},{default:l(()=>[u("div",ie,[(f(!0),P(K,null,ae(t.row.countries,g=>(f(),z($,{key:g.id,dense:"",size:"sm"},{default:l(()=>[F(T(g.iso2),1)]),_:2},1024))),128))])]),_:2},1032,["props"])]),"body-cell-status":l(t=>[a(v,{props:t,class:"tw-text-center"},{default:l(()=>[a(oe,{value:t.row.status},null,8,["value"])]),_:2},1032,["props"])]),"body-cell-tracking_snippet":l(t=>[a(v,{props:t},{default:l(()=>[a(i,{flat:"",dense:"",size:"sm",icon:"code",color:"primary",label:"Snippet",onClick:g=>U(t.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-actions":l(t=>[a(v,{props:t,class:"tw-text-right"},{default:l(()=>[a(i,{flat:"",dense:"",size:"sm",icon:"edit",color:"primary",onClick:g=>O(t.row)},null,8,["onClick"]),a(i,{flat:"",dense:"",size:"sm",icon:"delete",color:"negative",onClick:g=>E(t.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","pagination","no-data-label","no-results-label","loading-label","rows-per-page-label","all-rows-label","pagination-label"])]),_:1})]),_:1})]),a(X,{modelValue:_.value,"onUpdate:modelValue":n[2]||(n[2]=t=>_.value=t)},{default:l(()=>[a(j,{style:{"min-width":"720px","max-width":"95vw","min-height":"450px"}},{default:l(()=>[a(N,{class:"tw-flex tw-justify-between tw-items-center"},{default:l(()=>[n[4]||(n[4]=u("div",{class:"tw-text-lg tw-font-semibold"}," Código de acompanhamento ",-1)),R(a(i,{flat:"",dense:"",icon:"close"},null,512),[[q]])]),_:1}),a(D),a(N,null,{default:l(()=>[y.value?(f(),P("div",ce," Carregando... ")):te("",!0),u("textarea",{ref_key:"trackingTextarea",ref:w,class:"tw-w-full tw-h-72 tw-font-mono tw-text-sm tw-p-3 tw-bg-gray-100 tw-rounded",readonly:""},T(m.value),513)]),_:1}),a(D),a(W,{align:"right"},{default:l(()=>[a(i,{flat:"",icon:"content_copy",label:"Copiar",disable:!m.value,onClick:G},null,8,["disable"]),R(a(i,{color:"primary",label:"Fechar"},null,512),[[q]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{ge as default};
