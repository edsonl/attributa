import{x as A,E as u,h as s,F as M,r as $,s as S,G as B,i as Q,t as z,v as J,N as C}from"./vendor-quasar-D0sfcEux.js";import{f as d,r as i,w as W,Y,E as U,F as k,O as _,C as n,A as Z,J as F,u as o,Q as H,Z as X,B as c,j as N,L as ee,G as ae,S as oe}from"./vendor-D6jaF0sv.js";import{_ as le}from"../app-PRapPME2.js";const te={class:"tw-flex tw-justify-end tw-gap-2"},re={key:0,class:"tw-text-center tw-py-6"},ne={__name:"FormCampaign",props:{campaign:{type:Object,default:null},channels:{type:Array,required:!0},countries:{type:Array,required:!0},affiliate_platforms:{type:Array,required:!0},googleAdsAccounts:{type:Array,required:!0},conversionGoals:{type:Array,required:!0},defaults:{type:Object,default:()=>({})}},setup(y){const t=y,O=d(()=>!!t.campaign),m=i(t.countries??[]),p=i([...t.countries??[]]),b=i(null),E=d(()=>(t.channels??[]).map(e=>({...e,value:e.id,label:e.label??e.name}))),L=d(()=>(t.affiliate_platforms??[]).map(e=>({...e,value:e.id,label:e.label??e.name}))),j=d(()=>(t.conversionGoals??[]).map(e=>({...e,value:e.id,label:e.active===!1?`${e.label??e.goal_code} (inativa)`:e.label??e.goal_code})));W(()=>t.countries,(e=[])=>{m.value=e,p.value=[...e]});const a=Y({name:t.campaign?.name??"",product_url:t.campaign?.product_url??"",conversion_goal_id:t.campaign?.conversion_goal_id??null,status:t.campaign?.status??!0,channel_id:t.campaign?.channel_id??t.defaults?.channel_id??null,affiliate_platform_id:t.campaign?.affiliate_platform_id??t.defaults?.affiliate_platform_id??null,google_ads_account_id:t.campaign?.google_ads_account_id??null,countries:t.campaign?.countries?t.campaign.countries.map(e=>e.id):[],commission_value:t.campaign?.commission_value??null}),x=d(()=>{if(a.errors.countries)return a.errors.countries;const e=Object.entries(a.errors).find(([l])=>l.startsWith("countries."));return e?e[1]:null});function G(){const e=t.campaign?.hashid??t.campaign?.id;O.value?a.put(route("panel.campaigns.update",e)):a.post(route("panel.campaigns.store"))}function R(e,l,r){if(!m.value.length)return r();const v=(e||"").trim().toLowerCase();l(()=>{if(!v){p.value=[...m.value];return}p.value=m.value.filter(h=>{const P=(h.name||"").toLowerCase(),I=(h.iso2||"").toLowerCase(),K=(h.iso3||"").toLowerCase();return P.includes(v)||I.includes(v)||K.includes(v)})})}function T(){b.value?.hidePopup&&b.value.hidePopup()}const w=i(!1),V=i(!1),g=i(""),f=i(null);async function q(){const e=t.campaign?.hashid??t.campaign?.id;if(e){w.value=!0,V.value=!0,g.value="";try{const l=await oe.get(route("panel.campaigns.tracking_code",e));g.value=String(l.data.script||"").trim()}catch{C.create({type:"negative",message:"Não foi possível carregar o código de acompanhamento",position:"top-right"})}finally{V.value=!1}}}function D(){if(f.value){f.value.focus(),f.value.select();try{if(!document.execCommand("copy"))throw new Error;C.create({type:"positive",message:"Código copiado",timeout:2e3,position:"top-right"})}catch{C.create({type:"negative",message:"Não foi possível copiar o código",timeout:3e3,position:"top-right"})}}}return(e,l)=>(k(),U(ae,null,[_("form",{onSubmit:X(G,["prevent"]),class:"tw-space-y-6"},[n(A,{modelValue:o(a).name,"onUpdate:modelValue":l[0]||(l[0]=r=>o(a).name=r),label:"Nome da campanha",outlined:"",dense:"",error:!!o(a).errors.name,"error-message":o(a).errors.name},null,8,["modelValue","error","error-message"]),n(A,{modelValue:o(a).product_url,"onUpdate:modelValue":l[1]||(l[1]=r=>o(a).product_url=r),label:"URL do produto autorizada",hint:"Exemplo: https://biovitania.online",outlined:"",dense:"",error:!!o(a).errors.product_url,"error-message":o(a).errors.product_url},null,8,["modelValue","error","error-message"]),n(u,{modelValue:o(a).channel_id,"onUpdate:modelValue":l[2]||(l[2]=r=>o(a).channel_id=r),options:E.value,"option-label":"label","option-value":"value","emit-value":"","map-options":"",label:"Canal",outlined:"",dense:"",error:!!o(a).errors.channel_id,"error-message":o(a).errors.channel_id},null,8,["modelValue","options","error","error-message"]),n(u,{modelValue:o(a).affiliate_platform_id,"onUpdate:modelValue":l[3]||(l[3]=r=>o(a).affiliate_platform_id=r),options:L.value,"option-label":"label","option-value":"value","emit-value":"","map-options":"",label:"Plataforma de Afiliado",outlined:"",dense:"",error:!!o(a).errors.affiliate_platform_id,"error-message":o(a).errors.affiliate_platform_id},null,8,["modelValue","options","error","error-message"]),n(u,{ref_key:"countrySelectRef",ref:b,label:"Regiões de segmentação (países)",modelValue:o(a).countries,"onUpdate:modelValue":[l[4]||(l[4]=r=>o(a).countries=r),T],options:p.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",multiple:"","use-chips":"","use-input":"",onFilter:R,outlined:"",dense:"",error:!!x.value,"error-message":x.value},null,8,["modelValue","options","error","error-message"]),n(u,{modelValue:o(a).google_ads_account_id,"onUpdate:modelValue":l[5]||(l[5]=r=>o(a).google_ads_account_id=r),options:y.googleAdsAccounts,"option-value":"id","option-label":"label","emit-value":"","map-options":"",clearable:"",label:"Conta de Anúncios",hint:"Selecione a conta do Google Ads desta campanha",error:!!o(a).errors.google_ads_account_id,"error-message":o(a).errors.google_ads_account_id},null,8,["modelValue","options","error","error-message"]),n(u,{modelValue:o(a).conversion_goal_id,"onUpdate:modelValue":l[6]||(l[6]=r=>o(a).conversion_goal_id=r),options:j.value,"option-value":"value","option-label":"label","emit-value":"","map-options":"",clearable:"",label:"Meta de conversao",hint:"Selecione a meta/codigo de conversao vinculada a campanha",outlined:"",dense:"",error:!!o(a).errors.conversion_goal_id,"error-message":o(a).errors.conversion_goal_id},null,8,["modelValue","options","error","error-message"]),y.campaign?(k(),Z(s,{key:0,flat:"",icon:"code",color:"primary",label:"Ver código de acompanhamento",onClick:q})):F("",!0),n(M,{modelValue:o(a).status,"onUpdate:modelValue":l[7]||(l[7]=r=>o(a).status=r),label:"Campanha ativa"},null,8,["modelValue"]),_("div",te,[n(s,{flat:"",label:"Cancelar",onClick:l[8]||(l[8]=r=>o(H).visit(e.route("panel.campaigns.index")))}),n(s,{color:"primary",label:"Salvar",type:"submit"})])],32),n(J,{modelValue:w.value,"onUpdate:modelValue":l[9]||(l[9]=r=>w.value=r)},{default:c(()=>[n($,{style:{"min-width":"720px","max-width":"95vw","min-height":"450px"}},{default:c(()=>[n(S,{class:"tw-flex tw-justify-between tw-items-center"},{default:c(()=>[l[10]||(l[10]=_("div",{class:"tw-text-lg tw-font-semibold"}," Código de acompanhamento ",-1)),N(n(s,{flat:"",dense:"",icon:"close"},null,512),[[B]])]),_:1}),n(Q),n(S,null,{default:c(()=>[V.value?(k(),U("div",re," Carregando... ")):F("",!0),_("textarea",{ref_key:"trackingTextarea",ref:f,class:"tw-w-full tw-h-72 tw-font-mono tw-text-sm tw-p-3 tw-bg-gray-100 tw-rounded",readonly:""},ee(g.value),513)]),_:1}),n(Q),n(z,{align:"right"},{default:c(()=>[n(s,{flat:"",icon:"content_copy",label:"Copiar",disable:!g.value,onClick:D},null,8,["disable"]),N(n(s,{color:"primary",label:"Fechar"},null,512),[[B]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},de=le(ne,[["__scopeId","data-v-6310d5da"]]);export{de as default};
