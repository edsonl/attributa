import{u as I,E as M,A as T,B as s,k as z,h as A,r as G}from"./vendor-quasar-s7YXAUFU.js";import{r,w as R,e as j,E as k,F as b,C as o,u as D,N as J,B as l,O as i,K as v,L as u,J as U,A as K,G as O,S as w}from"./vendor-D6jaF0sv.js";import H from"./conversionpageviewdetailmodal-DwexC1Sh.js";import"../app-ByZdZbaT.js";const W={class:"row q-mb-md items-center"},X={class:"col-12 col-md-4"},Y={class:"tw-flex tw-items-center tw-gap-1"},Z={class:"tw-flex tw-items-center tw-gap-2"},ee=["src","alt"],re={__name:"Index",setup(ae){const y=r([]),m=r(!1),C=I(),n=r({page:1,rowsPerPage:20,rowsNumber:0,sortBy:"conversion_event_time",descending:!0}),d=r(null),h=r([]),c=r(!1),f=r(!1),p=r(null),x="https://attributa.master.dev.br".replace(/\/$/,""),Q=[{name:"conversion_event_time",label:"Data",field:"conversion_event_time_formatted",sortable:!0,align:"left"},{name:"campaign_name",label:"Campanha",field:"campaign_name",sortable:!0,align:"left"},{name:"campaign_code",label:"Cód/Campanha",field:"campaign_code",sortable:!0,align:"left"},{name:"conversion_name",label:"Pixel/Conversão",field:"conversion_name",sortable:!0,align:"left"},{name:"pageview_id",label:"Pageview ID",field:"pageview_id",sortable:!0,align:"left"},{name:"country_code",label:"País",field:"country_code",sortable:!0,align:"left"},{name:"region_name",label:"Região",field:"region_name",sortable:!0,align:"left"},{name:"city",label:"Cidade",field:"city",sortable:!0,align:"left"},{name:"conversion_value",label:"Valor (USD)",field:"conversion_value",sortable:!0,align:"left"},{name:"currency_code",label:"Moeda",field:"currency_code",sortable:!0,align:"left"},{name:"google_upload_status",label:"Status Google",field:"google_upload_status",sortable:!0,align:"left"}];function E(t){return t==null||t===""?"-":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(Number(t))}function P(t){const a=t?.country_code;if(!a)return null;const e=String(a).toLowerCase();return`${x}/assets/country-flags/${e}.svg`}function B(t){const a=String(t??"").trim().toLowerCase();return{0:"pending",1:"processing",2:"processing_export",3:"success",4:"exported",5:"error"}[a]??a}function F(t){const a=B(t);return a==="exported"||a==="success"?"positive":a==="processing_export"||a==="processing"?"warning":a==="pending"?"grey-6":a==="error"||a==="failed"?"negative":"primary"}function L(t){const a=B(t);return a==="exported"?"Exportado":a==="processing_export"||a==="processing"?"Processando":a==="pending"?"Pendente":a==="error"||a==="failed"?"Erro":a==="success"?"Sucesso":t||"-"}async function $(t){if(!t){C.notify({type:"warning",message:"Pageview não encontrada para esta conversão."});return}c.value=!0,f.value=!0,p.value=null;try{const a=await w.get(route("panel.atividade.pageviews.show",t));p.value=a.data}catch{c.value=!1,C.notify({type:"negative",message:"Não foi possível carregar os detalhes da pageview."})}finally{f.value=!1}}function q(){w.get(route("panel.conversoes.campaigns")).then(t=>{h.value=t.data})}function _(t=null){m.value=!0;const a=t?.pagination??n.value,{page:e,rowsPerPage:S,sortBy:V,descending:N}=a;w.get(route("panel.conversoes.data"),{params:{page:e,per_page:S,sortBy:V,descending:N,campaign_id:d.value}}).then(g=>{y.value=g.data.data,n.value={...n.value,page:g.data.current_page,rowsPerPage:g.data.per_page,rowsNumber:g.data.total,sortBy:V,descending:N}}).finally(()=>{m.value=!1})}return R(d,()=>{n.value.page=1,_({pagination:n.value})}),j(()=>{q(),_({pagination:n.value})}),(t,a)=>(b(),k(O,null,[o(D(J),{title:"Conversões"}),o(G,{flat:"",bordered:"",class:"tw-rounded-2xl tw-p-4"},{default:l(()=>[i("div",W,[i("div",X,[o(M,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),options:h.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",clearable:"",label:"Filtrar por campanha"},null,8,["modelValue","options"])])]),o(T,{title:"Conversões",rows:y.value,columns:Q,"row-key":"id",loading:m.value,pagination:n.value,"onUpdate:pagination":a[1]||(a[1]=e=>n.value=e),"binary-state-sort":!0,onRequest:_},{"body-cell-conversion_event_time":l(e=>[o(s,{props:e},{default:l(()=>[v(u(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-conversion_value":l(e=>[o(s,{props:e},{default:l(()=>[v(u(E(e.value)),1)]),_:2},1032,["props"])]),"body-cell-pageview_id":l(e=>[o(s,{props:e},{default:l(()=>[i("div",Y,[i("span",null,u(e.value??"-"),1),e.value?(b(),K(A,{key:0,dense:"",flat:"",round:"",size:"sm",icon:"manage_search",color:"primary",onClick:S=>$(e.value)},null,8,["onClick"])):U("",!0)])]),_:2},1032,["props"])]),"body-cell-country_code":l(e=>[o(s,{props:e},{default:l(()=>[i("div",Z,[P(e.row)?(b(),k("img",{key:0,src:P(e.row),alt:e.value,class:"tw-w-6 tw-h-4 tw-rounded-sm tw-object-cover tw-border tw-border-gray-200"},null,8,ee)):U("",!0),i("span",null,u(e.value?e.value.toUpperCase():"-"),1)])]),_:2},1032,["props"])]),"body-cell-region_name":l(e=>[o(s,{props:e},{default:l(()=>[v(u(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-city":l(e=>[o(s,{props:e},{default:l(()=>[v(u(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-google_upload_status":l(e=>[o(s,{props:e},{default:l(()=>[o(z,{color:F(e.row.google_upload_status_slug??e.value),label:e.row.google_upload_status_label??L(e.row.google_upload_status_slug??e.value)},null,8,["color","label"])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])]),_:1}),o(H,{modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=e=>c.value=e),loading:f.value,payload:p.value,"asset-base-url":D(x)},null,8,["modelValue","loading","payload","asset-base-url"])],64))}};export{re as default};
