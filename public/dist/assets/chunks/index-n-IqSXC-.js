import{u as le,h as i,s as h,x as C,c as oe,A as q,B as m,G as se,r as $,J as D,i as V,t as ne,v as I,M as re}from"./vendor-quasar-C0Sd45BE.js";import{f as ie,r as v,w as U,E as de,F as ue,C as a,O as c,u as s,N as ce,B as l,P as ge,_ as pe,L as _,K as M,j as Q,Z as G,M as ve,G as fe,Q as j,S as E}from"./vendor-D6jaF0sv.js";import{q as d}from"./qtable-pt-CkdICETI.js";const we={class:"tw-space-y-3"},me={class:"tw-flex tw-items-center tw-justify-between tw-flex-col sm:tw-flex-row tw-gap-3"},be={class:"tw-flex tw-gap-3 tw-flex-col md:tw-flex-row"},ye={class:"tw-text-xs tw-text-slate-700"},_e={class:"tw-text-xs tw-text-slate-700"},he={class:"tw-flex tw-items-center tw-gap-3"},xe={class:"tw-text-base tw-font-semibold"},Ce={class:"tw-inline-flex tw-items-center tw-rounded-full tw-bg-slate-100 tw-px-3 tw-py-1 tw-text-xs tw-font-medium tw-text-slate-600"},ke={class:"tw-flex tw-items-center tw-gap-2"},Le={__name:"Index",props:{conversionGoals:{type:Object,required:!0},logsRetentionDays:{type:Number,default:10},filters:{type:Object,default:()=>({})}},setup(O){const g=O,T=ie(()=>g.conversionGoals?.data??[]),f=v(g.filters?.search??""),p=le(),k=v(!1),w=v(null),P=v(!1),b=v(!1),z=v(""),x=v([]),r=v({page:1,rowsPerPage:15,rowsNumber:0,sortBy:"created_at",descending:!0}),y=v(null),F=[{name:"created_at",label:"Data",field:"created_at_formatted",align:"left",sortable:!0},{name:"message",label:"Mensagem",field:"message",align:"left",sortable:!1}],n=v({page:g.conversionGoals?.current_page??1,rowsPerPage:g.conversionGoals?.per_page??15,rowsNumber:g.conversionGoals?.total??0,sortBy:g.filters?.sort??"created_at",descending:(g.filters?.direction??"desc")==="desc"});U(()=>g.conversionGoals,t=>{t&&(n.value.page=t.current_page,n.value.rowsPerPage=t.per_page,n.value.rowsNumber=t.total)}),U(()=>g.filters,t=>{n.value.sortBy=t?.sort??"created_at",n.value.descending=(t?.direction??"desc")==="desc",(t?.search??"")!==f.value&&(f.value=t?.search??"")});const A=[{name:"id",label:"ID",field:"id",align:"left",sortable:!0},{name:"goal_code",label:"Codigo",field:"goal_code",align:"left",sortable:!0},{name:"active",label:"Status",field:"active",align:"center",sortable:!0},{name:"timezone",label:"Timezone",field:t=>t.timezone?.label??t.timezone?.identifier??"-",align:"left"},{name:"campaigns",label:"Campanhas",field:"campaigns",align:"left"},{name:"created_at",label:"Criado em",field:"created_at",align:"left",sortable:!0},{name:"integration",label:"Integracao",field:"integration",align:"center"},{name:"logs",label:"Logs",field:"logs",align:"center"},{name:"actions",label:"Acoes",field:"actions",align:"right"}];function B(){const t={page:n.value.page,per_page:n.value.rowsPerPage,sort:n.value.sortBy,direction:n.value.descending?"desc":"asc",search:f.value||void 0};j.get(route("panel.conversion-goals.index"),t,{preserveState:!0,preserveScroll:!0,replace:!0})}function K({pagination:t}){Object.assign(n.value,t),B()}function L(){n.value.page=1,B()}function J(){f.value!==""&&(f.value="",n.value.page=1,B())}function S(t){return t?.hashid??t?.id}function Z(t){j.visit(route("panel.conversion-goals.edit",S(t)))}function H(t){const o=(t.campaigns??[]).map(u=>u?.name).filter(Boolean);if(!o.length)return"-";const e=o.join(", ");return e.length<=60?e:`${e.slice(0,60).trimEnd()}...`}function W(t){p.dialog({title:"Confirmar exclusao",message:`Deseja realmente remover a meta "${t.goal_code}"?`,cancel:{label:"Cancelar",flat:!0},ok:{label:"Excluir",color:"negative",unelevated:!0},persistent:!0}).onOk(()=>{j.delete(route("panel.conversion-goals.destroy",S(t)))})}function X(t){w.value={url:t.integration_url,username:`googleads-${t.user_slug_id}`,password:t.googleads_password},k.value=!0}async function R(t,o){const e=String(t??"");if(e===""){p.notify({type:"warning",message:`${o} vazio.`});return}try{await re(e),p.notify({type:"positive",message:`${o} copiado.`})}catch{p.notify({type:"negative",message:`Falha ao copiar ${o.toLowerCase()}.`})}}function Y(){return p.screen.lt.sm?"width: 96vw; max-width: 96vw; height: 92vh; max-height: 92vh;":p.screen.lt.md?"width: 92vw; max-width: 92vw; height: 90vh; max-height: 90vh;":"width: 70vw; max-width: 70vw; height: 88vh; max-height: 88vh;"}async function N(t,o=null){if(!t)return;b.value=!0;const e=o??r.value;try{const u=await E.get(route("panel.conversion-goals.logs",t),{params:{page:e.page,per_page:e.rowsPerPage,sort:e.sortBy||"created_at",direction:e.descending?"desc":"asc"}});x.value=u.data.data??[],r.value={...r.value,page:u.data.current_page,rowsPerPage:u.data.per_page,rowsNumber:u.data.total,sortBy:e.sortBy||"created_at",descending:!!e.descending}}finally{b.value=!1}}async function ee(t){y.value=S(t),z.value=t.goal_code,x.value=[],r.value={...r.value,page:1,sortBy:"created_at",descending:!0},P.value=!0,await N(y.value,r.value)}async function ae({pagination:t}){r.value={...r.value,...t},await N(y.value,r.value)}async function te(){y.value&&p.dialog({title:"Excluir logs",message:`Deseja excluir todos os logs da meta ${z.value||""}?`,cancel:{label:"Cancelar",flat:!0},ok:{label:"Excluir logs",color:"negative",unelevated:!0},persistent:!0}).onOk(async()=>{b.value=!0;try{await E.delete(route("panel.conversion-goals.logs.destroy",y.value)),x.value=[],r.value={...r.value,page:1,rowsNumber:0},p.notify({type:"positive",message:"Logs removidos com sucesso."})}catch{p.notify({type:"negative",message:"Falha ao remover logs."})}finally{b.value=!1}})}return(t,o)=>(ue(),de(fe,null,[a(s(ce),{title:"Metas de Conversao"}),c("div",we,[c("div",me,[o[8]||(o[8]=c("h1",{class:"tw-text-lg tw-font-semibold"}," Metas de Conversao ",-1)),a(s(ge),{href:t.route("panel.conversion-goals.create")},{default:l(()=>[a(i,{color:"positive",icon:"add",label:"Nova Meta",unelevated:""})]),_:1},8,["href"])]),a($,{flat:"",bordered:""},{default:l(()=>[a(h,{class:"tw-space-y-3"},{default:l(()=>[c("div",be,[a(C,{modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=e=>f.value=e),dense:"",outlined:"",clearable:"",placeholder:"Pesquisar por codigo",class:"md:tw-flex-1",onKeyup:pe(L,["enter"]),onClear:J},{append:l(()=>[a(oe,{name:"search",class:"cursor-pointer",onClick:L})]),_:1},8,["modelValue"]),a(i,{outline:"",color:"primary",icon:"search",label:"Filtrar",class:"md:tw-w-auto",onClick:L})]),a(q,{flat:"",rows:T.value,columns:A,"row-key":"id","binary-state-sort":"",pagination:n.value,"onUpdate:pagination":o[1]||(o[1]=e=>n.value=e),"rows-per-page-options":[10,15,25,50],"no-data-label":s(d).noData,"no-results-label":s(d).noResults,"loading-label":s(d).loading,"rows-per-page-label":s(d).recordsPerPage,"all-rows-label":s(d).allRows,"pagination-label":s(d).pagination,onRequest:K},{"body-cell-active":l(e=>[a(m,{props:e,class:"tw-text-center"},{default:l(()=>[a(se,{dense:"",size:"sm",color:e.row.active?"positive":"negative","text-color":"white"},{default:l(()=>[M(_(e.row.active?"Ativo":"Inativo"),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-created_at":l(e=>[a(m,{props:e},{default:l(()=>[M(_(e.row.created_at?new Date(e.row.created_at).toLocaleString("pt-BR"):"-"),1)]),_:2},1032,["props"])]),"body-cell-campaigns":l(e=>[a(m,{props:e},{default:l(()=>[c("span",ye,_(H(e.row)),1)]),_:2},1032,["props"])]),"body-cell-timezone":l(e=>[a(m,{props:e},{default:l(()=>[c("span",_e,_(e.row.timezone?.label??e.row.timezone?.identifier??"-"),1)]),_:2},1032,["props"])]),"body-cell-actions":l(e=>[a(m,{props:e,class:"tw-text-right"},{default:l(()=>[a(i,{flat:"",dense:"",size:"sm",icon:"edit",color:"primary",onClick:u=>Z(e.row)},null,8,["onClick"]),a(i,{flat:"",dense:"",size:"sm",icon:"delete",color:"negative",onClick:u=>W(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-integration":l(e=>[a(m,{props:e,class:"tw-text-center"},{default:l(()=>[a(i,{flat:"",dense:"",size:"sm",icon:"link",color:"primary",onClick:u=>X(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-logs":l(e=>[a(m,{props:e,class:"tw-text-center"},{default:l(()=>[a(i,{flat:"",dense:"",size:"sm",icon:"history",label:"Logs",color:"secondary",onClick:u=>ee(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","pagination","no-data-label","no-results-label","loading-label","rows-per-page-label","all-rows-label","pagination-label"])]),_:1})]),_:1}),a(I,{modelValue:k.value,"onUpdate:modelValue":o[5]||(o[5]=e=>k.value=e)},{default:l(()=>[a($,{style:{"min-width":"620px","max-width":"90vw"}},{default:l(()=>[a(h,{class:"tw-flex tw-items-center tw-justify-between"},{default:l(()=>[o[9]||(o[9]=c("div",{class:"tw-text-base tw-font-semibold"}," Integração Google Ads ",-1)),Q(a(i,{flat:"",round:"",dense:"",icon:"close"},null,512),[[D]])]),_:1}),a(V),a(h,{class:"tw-space-y-4"},{default:l(()=>[a(C,{"model-value":w.value?.url??"",label:"URL CSV",readonly:"",outlined:"",dense:""},{append:l(()=>[a(i,{flat:"",dense:"",icon:"content_copy",onClick:o[2]||(o[2]=G(e=>R(w.value?.url,"URL"),["stop","prevent"]))})]),_:1},8,["model-value"]),a(C,{"model-value":w.value?.username??"",label:"Usuário",readonly:"",outlined:"",dense:""},{append:l(()=>[a(i,{flat:"",dense:"",icon:"content_copy",onClick:o[3]||(o[3]=G(e=>R(w.value?.username,"Usuário"),["stop","prevent"]))})]),_:1},8,["model-value"]),a(C,{"model-value":w.value?.password??"",label:"Senha",readonly:"",outlined:"",dense:""},{append:l(()=>[a(i,{flat:"",dense:"",icon:"content_copy",onClick:o[4]||(o[4]=G(e=>R(w.value?.password,"Senha"),["stop","prevent"]))})]),_:1},8,["model-value"])]),_:1}),a(V),a(ne,{align:"right"},{default:l(()=>[Q(a(i,{flat:"",label:"Fechar"},null,512),[[D]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(I,{modelValue:P.value,"onUpdate:modelValue":o[7]||(o[7]=e=>P.value=e),maximized:s(p).screen.lt.sm},{default:l(()=>[a($,{style:ve(Y())},{default:l(()=>[a(h,{class:"tw-flex tw-items-center tw-justify-between"},{default:l(()=>[c("div",he,[c("div",xe," Logs da Meta "+_(z.value||"-"),1),c("span",Ce," Os logs são armazenados temporariamente e serão excluídos após "+_(g.logsRetentionDays)+" dias. ",1)]),c("div",ke,[a(i,{flat:"",dense:"",color:"negative",icon:"delete_sweep",label:"Excluir logs",disable:b.value||!y.value,onClick:te},null,8,["disable"]),Q(a(i,{flat:"",round:"",dense:"",icon:"close"},null,512),[[D]])])]),_:1}),a(V),a(h,{class:"tw-p-0",style:{height:"calc(100% - 72px)"}},{default:l(()=>[a(q,{flat:"",rows:x.value,columns:F,"row-key":"id",loading:b.value,pagination:r.value,"onUpdate:pagination":o[6]||(o[6]=e=>r.value=e),"rows-per-page-options":[10,15,25,50],"no-data-label":s(d).noData,"no-results-label":s(d).noResults,"loading-label":s(d).loading,"rows-per-page-label":s(d).recordsPerPage,"all-rows-label":s(d).allRows,"pagination-label":s(d).pagination,"binary-state-sort":"",onRequest:ae},null,8,["rows","loading","pagination","no-data-label","no-results-label","loading-label","rows-per-page-label","all-rows-label","pagination-label"])]),_:1})]),_:1},8,["style"])]),_:1},8,["modelValue","maximized"])])],64))}};export{Le as default};
