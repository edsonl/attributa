import{u as be,C as he,x as Ce,J as De,h as v,K as xe,c as R,n as E,A as ke,B as c,k as V,r as Pe}from"./vendor-quasar-DSLrBDx5.js";import{r as d,f as Z,w as ee,e as Se,E as h,F as u,C as o,u as te,N as $e,B as l,O as r,K as C,L as f,A as P,J as B,M as Y,G as Le,S}from"./vendor-D6jaF0sv.js";import Re from"./pageviewdetailmodal-QKVLLifc.js";import{_ as Ve}from"../app-DdS2ngyJ.js";const Be={class:"row q-mb-md items-center q-col-gutter-md"},Te={class:"col-12 col-sm-8 col-md-3 q-mb-sm q-mb-md-0"},Fe={class:"col-12 col-sm-6 col-md-2 q-mb-sm q-mb-md-0"},Ne={class:"tw-grid tw-grid-cols-1 md:tw-grid-cols-[150px_1fr] tw-gap-3 tw-p-3"},Ie={class:"tw-flex tw-flex-col tw-gap-2"},Me={class:"tw-flex tw-justify-end tw-gap-2 tw-px-3 tw-pb-3"},Ue={class:"col-12 col-md q-mt-sm q-mt-md-0 tw-flex md:tw-justify-end"},Qe={class:"tw-flex tw-items-center tw-gap-1"},qe={class:"tw-flex tw-items-center tw-gap-2"},Ae={class:"tw-flex tw-items-center tw-gap-2 tw-flex-wrap"},Ee={key:0,class:"tw-inline-flex tw-items-center tw-gap-1"},Ye={key:1},je={key:2},ze={key:3,class:"tw-text-slate-400"},Ge={key:4,class:"tw-inline-flex tw-items-center tw-gap-1"},Oe={class:"tw-flex tw-items-center tw-gap-2"},Ke=["src","alt"],Je={__name:"Pageviews",setup(We){const j=d([]),_=d(!1),ae=d(null),p=be(),m=d({page:1,rowsPerPage:20,rowsNumber:0,sortBy:"created_at",descending:!0}),y=d(null),z=d([]),s=d({from:"",to:""}),b=d({from:"",to:""}),$=d(!1),T=d(!1),F={label:"Não determinado",color:"#FCE7F3",description:"Categoria ainda não determinada."},N=d(!1),I=d(!1),M=d(null),D=d([]),U=Z(()=>D.value.length>0),oe=Z(()=>{const t=String(s.value?.from||""),a=String(s.value?.to||"");return!t||!a?"":`${W(t)}  -  ${W(a)}`}),G="https://attributa.master.dev.br".replace(/\/$/,""),le=[{name:"created_at",label:"Data",field:"created_at_formatted",sortable:!0,align:"left"},{name:"ip",label:"Classificação / IP",field:"ip",sortable:!0,align:"left"},{name:"campaign_name",label:"Campanha",field:"campaign_name",sortable:!0,align:"left"},{name:"traffic_source",label:"Origem do Tráfego",field:"traffic_source_name",sortable:!0,align:"left"},{name:"device_browser",label:"Dispositivo/Navegador",field:t=>re(t),sortable:!0,align:"left"},{name:"country_code",label:"País",field:"country_code",sortable:!0,align:"left"},{name:"region_name",label:"Região",field:"region_name",sortable:!0,align:"left"},{name:"city",label:"Cidade",field:"city",sortable:!0,align:"left"},{name:"gclid",label:"GCLID",field:"has_gclid",sortable:!0,align:"left"},{name:"conversion",label:"Conversão",field:"conversion",sortable:!0,align:"left"},{name:"details",label:"Detalhes",field:"id",align:"center"},{name:"actions",label:"Ações",field:"id",align:"right"}];function O(t){return{label:t?.ip_category_name??F.label,color:t?.ip_category_color??F.color,description:t?.ip_category_description??F.description}}function Q(t){return{label:t?.traffic_source_name??"-",icon:t?.traffic_source_icon||"help_outline",color:t?.traffic_source_color||"#64748B"}}function K(t){const a=t?.country_code;if(!a)return null;const e=String(a).toLowerCase();return`${G}/assets/country-flags/${e}.svg`}function ne(t){return t===!0||t===1||t==="1"}function ie(t){return t===!0||t===1||t==="1"?!0:typeof t=="string"?t.trim().length>0&&t!=="0":!1}function J(t){const a=String(t||"").trim();return a?a.split(/[_\s-]+/).filter(Boolean).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"-"}function re(t){const a=J(t?.device_type),e=String(t?.browser_name||"").trim()||"-";return a==="-"&&e==="-"?"-":a==="-"?e:e==="-"?a:`${a} • ${e}`}function g(t){return{deviceLabel:J(t?.device_type),deviceIcon:t?.device_icon||"devices_other",deviceColor:t?.device_color||"#64748B",browserLabel:String(t?.browser_name||"").trim()||"-"}}function q(t){return g(t).deviceLabel!=="-"}async function se(t,a="Valor"){if(t)try{await navigator.clipboard.writeText(String(t)),p.notify({type:"positive",message:`${a} copiado.`})}catch{p.notify({type:"negative",message:`Não foi possível copiar ${a.toLowerCase()}.`})}}function de(){S.get(route("panel.atividade.campaigns")).then(t=>{z.value=t.data})}function k(t){const a=new Date(t),e=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),i=String(a.getDate()).padStart(2,"0");return`${e}-${n}-${i}`}function W(t){if(!t||!/^\d{4}-\d{2}-\d{2}$/.test(t))return"";const[a,e,n]=t.split("-");return`${n}.${e}.${a}`}function H(){const t=new Date,a=new Date;return a.setDate(t.getDate()-6),{from:k(a),to:k(t)}}function ce(t){const a=new Date,e=new Date(a),n=new Date(a);if(t==="last_7")e.setDate(a.getDate()-6);else if(t==="last_31")e.setDate(a.getDate()-30);else if(t==="month_current")e.setDate(1);else if(t==="month_previous"){const i=new Date(a.getFullYear(),a.getMonth()-1,1),w=new Date(a.getFullYear(),a.getMonth(),0);e.setTime(i.getTime()),n.setTime(w.getTime())}return{from:k(e),to:k(n)}}function L(t){b.value=ce(t)}function ue(){const t=k(new Date);b.value={from:t,to:t}}function fe(){b.value={from:String(s.value?.from||""),to:String(s.value?.to||"")}}function me(){$.value=!1}function ge(){const t=String(b.value?.from||""),a=String(b.value?.to||"");t&&a&&(s.value={from:t,to:a}),$.value=!1}function A(){if(typeof window>"u")return;const t=new URL(window.location.href);y.value?t.searchParams.set("campaign_id",String(y.value)):t.searchParams.delete("campaign_id"),s.value?.from&&s.value?.to?(t.searchParams.set("date_from",s.value.from),t.searchParams.set("date_to",s.value.to)):(t.searchParams.delete("date_from"),t.searchParams.delete("date_to")),window.history.replaceState({},"",t.toString())}function ve(){if(typeof window>"u"){s.value=H();return}const t=new URLSearchParams(window.location.search);y.value=t.get("campaign_id")?Number(t.get("campaign_id")):null;const a=t.get("date_from"),e=t.get("date_to"),n=i=>/^\d{4}-\d{2}-\d{2}$/.test(String(i||""));if(n(a)&&n(e)){s.value={from:a,to:e};return}s.value=H()}function x(t){_.value=!0;const{page:a,rowsPerPage:e,sortBy:n,descending:i}=t.pagination;return S.get(route("panel.atividade.pageviews.data"),{params:{page:a,per_page:e,sortBy:n,descending:i,campaign_id:y.value,date_from:s.value?.from||void 0,date_to:s.value?.to||void 0}}).then(w=>{j.value=w.data.data,D.value=[],m.value={...m.value,page:w.data.current_page,rowsPerPage:w.data.per_page,rowsNumber:w.data.total,sortBy:n,descending:i}}).finally(()=>{_.value=!1})}async function we(t){if(!t)return;let a=!0;const e=typeof window<"u",n=e?window.$confirm:null;if(n?a=await n({title:"Excluir pageview",message:"Esta ação é permanente. Deseja realmente remover?",okLabel:"Remover",okColor:"negative"}):e&&(a=window.confirm("Excluir este pageview?")),!!a){_.value=!0;try{const{data:i}=await S.delete(route("panel.atividade.pageviews.destroy",t));if(i?.deleted===!1){p.notify({type:"warning",message:i?.message||"Pageview convertido não pode ser excluído."});return}p.notify({type:"positive",message:i?.message||"Pageview excluído com sucesso."}),await x({pagination:m.value})}catch{p.notify({type:"negative",message:"Falha ao excluir pageview."})}finally{_.value=!1}}}async function pe(){if(!U.value)return;let t=!0;const a=typeof window<"u",e=a?window.$confirm:null,n=`Você selecionou ${D.value.length} registro(s). Deseja remover?`;if(e?t=await e({title:"Remover pageviews",message:n,okLabel:"Remover",okColor:"negative"}):a&&(t=window.confirm(n)),!!t){_.value=!0;try{const{data:i}=await S.delete(route("panel.atividade.pageviews.bulk-destroy"),{data:{ids:D.value.map(ye=>ye.id)}}),w=Number(i?.deleted||0),X=Number(i?.ignored_converted||0);w>0&&X>0?p.notify({type:"warning",message:`${w} removido(s). ${X} convertido(s) ignorado(s).`}):w>0?p.notify({type:"positive",message:i?.message||"Pageviews excluídos com sucesso."}):p.notify({type:"warning",message:i?.message||"Nenhum pageview elegível para exclusão."}),await x({pagination:m.value})}catch{p.notify({type:"negative",message:"Falha ao remover os pageviews selecionados."})}finally{_.value=!1}}}async function _e(t){N.value=!0,I.value=!0,M.value=null;try{const a=await S.get(route("panel.atividade.pageviews.show",t.id));M.value=a.data}finally{I.value=!1}}return ee(y,()=>{T.value&&(m.value.page=1,A(),x({pagination:m.value}))}),ee(()=>[s.value?.from,s.value?.to],()=>{T.value&&(m.value.page=1,A(),x({pagination:m.value}))}),Se(()=>{ve(),A(),T.value=!0,de(),x({pagination:m.value})}),(t,a)=>(u(),h(Le,null,[o(te($e),{title:"Relatório de atividade"}),o(Pe,{flat:"",bordered:"",class:"tw-rounded-2xl tw-p-4"},{default:l(()=>[r("div",Be,[r("div",Te,[o(he,{ref_key:"tableRef",ref:ae,modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=e=>y.value=e),options:z.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",clearable:"",dense:"",outlined:"",class:"filter-field campaign-filter-field",label:"Filtrar por campanha"},null,8,["modelValue","options"])]),r("div",Fe,[o(Ce,{dense:"",outlined:"",readonly:"",class:"filter-field",label:"Período","model-value":oe.value,placeholder:"Selecione um intervalo"},{prepend:l(()=>[o(R,{name:"event"})]),append:l(()=>[o(R,{name:"expand_more"})]),default:l(()=>[o(De,{modelValue:$.value,"onUpdate:modelValue":a[6]||(a[6]=e=>$.value=e),anchor:"bottom left",self:"top left",offset:[0,6],"transition-show":"scale","transition-hide":"scale",onBeforeShow:fe},{default:l(()=>[r("div",Ne,[r("div",Ie,[o(v,{flat:"","no-caps":"",dense:"",label:"Hoje",onClick:ue}),o(v,{flat:"","no-caps":"",dense:"",label:"Últimos 7 dias",onClick:a[1]||(a[1]=e=>L("last_7"))}),o(v,{flat:"","no-caps":"",dense:"",label:"Últimos 31 dias",onClick:a[2]||(a[2]=e=>L("last_31"))}),o(v,{flat:"","no-caps":"",dense:"",label:"Mês atual",onClick:a[3]||(a[3]=e=>L("month_current"))}),o(v,{flat:"","no-caps":"",dense:"",label:"Mês anterior",onClick:a[4]||(a[4]=e=>L("month_previous"))})]),o(xe,{modelValue:b.value,"onUpdate:modelValue":a[5]||(a[5]=e=>b.value=e),range:"",mask:"YYYY-MM-DD",minimal:"",class:"period-date-picker"},null,8,["modelValue"])]),r("div",Me,[o(v,{flat:"","no-caps":"",label:"Cancelar",onClick:me}),o(v,{color:"primary","no-caps":"",label:"Aplicar",onClick:ge})])]),_:1},8,["modelValue"])]),_:1},8,["model-value"])]),r("div",Ue,[o(v,{color:"negative",icon:"delete",disable:!U.value,onClick:pe,class:"bulk-delete-btn",round:"",dense:"","aria-label":"Remover selecionados"},{default:l(()=>[o(E,{anchor:"center left",self:"center right",offset:[8,0]},{default:l(()=>[C(f(U.value?"Remover selecionados":"Selecione registros para remover"),1)]),_:1})]),_:1},8,["disable"])])]),o(ke,{rows:j.value,columns:le,"row-key":"id",loading:_.value,pagination:m.value,"onUpdate:pagination":a[7]||(a[7]=e=>m.value=e),"binary-state-sort":!0,"rows-per-page-options":[10,15,20,25,50],onRequest:x,selection:"multiple",selected:D.value,"onUpdate:selected":a[8]||(a[8]=e=>D.value=e)},{"body-cell-created_at":l(e=>[o(c,{props:e},{default:l(()=>[C(f(e.value),1)]),_:2},1032,["props"])]),"body-cell-ip":l(e=>[o(c,{props:e},{default:l(()=>[r("div",Qe,[r("span",{class:"tw-inline-flex tw-h-3 tw-w-3 tw-rounded-full tw-border tw-border-white/20 tw-shadow-sm",style:Y({backgroundColor:O(e.row).color})},[o(E,{class:"tw-text-xs tw-max-w-xs tw-leading-snug"},{default:l(()=>[C(f(O(e.row).description),1)]),_:2},1024)],4),r("span",null,f(e.value||"-"),1),e.value?(u(),P(v,{key:0,dense:"",flat:"",round:"",size:"sm",icon:"content_copy",color:"primary",onClick:n=>se(e.value,"IP")},{default:l(()=>[o(E,{anchor:"center right",self:"center left",offset:[8,0]},{default:l(()=>[...a[10]||(a[10]=[C(" Copiar IP ",-1)])]),_:1})]),_:1},8,["onClick"])):B("",!0)])]),_:2},1032,["props"])]),"body-cell-campaign_name":l(e=>[o(c,{props:e},{default:l(()=>[C(f(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-traffic_source":l(e=>[o(c,{props:e},{default:l(()=>[r("div",qe,[o(R,{name:Q(e.row).icon,size:"18px",color:"primary",style:Y({color:Q(e.row).color})},null,8,["name","style"]),r("span",null,f(Q(e.row).label),1)])]),_:2},1032,["props"])]),"body-cell-device_browser":l(e=>[o(c,{props:e},{default:l(()=>[r("div",Ae,[q(e.row)?(u(),h("div",Ee,[o(R,{name:g(e.row).deviceIcon,size:"18px",style:Y({color:g(e.row).deviceColor})},null,8,["name","style"]),r("span",null,f(g(e.row).deviceLabel),1)])):g(e.row).browserLabel==="-"?(u(),h("span",Ye,"-")):(u(),h("span",je,f(g(e.row).browserLabel),1)),q(e.row)&&g(e.row).browserLabel&&g(e.row).browserLabel!=="-"?(u(),h("span",ze," • ")):B("",!0),q(e.row)&&g(e.row).browserLabel&&g(e.row).browserLabel!=="-"?(u(),h("div",Ge,[r("span",null,f(g(e.row).browserLabel),1)])):B("",!0)])]),_:2},1032,["props"])]),"body-cell-country_code":l(e=>[o(c,{props:e},{default:l(()=>[r("div",Oe,[K(e.row)?(u(),h("img",{key:0,src:K(e.row),alt:e.value,class:"country-flag"},null,8,Ke)):B("",!0),r("span",null,f(e.value?e.value.toUpperCase():"-"),1)])]),_:2},1032,["props"])]),"body-cell-region_name":l(e=>[o(c,{props:e},{default:l(()=>[C(f(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-city":l(e=>[o(c,{props:e},{default:l(()=>[C(f(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-gclid":l(e=>[o(c,{props:e},{default:l(()=>[ie(e.value)?(u(),P(V,{key:0,color:"primary",label:"Sim"})):(u(),P(V,{key:1,color:"grey-4","text-color":"dark",label:"Não"}))]),_:2},1032,["props"])]),"body-cell-conversion":l(e=>[o(c,{props:e},{default:l(()=>[ne(e.value)?(u(),P(V,{key:0,color:"green",label:"Convertido"})):(u(),P(V,{key:1,color:"grey-4","text-color":"dark",label:"Não convertido"}))]),_:2},1032,["props"])]),"body-cell-details":l(e=>[o(c,{props:e},{default:l(()=>[o(v,{dense:"",flat:"",round:"",size:"sm",icon:"manage_search",color:"primary",onClick:n=>_e(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-actions":l(e=>[o(c,{props:e,class:"tw-text-right"},{default:l(()=>[o(v,{dense:"",flat:"",icon:"delete",size:"sm",class:"qtable-delete-btn",onClick:n=>we(e.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination","selected"])]),_:1}),o(Re,{modelValue:N.value,"onUpdate:modelValue":a[9]||(a[9]=e=>N.value=e),loading:I.value,payload:M.value,"asset-base-url":te(G)},null,8,["modelValue","loading","payload","asset-base-url"])],64))}},tt=Ve(Je,[["__scopeId","data-v-afbb6d98"]]);export{tt as default};
