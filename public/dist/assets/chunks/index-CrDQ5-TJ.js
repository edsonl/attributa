import{u as qe,A as Me,M as je,e as d,O as Ie,c as te,H as oe,n as B,o as N,q as ne,Q as se,a as E,b as P,E as re,l as ie,F as Ae,G as m,v as de,w as ue,K as Oe,y as Te}from"./vendor-quasar-Bee0Lbku.js";import{r as s,f as ce,w as Y,e as Be,G as z,H as q,E as t,u as fe,S as Ee,D as o,Q as p,C as Ye,M as ze,N as u,O as v,I as H,J as me,a0 as pe,j as He,R as C}from"./vendor-BB0I-wvh.js";import Je from"./pageviewdetailmodal-BYD_8wyv.js";import{_ as Ge}from"../app-KLA-tYsL.js";const We={class:"row q-mb-md items-start q-col-gutter-md"},Ke={class:"col-12 col-sm-6 col-md-4 col-lg-2 q-mb-sm q-mb-md-0"},Xe={class:"tw-grid tw-grid-cols-1 md:tw-grid-cols-[150px_1fr] tw-gap-3 tw-p-3"},Ze={class:"tw-flex tw-flex-col tw-gap-2"},ea={class:"tw-flex tw-justify-end tw-gap-2 tw-px-3 tw-pb-3"},aa={class:"col-12 col-sm-6 col-md-4 col-lg-3 q-mb-sm q-mb-md-0"},la={class:"col-12 col-sm-6 col-md-4 col-lg-2 q-mb-sm q-mb-md-0"},ta={class:"col-auto q-mb-sm q-mb-md-0"},oa={class:"col-auto q-mb-sm q-mb-md-0"},na={class:"col-12 col-md q-mt-sm q-mt-md-0 tw-flex md:tw-justify-end"},sa={class:"tw-font-mono"},ra={class:"payload-log-pre"},ia={__name:"Index",setup(da){const J=s([]),_=s(!1),y=qe(),D=s([]),M=ce(()=>D.value.length>0),c=s({page:1,rowsPerPage:20,rowsNumber:0,sortBy:"created_at",descending:!0}),j=s([]),x=s([]),G=s([]),w=s(null),h=s(null),f=s([]),V=s(!1),r=s({from:"",to:""}),b=s({from:"",to:""}),$=s(!1),L=s(!1),I=s(!1),A=s(null),O=s(!1),T=s(""),ve="https://attributa.master.dev.br".replace(/\/$/,""),W=[{label:"Processando",value:"processing"},{label:"Aprovado",value:"approved"},{label:"Rejeitado",value:"rejected"},{label:"Lixo",value:"trash"},{label:"Cancelado",value:"cancelled"},{label:"Reembolsado",value:"refunded"},{label:"Chargeback",value:"chargeback"}],Q=[{name:"created_at",label:"Data de criação",field:"created_at_formatted",sortable:!0,align:"left"},{name:"lead_status",label:"Status",field:"lead_status",sortable:!0,align:"left"},{name:"updated_at",label:"Data de atualização",field:"updated_at_formatted",sortable:!0,align:"left"},{name:"campaign_name",label:"Campanha",field:"campaign_name",sortable:!0,align:"left"},{name:"platform_name",label:"Plataforma",field:"platform_name",sortable:!0,align:"left"},{name:"platform_lead_id",label:"UUID Lead",field:"platform_lead_id",sortable:!0,align:"left"},{name:"offer_id",label:"Offer ID",field:"offer_id",sortable:!0,align:"left"},{name:"payout_amount",label:"Payout",field:"payout_amount",sortable:!0,align:"left"},{name:"currency_code",label:"Moeda",field:"currency_code",sortable:!0,align:"left"},{name:"details",label:"Detalhes",field:"id",sortable:!1,align:"center"},{name:"conversion",label:"Conversão",field:"has_conversion",sortable:!1,align:"left"},{name:"callback_log",label:"Log callback",field:"payload_json",sortable:!1,align:"center"},{name:"actions",label:"Ações",field:"id",sortable:!1,align:"right"}],ge=["updated_at"],R=s(Q.map(l=>l.name).filter(l=>!ge.includes(l)));function K(l){return R.value.includes(l)}function X(l,a){const e=new Set(R.value);a?e.add(l):e.delete(l),R.value=Q.map(n=>n.name).filter(n=>e.has(n))}const be=ce(()=>{const l=String(r.value?.from||""),a=String(r.value?.to||"");return!l||!a?"":`${ae(l)}  -  ${ae(a)}`});function _e(l){const a=W.map(e=>e.value);return Array.isArray(l)?l.filter(e=>a.includes(String(e))):[]}function ye(){f.value=[]}function Z(l){return f.value.includes(l)}function ee(l,a){const e=new Set(_e(f.value));a?e.add(l):e.delete(l),f.value=Array.from(e)}function we(l,a){a(()=>{const e=String(l||"").trim().toLowerCase();if(e===""){x.value=j.value;return}x.value=j.value.filter(n=>String(n?.name||"").toLowerCase().includes(e))})}function k(l){const a=new Date(l),e=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),i=String(a.getDate()).padStart(2,"0");return`${e}-${n}-${i}`}function ae(l){if(!l||!/^\d{4}-\d{2}-\d{2}$/.test(l))return"";const[a,e,n]=l.split("-");return`${n}.${e}.${a}`}function le(){const l=new Date,a=new Date;return a.setDate(l.getDate()-6),{from:k(a),to:k(l)}}function he(l){const a=new Date,e=new Date(a),n=new Date(a);if(l==="last_7")e.setDate(a.getDate()-6);else if(l==="last_31")e.setDate(a.getDate()-30);else if(l==="month_current")e.setDate(1);else if(l==="month_previous"){const i=new Date(a.getFullYear(),a.getMonth()-1,1),g=new Date(a.getFullYear(),a.getMonth(),0);e.setTime(i.getTime()),n.setTime(g.getTime())}return{from:k(e),to:k(n)}}function U(l){b.value=he(l)}function Se(){const l=k(new Date);b.value={from:l,to:l}}function De(){const l=new Date;l.setDate(l.getDate()-1);const a=k(l);b.value={from:a,to:a}}function ke(){b.value={from:String(r.value?.from||""),to:String(r.value?.to||"")}}function Ce(){$.value=!1}function Pe(){const l=String(b.value?.from||""),a=String(b.value?.to||"");l&&a&&(r.value={from:l,to:a}),$.value=!1}function xe(l,a){const e=Number(l);if(Number.isNaN(e))return"-";try{return new Intl.NumberFormat("en-US",{style:"currency",currency:String(a||"USD").toUpperCase()}).format(e)}catch{return e.toFixed(2)}}function F(){if(typeof window>"u")return;const l=new URL(window.location.href);w.value?l.searchParams.set("campaign_id",String(w.value)):l.searchParams.delete("campaign_id"),h.value?l.searchParams.set("platform_id",String(h.value)):l.searchParams.delete("platform_id");const a=Array.isArray(f.value)?f.value:[];a.length>0?l.searchParams.set("lead_statuses",a.join(",")):l.searchParams.delete("lead_statuses"),r.value?.from&&r.value?.to?(l.searchParams.set("date_from",r.value.from),l.searchParams.set("date_to",r.value.to)):(l.searchParams.delete("date_from"),l.searchParams.delete("date_to")),window.history.replaceState({},"",l.toString())}function Ve(){if(typeof window>"u"){r.value=le();return}const l=new URLSearchParams(window.location.search);w.value=l.get("campaign_id")?Number(l.get("campaign_id")):null,h.value=l.get("platform_id")?Number(l.get("platform_id")):null,f.value=[];const a=l.get("date_from"),e=l.get("date_to"),n=i=>/^\d{4}-\d{2}-\d{2}$/.test(String(i||""));if(n(a)&&n(e)){r.value={from:a,to:e};return}r.value=le()}function $e(){C.get(route("panel.leads.campaigns")).then(l=>{j.value=l.data,x.value=l.data})}function Le(){C.get(route("panel.leads.platforms")).then(l=>{G.value=l.data})}function S(l){_.value=!0;const{page:a,rowsPerPage:e,sortBy:n,descending:i}=l.pagination;return C.get(route("panel.leads.data"),{params:{page:a,per_page:e,sortBy:n,descending:i,campaign_id:w.value||void 0,platform_id:h.value||void 0,lead_statuses:Array.isArray(f.value)&&f.value.length>0?f.value:void 0,date_from:r.value?.from||void 0,date_to:r.value?.to||void 0}}).then(g=>{J.value=g.data.data,D.value=[],c.value={...c.value,page:g.data.current_page,rowsPerPage:g.data.per_page,rowsNumber:g.data.total,sortBy:n,descending:i}}).finally(()=>{_.value=!1})}async function Qe(l){if(!l)return;let a=!0;const e=typeof window<"u",n=e?window.$confirm:null;if(n?a=await n({title:"Excluir lead",message:"Esta ação é permanente. Deseja realmente remover?",okLabel:"Remover",okColor:"negative"}):e&&(a=window.confirm("Excluir este lead?")),!!a){_.value=!0;try{const{data:i}=await C.delete(route("panel.leads.destroy",l));y.notify({type:"positive",message:i?.message||"Lead excluído com sucesso."}),await S({pagination:c.value})}catch{y.notify({type:"negative",message:"Falha ao excluir lead."})}finally{_.value=!1}}}async function Re(){if(!M.value)return;let l=!0;const a=typeof window<"u",e=a?window.$confirm:null,n=`Você selecionou ${D.value.length} lead(s). Deseja remover?`;if(e?l=await e({title:"Remover leads",message:n,okLabel:"Remover",okColor:"negative"}):a&&(l=window.confirm(n)),!!l){_.value=!0;try{const{data:i}=await C.delete(route("panel.leads.bulk-destroy"),{data:{ids:D.value.map(Ne=>Ne.id)}}),g=Number(i?.deleted||0);y.notify({type:g>0?"positive":"warning",message:g>0?i?.message||"Leads excluídos com sucesso.":i?.message||"Nenhum lead elegível para exclusão."}),await S({pagination:c.value})}catch{y.notify({type:"negative",message:"Falha ao remover os leads selecionados."})}finally{_.value=!1}}}async function Ue(l){if(!l){y.notify({type:"warning",message:"Este lead não possui pageview associada."});return}L.value=!0,I.value=!0,A.value=null;try{const a=await C.get(route("panel.atividade.pageviews.show",l));A.value=a.data}catch{L.value=!1,y.notify({type:"negative",message:"Não foi possível carregar os detalhes da visita."})}finally{I.value=!1}}function Fe(l){const a=l?.payload_json;if(!a){y.notify({type:"warning",message:"Sem payload salvo para este lead."});return}try{const e=typeof a=="string"?JSON.parse(a):a;T.value=JSON.stringify(e,null,2)}catch{T.value=String(a)}O.value=!0}return Y([w,h],()=>{V.value&&(c.value.page=1,F(),S({pagination:c.value}))}),Y(f,()=>{V.value&&(c.value.page=1,F(),S({pagination:c.value}))},{deep:!0}),Y(()=>[r.value?.from,r.value?.to],()=>{V.value&&(c.value.page=1,F(),S({pagination:c.value}))}),Be(()=>{Ve(),F(),V.value=!0,$e(),Le(),S({pagination:c.value})}),(l,a)=>(q(),z(H,null,[t(fe(Ee),{title:"Leads"}),t(de,{flat:"",bordered:"",class:"tw-rounded-2xl tw-p-4"},{default:o(()=>[p("div",We,[p("div",Ke,[t(Me,{dense:"",outlined:"",readonly:"",class:"filter-field",label:"Período","model-value":be.value,placeholder:"Selecione um intervalo"},{prepend:o(()=>[t(te,{name:"event"})]),append:o(()=>[t(te,{name:"expand_more"})]),default:o(()=>[t(je,{modelValue:$.value,"onUpdate:modelValue":a[5]||(a[5]=e=>$.value=e),anchor:"bottom left",self:"top left",offset:[0,6],"transition-show":"scale","transition-hide":"scale",onBeforeShow:ke},{default:o(()=>[p("div",Xe,[p("div",Ze,[t(d,{flat:"","no-caps":"",dense:"",label:"Hoje",onClick:Se}),t(d,{flat:"","no-caps":"",dense:"",label:"Ontem",onClick:De}),t(d,{flat:"","no-caps":"",dense:"",label:"Últimos 7 dias",onClick:a[0]||(a[0]=e=>U("last_7"))}),t(d,{flat:"","no-caps":"",dense:"",label:"Últimos 31 dias",onClick:a[1]||(a[1]=e=>U("last_31"))}),t(d,{flat:"","no-caps":"",dense:"",label:"Mês atual",onClick:a[2]||(a[2]=e=>U("month_current"))}),t(d,{flat:"","no-caps":"",dense:"",label:"Mês anterior",onClick:a[3]||(a[3]=e=>U("month_previous"))})]),t(Ie,{modelValue:b.value,"onUpdate:modelValue":a[4]||(a[4]=e=>b.value=e),range:"",mask:"YYYY-MM-DD",minimal:"",class:"period-date-picker"},null,8,["modelValue"])]),p("div",ea,[t(d,{flat:"","no-caps":"",label:"Cancelar",onClick:Ce}),t(d,{color:"primary","no-caps":"",label:"Aplicar",onClick:Pe})])]),_:1},8,["modelValue"])]),_:1},8,["model-value"])]),p("div",aa,[t(oe,{modelValue:w.value,"onUpdate:modelValue":a[6]||(a[6]=e=>w.value=e),options:x.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"","use-input":"","fill-input":"","hide-selected":"","input-debounce":"0",clearable:"",dense:"",outlined:"","hide-bottom-space":"",class:"filter-field campaign-filter-field",label:"Filtrar por campanha",onFilter:we},null,8,["modelValue","options"])]),p("div",la,[t(oe,{modelValue:h.value,"onUpdate:modelValue":a[7]||(a[7]=e=>h.value=e),options:G.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",clearable:"",dense:"",outlined:"",class:"filter-field",label:"Filtrar por plataforma"},null,8,["modelValue","options"])]),p("div",ta,[t(d,{dense:"",flat:"",round:"",icon:"filter_list",color:"grey-7","aria-label":"Filtrar status"},{default:o(()=>[f.value.length>0?(q(),Ye(B,{key:0,color:"primary",floating:""},{default:o(()=>[u(v(f.value.length),1)]),_:1})):ze("",!0),t(N,null,{default:o(()=>[...a[14]||(a[14]=[u("Filtrar status",-1)])]),_:1}),t(ne,{anchor:"bottom right",self:"top right"},{default:o(()=>[t(se,{dense:"",style:{"min-width":"220px"}},{default:o(()=>[(q(),z(H,null,me(W,e=>t(E,{key:e.value,clickable:"",onClick:n=>ee(e.value,!Z(e.value))},{default:o(()=>[t(P,{avatar:""},{default:o(()=>[t(re,{dense:"","model-value":Z(e.value),onClick:a[8]||(a[8]=pe(()=>{},["stop"])),"onUpdate:modelValue":n=>ee(e.value,n)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024),t(P,null,{default:o(()=>[u(v(e.label),1)]),_:2},1024)]),_:2},1032,["onClick"])),64)),t(ie),t(E,{clickable:"",onClick:ye},{default:o(()=>[t(P,{class:"tw-text-primary"},{default:o(()=>[...a[15]||(a[15]=[u("Limpar seleção",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),p("div",oa,[t(d,{dense:"",flat:"",round:"",icon:"view_column",color:"grey-7","aria-label":"Organizar colunas"},{default:o(()=>[t(N,null,{default:o(()=>[...a[16]||(a[16]=[u("Organizar colunas",-1)])]),_:1}),t(ne,{anchor:"bottom right",self:"top right"},{default:o(()=>[t(se,{dense:"",style:{"min-width":"220px"}},{default:o(()=>[(q(),z(H,null,me(Q,e=>t(E,{key:e.name,clickable:"",onClick:n=>X(e.name,!K(e.name))},{default:o(()=>[t(P,{avatar:""},{default:o(()=>[t(re,{dense:"","model-value":K(e.name),onClick:a[9]||(a[9]=pe(()=>{},["stop"])),"onUpdate:modelValue":n=>X(e.name,n)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024),t(P,null,{default:o(()=>[u(v(e.label),1)]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1})]),_:1})]),p("div",na,[t(d,{color:"negative",icon:"delete",disable:!M.value,onClick:Re,class:"bulk-delete-btn",round:"",dense:"","aria-label":"Remover selecionados"},{default:o(()=>[t(N,{anchor:"center left",self:"center right",offset:[8,0]},{default:o(()=>[u(v(M.value?"Remover selecionados":"Selecione registros para remover"),1)]),_:1})]),_:1},8,["disable"])])]),t(Ae,{rows:J.value,columns:Q,"visible-columns":R.value,"row-key":"id",loading:_.value,pagination:c.value,"onUpdate:pagination":a[10]||(a[10]=e=>c.value=e),"binary-state-sort":!0,"rows-per-page-options":[10,15,20,25,50],onRequest:S,selection:"multiple",selected:D.value,"onUpdate:selected":a[11]||(a[11]=e=>D.value=e)},{"body-cell-created_at":o(e=>[t(m,{props:e},{default:o(()=>[u(v(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-updated_at":o(e=>[t(m,{props:e},{default:o(()=>[u(v(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-campaign_name":o(e=>[t(m,{props:e},{default:o(()=>[u(v(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-platform_name":o(e=>[t(m,{props:e},{default:o(()=>[u(v(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-platform_lead_id":o(e=>[t(m,{props:e},{default:o(()=>[p("span",sa,v(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-offer_id":o(e=>[t(m,{props:e},{default:o(()=>[u(v(e.value??"-"),1)]),_:2},1032,["props"])]),"body-cell-lead_status":o(e=>[t(m,{props:e},{default:o(()=>[t(B,{color:e.row.lead_status_color||"warning",label:e.row.lead_status_label||e.row.lead_status||"-"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-payout_amount":o(e=>[t(m,{props:e},{default:o(()=>[u(v(xe(e.value,e.row.currency_code)),1)]),_:2},1032,["props"])]),"body-cell-currency_code":o(e=>[t(m,{props:e},{default:o(()=>[u(v(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-details":o(e=>[t(m,{props:e},{default:o(()=>[t(d,{dense:"",flat:"",round:"",size:"sm",icon:"manage_search",color:"primary",disable:!e.row.pageview_id,onClick:n=>Ue(e.row.pageview_id)},null,8,["disable","onClick"])]),_:2},1032,["props"])]),"body-cell-conversion":o(e=>[t(m,{props:e},{default:o(()=>[t(B,{color:e.row.has_conversion?"positive":"grey-6",label:e.row.has_conversion?"Criada":"Pendente"},null,8,["color","label"])]),_:2},1032,["props"])]),"body-cell-callback_log":o(e=>[t(m,{props:e},{default:o(()=>[t(d,{dense:"",flat:"",round:"",size:"sm",icon:"article",color:"primary",disable:!e.row.payload_json,onClick:n=>Fe(e.row)},{default:o(()=>[t(N,null,{default:o(()=>[...a[17]||(a[17]=[u("Ver log do callback",-1)])]),_:1})]),_:1},8,["disable","onClick"])]),_:2},1032,["props"])]),"body-cell-actions":o(e=>[t(m,{props:e,class:"tw-text-right"},{default:o(()=>[t(d,{dense:"",flat:"",icon:"delete",size:"sm",class:"qtable-delete-btn",onClick:n=>Qe(e.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","visible-columns","loading","pagination","selected"])]),_:1}),t(Je,{modelValue:L.value,"onUpdate:modelValue":a[12]||(a[12]=e=>L.value=e),loading:I.value,payload:A.value,"asset-base-url":fe(ve)},null,8,["modelValue","loading","payload","asset-base-url"]),t(Te,{modelValue:O.value,"onUpdate:modelValue":a[13]||(a[13]=e=>O.value=e)},{default:o(()=>[t(de,{class:"payload-log-card"},{default:o(()=>[t(ue,{class:"tw-flex tw-items-center tw-justify-between"},{default:o(()=>[a[18]||(a[18]=p("div",{class:"text-h6"},"Log do callback",-1)),He(t(d,{flat:"",round:"",dense:"",icon:"close"},null,512),[[Oe]])]),_:1}),t(ie),t(ue,null,{default:o(()=>[p("pre",ra,v(T.value),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},pa=Ge(ia,[["__scopeId","data-v-99808bb3"]]);export{pa as default};
