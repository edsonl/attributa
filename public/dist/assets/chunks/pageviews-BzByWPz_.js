import{u as Me,H as Ue,A as qe,M as ze,e as u,O as Ee,c as U,o as S,q as Oe,Q as Ye,a as Ae,b as se,E as je,F as Ge,G as m,n as $,v as He}from"./vendor-quasar-Bee0Lbku.js";import{r as s,f as ce,w as de,e as We,G as y,H as f,E as o,u as ue,S as Je,D as l,Q as i,N as w,I as fe,J as Ke,a0 as Xe,O as d,C as P,M as L,P as J,L as Ze,R}from"./vendor-BB0I-wvh.js";import et from"./pageviewdetailmodal-BYD_8wyv.js";import{_ as tt}from"../app-KLA-tYsL.js";const at={class:"row q-mb-md items-center q-col-gutter-md"},ot={class:"col-12 col-sm-8 col-md-3 q-mb-sm q-mb-md-0"},lt={class:"col-12 col-sm-6 col-md-2 q-mb-sm q-mb-md-0"},nt={class:"tw-grid tw-grid-cols-1 md:tw-grid-cols-[150px_1fr] tw-gap-3 tw-p-3"},it={class:"tw-flex tw-flex-col tw-gap-2"},rt={class:"tw-flex tw-justify-end tw-gap-2 tw-px-3 tw-pb-3"},st={class:"col-auto q-mb-sm q-mb-md-0"},ct={class:"col-12 col-md q-mt-sm q-mt-md-0 tw-flex md:tw-justify-end"},dt={class:"tw-flex tw-items-center tw-gap-1"},ut={class:"tw-flex tw-items-center tw-gap-1"},ft={class:"tw-flex tw-items-center tw-gap-2"},mt={class:"tw-flex tw-items-center tw-gap-2 tw-flex-wrap"},vt={key:0,class:"tw-inline-flex tw-items-center tw-gap-1"},gt={key:1},wt={key:2},pt={key:3,class:"tw-text-slate-400"},bt={key:4,class:"tw-inline-flex tw-items-center tw-gap-1"},_t={class:"tw-flex tw-items-center tw-gap-2"},yt=["src","alt"],ht={__name:"Pageviews",setup(Ct){const K=s([]),h=s(!1),me=s(null),b=Me(),v=s({page:1,rowsPerPage:20,rowsNumber:0,sortBy:"created_at",descending:!0}),C=s(null),q=s([]),V=s([]),c=s({from:"",to:""}),_=s({from:"",to:""}),B=s(!1),z=s(!1),E={label:"Não determinado",color:"#FCE7F3",description:"Categoria ainda não determinada."},O=s(!1),Y=s(!1),A=s(null),x=s([]),N=s({}),j=ce(()=>x.value.length>0),ve=ce(()=>{const t=String(c.value?.from||""),a=String(c.value?.to||"");return!t||!a?"":`${ne(t)}  -  ${ne(a)}`}),X="https://attributa.master.dev.br".replace(/\/$/,""),F=[{name:"created_at",label:"Data",field:"created_at_formatted",sortable:!0,align:"left"},{name:"ip",label:"Classificação / IP",field:"ip",sortable:!0,align:"left"},{name:"country_code",label:"País",field:"country_code",sortable:!0,align:"left"},{name:"region_name",label:"Região",field:"region_name",sortable:!0,align:"left"},{name:"city",label:"Cidade",field:"city",sortable:!0,align:"left"},{name:"campaign_name",label:"Campanha",field:"campaign_name",sortable:!0,align:"left"},{name:"visitor",label:"Visitante",field:"visitor_status",sortable:!0,align:"center"},{name:"traffic_source",label:"Origem do Tráfego",field:"traffic_source_name",sortable:!0,align:"left"},{name:"device_browser",label:"Dispositivo/Navegador",field:t=>be(t),sortable:!0,align:"left"},{name:"gclid",label:"GCLID",field:"has_gclid",sortable:!0,align:"left"},{name:"conversion",label:"Conversão",field:"conversion",sortable:!0,align:"left"},{name:"details",label:"Detalhes",field:"id",align:"center"},{name:"actions",label:"Ações",field:"id",align:"right"}],ge=["region_name","city"],Q=s(F.map(t=>t.name).filter(t=>!ge.includes(t)));function Z(t){return Q.value.includes(t)}function ee(t,a){const e=new Set(Q.value);a?e.add(t):e.delete(t),Q.value=F.map(n=>n.name).filter(n=>e.has(n))}function te(t){return{label:t?.ip_category_name??E.label,color:t?.ip_category_color??E.color,description:t?.ip_category_description??E.description}}function G(t){return{label:t?.traffic_source_name??"-",icon:t?.traffic_source_icon||"help_outline",color:t?.traffic_source_color||"#64748B"}}function ae(t){const a=t?.country_code;if(!a)return null;const e=String(a).toLowerCase();return`${X}/assets/country-flags/${e}.svg`}function we(t){return t===!0||t===1||t==="1"}function pe(t){return t===!0||t===1||t==="1"?!0:typeof t=="string"?t.trim().length>0&&t!=="0":!1}function oe(t){const a=String(t||"").trim();return a?a.split(/[_\s-]+/).filter(Boolean).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"-"}function be(t){const a=oe(t?.device_type),e=String(t?.browser_name||"").trim()||"-";return a==="-"&&e==="-"?"-":a==="-"?e:e==="-"?a:`${a} • ${e}`}function g(t){return{deviceLabel:oe(t?.device_type),deviceIcon:t?.device_icon||"devices_other",deviceColor:t?.device_color||"#64748B",browserLabel:String(t?.browser_name||"").trim()||"-"}}function H(t){return g(t).deviceLabel!=="-"}function T(t){return String(t?.visitor_status||"").toLowerCase()==="recorrente"?"recorrente":"novo"}function _e(t){return T(t)==="recorrente"?"Recorrente":"Novo"}function ye(t){return T(t)==="recorrente"?"indigo-1":"teal-1"}function he(t){return T(t)==="recorrente"?"indigo-10":"teal-10"}function Ce(t){const a=Math.max(Number(t?.visitor_hits??1),1).toLocaleString("pt-BR"),e=T(t)==="recorrente"?"visitas recorrentes":"primeira visita";return`${a} pageviews deste visitante nesta campanha (${e}).`}function le(t){const a=String(t||"").trim();return a!==""&&a!=="-"&&a.length>24}function I(t){const a=String(t?.id??"");return a?!!N.value[a]:!1}function xe(t){const a=String(t?.id??"");a&&(N.value={...N.value,[a]:!N.value[a]})}async function ke(t,a="Valor"){if(t)try{await navigator.clipboard.writeText(String(t)),b.notify({type:"positive",message:`${a} copiado.`})}catch{b.notify({type:"negative",message:`Não foi possível copiar ${a.toLowerCase()}.`})}}function De(){R.get(route("panel.atividade.campaigns")).then(t=>{q.value=t.data,V.value=t.data})}function Se(t,a){a(()=>{const e=String(t||"").trim().toLowerCase();if(e===""){V.value=q.value;return}V.value=q.value.filter(n=>String(n?.name||"").toLowerCase().includes(e))})}function k(t){const a=new Date(t),e=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),r=String(a.getDate()).padStart(2,"0");return`${e}-${n}-${r}`}function ne(t){if(!t||!/^\d{4}-\d{2}-\d{2}$/.test(t))return"";const[a,e,n]=t.split("-");return`${n}.${e}.${a}`}function ie(){const t=new Date,a=new Date;return a.setDate(t.getDate()-6),{from:k(a),to:k(t)}}function Pe(t){const a=new Date,e=new Date(a),n=new Date(a);if(t==="last_7")e.setDate(a.getDate()-6);else if(t==="last_31")e.setDate(a.getDate()-30);else if(t==="month_current")e.setDate(1);else if(t==="month_previous"){const r=new Date(a.getFullYear(),a.getMonth()-1,1),p=new Date(a.getFullYear(),a.getMonth(),0);e.setTime(r.getTime()),n.setTime(p.getTime())}return{from:k(e),to:k(n)}}function M(t){_.value=Pe(t)}function $e(){const t=k(new Date);_.value={from:t,to:t}}function Le(){const t=new Date;t.setDate(t.getDate()-1);const a=k(t);_.value={from:a,to:a}}function Re(){_.value={from:String(c.value?.from||""),to:String(c.value?.to||"")}}function Ve(){B.value=!1}function Be(){const t=String(_.value?.from||""),a=String(_.value?.to||"");t&&a&&(c.value={from:t,to:a}),B.value=!1}function W(){if(typeof window>"u")return;const t=new URL(window.location.href);C.value?t.searchParams.set("campaign_id",String(C.value)):t.searchParams.delete("campaign_id"),c.value?.from&&c.value?.to?(t.searchParams.set("date_from",c.value.from),t.searchParams.set("date_to",c.value.to)):(t.searchParams.delete("date_from"),t.searchParams.delete("date_to")),window.history.replaceState({},"",t.toString())}function Ne(){if(typeof window>"u"){c.value=ie();return}const t=new URLSearchParams(window.location.search);C.value=t.get("campaign_id")?Number(t.get("campaign_id")):null;const a=t.get("date_from"),e=t.get("date_to"),n=r=>/^\d{4}-\d{2}-\d{2}$/.test(String(r||""));if(n(a)&&n(e)){c.value={from:a,to:e};return}c.value=ie()}function D(t){h.value=!0;const{page:a,rowsPerPage:e,sortBy:n,descending:r}=t.pagination;return R.get(route("panel.atividade.pageviews.data"),{params:{page:a,per_page:e,sortBy:n,descending:r,campaign_id:C.value,date_from:c.value?.from||void 0,date_to:c.value?.to||void 0}}).then(p=>{K.value=p.data.data,x.value=[],v.value={...v.value,page:p.data.current_page,rowsPerPage:p.data.per_page,rowsNumber:p.data.total,sortBy:n,descending:r}}).finally(()=>{h.value=!1})}async function Fe(t){if(!t)return;let a=!0;const e=typeof window<"u",n=e?window.$confirm:null;if(n?a=await n({title:"Excluir pageview",message:"Esta ação é permanente. Deseja realmente remover?",okLabel:"Remover",okColor:"negative"}):e&&(a=window.confirm("Excluir este pageview?")),!!a){h.value=!0;try{const{data:r}=await R.delete(route("panel.atividade.pageviews.destroy",t));if(r?.deleted===!1){b.notify({type:"warning",message:r?.message||"Pageview convertido não pode ser excluído."});return}b.notify({type:"positive",message:r?.message||"Pageview excluído com sucesso."}),await D({pagination:v.value})}catch{b.notify({type:"negative",message:"Falha ao excluir pageview."})}finally{h.value=!1}}}async function Qe(){if(!j.value)return;let t=!0;const a=typeof window<"u",e=a?window.$confirm:null,n=`Você selecionou ${x.value.length} registro(s). Deseja remover?`;if(e?t=await e({title:"Remover pageviews",message:n,okLabel:"Remover",okColor:"negative"}):a&&(t=window.confirm(n)),!!t){h.value=!0;try{const{data:r}=await R.delete(route("panel.atividade.pageviews.bulk-destroy"),{data:{ids:x.value.map(Ie=>Ie.id)}}),p=Number(r?.deleted||0),re=Number(r?.ignored_converted||0);p>0&&re>0?b.notify({type:"warning",message:`${p} removido(s). ${re} convertido(s) ignorado(s).`}):p>0?b.notify({type:"positive",message:r?.message||"Pageviews excluídos com sucesso."}):b.notify({type:"warning",message:r?.message||"Nenhum pageview elegível para exclusão."}),await D({pagination:v.value})}catch{b.notify({type:"negative",message:"Falha ao remover os pageviews selecionados."})}finally{h.value=!1}}}async function Te(t){O.value=!0,Y.value=!0,A.value=null;try{const a=await R.get(route("panel.atividade.pageviews.show",t.id));A.value=a.data}finally{Y.value=!1}}return de(C,()=>{z.value&&(v.value.page=1,W(),D({pagination:v.value}))}),de(()=>[c.value?.from,c.value?.to],()=>{z.value&&(v.value.page=1,W(),D({pagination:v.value}))}),We(()=>{Ne(),W(),z.value=!0,De(),D({pagination:v.value})}),(t,a)=>(f(),y(fe,null,[o(ue(Je),{title:"Relatório de atividade"}),o(He,{flat:"",bordered:"",class:"tw-rounded-2xl tw-p-4"},{default:l(()=>[i("div",at,[i("div",ot,[o(Ue,{ref_key:"tableRef",ref:me,modelValue:C.value,"onUpdate:modelValue":a[0]||(a[0]=e=>C.value=e),options:V.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"","use-input":"","fill-input":"","hide-selected":"","input-debounce":"0",clearable:"",dense:"",outlined:"","hide-bottom-space":"",class:"filter-field campaign-filter-field",label:"Filtrar por campanha",onFilter:Se},null,8,["modelValue","options"])]),i("div",lt,[o(qe,{dense:"",outlined:"",readonly:"",class:"filter-field",label:"Período","model-value":ve.value,placeholder:"Selecione um intervalo"},{prepend:l(()=>[o(U,{name:"event"})]),append:l(()=>[o(U,{name:"expand_more"})]),default:l(()=>[o(ze,{modelValue:B.value,"onUpdate:modelValue":a[6]||(a[6]=e=>B.value=e),anchor:"bottom left",self:"top left",offset:[0,6],"transition-show":"scale","transition-hide":"scale",onBeforeShow:Re},{default:l(()=>[i("div",nt,[i("div",it,[o(u,{flat:"","no-caps":"",dense:"",label:"Hoje",onClick:$e}),o(u,{flat:"","no-caps":"",dense:"",label:"Ontem",onClick:Le}),o(u,{flat:"","no-caps":"",dense:"",label:"Últimos 7 dias",onClick:a[1]||(a[1]=e=>M("last_7"))}),o(u,{flat:"","no-caps":"",dense:"",label:"Últimos 31 dias",onClick:a[2]||(a[2]=e=>M("last_31"))}),o(u,{flat:"","no-caps":"",dense:"",label:"Mês atual",onClick:a[3]||(a[3]=e=>M("month_current"))}),o(u,{flat:"","no-caps":"",dense:"",label:"Mês anterior",onClick:a[4]||(a[4]=e=>M("month_previous"))})]),o(Ee,{modelValue:_.value,"onUpdate:modelValue":a[5]||(a[5]=e=>_.value=e),range:"",mask:"YYYY-MM-DD",minimal:"",class:"period-date-picker"},null,8,["modelValue"])]),i("div",rt,[o(u,{flat:"","no-caps":"",label:"Cancelar",onClick:Ve}),o(u,{color:"primary","no-caps":"",label:"Aplicar",onClick:Be})])]),_:1},8,["modelValue"])]),_:1},8,["model-value"])]),i("div",st,[o(u,{dense:"",flat:"",round:"",icon:"view_column",color:"grey-7","aria-label":"Organizar colunas"},{default:l(()=>[o(S,null,{default:l(()=>[...a[11]||(a[11]=[w("Organizar colunas",-1)])]),_:1}),o(Oe,{anchor:"bottom right",self:"top right"},{default:l(()=>[o(Ye,{dense:"",style:{"min-width":"220px"}},{default:l(()=>[(f(),y(fe,null,Ke(F,e=>o(Ae,{key:e.name,clickable:"",onClick:n=>ee(e.name,!Z(e.name))},{default:l(()=>[o(se,{avatar:""},{default:l(()=>[o(je,{dense:"","model-value":Z(e.name),onClick:a[7]||(a[7]=Xe(()=>{},["stop"])),"onUpdate:modelValue":n=>ee(e.name,n)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024),o(se,null,{default:l(()=>[w(d(e.label),1)]),_:2},1024)]),_:2},1032,["onClick"])),64))]),_:1})]),_:1})]),_:1})]),i("div",ct,[o(u,{color:"negative",icon:"delete",disable:!j.value,onClick:Qe,class:"bulk-delete-btn",round:"",dense:"","aria-label":"Remover selecionados"},{default:l(()=>[o(S,{anchor:"center left",self:"center right",offset:[8,0]},{default:l(()=>[w(d(j.value?"Remover selecionados":"Selecione registros para remover"),1)]),_:1})]),_:1},8,["disable"])])]),o(Ge,{rows:K.value,columns:F,"visible-columns":Q.value,"row-key":"id",loading:h.value,pagination:v.value,"onUpdate:pagination":a[8]||(a[8]=e=>v.value=e),"binary-state-sort":!0,"rows-per-page-options":[10,15,20,25,50],onRequest:D,selection:"multiple",selected:x.value,"onUpdate:selected":a[9]||(a[9]=e=>x.value=e)},{"body-cell-created_at":l(e=>[o(m,{props:e},{default:l(()=>[w(d(e.value),1)]),_:2},1032,["props"])]),"body-cell-ip":l(e=>[o(m,{props:e},{default:l(()=>[i("div",dt,[i("span",{class:"tw-inline-flex tw-h-3 tw-w-3 tw-rounded-full tw-border tw-border-white/20 tw-shadow-sm",style:J({backgroundColor:te(e.row).color})},[o(S,{class:"tw-text-xs tw-max-w-xs tw-leading-snug"},{default:l(()=>[w(d(te(e.row).description),1)]),_:2},1024)],4),i("span",null,d(e.value||"-"),1),e.value?(f(),P(u,{key:0,dense:"",flat:"",round:"",size:"sm",icon:"content_copy",color:"primary",onClick:n=>ke(e.value,"IP")},{default:l(()=>[o(S,{anchor:"center right",self:"center left",offset:[8,0]},{default:l(()=>[...a[12]||(a[12]=[w(" Copiar IP ",-1)])]),_:1})]),_:1},8,["onClick"])):L("",!0)])]),_:2},1032,["props"])]),"body-cell-campaign_name":l(e=>[o(m,{props:e},{default:l(()=>[i("div",ut,[i("div",{class:Ze(["campaign-name-truncate",{"campaign-name-truncate--fade":le(e.value)&&!I(e.row),"campaign-name-truncate--expanded":I(e.row)}])},d(e.value||"-"),3),le(e.value)?(f(),P(u,{key:0,dense:"",flat:"",round:"",size:"sm",icon:I(e.row)?"visibility_off":"visibility",color:"grey-6",class:"campaign-name-eye-btn",onClick:n=>xe(e.row)},{default:l(()=>[o(S,null,{default:l(()=>[w(d(I(e.row)?"Recolher nome":"Ver nome completo"),1)]),_:2},1024)]),_:2},1032,["icon","onClick"])):L("",!0)])]),_:2},1032,["props"])]),"body-cell-visitor":l(e=>[o(m,{props:e,class:"tw-text-center"},{default:l(()=>[o($,{rounded:"",color:ye(e.row),"text-color":he(e.row),class:"visitor-badge"},{default:l(()=>[w(d(_e(e.row))+" ",1),o(S,null,{default:l(()=>[w(d(Ce(e.row)),1)]),_:2},1024)]),_:2},1032,["color","text-color"])]),_:2},1032,["props"])]),"body-cell-traffic_source":l(e=>[o(m,{props:e},{default:l(()=>[i("div",ft,[o(U,{name:G(e.row).icon,size:"18px",color:"primary",style:J({color:G(e.row).color})},null,8,["name","style"]),i("span",null,d(G(e.row).label),1)])]),_:2},1032,["props"])]),"body-cell-device_browser":l(e=>[o(m,{props:e},{default:l(()=>[i("div",mt,[H(e.row)?(f(),y("div",vt,[o(U,{name:g(e.row).deviceIcon,size:"18px",style:J({color:g(e.row).deviceColor})},null,8,["name","style"]),i("span",null,d(g(e.row).deviceLabel),1)])):g(e.row).browserLabel==="-"?(f(),y("span",gt,"-")):(f(),y("span",wt,d(g(e.row).browserLabel),1)),H(e.row)&&g(e.row).browserLabel&&g(e.row).browserLabel!=="-"?(f(),y("span",pt," • ")):L("",!0),H(e.row)&&g(e.row).browserLabel&&g(e.row).browserLabel!=="-"?(f(),y("div",bt,[i("span",null,d(g(e.row).browserLabel),1)])):L("",!0)])]),_:2},1032,["props"])]),"body-cell-country_code":l(e=>[o(m,{props:e},{default:l(()=>[i("div",_t,[ae(e.row)?(f(),y("img",{key:0,src:ae(e.row),alt:e.value,class:"country-flag"},null,8,yt)):L("",!0),i("span",null,d(e.value?e.value.toUpperCase():"-"),1)])]),_:2},1032,["props"])]),"body-cell-region_name":l(e=>[o(m,{props:e},{default:l(()=>[w(d(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-city":l(e=>[o(m,{props:e},{default:l(()=>[w(d(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-gclid":l(e=>[o(m,{props:e},{default:l(()=>[pe(e.value)?(f(),P($,{key:0,color:"primary",label:"Sim"})):(f(),P($,{key:1,color:"grey-4","text-color":"dark",label:"Não"}))]),_:2},1032,["props"])]),"body-cell-conversion":l(e=>[o(m,{props:e},{default:l(()=>[we(e.value)?(f(),P($,{key:0,color:"green",label:"Convertido"})):(f(),P($,{key:1,color:"grey-4","text-color":"dark",label:"Não convertido"}))]),_:2},1032,["props"])]),"body-cell-details":l(e=>[o(m,{props:e},{default:l(()=>[o(u,{dense:"",flat:"",round:"",size:"sm",icon:"manage_search",color:"primary",onClick:n=>Te(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-actions":l(e=>[o(m,{props:e,class:"tw-text-right"},{default:l(()=>[o(u,{dense:"",flat:"",icon:"delete",size:"sm",class:"qtable-delete-btn",onClick:n=>Fe(e.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","visible-columns","loading","pagination","selected"])]),_:1}),o(et,{modelValue:O.value,"onUpdate:modelValue":a[10]||(a[10]=e=>O.value=e),loading:Y.value,payload:A.value,"asset-base-url":ue(X)},null,8,["modelValue","loading","payload","asset-base-url"])],64))}},Pt=tt(ht,[["__scopeId","data-v-24cb11a8"]]);export{Pt as default};
