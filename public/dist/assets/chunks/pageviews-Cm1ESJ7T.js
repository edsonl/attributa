import{C as ae,A as le,B as r,h as R,k as h,r as F,s as G,E as se,Q as oe,a as ie,b as ne,v as re}from"./vendor-quasar-CQUzQrOh.js";import{r as u,f as c,w as de,e as ue,G as x,H as n,E as i,u as ce,P as we,D as s,Q as t,C as p,M as g,N as o,O as pe,L as T,I as S,J as D,V as L}from"./vendor-D8nj3W7R.js";import{_ as me}from"../app-BY3tkQLW.js";const ge={class:"row q-mb-md items-center"},ve={class:"col-12 col-md-4"},fe={class:"tw-flex tw-items-center tw-gap-2"},ye={class:"tw-text-sm tw-font-medium"},xe={class:"tw-grid md:tw-grid-cols-2 lg:tw-grid-cols-3 tw-gap-3 tw-mt-2"},_e={class:"tw-text-sm tw-font-medium"},be={class:"tw-text-sm tw-font-medium"},ke={class:"tw-text-sm tw-font-medium tw-break-all"},Ce={class:"tw-text-sm tw-font-medium"},Pe={class:"tw-text-sm tw-font-medium"},he={class:"tw-text-sm tw-font-medium"},Se={class:"tw-grid md:tw-grid-cols-2 lg:tw-grid-cols-3 tw-gap-3 tw-mt-2"},Le={class:"tw-text-xs tw-uppercase tw-text-slate-500"},Ne={class:"tw-text-sm tw-font-medium"},Re={class:"tw-mt-2"},De={class:"tw-text-xs tw-uppercase tw-text-slate-500"},Ie={class:"tw-text-sm tw-font-medium tw-break-all"},Qe={key:1,class:"tw-text-sm tw-text-slate-500"},Ae={class:"tw-grid md:tw-grid-cols-2 lg:tw-grid-cols-3 tw-gap-3 tw-mt-2"},Ve={class:"tw-text-sm tw-font-medium"},Be={class:"tw-text-sm tw-font-medium"},Ee={class:"tw-text-sm tw-font-medium"},Ue={class:"tw-text-sm tw-font-medium"},Oe={class:"tw-text-sm tw-font-medium"},Fe={class:"tw-grid md:tw-grid-cols-2 lg:tw-grid-cols-3 tw-gap-3 tw-mt-4"},Ge={class:"tw-text-xs tw-uppercase tw-text-slate-500"},Te={class:"tw-text-sm tw-font-medium"},$e={__name:"Pageviews",setup(ze){const I=u([]),f=u(!1),$=u(null),w=u({page:1,rowsPerPage:20,rowsNumber:0,sortBy:"created_at",descending:!0}),_=u(null),Q=u([]),A={label:"Não determinado",color:"#FCE7F3"},b=u(!1),k=u(!1),v=u(null),y=c(()=>v.value?.pageview??{}),V=c(()=>v.value?.url??{full:null,origin:null,path:null,query_params:{}}),z=c(()=>v.value?.geo??{}),m=c(()=>v.value?.network??{}),B=c(()=>{const l=V.value?.query_params??{};return Object.entries(l)}),j=c(()=>B.value.length>0),q=c(()=>y.value?.campaign?.name??"-"),M=c(()=>m.value?.flags??{}),H=c(()=>m.value?.ip_category?.name??"-"),J=[{name:"created_at",label:"Data",field:"created_at",sortable:!0,align:"left"},{name:"ip_category",label:"Classificação IP",field:l=>l?.ip_category_name,sortable:!0,align:"left"},{name:"ip",label:"IP",field:"ip",sortable:!0,align:"left"},{name:"campaign_name",label:"Campanha",field:"campaign_name",sortable:!0,align:"left"},{name:"country_code",label:"País",field:"country_code",sortable:!0,align:"left"},{name:"region_name",label:"Região",field:"region_name",sortable:!0,align:"left"},{name:"city",label:"Cidade",field:"city",sortable:!0,align:"left"},{name:"gclid",label:"GCLID",field:"gclid",sortable:!0,align:"left"},{name:"conversion",label:"Conversão",field:"conversion",sortable:!0,align:"left"},{name:"details",label:"Detalhes",field:"id",align:"center"},{name:"actions",label:"Ações",field:"id",align:"right"}];function N(l){return l?new Date(l).toLocaleString("pt-BR",{dateStyle:"short",timeStyle:"medium"}):"-"}function K(l){if(!l)return"-";try{const a=typeof window<"u"?window.location.origin:"https://placeholder.local",e=new URL(l,a);return`${e.origin}${e.pathname}`}catch{return l.split("?")[0]??l}}function E(l){return{label:l?.ip_category_name??A.label,color:l?.ip_category_color??A.color}}function W(l){return l==null?!1:String(l).trim().length>0}function U(l){return l===!0||l===1||l==="1"}function Y(l){return l==null?"-":l?"Sim":"Não"}function Z(l){if(l==null)return"-";if(Array.isArray(l)||typeof l=="object")try{return JSON.stringify(l)}catch{return String(l)}return String(l)}function X(){L.get(route("panel.atividade.campaigns")).then(l=>{Q.value=l.data})}function C(l){f.value=!0;const{page:a,rowsPerPage:e,sortBy:d,descending:O}=l.pagination;return L.get(route("panel.atividade.pageviews.data"),{params:{page:a,per_page:e,sortBy:d,descending:O,campaign_id:_.value}}).then(P=>{I.value=P.data.data,w.value={...w.value,page:P.data.current_page,rowsPerPage:P.data.per_page,rowsNumber:P.data.total,sortBy:d,descending:O}}).finally(()=>{f.value=!1})}async function ee(l){if(!l)return;let a=!0;const e=typeof window<"u",d=e?window.$confirm:null;if(d?a=await d({title:"Excluir pageview",message:"Esta ação é permanente. Deseja realmente remover?",okLabel:"Remover",okColor:"negative"}):e&&(a=window.confirm("Excluir este pageview?")),!!a){f.value=!0;try{await L.delete(route("panel.atividade.pageviews.destroy",l)),await C({pagination:w.value})}finally{f.value=!1}}}async function te(l){b.value=!0,k.value=!0,v.value=null;try{const a=await L.get(route("panel.atividade.pageviews.show",l.id));v.value=a.data}finally{k.value=!1}}return de(_,()=>{w.value.page=1,C({pagination:w.value})}),ue(()=>{X(),C({pagination:w.value})}),(l,a)=>(n(),x(S,null,[i(ce(we),{title:"Relatório de atividade"}),i(F,{flat:"",bordered:"",class:"tw-rounded-2xl tw-p-4"},{default:s(()=>[t("div",ge,[t("div",ve,[i(ae,{ref_key:"tableRef",ref:$,modelValue:_.value,"onUpdate:modelValue":a[0]||(a[0]=e=>_.value=e),options:Q.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",clearable:"",label:"Filtrar por campanha"},null,8,["modelValue","options"])])]),i(le,{rows:I.value,columns:J,"row-key":"id",loading:f.value,pagination:w.value,"onUpdate:pagination":a[1]||(a[1]=e=>w.value=e),"binary-state-sort":!0,onRequest:C},{"body-cell-created_at":s(e=>[i(r,{props:e},{default:s(()=>[g(o(N(e.value)),1)]),_:2},1032,["props"])]),"body-cell-ip_category":s(e=>[i(r,{props:e},{default:s(()=>[t("div",fe,[t("span",{class:"tw-inline-flex tw-h-3 tw-w-3 tw-rounded-full tw-border tw-border-white/20 tw-shadow-sm",style:pe({backgroundColor:E(e.row).color})},null,4),t("span",ye,o(E(e.row).label),1)])]),_:2},1032,["props"])]),"body-cell-ip":s(e=>[i(r,{props:e},{default:s(()=>[g(o(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-campaign_name":s(e=>[i(r,{props:e},{default:s(()=>[g(o(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-country_code":s(e=>[i(r,{props:e},{default:s(()=>[g(o(e.value?e.value.toUpperCase():"-"),1)]),_:2},1032,["props"])]),"body-cell-region_name":s(e=>[i(r,{props:e},{default:s(()=>[g(o(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-city":s(e=>[i(r,{props:e},{default:s(()=>[g(o(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-url":s(e=>[i(r,{props:e},{default:s(()=>[g(o(K(e.value)),1)]),_:2},1032,["props"])]),"body-cell-gclid":s(e=>[i(r,{props:e},{default:s(()=>[W(e.value)?(n(),p(h,{key:0,color:"primary",label:"Sim"})):(n(),p(h,{key:1,color:"grey-4","text-color":"dark",label:"Não"}))]),_:2},1032,["props"])]),"body-cell-conversion":s(e=>[i(r,{props:e},{default:s(()=>[U(e.value)?(n(),p(h,{key:0,color:"green",label:"Convertido"})):(n(),p(h,{key:1,color:"grey-4","text-color":"dark",label:"Não convertido"}))]),_:2},1032,["props"])]),"body-cell-details":s(e=>[i(r,{props:e},{default:s(()=>[i(R,{dense:"",flat:"",round:"",size:"sm",icon:"manage_search",color:"primary",onClick:d=>te(e.row)},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-actions":s(e=>[i(r,{props:e,class:"tw-text-right"},{default:s(()=>[i(R,{dense:"",flat:"",icon:"delete",color:"negative",onClick:d=>ee(e.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])]),_:1}),i(re,{modelValue:b.value,"onUpdate:modelValue":a[3]||(a[3]=e=>b.value=e),"transition-show":"scale","transition-hide":"scale"},{default:s(()=>[i(F,{class:"pageview-detail-card"},{default:s(()=>[i(G,{class:"tw-flex tw-justify-end"},{default:s(()=>[i(R,{icon:"close",flat:"",round:"",dense:"",onClick:a[2]||(a[2]=e=>b.value=!1)})]),_:1}),k.value?(n(),p(se,{key:0,indeterminate:"",color:"primary"})):T("",!0),k.value?T("",!0):(n(),p(G,{key:1,class:"tw-space-y-6"},{default:s(()=>[t("section",null,[a[10]||(a[10]=t("div",{class:"tw-inline-flex tw-items-center tw-rounded-full tw-bg-slate-100 tw-px-3 tw-py-1 tw-text-[11px] tw-font-semibold tw-tracking-wide tw-text-slate-600 tw-uppercase"},"VISITA",-1)),t("div",xe,[t("div",null,[a[4]||(a[4]=t("div",{class:"tw-text-xs tw-uppercase tw-text-slate-500"},"Data/Horário",-1)),t("div",_e,o(N(y.value.created_at)),1)]),t("div",null,[a[5]||(a[5]=t("div",{class:"tw-text-xs tw-uppercase tw-text-slate-500"},"Campanha",-1)),t("div",be,o(q.value),1)]),t("div",null,[a[6]||(a[6]=t("div",{class:"tw-text-xs tw-uppercase tw-text-slate-500"},"URL completa",-1)),t("div",ke,o(V.value.full||"-"),1)]),t("div",null,[a[7]||(a[7]=t("div",{class:"tw-text-xs tw-uppercase tw-text-slate-500"},"IP",-1)),t("div",Ce,o(y.value.ip||"-"),1)]),t("div",null,[a[8]||(a[8]=t("div",{class:"tw-text-xs tw-uppercase tw-text-slate-500"},"GCLID",-1)),t("div",Pe,o(y.value.gclid||"-"),1)]),t("div",null,[a[9]||(a[9]=t("div",{class:"tw-text-xs tw-uppercase tw-text-slate-500"},"Conversão",-1)),t("div",he,o(U(y.value.conversion)?"Sim":"Não"),1)])])]),t("section",null,[a[11]||(a[11]=t("div",{class:"tw-inline-flex tw-items-center tw-rounded-full tw-bg-slate-100 tw-px-3 tw-py-1 tw-text-[11px] tw-font-semibold tw-tracking-wide tw-text-slate-600 tw-uppercase"},"GEOLOCALIZAÇÃO",-1)),t("div",Se,[(n(),x(S,null,D([{label:"País",key:"country_name"},{label:"Código",key:"country_code"},{label:"Região",key:"region_name"},{label:"Cidade",key:"city"},{label:"Latitude",key:"latitude"},{label:"Longitude",key:"longitude"},{label:"Timezone",key:"timezone"}],e=>t("div",{key:e.key},[t("div",Le,o(e.label),1),t("div",Ne,o(z.value[e.key]??"-"),1)])),64))])]),t("section",null,[a[12]||(a[12]=t("div",{class:"tw-inline-flex tw-items-center tw-rounded-full tw-bg-slate-100 tw-px-3 tw-py-1 tw-text-[11px] tw-font-semibold tw-tracking-wide tw-text-slate-600 tw-uppercase"},"PARÂMETROS DA URL",-1)),t("div",Re,[j.value?(n(),p(oe,{key:0,bordered:"",class:"rounded-borders"},{default:s(()=>[(n(!0),x(S,null,D(B.value,([e,d])=>(n(),p(ie,{key:`${e}-${d}`},{default:s(()=>[i(ne,null,{default:s(()=>[t("div",De,o(e),1),t("div",Ie,o(Z(d)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(n(),x("div",Qe,"Sem parâmetros na URL."))])]),t("section",null,[a[18]||(a[18]=t("div",{class:"tw-inline-flex tw-items-center tw-rounded-full tw-bg-slate-100 tw-px-3 tw-py-1 tw-text-[11px] tw-font-semibold tw-tracking-wide tw-text-slate-600 tw-uppercase"},"REDE & SEGURANÇA",-1)),t("div",Ae,[t("div",null,[a[13]||(a[13]=t("div",{class:"tw-text-xs tw-uppercase tw-text-slate-500"},"ISP",-1)),t("div",Ve,o(m.value.isp||"-"),1)]),t("div",null,[a[14]||(a[14]=t("div",{class:"tw-text-xs tw-uppercase tw-text-slate-500"},"Organização",-1)),t("div",Be,o(m.value.organization||"-"),1)]),t("div",null,[a[15]||(a[15]=t("div",{class:"tw-text-xs tw-uppercase tw-text-slate-500"},"Categoria IP (Lookup)",-1)),t("div",Ee,o(H.value),1)]),t("div",null,[a[16]||(a[16]=t("div",{class:"tw-text-xs tw-uppercase tw-text-slate-500"},"Fraud Score",-1)),t("div",Ue,o(m.value.fraud_score??"-"),1)]),t("div",null,[a[17]||(a[17]=t("div",{class:"tw-text-xs tw-uppercase tw-text-slate-500"},"Última verificação",-1)),t("div",Oe,o(m.value.last_checked?N(m.value.last_checked):"-"),1)])]),t("div",Fe,[(n(),x(S,null,D([{key:"is_proxy",label:"Proxy"},{key:"is_vpn",label:"VPN"},{key:"is_tor",label:"Tor"},{key:"is_datacenter",label:"Datacenter"},{key:"is_bot",label:"Bot"}],e=>t("div",{key:e.key},[t("div",Ge,o(e.label),1),t("div",Te,o(Y(M.value[e.key])),1)])),64))])])]),_:1}))]),_:1})]),_:1},8,["modelValue"])],64))}},He=me($e,[["__scopeId","data-v-4b5dbd09"]]);export{He as default};
