import{x as S,C as g,h as s,E as $,r as H,s as A,F as B,i as Q,t as M,v as W,N as h}from"./vendor-quasar-CLzIisyG.js";import{f as v,r as i,w as z,_ as J,G as N,H as x,Q as _,E as r,C as K,L as U,u as a,S as X,$ as Y,D as u,j,N as Z,I as ee,V as ae}from"./vendor-D8nj3W7R.js";const oe={class:"tw-flex tw-justify-end tw-gap-2"},te={key:0,class:"tw-text-center tw-py-6"},ne={__name:"FormCampaign",props:{campaign:{type:Object,default:null},channels:{type:Array,required:!0},countries:{type:Array,required:!0},affiliate_platforms:{type:Array,required:!0},googleAdsAccounts:{type:Array,required:!0},defaults:{type:Object,default:()=>({})}},setup(y){const l=y,D=v(()=>!!l.campaign),d=i(l.countries??[]),c=i([...l.countries??[]]),w=i(null),E=v(()=>(l.channels??[]).map(o=>({...o,value:o.id,label:o.label??o.name}))),F=v(()=>(l.affiliate_platforms??[]).map(o=>({...o,value:o.id,label:o.label??o.name})));z(()=>l.countries,(o=[])=>{d.value=o,c.value=[...o]});const e=J({name:l.campaign?.name??"",pixel_code:l.campaign?.pixel_code??"",status:l.campaign?.status??!0,channel_id:l.campaign?.channel_id??l.defaults?.channel_id??null,affiliate_platform_id:l.campaign?.affiliate_platform_id??l.defaults?.affiliate_platform_id??null,google_ads_account_id:l.campaign?.google_ads_account_id??null,countries:l.campaign?.countries?l.campaign.countries.map(o=>o.id):[],commission_value:l.campaign?.commission_value??null}),k=v(()=>{if(e.errors.countries)return e.errors.countries;const o=Object.entries(e.errors).find(([t])=>t.startsWith("countries."));return o?o[1]:null});function L(){D.value?e.put(route("panel.campaigns.update",l.campaign.id)):e.post(route("panel.campaigns.store"))}function O(o,t,n){if(!d.value.length)return n();const f=(o||"").trim().toLowerCase();t(()=>{if(!f){c.value=[...d.value];return}c.value=d.value.filter(C=>{const R=(C.name||"").toLowerCase(),G=(C.iso2||"").toLowerCase(),I=(C.iso3||"").toLowerCase();return R.includes(f)||G.includes(f)||I.includes(f)})})}function P(){w.value?.hidePopup&&w.value.hidePopup()}const b=i(!1),V=i(!1),m=i(""),p=i(null);async function T(){if(l.campaign?.id){b.value=!0,V.value=!0,m.value="";try{const o=await ae.get(route("panel.campaigns.tracking_code",l.campaign.id));m.value=String(o.data.script||"").trim()}catch{h.create({type:"negative",message:"Não foi possível carregar o código de acompanhamento",position:"top-right"})}finally{V.value=!1}}}function q(){if(p.value){p.value.focus(),p.value.select();try{if(!document.execCommand("copy"))throw new Error;h.create({type:"positive",message:"Código copiado",timeout:2e3,position:"top-right"})}catch{h.create({type:"negative",message:"Não foi possível copiar o código",timeout:3e3,position:"top-right"})}}}return(o,t)=>(x(),N(ee,null,[_("form",{onSubmit:Y(L,["prevent"]),class:"tw-space-y-6"},[r(S,{modelValue:a(e).name,"onUpdate:modelValue":t[0]||(t[0]=n=>a(e).name=n),label:"Nome da campanha",outlined:"",dense:"",error:!!a(e).errors.name,"error-message":a(e).errors.name},null,8,["modelValue","error","error-message"]),r(g,{modelValue:a(e).channel_id,"onUpdate:modelValue":t[1]||(t[1]=n=>a(e).channel_id=n),options:E.value,"option-label":"label","option-value":"value","emit-value":"","map-options":"",label:"Canal",outlined:"",dense:"",error:!!a(e).errors.channel_id,"error-message":a(e).errors.channel_id},null,8,["modelValue","options","error","error-message"]),r(g,{modelValue:a(e).affiliate_platform_id,"onUpdate:modelValue":t[2]||(t[2]=n=>a(e).affiliate_platform_id=n),options:F.value,"option-label":"label","option-value":"value","emit-value":"","map-options":"",label:"Plataforma de Afiliado",outlined:"",dense:"",error:!!a(e).errors.affiliate_platform_id,"error-message":a(e).errors.affiliate_platform_id},null,8,["modelValue","options","error","error-message"]),r(g,{ref_key:"countrySelectRef",ref:w,label:"Regiões de segmentação (países)",modelValue:a(e).countries,"onUpdate:modelValue":[t[3]||(t[3]=n=>a(e).countries=n),P],options:c.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",multiple:"","use-chips":"","use-input":"",onFilter:O,outlined:"",dense:"",error:!!k.value,"error-message":k.value},null,8,["modelValue","options","error","error-message"]),r(g,{modelValue:a(e).google_ads_account_id,"onUpdate:modelValue":t[4]||(t[4]=n=>a(e).google_ads_account_id=n),options:y.googleAdsAccounts,"option-value":"id","option-label":"label","emit-value":"","map-options":"",clearable:"",label:"Conta de Anúncios",hint:"Selecione a conta do Google Ads desta campanha",error:!!a(e).errors.google_ads_account_id,"error-message":a(e).errors.google_ads_account_id},null,8,["modelValue","options","error","error-message"]),r(S,{modelValue:a(e).pixel_code,"onUpdate:modelValue":t[5]||(t[5]=n=>a(e).pixel_code=n),label:"Pixel de acompanhamento",outlined:"",dense:"",error:!!a(e).errors.pixel_code,"error-message":a(e).errors.pixel_code},null,8,["modelValue","error","error-message"]),y.campaign?(x(),K(s,{key:0,flat:"",icon:"code",color:"primary",label:"Ver código de acompanhamento",onClick:T})):U("",!0),r($,{modelValue:a(e).status,"onUpdate:modelValue":t[6]||(t[6]=n=>a(e).status=n),label:"Campanha ativa"},null,8,["modelValue"]),_("div",oe,[r(s,{flat:"",label:"Cancelar",onClick:t[7]||(t[7]=n=>a(X).visit(o.route("panel.campaigns.index")))}),r(s,{color:"primary",label:"Salvar",type:"submit"})])],32),r(W,{modelValue:b.value,"onUpdate:modelValue":t[8]||(t[8]=n=>b.value=n)},{default:u(()=>[r(H,{style:{"min-width":"720px","max-width":"95vw","min-height":"450px"}},{default:u(()=>[r(A,{class:"tw-flex tw-justify-between tw-items-center"},{default:u(()=>[t[9]||(t[9]=_("div",{class:"tw-text-lg tw-font-semibold"}," Código de acompanhamento ",-1)),j(r(s,{flat:"",dense:"",icon:"close"},null,512),[[B]])]),_:1}),r(Q),r(A,null,{default:u(()=>[V.value?(x(),N("div",te," Carregando... ")):U("",!0),_("textarea",{ref_key:"trackingTextarea",ref:p,class:"tw-w-full tw-h-72 tw-font-mono tw-text-sm tw-p-3 tw-bg-gray-100 tw-rounded",readonly:""},Z(m.value),513)]),_:1}),r(Q),r(M,{align:"right"},{default:u(()=>[r(s,{flat:"",icon:"content_copy",label:"Copiar",disable:!m.value,onClick:q},null,8,["disable"]),j(r(s,{color:"primary",label:"Fechar"},null,512),[[B]])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}};export{ne as default};
