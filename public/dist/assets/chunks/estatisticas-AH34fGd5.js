import{C as le,x as ne,J as re,h as _,K as se,c as h,A as ie,B as u,k as P,n as ce,r as de}from"./vendor-quasar-DQshVSCQ.js";import{r as f,f as ue,w as Y,e as fe,E as p,F as c,C as o,u as me,O as ge,B as l,P as n,A as x,L as D,M as d,J as $,N as B,G as we,U as z}from"./vendor-auwb9AcH.js";import{_ as ve}from"../app-DqTThPGM.js";const _e={class:"row q-mb-md items-center q-col-gutter-md"},pe={class:"col-12 col-sm-8 col-md-3 q-mb-sm q-mb-md-0"},be={class:"col-12 col-sm-6 col-md-2 q-mb-sm q-mb-md-0"},ye={class:"tw-grid tw-grid-cols-1 md:tw-grid-cols-[150px_1fr] tw-gap-3 tw-p-3"},he={class:"tw-flex tw-flex-col tw-gap-2"},xe={class:"tw-flex tw-justify-end tw-gap-2 tw-px-3 tw-pb-3"},De={class:"tw-flex tw-items-center tw-gap-2 tw-flex-wrap"},Ce={class:"tw-text-slate-600"},ke={class:"tw-flex tw-items-center tw-gap-2"},Se={class:"tw-flex tw-items-center tw-gap-2 tw-flex-wrap"},Pe={key:0,class:"tw-inline-flex tw-items-center tw-gap-1"},$e={key:1},Be={key:2},Le={key:3,class:"tw-text-slate-400"},Re={key:4,class:"tw-inline-flex tw-items-center tw-gap-1"},Ie={class:"tw-flex tw-items-center tw-gap-2"},Te=["src","alt"],Ve={__name:"Estatisticas",setup(Fe){const M=f([]),L=f(!1),A=f(null),m=f({page:1,rowsPerPage:20,rowsNumber:0,sortBy:"created_at",descending:!0}),w=f(null),N=f([]),r=f({from:"",to:""}),v=f({from:"",to:""}),C=f(!1),R=f(!1),j=ue(()=>{const t=String(r.value?.from||""),a=String(r.value?.to||"");return!t||!a?"":`${q(t)}  -  ${q(a)}`}),G="https://attributa.master.dev.br".replace(/\/$/,""),O=[{name:"created_at",label:"Data",field:"created_at_formatted",sortable:!0,align:"left"},{name:"ip",label:"Classificação / IP",field:"ip",sortable:!0,align:"left"},{name:"campaign_name",label:"Campanha",field:"campaign_name",sortable:!0,align:"left"},{name:"traffic_source",label:"Origem do Tráfego",field:"traffic_source_name",sortable:!0,align:"left"},{name:"device_browser",label:"Dispositivo/Navegador",field:t=>K(t),sortable:!0,align:"left"},{name:"country_code",label:"País",field:"country_code",sortable:!0,align:"left"},{name:"region_name",label:"Região",field:"region_name",sortable:!0,align:"left"},{name:"city",label:"Cidade",field:"city",sortable:!0,align:"left"},{name:"gclid",label:"GCLID",field:"has_gclid",sortable:!0,align:"left"},{name:"conversion",label:"Conversão",field:"conversion",sortable:!0,align:"left"}];function U(t){const a=t?.country_code;if(!a)return null;const e=String(a).toLowerCase();return`${G}/assets/country-flags/${e}.svg`}function J(t){return t===!0||t===1||t==="1"}function H(t){return t===!0||t===1||t==="1"?!0:typeof t=="string"?t.trim().length>0&&t!=="0":!1}function Q(t){const a=String(t||"").trim();return a?a.split(/[_\s-]+/).filter(Boolean).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "):"-"}function K(t){const a=Q(t?.device_type),e=String(t?.browser_name||"").trim()||"-";return a==="-"&&e==="-"?"-":a==="-"?e:e==="-"?a:`${a} • ${e}`}function I(t){return{label:t?.traffic_source_name??"-",icon:t?.traffic_source_icon||"help_outline",color:t?.traffic_source_color||"#64748B"}}function T(t){return{label:t?.ip_category_name??"Não determinado",color:t?.ip_category_color??"#FCE7F3",description:t?.ip_category_description??"Categoria ainda não determinada."}}function s(t){return{deviceLabel:Q(t?.device_type),deviceIcon:t?.device_icon||"devices_other",deviceColor:t?.device_color||"#64748B",browserLabel:String(t?.browser_name||"").trim()||"-",browserIcon:t?.browser_icon||null,browserColor:t?.browser_color||"#64748B"}}function V(t){return s(t).deviceLabel!=="-"}function W(){z.get(route("panel.estatisticas.campaigns")).then(t=>{N.value=t.data})}function y(t){const a=new Date(t),e=a.getFullYear(),i=String(a.getMonth()+1).padStart(2,"0"),g=String(a.getDate()).padStart(2,"0");return`${e}-${i}-${g}`}function q(t){if(!t||!/^\d{4}-\d{2}-\d{2}$/.test(String(t||"")))return"";const[a,e,i]=t.split("-");return`${i}.${e}.${a}`}function E(){const t=new Date,a=new Date;return a.setDate(t.getDate()-6),{from:y(a),to:y(t)}}function X(t){const a=new Date,e=new Date(a),i=new Date(a);if(t==="last_7")e.setDate(a.getDate()-6);else if(t==="last_31")e.setDate(a.getDate()-30);else if(t==="month_current")e.setDate(1);else if(t==="month_previous"){const g=new Date(a.getFullYear(),a.getMonth()-1,1),b=new Date(a.getFullYear(),a.getMonth(),0);e.setTime(g.getTime()),i.setTime(b.getTime())}return{from:y(e),to:y(i)}}function k(t){v.value=X(t)}function Z(){const t=y(new Date);v.value={from:t,to:t}}function ee(){v.value={from:String(r.value?.from||""),to:String(r.value?.to||"")}}function te(){C.value=!1}function ae(){const t=String(v.value?.from||""),a=String(v.value?.to||"");t&&a&&(r.value={from:t,to:a}),C.value=!1}function F(){if(typeof window>"u")return;const t=new URL(window.location.href);w.value?t.searchParams.set("campaign_id",String(w.value)):t.searchParams.delete("campaign_id"),r.value?.from&&r.value?.to?(t.searchParams.set("date_from",r.value.from),t.searchParams.set("date_to",r.value.to)):(t.searchParams.delete("date_from"),t.searchParams.delete("date_to")),window.history.replaceState({},"",t.toString())}function oe(){if(typeof window>"u"){r.value=E();return}const t=new URLSearchParams(window.location.search);w.value=t.get("campaign_id")?Number(t.get("campaign_id")):null;const a=t.get("date_from"),e=t.get("date_to"),i=g=>/^\d{4}-\d{2}-\d{2}$/.test(String(g||""));if(i(a)&&i(e)){r.value={from:a,to:e};return}r.value=E()}function S(t){L.value=!0;const{page:a,rowsPerPage:e,sortBy:i,descending:g}=t.pagination;return z.get(route("panel.estatisticas.data"),{params:{page:a,per_page:e,sortBy:i,descending:g,campaign_id:w.value,date_from:r.value?.from||void 0,date_to:r.value?.to||void 0}}).then(b=>{M.value=b.data.data,m.value={...m.value,page:b.data.current_page,rowsPerPage:b.data.per_page,rowsNumber:b.data.total,sortBy:i,descending:g}}).finally(()=>{L.value=!1})}return Y(w,()=>{R.value&&(m.value.page=1,F(),S({pagination:m.value}))}),Y(()=>[r.value?.from,r.value?.to],()=>{R.value&&(m.value.page=1,F(),S({pagination:m.value}))}),fe(()=>{oe(),F(),R.value=!0,W(),S({pagination:m.value})}),(t,a)=>(c(),p(we,null,[o(me(ge),{title:"Estatísticas"}),o(de,{flat:"",bordered:"",class:"tw-rounded-2xl tw-p-4"},{default:l(()=>[n("div",_e,[n("div",pe,[o(le,{ref_key:"tableRef",ref:A,modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=e=>w.value=e),options:N.value,"option-label":"name","option-value":"id","emit-value":"","map-options":"",clearable:"",dense:"",outlined:"",class:"filter-field campaign-filter-field",label:"Filtrar por campanha"},null,8,["modelValue","options"])]),n("div",be,[o(ne,{dense:"",outlined:"",readonly:"",class:"filter-field",label:"Período","model-value":j.value,placeholder:"Selecione um intervalo"},{prepend:l(()=>[o(h,{name:"event"})]),append:l(()=>[o(h,{name:"expand_more"})]),default:l(()=>[o(re,{modelValue:C.value,"onUpdate:modelValue":a[6]||(a[6]=e=>C.value=e),anchor:"bottom left",self:"top left",offset:[0,6],"transition-show":"scale","transition-hide":"scale",onBeforeShow:ee},{default:l(()=>[n("div",ye,[n("div",he,[o(_,{flat:"","no-caps":"",dense:"",label:"Hoje",onClick:Z}),o(_,{flat:"","no-caps":"",dense:"",label:"Últimos 7 dias",onClick:a[1]||(a[1]=e=>k("last_7"))}),o(_,{flat:"","no-caps":"",dense:"",label:"Últimos 31 dias",onClick:a[2]||(a[2]=e=>k("last_31"))}),o(_,{flat:"","no-caps":"",dense:"",label:"Mês atual",onClick:a[3]||(a[3]=e=>k("month_current"))}),o(_,{flat:"","no-caps":"",dense:"",label:"Mês anterior",onClick:a[4]||(a[4]=e=>k("month_previous"))})]),o(se,{modelValue:v.value,"onUpdate:modelValue":a[5]||(a[5]=e=>v.value=e),range:"",mask:"YYYY-MM-DD",minimal:"",class:"period-date-picker"},null,8,["modelValue"])]),n("div",xe,[o(_,{flat:"","no-caps":"",label:"Cancelar",onClick:te}),o(_,{color:"primary","no-caps":"",label:"Aplicar",onClick:ae})])]),_:1},8,["modelValue"])]),_:1},8,["model-value"])])]),o(ie,{rows:M.value,columns:O,"row-key":"id",loading:L.value,pagination:m.value,"onUpdate:pagination":a[7]||(a[7]=e=>m.value=e),"binary-state-sort":!0,"rows-per-page-options":[10,15,20,25,50],onRequest:S},{"body-cell-created_at":l(e=>[o(u,{props:e},{default:l(()=>[D(d(e.value),1)]),_:2},1032,["props"])]),"body-cell-ip":l(e=>[o(u,{props:e},{default:l(()=>[n("div",De,[n("span",{class:"tw-inline-flex tw-h-3 tw-w-3 tw-rounded-full tw-border tw-border-white/20 tw-shadow-sm",style:B({backgroundColor:T(e.row).color})},[o(ce,{class:"tw-text-xs tw-max-w-xs tw-leading-snug"},{default:l(()=>[D(d(T(e.row).description),1)]),_:2},1024)],4),n("span",Ce,d(T(e.row).label),1),a[8]||(a[8]=n("span",{class:"tw-text-slate-400"},"•",-1)),n("span",null,d(e.value||"-"),1)])]),_:2},1032,["props"])]),"body-cell-campaign_name":l(e=>[o(u,{props:e},{default:l(()=>[D(d(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-traffic_source":l(e=>[o(u,{props:e},{default:l(()=>[n("div",ke,[o(h,{name:I(e.row).icon,size:"18px",style:B({color:I(e.row).color})},null,8,["name","style"]),n("span",null,d(I(e.row).label),1)])]),_:2},1032,["props"])]),"body-cell-device_browser":l(e=>[o(u,{props:e},{default:l(()=>[n("div",Se,[V(e.row)?(c(),p("div",Pe,[o(h,{name:s(e.row).deviceIcon,size:"18px",style:B({color:s(e.row).deviceColor})},null,8,["name","style"]),n("span",null,d(s(e.row).deviceLabel),1)])):s(e.row).browserLabel==="-"?(c(),p("span",$e,"-")):(c(),p("span",Be,d(s(e.row).browserLabel),1)),V(e.row)&&s(e.row).browserLabel&&s(e.row).browserLabel!=="-"?(c(),p("span",Le," • ")):$("",!0),V(e.row)&&s(e.row).browserLabel&&s(e.row).browserLabel!=="-"?(c(),p("div",Re,[s(e.row).browserIcon?(c(),x(h,{key:0,name:s(e.row).browserIcon,size:"18px",style:B({color:s(e.row).browserColor})},null,8,["name","style"])):$("",!0),n("span",null,d(s(e.row).browserLabel),1)])):$("",!0)])]),_:2},1032,["props"])]),"body-cell-country_code":l(e=>[o(u,{props:e},{default:l(()=>[n("div",Ie,[U(e.row)?(c(),p("img",{key:0,src:U(e.row),alt:e.value,class:"country-flag"},null,8,Te)):$("",!0),n("span",null,d(e.value?e.value.toUpperCase():"-"),1)])]),_:2},1032,["props"])]),"body-cell-region_name":l(e=>[o(u,{props:e},{default:l(()=>[D(d(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-city":l(e=>[o(u,{props:e},{default:l(()=>[D(d(e.value||"-"),1)]),_:2},1032,["props"])]),"body-cell-gclid":l(e=>[o(u,{props:e},{default:l(()=>[H(e.value)?(c(),x(P,{key:0,color:"primary",label:"Sim"})):(c(),x(P,{key:1,color:"grey-4","text-color":"dark",label:"Não"}))]),_:2},1032,["props"])]),"body-cell-conversion":l(e=>[o(u,{props:e},{default:l(()=>[J(e.value)?(c(),x(P,{key:0,color:"green",label:"Convertido"})):(c(),x(P,{key:1,color:"grey-4","text-color":"dark",label:"Não convertido"}))]),_:2},1032,["props"])]),_:1},8,["rows","loading","pagination"])]),_:1})],64))}},Qe=ve(Ve,[["__scopeId","data-v-fc6adf85"]]);export{Qe as default};
